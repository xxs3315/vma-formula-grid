var nE=Object.defineProperty;var iE=(t,e,r)=>e in t?nE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var fe=(t,e,r)=>(iE(t,typeof e!="symbol"?e+"":e,r),r);import{P as gt,d as qt,j as Si,aj as El,A as jm,y as yt,D as Ft,h as He,g as it,a1 as Ir,X as or,ai as X,e as st,N as bi,ak as _f,al as aE,G as vc,am as sE}from"./framework.8pNAmyNF.js";const Nt=class Nt{constructor(e){fe(this,"value");if(!e)throw new TypeError("Invalid argument; `value` has no value.");this.value=Nt.EMPTY,e&&Nt.isGuid(e)&&(this.value=e)}static isGuid(e){const r=e.toString();return e&&(e instanceof Nt||Nt.validator.test(r))}static create(){return new Nt([Nt.gen(2),Nt.gen(1),Nt.gen(1),Nt.gen(1),Nt.gen(3)].join("-"))}static createEmpty(){return new Nt("empty-guid")}static parse(e){return new Nt(e)}static raw(){return[Nt.gen(2),Nt.gen(1),Nt.gen(1),Nt.gen(1),Nt.gen(3)].join("-")}static gen(e){let r="";for(let n=0;n<e;n++)r+=((1+Math.random())*65536|0).toString(16).substring(1);return r}equals(e){return Nt.isGuid(e)&&this.value===e.toString()}isEmpty(){return this.value===Nt.EMPTY}toString(){return this.value}};fe(Nt,"validator",/^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$/),fe(Nt,"EMPTY","00000000-0000-0000-0000-000000000000");let Pt=Nt;function oE(t){if(typeof t!="string")return!1;const e="Arial";if(t.toLowerCase()==e.toLowerCase())return!0;const r="a",n=100,i=100,a=100,s=document.createElement("canvas"),l=s.getContext("2d",{willReadFrequently:!0});s.width=i,s.height=a,l.textAlign="center",l.fillStyle="black",l.textBaseline="middle";const u=function(c){l.clearRect(0,0,i,a),l.font=n+"px "+c+", "+e,l.fillText(r,i/2,a/2);const o=l.getImageData(0,0,i,a).data;return[].slice.call(o).filter(function(f){return f!=0})};return u(e).join("")!==u(t).join("")}const kf=[{ch:"Andale Mono",en:"andale mono,monospace"},{ch:"Arial",en:"arial,helvetica,sans-serif"},{ch:"Arial Black",en:"arial black,sans-serif"},{ch:"Book Antiqua",en:"book antiqua,palatino,serif"},{ch:"Comic Sans MS",en:"comic sans ms,sans-serif"},{ch:"Courier New",en:"courier new,courier,monospace"},{ch:"Georgia",en:"georgia,palatino,serif"},{ch:"Helvetica",en:"helvetica,arial,sans-serif"},{ch:"Impact",en:"impact,sans-serif"},{ch:"Symbol",en:"symbol"},{ch:"Tahoma",en:"tahoma,arial,helvetica,sans-serif"},{ch:"Terminal",en:"terminal,monaco,monospace"},{ch:"Times New Roman",en:"times new roman,times,serif"},{ch:"Trebuchet MS",en:"trebuchet ms,geneva,sans-serif"},{ch:"Verdana",en:"verdana,geneva,sans-serif"},{ch:"Webdings",en:"webdings"},{ch:"Wingdings",en:"wingdings,zapf dingbats"}],Pf={windows:[{ch:"宋体",en:"SimSun"},{ch:"黑体",en:"SimHei"},{ch:"微软雅黑",en:"Microsoft Yahei"},{ch:"微软正黑体",en:"Microsoft JhengHei"},{ch:"楷体",en:"KaiTi"},{ch:"新宋体",en:"NSimSun"},{ch:"仿宋",en:"FangSong"}],"OS X":[{ch:"苹方",en:"PingFang SC"},{ch:"华文黑体",en:"STHeiti"},{ch:"华文楷体",en:"STKaiti"},{ch:"华文宋体",en:"STSong"},{ch:"华文仿宋",en:"STFangsong"},{ch:"华文中宋",en:"STZhongsong"},{ch:"华文琥珀",en:"STHupo"},{ch:"华文新魏",en:"STXinwei"},{ch:"华文隶书",en:"STLiti"},{ch:"华文行楷",en:"STXingkai"},{ch:"冬青黑体简",en:"Hiragino Sans GB"},{ch:"兰亭黑-简",en:"Lantinghei SC"},{ch:"翩翩体-简",en:"Hanzipen SC"},{ch:"手札体-简",en:"Hannotate SC"},{ch:"宋体-简",en:"Songti SC"},{ch:"娃娃体-简",en:"Wawati SC"},{ch:"魏碑-简",en:"Weibei SC"},{ch:"行楷-简",en:"Xingkai SC"},{ch:"雅痞-简",en:"Yapi SC"},{ch:"圆体-简",en:"Yuanti SC"}],office:[{ch:"幼圆",en:"YouYuan"},{ch:"隶书",en:"LiSu"},{ch:"华文细黑",en:"STXihei"},{ch:"华文楷体",en:"STKaiti"},{ch:"华文宋体",en:"STSong"},{ch:"华文仿宋",en:"STFangsong"},{ch:"华文中宋",en:"STZhongsong"},{ch:"华文彩云",en:"STCaiyun"},{ch:"华文琥珀",en:"STHupo"},{ch:"华文新魏",en:"STXinwei"},{ch:"华文隶书",en:"STLiti"},{ch:"华文行楷",en:"STXingkai"},{ch:"方正舒体",en:"FZShuTi"},{ch:"方正姚体",en:"FZYaoti"}],open:[{ch:"思源黑体",en:"Source Han Sans CN"},{ch:"思源宋体",en:"Source Han Serif SC"},{ch:"文泉驿微米黑",en:"WenQuanYi Micro Hei"}]},Qh=()=>{const t=[];return kf.map(e=>{t.push(e)}),Object.values(Pf).forEach(e=>{e.forEach(r=>{oE(r.en)&&t.push(r)})}),t},wa=t=>{let e="";return kf.forEach(r=>{r.ch===t&&(e=r.en)}),Object.values(Pf).forEach(r=>{r.forEach(n=>{n.ch===t&&(e=n.en)})}),e},lE=t=>{let e="";return kf.forEach(r=>{r.en===t&&(e=r.ch)}),Object.values(Pf).forEach(r=>{r.forEach(n=>{n.en===t&&(e=n.ch)})}),e},Kh=()=>[6,8,9,10,11,12,14,16,18,20,22,24,26,28,32,64,72,144,288],jh=()=>({n:{general:"0.00",percent:"0.00%",science:"0.00E+0",fraction:"0/0",thousands:"###,###"},d:{time:"hh:mm:ss AM/PM",shortDate:"yyyy-mm-dd dddd",longDate:"yyyy-mm-dd hh:mm:ss AM/PM"},c:{cny:'#,##0.00" ¥"',usd:"$#,##0.00",euro:'#,##0" €"',others:[{key:"英镑",value:'"£ "#,##0.00'},{key:"韩元",value:'"₩ "#,##0.00'}]}});function Uo(t){return typeof t=="number"||/^\d+(\.\d+)?$/.test(t)}function Zm(t){return Number.isNaN?Number.isNaN(t):t!==t}function cE(t){return Object.prototype.toString.call(t)==="[object Object]"}function Jm(t,e){if(t){if(e==="large")return Math.max(144,t);if(e==="normal")return Math.max(132,t);if(e==="small")return Math.max(120,t);if(e==="mini")return Math.max(108,t)}else{if(e==="large")return 144;if(e==="normal")return 132;if(e==="small")return 120;if(e==="mini")return 108}return 132}function e0(t,e){if(t){if(e==="large")return Math.max(32,t);if(e==="normal")return Math.max(28,t);if(e==="small")return Math.max(24,t);if(e==="mini")return Math.max(20,t)}else{if(e==="large")return 32;if(e==="normal")return 28;if(e==="small")return 24;if(e==="mini")return 20}return 28}function Zh(t){return t==="large"?14:t==="normal"?12:t==="small"?10:t==="mini"?8:12}const Re=t=>{let e=t,r="";do{e--;const n=e%26;r+=String.fromCharCode(n+65),e=Math.trunc((e-n)/26)}while(e>0);return r.split("").reverse().join("")},le=t=>{let e="",r=65;return t.toUpperCase().split("").forEach(n=>{const i=n.charCodeAt(0),a=i-r+1;a>9?e+=String.fromCharCode(i-9):e+=a.toString()}),parseInt(e,26)},uE=(t,e,r,n)=>{if(Object.keys(r).length&&Object.keys(n).length){let i=0,a=0;do n[`${i+1}`]===0?a+=0:r[`${i+1}`]?a+=r[`${i+1}`]:a+=e,i++;while(t>=a);return i-1}if(Object.keys(r).length){let i=0,a=0;do a+=r[`${i+1}`]?r[`${i+1}`]:e,i++;while(t>=a);return i-1}if(Object.keys(n).length){let i=0,a=0;do a+=n[`${i+1}`]===0?0:e,i++;while(t>=a);return i-1}return Math.floor(t/e)},fE=(t,e,r,n,i)=>{let a=0,s=0;for(;s<t;)s+=i[`${e+a+1}`]===0?0:n[`${e+a+1}`]?n[`${e+a+1}`]:r,a++;return a},hE=(t,e,r,n)=>{if(Object.keys(r).length&&Object.keys(n).length){let i=0,a=0;do n[`${i+1}`]===0?a+=0:r[`${i+1}`]?a+=r[`${i+1}`]:a+=e,i++;while(t>=a);return i-1}if(Object.keys(r).length){let i=0,a=0;do a+=r[`${i+1}`]?r[`${i+1}`]:e,i++;while(t>=a);return i-1}if(Object.keys(n).length){let i=0,a=0;do a+=n[`${i+1}`]===0?0:e,i++;while(t>=a);return i-1}return Math.floor(t/e)},dE=(t,e,r,n,i)=>{let a=0,s=0;for(;s<t;)s+=i[`${e+a+1}`]===0?0:n[`${e+a+1}`]?n[`${e+a+1}`]:r,a++;return a},Eo=(t,e,r,n)=>{if(Object.keys(r).length&&Object.keys(n).length){let i=0,a=0;for(;t>i;)n[`${i+1}`]===0?a+=0:r[`${i+1}`]?a+=r[`${i+1}`]:a+=e,i++;return a}if(Object.keys(r).length){let i=0,a=0;for(;t>i;)a+=r[`${i+1}`]?r[`${i+1}`]:e,i++;return a}if(Object.keys(n).length){let i=0,a=0;for(;t>i;)a+=n[`${i+1}`]===0?0:e,i++;return a}return Math.max(0,(t-1)*e)},Oo=(t,e,r,n)=>{if(Object.keys(r).length&&Object.keys(n).length){let i=0,a=0;for(;t>i;)n[`${i+1}`]===0?a+=0:r[`${i+1}`]?a+=r[`${i+1}`]:a+=e,i++;return a}if(Object.keys(r).length){let i=0,a=0;for(;t>i;)a+=r[`${i+1}`]?r[`${i+1}`]:e,i++;return a}if(Object.keys(n).length){let i=0,a=0;for(;t>i;)a+=n[`${i+1}`]===0?0:e,i++;return a}return Math.max(0,t*e)},Jh=(t,e,r,n,i)=>{let a=0;if(Object.keys(n).length&&Object.keys(i).length){for(const s in Object.keys(n))n.hasOwnProperty(Object.keys(n)[s])&&(a+=n[Object.keys(n)[s]]-r);for(const s in Object.keys(i))i.hasOwnProperty(Object.keys(i)[s])&&(n[Object.keys(i)[s]]?a-=n[Object.keys(i)[s]]:a-=r)}else if(Object.keys(n).length)for(const s in Object.keys(n))n.hasOwnProperty(Object.keys(n)[s])&&(a+=n[Object.keys(n)[s]]-r);else if(Object.keys(i).length)for(const s in Object.keys(i))i.hasOwnProperty(Object.keys(i)[s])&&(a-=r);return t+(e-1)*r+a},pE=(t,e,r,n)=>{let i=0;if(Object.keys(r).length&&Object.keys(n).length){for(const a in Object.keys(r))r.hasOwnProperty(Object.keys(r)[a])&&(i+=r[Object.keys(r)[a]]-e);for(const a in Object.keys(n))n.hasOwnProperty(Object.keys(n)[a])&&(r[Object.keys(n)[a]]?i-=r[Object.keys(n)[a]]:i-=e)}else if(Object.keys(r).length)for(const a in Object.keys(r))r.hasOwnProperty(Object.keys(r)[a])&&(i+=r[Object.keys(r)[a]]-e);else if(Object.keys(n).length)for(const a in Object.keys(n))n.hasOwnProperty(Object.keys(n)[a])&&(i-=e);return t*e+i};class xr{constructor(...e){fe(this,"head");fe(this,"tail");fe(this,"size");this.head=null,this.tail=null,this.size=0;for(let r=0;r<e.length;r++)this.append(e[r])}get length(){return this.size}static from(e){return new xr(...e)}get(e){const r=this.getNode(e);return r!==void 0?r.data:void 0}getNode(e){if(this.head===null||e<0||e>=this.length)return;const r=e<this.length/2,n=r?e:this.length-e-1,i=r?"next":"prev";let a=r?this.head:this.tail;for(let s=0;s<n;s++)a=a[i];return a}findNodeIndex(e){let r=0,n=this.head;for(;n;){if(e(n.data,r,this))return{index:r,node:n};n=n.next,r+=1}}findNode(e){const r=this.findNodeIndex(e);return r!==void 0?r.node:void 0}find(e){const r=this.findNodeIndex(e);return r!==void 0?r.node.data:void 0}findIndex(e){const r=this.findNodeIndex(e);return r!==void 0?r.index:-1}append(...e){for(const r of e){const n=new Fs(r,this.tail,null,this);this.head===null&&(this.head=n),this.tail!==null&&(this.tail.next=n),this.tail=n,this.size+=1}return this}push(...e){return this.append(...e),this.length}prepend(...e){const r=Array.from(e).reverse();for(const n of r){const i=new Fs(n,null,this.head,this);this.tail===null&&(this.tail=i),this.head!==null&&(this.head.prev=i),this.head=i,this.size+=1}return this}insertAt(e,r){if(this.head===null)return this.append(r);if(e<=0)return this.prepend(r);let n=this.head,i=0;for(;i<e-1&&n.next!==null;)i+=1,n=n.next;return n.insertAfter(r),this}removeNode(e){if(e.list!==this)throw new ReferenceError("Node does not belong to this list");return e.prev!==null&&(e.prev.next=e.next),e.next!==null&&(e.next.prev=e.prev),this.head===e&&(this.head=e.next),this.tail===e&&(this.tail=e.prev),this.size-=1,e.next=null,e.prev=null,e.list=null,e}removeAt(e){const r=this.getNode(e);return r!==void 0?this.removeNode(r):void 0}insertBefore(e,r){const n=new Fs(r,e.prev,e,this);return e.prev===null&&(this.head=n),e.prev!==null&&(e.prev.next=n),e.prev=n,this.size+=1,this}sort(e){if(this.head===null||this.tail===null)return this;if(this.length<2)return this;const r=(n,i)=>{if(n===i)return;const a=i.data;let s=n,l=n;for(;s&&s!==i;){if(e(s.data,a)){if(s!==l){const c=l.data;l.data=s.data,s.data=c}l=l.next}s=s.next}i.data=l.data,l.data=a,n.next!==i.prev&&(l.prev&&l!==n&&r(n,l.prev),l.next&&l!==i&&r(l.next,i))};return r(this.head,this.tail),this}insertAfter(e,r){const n=new Fs(r,e,e.next,this);return e.next===null&&(this.tail=n),e.next!==null&&(e.next.prev=n),e.next=n,this.size+=1,this}shift(){return this.removeFromAnyEnd(this.head)}pop(){return this.removeFromAnyEnd(this.tail)}merge(e){this.tail!==null&&(this.tail.next=e.head),e.head!==null&&(e.head.prev=this.tail),this.head=this.head||e.head,this.tail=e.tail||this.tail,this.size+=e.size,e.size=this.size,e.head=this.head,e.tail=this.tail}clear(){return this.head=null,this.tail=null,this.size=0,this}slice(e,r){const n=new xr;let i=r;if(this.head===null||this.tail===null)return n;(i===void 0||i<e)&&(i=this.length);let a=this.getNode(e);for(let s=0;s<i-e&&a!==null&&a!==void 0;s++)n.append(a.data),a=a.next;return n}reverse(){let e=this.head;for(;e;){const n=e.next;e.next=e.prev,e.prev=n,e=e.prev}const r=this.tail;return this.tail=this.head,this.head=r,this}forEach(e,r=!1){let n=r?this.length-1:0,i=r?this.tail:this.head;const a=r?-1:1,s=r?"prev":"next";for(;i;)e(i.data,n,this),i=i[s],n+=a}map(e,r=!1){const n=new xr;return this.forEach((i,a)=>n.append(e(i,a,this)),r),n}filter(e,r=!1){const n=new xr;return this.forEach((i,a)=>{e(i,a,this)&&n.append(i)},r),n}reduce(e,r,n=!1){let i=n?this.length-1:0;const a=n?-1:1,s=n?"prev":"next";let l=n?this.tail:this.head,u;if(r!==void 0)u=r;else if(l)u=l.data,l=l[s];else throw new TypeError("Reduce of empty ll with no initial value");for(;l;)u=e(u,l.data,i,this),i+=a,l=l[s];return u}toArray(){return[...this]}toString(e=" "){return this.reduce((r,n)=>`${r}${e}${n}`)}*[Symbol.iterator](){let e=this.head;for(;e!==null;)yield e.data,e=e.next}removeFromAnyEnd(e){return e!==null?this.removeNode(e).data:void 0}}class Fs{constructor(e,r,n,i){this.data=e,this.prev=r,this.next=n,this.list=i}get value(){return this.data}get index(){if(this.list)return this.list.findIndex(e=>e===this.value)}insertBefore(e){return this.list!==null?this.list.insertBefore(this,e):new xr(e,this.data)}insertAfter(e){return this.list!==null?this.list.insertAfter(this,e):new xr(this.data,e)}remove(){if(this.list===null)throw new ReferenceError("Node does not belong to any list");return this.list.removeNode(this)}}class gE{constructor(e){fe(this,"_v");fe(this,"_e");fe(this,"_g");fe(this,"_aj");fe(this,"ae",(e,r)=>{this._aj.get(e).append(r),this._e++});this._g=e;const r=Object.keys(this._g);this._v=r.length,this._e=0,this._aj=xr.from([...Array.from({length:this._v},()=>new xr)]),this._aj.forEach((n,i)=>{this._g[r[i]].children.forEach(a=>{this.ae(i,r.indexOf(a))})})}get v(){return this._v}set v(e){this._v=e}get e(){return this._e}set e(e){this._e=e}get g(){return this._g}set g(e){this._g=e}get aj(){return this._aj}set aj(e){this._aj=e}}class mE{constructor(e){fe(this,"_m");fe(this,"_et");fe(this,"_cy",[]);fe(this,"_os");fe(this,"hc",()=>this._cy!==null&&this._cy!==void 0&&this._cy.length>0);fe(this,"dfp",(e,r)=>{this._m[r]=!0,this._os[r]=!0,e.aj.get(r)&&e.aj.get(r).forEach(n=>{if(this._cy===null||this._cy===void 0||this._cy.length===0){if(!this._m[n])this._et[n]=r,this.dfp(e,n);else if(this._os[n]){for(let i=r;i!==n;i=this._et[i])this._cy.push(i);this._cy.push(n),this._cy.push(r)}}}),this._os[r]=!1});this._m=Array.from({length:e.v}),this._et=Array.from({length:e.v}),this._os=Array.from({length:e.v});for(let r=0;r<e.v;r++)this._m[r]||this.dfp(e,r)}get m(){return this._m}set m(e){this._m=e}get et(){return this._et}set et(e){this._et=e}get c(){return this._cy}set c(e){this._cy=e}get os(){return this._os}set os(e){this._os=e}}class vE{constructor(e){fe(this,"_m");fe(this,"_f");fe(this,"_b");fe(this,"_rb");fe(this,"dfp",(e,r)=>{this._f.append(r),this._m[r]=!0,e.aj.get(r)&&e.aj.get(r).forEach(n=>{this._m[n]||this.dfp(e,n)}),this._b.append(r),this._rb.push(r)});this._f=new xr,this._b=new xr,this._rb=new xr,this._m=Array.from({length:e.v});for(let r=0;r<e.v;r++)this._m[r]||this.dfp(e,r)}get m(){return this._m}set m(e){this._m=e}get f(){return this._f}set f(e){this._f=e}get b(){return this._b}set b(e){this._b=e}get rb(){return this._rb}set rb(e){this._rb=e}}function t0(t,e){const r=Object.keys(t);if(r.length===0)return{noErrorVertexes:t,errorMap:e};const n=Object.keys(e);let i=!1;for(let a=0;a<r.length;a++){if(t.hasOwnProperty(r[a])&&t[r[a]].children&&t[r[a]].children.length>0&&t[r[a]].children.find(l=>n.indexOf(l)>=0)){i=!0,e[r[a]]=t[r[a]],delete t[r[a]];break}i&&t0(t,e)}return{noErrorVertexes:t,errorMap:e}}function r0(t,e){const r=Object.keys(t);let n;const i=new gE(t),a=new mE(i);if(a.hc()){for(let s=0;s<a.c.length;s++)e.hasOwnProperty(r[a.c[s]])||(e[r[a.c[s]]]=[t[r[a.c[s]]]].concat()[0],delete t[r[a.c[s]]]);n=r0(t,e)}else{const s=new vE(i),l=[];s.rb&&s.rb.length>0&&s.rb.forEach(u=>{l.push(r[u])}),n={g:i,topological:l,noCycleVertexes:t,cycleVertexes:e}}return n}function yE(t,e,r){const n=Object.keys(r);for(let i=0;i<n.length;i++)if(n[i].startsWith(`${t}_${e}:`))return{rowSpan:r[n[i]].rowSpan,colSpan:r[n[i]].colSpan};return{rowSpan:1,colSpan:1}}function gi(t,e,r){const n=Object.keys(r);for(let i=0;i<n.length;i++)if(t>r[n[i]].colStart&&t<=r[n[i]].colEnd&&e>=r[n[i]].rowStart&&e<=r[n[i]].rowEnd||t>=r[n[i]].colStart&&t<=r[n[i]].colEnd&&e>r[n[i]].rowStart&&e<=r[n[i]].rowEnd)return!0;return!1}function n0(t,e,r,n,i,a,s,l){const u=Math.min(l.start.col,l.end.col),c=Math.max(l.start.col,l.end.col),o=Math.min(l.start.row,l.end.row),f=Math.max(l.start.row,l.end.row);let h=1,d=1;l.start.row===f&&l.start.col===c?(l.start.colSpan,l.start.rowSpan,h=l.end.colSpan,d=l.end.rowSpan):(l.end.colSpan,l.end.rowSpan,h=l.start.colSpan,d=l.start.rowSpan);const p={w:0,h:0,sci:-1,eci:-1,sri:-1,eri:-1,startRowIndex:o,startColIndex:u};if(u===c&&o===f){let g=[];Object.keys(s).forEach(m=>{let v=!1,b=!1,C=[Math.min(u+1,c+1),Math.min(s[m].colStart,s[m].colEnd)],A=[Math.max(u+1,c+1),Math.max(s[m].colStart,s[m].colEnd)];Math.max(...C)<=Math.min(...A)&&(v=!0);let O=[Math.min(o+1,f+1),Math.min(s[m].rowStart,s[m].rowEnd)],w=[Math.max(o+1,f+1),Math.max(s[m].rowStart,s[m].rowEnd)];Math.max(...O)<=Math.min(...w)&&(b=!0),v&&b&&g.push(s[m])}),g.length>0?(p.w=Vs(u,u+h-1,t,e,r),p.h=Ws(o,o+d-1,n,i,a),p.sci=u,p.eci=u+h-1,p.sri=o,p.eri=o+d-1):(p.w=Vs(u,c,t,e,r),p.h=Ws(o,f,n,i,a),p.sci=u,p.eci=c,p.sri=o,p.eri=f)}else{let g=[],m=u,v=c,b=o,C=f;const A=Object.assign({},s);let O=Object.keys(A);for(;O.length>0;){let w=!1,S=!1,N=[Math.min(m+1,v+1),Math.min(s[O[0]].colStart,s[O[0]].colEnd)],R=[Math.max(m+1,v+1),Math.max(s[O[0]].colStart,s[O[0]].colEnd)];Math.max(...N)<=Math.min(...R)&&(w=!0);let k=[Math.min(b+1,C+1),Math.min(s[O[0]].rowStart,s[O[0]].rowEnd)],z=[Math.max(b+1,C+1),Math.max(s[O[0]].rowStart,s[O[0]].rowEnd)];Math.max(...k)<=Math.min(...z)&&(S=!0),w&&S&&(g.push(s[O[0]]),m=Math.min(m,s[O[0]].colStart-1),v=Math.max(v,s[O[0]].colEnd-1),b=Math.min(b,s[O[0]].rowStart-1),C=Math.max(C,s[O[0]].rowEnd-1)),Object.keys(s).forEach(Y=>{if(Y!==O[0]){let re=!1,Q=!1,ae=[Math.min(m+1,v+1),Math.min(s[Y].colStart,s[Y].colEnd)],ve=[Math.max(m+1,v+1),Math.max(s[Y].colStart,s[Y].colEnd)];Math.max(...ae)<=Math.min(...ve)&&(re=!0);let J=[Math.min(b+1,C+1),Math.min(s[Y].rowStart,s[Y].rowEnd)],ne=[Math.max(b+1,C+1),Math.max(s[Y].rowStart,s[Y].rowEnd)];Math.max(...J)<=Math.min(...ne)&&(Q=!0),re&&Q&&(g.push(s[Y]),m=Math.min(m,s[Y].colStart-1),v=Math.max(v,s[Y].colEnd-1),b=Math.min(b,s[Y].rowStart-1),C=Math.max(C,s[Y].rowEnd-1))}}),O.splice(0,1)}g.length>0?(p.w=Vs(m,v,t,e,r),p.h=Ws(b,C,n,i,a),p.sci=m,p.eci=v,p.sri=b,p.eri=C,p.startRowIndex=b,p.startColIndex=m):(p.w=Vs(u,c,t,e,r),p.h=Ws(o,f,n,i,a),p.sci=u,p.eci=c,p.sri=o,p.eri=f)}return p}const Vs=(t,e,r,n,i)=>{let a=0;for(let s=t;s<=e;s++)Object.keys(i).length&&i[`${s+1}`]===0?a+=0:Object.keys(n).length&&n[`${s+1}`]?a+=n[`${s+1}`]:a+=r;return a},Ws=(t,e,r,n,i)=>{let a=0;for(let s=t;s<=e;s++)Object.keys(i).length&&i[`${s+1}`]===0?a+=0:Object.keys(n).length&&n[`${s+1}`]?a+=n[`${s+1}`]:a+=r;return a};function ed(t,e,r){return Object.keys(e).forEach(n=>{t>e[n].colStart&&t<e[n].colEnd&&(r==="min"&&(t=e[n].colStart),r==="max"&&(t=e[n].colEnd))}),t}function td(t,e,r){return Object.keys(e).forEach(n=>{t+1>e[n].rowStart&&t+1<e[n].rowEnd&&(r==="min"&&(t=e[n].rowStart-1),r==="max"&&(t=e[n].rowEnd+1))}),t}function yc(t,e,r){let n={g:"",gf:""};if(r&&r.length>0){let i="",a="";r.forEach(s=>{if(s.type==="columns")s.p&&s.p.length>0&&s.p.forEach(l=>{if(l.indexOf(":")>=0){const u=l.split(":");t+1>=le(u[0])&&t+1<=le(u[1])&&(a=s.details.hasOwnProperty("v")?s.details.v:"",i=a===""?"":s.details.type)}else Re(t+1)===l.toUpperCase()&&(a=s.details.hasOwnProperty("v")?s.details.v:"",i=a===""?"":s.details.type)});else if(s.type==="rows")s.p&&s.p.length>0&&s.p.forEach(l=>{if(typeof l=="string"&&l.indexOf(":")>=0){let u=l.split(":");u=u.map(Number),e+1>=u[0]&&e+1<=u[1]&&(a=s.details.hasOwnProperty("v")?s.details.v:"",i=a===""?"":s.details.type)}typeof l=="number"&&e+1===l&&(a=s.details.hasOwnProperty("v")?s.details.v:"",i=a===""?"":s.details.type)});else if(s.type==="cells")if(s.p.indexOf(":")>=0){const l=s.p.split(":");let u=le(l[0].replace(/[0-9]/g,"")),c=le(l[1].replace(/[0-9]/g,"")),o=parseInt(l[0].replace(/[^0-9]/gi,"")),f=parseInt(l[1].replace(/[^0-9]/gi,""));(t+1>=u&&t+1<=c&&e+1>=o&&e+1<=f||t+1>=c&&t+1<=u&&e+1>=o&&e+1<=f||t+1>=u&&t+1<=c&&e+1>=f&&e+1<=o||t+1>=c&&t+1<=u&&e+1>=f&&e+1<=o)&&(a=s.details.hasOwnProperty("v")?s.details.v:"",i=a===""?"":s.details.type)}else{let l=le(s.p.replace(/[0-9]/g,"")),u=parseInt(s.p.replace(/[^0-9]/gi,""));t+1===l&&e+1===u&&(a=s.details.hasOwnProperty("v")?s.details.v:"",i=a===""?"":s.details.type)}}),n.g=i,n.gf=a}return n}function ni(t,e,r){let n={fg:"",bg:"",b:!1,i:!1,u:!1,ff:null,fs:null};if(r.hasOwnProperty("bgc")&&r.bgc.length>0){let i="";r.bgc.forEach(a=>{if(a.type==="columns")a.p&&a.p.length>0&&a.p.forEach(s=>{if(s.indexOf(":")>=0){const l=s.split(":");t+1>=le(l[0])&&t+1<=le(l[1])&&(i=!a.hasOwnProperty("color")||a.color==="none"?"":a.color)}else Re(t+1)===s.toUpperCase()&&(i=!a.hasOwnProperty("color")||a.color==="none"?"":a.color)});else if(a.type==="rows")a.p&&a.p.length>0&&a.p.forEach(s=>{if(typeof s=="string"&&s.indexOf(":")>=0){let l=s.split(":");l=l.map(Number),e+1>=l[0]&&e+1<=l[1]&&(i=!a.hasOwnProperty("color")||a.color==="none"?"":a.color)}typeof s=="number"&&e+1===s&&(i=!a.hasOwnProperty("color")||a.color==="none"?"":a.color)});else if(a.type==="cells")if(a.p.indexOf(":")>=0){const s=a.p.split(":");let l=le(s[0].replace(/[0-9]/g,"")),u=le(s[1].replace(/[0-9]/g,"")),c=parseInt(s[0].replace(/[^0-9]/gi,"")),o=parseInt(s[1].replace(/[^0-9]/gi,""));(t+1>=l&&t+1<=u&&e+1>=c&&e+1<=o||t+1>=u&&t+1<=l&&e+1>=c&&e+1<=o||t+1>=l&&t+1<=u&&e+1>=o&&e+1<=c||t+1>=u&&t+1<=l&&e+1>=o&&e+1<=c)&&(i=a.color==="none"?"":a.color)}else{let s=le(a.p.replace(/[0-9]/g,"")),l=parseInt(a.p.replace(/[^0-9]/gi,""));t+1===s&&e+1===l&&(i=a.color==="none"?"":a.color)}}),n.bg=i}if(r.hasOwnProperty("fgc")&&r.fgc.length>0){let i="";r.fgc.forEach(a=>{if(a.type==="columns")a.p&&a.p.length>0&&a.p.forEach(s=>{if(s.indexOf(":")>=0){const l=s.split(":");t+1>=le(l[0])&&t+1<=le(l[1])&&(i=!a.hasOwnProperty("color")||a.color==="none"?"":a.color)}else Re(t+1)===s.toUpperCase()&&(i=!a.hasOwnProperty("color")||a.color==="none"?"":a.color)});else if(a.type==="rows")a.p&&a.p.length>0&&a.p.forEach(s=>{if(typeof s=="string"&&s.indexOf(":")>=0){let l=s.split(":");l=l.map(Number),e+1>=l[0]&&e+1<=l[1]&&(i=!a.hasOwnProperty("color")||a.color==="none"?"":a.color)}typeof s=="number"&&e+1===s&&(i=!a.hasOwnProperty("color")||a.color==="none"?"":a.color)});else if(a.type==="cells")if(a.p.indexOf(":")>=0){const s=a.p.split(":");let l=le(s[0].replace(/[0-9]/g,"")),u=le(s[1].replace(/[0-9]/g,"")),c=parseInt(s[0].replace(/[^0-9]/gi,"")),o=parseInt(s[1].replace(/[^0-9]/gi,""));(t+1>=l&&t+1<=u&&e+1>=c&&e+1<=o||t+1>=u&&t+1<=l&&e+1>=c&&e+1<=o||t+1>=l&&t+1<=u&&e+1>=o&&e+1<=c||t+1>=u&&t+1<=l&&e+1>=o&&e+1<=c)&&(i=a.color==="none"?"":a.color)}else{let s=le(a.p.replace(/[0-9]/g,"")),l=parseInt(a.p.replace(/[^0-9]/gi,""));t+1===s&&e+1===l&&(i=a.color==="none"?"":a.color)}}),n.fg=i}if(r.hasOwnProperty("b")&&r.b.length>0){let i=!1;r.b.forEach(a=>{if(a.type==="columns")a.p&&a.p.length>0&&a.p.forEach(s=>{if(s.indexOf(":")>=0){const l=s.split(":");t+1>=le(l[0])&&t+1<=le(l[1])&&(i=a.hasOwnProperty("v")&&a.v)}else Re(t+1)===s.toUpperCase()&&(i=a.hasOwnProperty("v")&&a.v)});else if(a.type==="rows")a.p&&a.p.length>0&&a.p.forEach(s=>{if(typeof s=="string"&&s.indexOf(":")>=0){let l=s.split(":");l=l.map(Number),e+1>=l[0]&&e+1<=l[1]&&(i=a.hasOwnProperty("v")&&a.v)}typeof s=="number"&&e+1===s&&(i=a.hasOwnProperty("v")&&a.v)});else if(a.type==="cells")if(a.p.indexOf(":")>=0){const s=a.p.split(":");let l=le(s[0].replace(/[0-9]/g,"")),u=le(s[1].replace(/[0-9]/g,"")),c=parseInt(s[0].replace(/[^0-9]/gi,"")),o=parseInt(s[1].replace(/[^0-9]/gi,""));(t+1>=l&&t+1<=u&&e+1>=c&&e+1<=o||t+1>=u&&t+1<=l&&e+1>=c&&e+1<=o||t+1>=l&&t+1<=u&&e+1>=o&&e+1<=c||t+1>=u&&t+1<=l&&e+1>=o&&e+1<=c)&&(i=a.hasOwnProperty("v")&&a.v)}else{let s=le(a.p.replace(/[0-9]/g,"")),l=parseInt(a.p.replace(/[^0-9]/gi,""));t+1===s&&e+1===l&&(i=a.hasOwnProperty("v")&&a.v)}}),n.b=i}if(r.hasOwnProperty("i")&&r.i.length>0){let i=!1;r.i.forEach(a=>{if(a.type==="columns")a.p&&a.p.length>0&&a.p.forEach(s=>{if(s.indexOf(":")>=0){const l=s.split(":");t+1>=le(l[0])&&t+1<=le(l[1])&&(i=a.hasOwnProperty("v")&&a.v)}else Re(t+1)===s.toUpperCase()&&(i=a.hasOwnProperty("v")&&a.v)});else if(a.type==="rows")a.p&&a.p.length>0&&a.p.forEach(s=>{if(typeof s=="string"&&s.indexOf(":")>=0){let l=s.split(":");l=l.map(Number),e+1>=l[0]&&e+1<=l[1]&&(i=a.hasOwnProperty("v")&&a.v)}typeof s=="number"&&e+1===s&&(i=a.hasOwnProperty("v")&&a.v)});else if(a.type==="cells")if(a.p.indexOf(":")>=0){const s=a.p.split(":");let l=le(s[0].replace(/[0-9]/g,"")),u=le(s[1].replace(/[0-9]/g,"")),c=parseInt(s[0].replace(/[^0-9]/gi,"")),o=parseInt(s[1].replace(/[^0-9]/gi,""));(t+1>=l&&t+1<=u&&e+1>=c&&e+1<=o||t+1>=u&&t+1<=l&&e+1>=c&&e+1<=o||t+1>=l&&t+1<=u&&e+1>=o&&e+1<=c||t+1>=u&&t+1<=l&&e+1>=o&&e+1<=c)&&(i=a.hasOwnProperty("v")&&a.v)}else{let s=le(a.p.replace(/[0-9]/g,"")),l=parseInt(a.p.replace(/[^0-9]/gi,""));t+1===s&&e+1===l&&(i=a.hasOwnProperty("v")&&a.v)}}),n.i=i}if(r.hasOwnProperty("u")&&r.u.length>0){let i=!1;r.u.forEach(a=>{if(a.type==="columns")a.p&&a.p.length>0&&a.p.forEach(s=>{if(s.indexOf(":")>=0){const l=s.split(":");t+1>=le(l[0])&&t+1<=le(l[1])&&(i=a.hasOwnProperty("v")&&a.v)}else Re(t+1)===s.toUpperCase()&&(i=a.hasOwnProperty("v")&&a.v)});else if(a.type==="rows")a.p&&a.p.length>0&&a.p.forEach(s=>{if(typeof s=="string"&&s.indexOf(":")>=0){let l=s.split(":");l=l.map(Number),e+1>=l[0]&&e+1<=l[1]&&(i=a.hasOwnProperty("v")&&a.v)}typeof s=="number"&&e+1===s&&(i=a.hasOwnProperty("v")&&a.v)});else if(a.type==="cells")if(a.p.indexOf(":")>=0){const s=a.p.split(":");let l=le(s[0].replace(/[0-9]/g,"")),u=le(s[1].replace(/[0-9]/g,"")),c=parseInt(s[0].replace(/[^0-9]/gi,"")),o=parseInt(s[1].replace(/[^0-9]/gi,""));(t+1>=l&&t+1<=u&&e+1>=c&&e+1<=o||t+1>=u&&t+1<=l&&e+1>=c&&e+1<=o||t+1>=l&&t+1<=u&&e+1>=o&&e+1<=c||t+1>=u&&t+1<=l&&e+1>=o&&e+1<=c)&&(i=a.hasOwnProperty("v")&&a.v)}else{let s=le(a.p.replace(/[0-9]/g,"")),l=parseInt(a.p.replace(/[^0-9]/gi,""));t+1===s&&e+1===l&&(i=a.hasOwnProperty("v")&&a.v)}}),n.u=i}if(r.hasOwnProperty("ff")&&r.u.length>0){let i="";r.ff.forEach(a=>{if(a.type==="columns")a.p&&a.p.length>0&&a.p.forEach(s=>{if(s.indexOf(":")>=0){const l=s.split(":");t+1>=le(l[0])&&t+1<=le(l[1])&&(i=a.hasOwnProperty("v")&&a.v!=="none"?wa(a.v):null)}else Re(t+1)===s.toUpperCase()&&(i=a.hasOwnProperty("v")&&a.v!=="none"?wa(a.v):null)});else if(a.type==="rows")a.p&&a.p.length>0&&a.p.forEach(s=>{if(typeof s=="string"&&s.indexOf(":")>=0){let l=s.split(":");l=l.map(Number),e+1>=l[0]&&e+1<=l[1]&&(i=a.hasOwnProperty("v")&&a.v!=="none"?wa(a.v):null)}typeof s=="number"&&e+1===s&&(i=a.hasOwnProperty("v")&&a.v!=="none"?wa(a.v):null)});else if(a.type==="cells")if(a.p.indexOf(":")>=0){const s=a.p.split(":");let l=le(s[0].replace(/[0-9]/g,"")),u=le(s[1].replace(/[0-9]/g,"")),c=parseInt(s[0].replace(/[^0-9]/gi,"")),o=parseInt(s[1].replace(/[^0-9]/gi,""));(t+1>=l&&t+1<=u&&e+1>=c&&e+1<=o||t+1>=u&&t+1<=l&&e+1>=c&&e+1<=o||t+1>=l&&t+1<=u&&e+1>=o&&e+1<=c||t+1>=u&&t+1<=l&&e+1>=o&&e+1<=c)&&(i=a.hasOwnProperty("v")&&a.v)}else{let s=le(a.p.replace(/[0-9]/g,"")),l=parseInt(a.p.replace(/[^0-9]/gi,""));t+1===s&&e+1===l&&(i=a.hasOwnProperty("v")&&a.v!=="none"?wa(a.v):null)}}),n.ff=i}if(r.hasOwnProperty("fs")&&r.u.length>0){let i=null;r.fs.forEach(a=>{if(a.type==="columns")a.p&&a.p.length>0&&a.p.forEach(s=>{if(s.indexOf(":")>=0){const l=s.split(":");t+1>=le(l[0])&&t+1<=le(l[1])&&(i=a.hasOwnProperty("v")&&a.v!=="none"?a.v:null)}else Re(t+1)===s.toUpperCase()&&(i=a.hasOwnProperty("v")&&a.v!=="none"?a.v:null)});else if(a.type==="rows")a.p&&a.p.length>0&&a.p.forEach(s=>{if(typeof s=="string"&&s.indexOf(":")>=0){let l=s.split(":");l=l.map(Number),e+1>=l[0]&&e+1<=l[1]&&(i=a.hasOwnProperty("v")&&a.v!=="none"?a.v:null)}typeof s=="number"&&e+1===s&&(i=a.hasOwnProperty("v")&&a.v!=="none"?a.v:null)});else if(a.type==="cells")if(a.p.indexOf(":")>=0){const s=a.p.split(":");let l=le(s[0].replace(/[0-9]/g,"")),u=le(s[1].replace(/[0-9]/g,"")),c=parseInt(s[0].replace(/[^0-9]/gi,"")),o=parseInt(s[1].replace(/[^0-9]/gi,""));(t+1>=l&&t+1<=u&&e+1>=c&&e+1<=o||t+1>=u&&t+1<=l&&e+1>=c&&e+1<=o||t+1>=l&&t+1<=u&&e+1>=o&&e+1<=c||t+1>=u&&t+1<=l&&e+1>=o&&e+1<=c)&&(i=a.hasOwnProperty("v")&&a.v)}else{let s=le(a.p.replace(/[0-9]/g,"")),l=parseInt(a.p.replace(/[^0-9]/gi,""));t+1===s&&e+1===l&&(i=a.hasOwnProperty("v")&&a.v!=="none"?a.v:null)}}),n.fs=i}return n}function bc(t,e,r,n,i){let a={bdl:!1,bdt:!1,bdr:!1,bdb:!1};if(r&&r.length>0){let s=[],l=[],u=[],c=[];r.forEach(o=>{if(o.type==="columns")o.p.indexOf(Re(t+1))>=0?o.hasOwnProperty("details")&&(o.details.hasOwnProperty("none")&&o.details.none?(s.push("none"),l.push("none"),u.push("none"),c.push("none")):o.details.hasOwnProperty("full")&&o.details.full?(s.push(!0),l.push(!0),u.push(!0),c.push(!0)):o.details.hasOwnProperty("outer")&&o.details.outer?(s.push(!0),l.push(e===0),u.push(!0),c.push(e===i-1)):(o.details.hasOwnProperty("left")&&o.details.left&&s.push(!0),o.details.hasOwnProperty("top")&&o.details.top&&l.push(!0),o.details.hasOwnProperty("right")&&o.details.right&&u.push(!0),o.details.hasOwnProperty("bottom")&&o.details.bottom&&c.push(!0))):o.p.forEach(f=>{if(typeof f=="string"&&f.indexOf(":")>=0){let h=f.split(":");h=h.map(g=>le(g));const d=Math.min(...h),p=Math.max(...h);t+1>=d&&t+1<=p&&(o.details.hasOwnProperty("none")&&o.details.none?(s.push("none"),l.push("none"),u.push("none"),c.push("none")):o.details.hasOwnProperty("full")&&o.details.full?(s.push(!0),l.push(!0),u.push(!0),c.push(!0)):o.details.hasOwnProperty("outer")&&o.details.outer?(s.push(d===t+1),l.push(e===0),u.push(p===t+1),c.push(e===i-1)):(o.details.hasOwnProperty("left")&&o.details.left&&s.push(!0),o.details.hasOwnProperty("top")&&o.details.top&&l.push(!0),o.details.hasOwnProperty("right")&&o.details.right&&u.push(!0),o.details.hasOwnProperty("bottom")&&o.details.bottom&&c.push(!0)))}});else if(o.type==="rows")o.p.indexOf(e+1)>=0?o.hasOwnProperty("details")&&(o.details.hasOwnProperty("none")&&o.details.none?(s.push("none"),l.push("none"),u.push("none"),c.push("none")):o.details.hasOwnProperty("full")&&o.details.full?(s.push(!0),l.push(!0),u.push(!0),c.push(!0)):o.details.hasOwnProperty("outer")&&o.details.outer?(s.push(t===0),l.push(!0),u.push(t===n-1-1),c.push(!0)):(o.details.hasOwnProperty("left")&&o.details.left&&s.push(!0),o.details.hasOwnProperty("top")&&o.details.top&&l.push(!0),o.details.hasOwnProperty("right")&&o.details.right&&u.push(!0),o.details.hasOwnProperty("bottom")&&o.details.bottom&&c.push(!0))):o.p.forEach(f=>{if(typeof f=="string"&&f.indexOf(":")>=0){let h=f.split(":");h=h.map(Number);const d=Math.min(...h),p=Math.max(...h);e+1>=d&&e+1<=p&&(o.details.hasOwnProperty("none")&&o.details.none?(s.push(!1),l.push(!1),u.push(!1),c.push(!1)):o.details.hasOwnProperty("full")&&o.details.full?(s.push(!0),l.push(!0),u.push(!0),c.push(!0)):o.details.hasOwnProperty("outer")&&o.details.outer?(s.push(t===0),l.push(d===e+1),u.push(t===n-1-1),c.push(p===e+1)):(o.details.hasOwnProperty("left")&&o.details.left&&s.push(!0),o.details.hasOwnProperty("top")&&o.details.top&&l.push(!0),o.details.hasOwnProperty("right")&&o.details.right&&u.push(!0),o.details.hasOwnProperty("bottom")&&o.details.bottom&&c.push(!0)))}});else if(o.type==="cells")if(o.p.indexOf(":")>=0){const f=o.p.split(":");let h=le(f[0].replace(/[0-9]/g,"")),d=le(f[1].replace(/[0-9]/g,"")),p=parseInt(f[0].replace(/[^0-9]/gi,"")),g=parseInt(f[1].replace(/[^0-9]/gi,""));(t>=h-1&&t<=d-1&&e>=p-1&&e<=g-1||t>=d-1&&t<=h-1&&e>=p-1&&e<=g-1||t>=h-1&&t<=d-1&&e>=g-1&&e<=p-1||t>=d-1&&t<=h-1&&e>=g-1&&e<=p-1)&&o.hasOwnProperty("details")&&(o.details.hasOwnProperty("none")&&o.details.none?(s.push("none"),l.push("none"),u.push("none"),c.push("none")):o.details.hasOwnProperty("full")&&o.details.full||o.details.hasOwnProperty("inner")&&o.details.inner&&o.details.hasOwnProperty("outer")&&o.details.outer?(s.push(!0),l.push(!0),u.push(!0),c.push(!0)):o.details.hasOwnProperty("full")&&o.details.full||o.details.hasOwnProperty("inner")&&o.details.inner&&o.details.hasOwnProperty("outer")&&o.details.outer?(o.details.hasOwnProperty("left")&&o.details.left&&t===Math.min(h-1,d-1)&&s.push(!0),o.details.hasOwnProperty("top")&&o.details.top&&e===Math.min(p-1,g-1)&&l.push(!0),o.details.hasOwnProperty("right")&&o.details.right&&t===Math.max(h-1,d-1)&&u.push(!0),o.details.hasOwnProperty("bottom")&&o.details.bottom&&e===Math.max(p-1,g-1)&&c.push(!0)):o.details.hasOwnProperty("inner")&&o.details.inner?(e===Math.min(p-1,g-1)&&t===Math.min(h-1,d-1)||e===Math.min(p-1,g-1)&&t===Math.max(h-1,d-1)||e===Math.max(p-1,g-1)&&t===Math.min(h-1,d-1)||e===Math.max(p-1,g-1)&&t===Math.max(h-1,d-1)?(e===Math.min(p-1,g-1)&&t===Math.min(h-1,d-1)&&(u.push(!0),c.push(!0)),e===Math.min(p-1,g-1)&&t===Math.max(h-1,d-1)&&(s.push(!0),c.push(!0)),e===Math.max(p-1,g-1)&&t===Math.min(h-1,d-1)&&(l.push(!0),u.push(!0)),e===Math.max(p-1,g-1)&&t===Math.max(h-1,d-1)&&(s.push(!0),l.push(!0))):(e===Math.min(p-1,g-1)&&(s.push(!0),u.push(!0),c.push(!0)),e===Math.max(p-1,g-1)&&(s.push(!0),l.push(!0),u.push(!0)),t===Math.min(h-1,d-1)&&(l.push(!0),u.push(!0),c.push(!0)),t===Math.max(h-1,d-1)&&(s.push(!0),l.push(!0),c.push(!0))),e>Math.min(p-1,g-1)&&e<Math.max(p-1,g-1)&&t>Math.min(h-1,d-1)&&t<Math.max(h-1,d-1)&&(s.push(!0),l.push(!0),u.push(!0),c.push(!0))):o.details.hasOwnProperty("outer")&&o.details.outer?(e===Math.min(p-1,g-1)&&l.push(!0),e===Math.max(p-1,g-1)&&c.push(!0),t===Math.min(h-1,d-1)&&s.push(!0),t===Math.max(h-1,d-1)&&u.push(!0)):(o.details.hasOwnProperty("left")&&o.details.left&&t===Math.min(h-1,d-1)&&s.push(!0),o.details.hasOwnProperty("top")&&o.details.top&&e===Math.min(p-1,g-1)&&l.push(!0),o.details.hasOwnProperty("right")&&o.details.right&&t===Math.max(h-1,d-1)&&u.push(!0),o.details.hasOwnProperty("bottom")&&o.details.bottom&&e===Math.max(p-1,g-1)&&c.push(!0)))}else{let f=le(o.p.replace(/[0-9]/g,"")),h=parseInt(o.p.replace(/[^0-9]/gi,""));t===f-1&&e===h-1&&o.hasOwnProperty("details")&&(o.details.hasOwnProperty("none")&&o.details.none?(s.push("none"),l.push("none"),u.push("none"),c.push("none")):o.details.hasOwnProperty("full")&&o.details.full?(s.push(!0),l.push(!0),u.push(!0),c.push(!0)):(o.details.hasOwnProperty("left")&&o.details.left&&s.push(!0),o.details.hasOwnProperty("top")&&o.details.top&&l.push(!0),o.details.hasOwnProperty("right")&&o.details.right&&u.push(!0),o.details.hasOwnProperty("bottom")&&o.details.bottom&&c.push(!0)))}}),s.length>0?(s.lastIndexOf("none")>=0&&(s=s.lastIndexOf("none")===s.length-1?[]:s.slice(s.lastIndexOf("none")+1)),s.length>0?a.bdl=s.reduce((o,f)=>o||f):a.bdl=!1):a.bdl=!1,l.length>0?(l.lastIndexOf("none")>=0&&(l=l.lastIndexOf("none")===l.length-1?[]:l.slice(l.lastIndexOf("none")+1)),l.length>0?a.bdt=l.reduce((o,f)=>o||f):a.bdt=!1):a.bdt=!1,u.length>0?(u.lastIndexOf("none")>=0&&(u=u.lastIndexOf("none")===u.length-1?[]:u.slice(u.lastIndexOf("none")+1)),u.length>0?a.bdr=u.reduce((o,f)=>o||f):a.bdr=!1):a.bdr=!1,c.length>0?(c.lastIndexOf("none")>=0&&(c=c.lastIndexOf("none")===c.length-1?[]:c.slice(c.lastIndexOf("none")+1)),c.length>0?a.bdb=c.reduce((o,f)=>o||f):a.bdb=!1):a.bdb=!1}return a}function Ec(t,e,r,n,i){if(t){if(e&&r&&n&&i)return"16";if(e&&r&&n&&!i)return"15";if(e&&r&&!n&&i)return"14";if(e&&!r&&n&&i)return"13";if(!e&&r&&n&&i)return"12";if(!e&&!r&&n&&i)return"11";if(!e&&r&&!n&&i)return"10";if(!e&&r&&n&&!i)return"9";if(e&&!r&&!n&&i)return"8";if(e&&!r&&n&&!i)return"7";if(e&&r&&!n&&!i)return"6";if(e&&!r&&!n&&!i)return"5";if(!e&&r&&!n&&!i)return"4";if(!e&&!r&&n&&!i)return"3";if(!e&&!r&&!n&&i)return"2";if(!e&&!r&&!n&&!i)return"1"}return e&&r&&n&&i?"32":e&&r&&n&&!i?"31":e&&r&&!n&&i?"30":e&&!r&&n&&i?"29":!e&&r&&n&&i?"28":!e&&!r&&n&&i?"27":!e&&r&&!n&&i?"26":!e&&r&&n&&!i?"25":e&&!r&&!n&&i?"24":e&&!r&&n&&!i?"23":e&&r&&!n&&!i?"22":e&&!r&&!n&&!i?"21":!e&&r&&!n&&!i?"20":!e&&!r&&n&&!i?"19":!e&&!r&&!n&&i?"18":"17"}function rd(t){return t==="large"?16:t==="normal"?14:t==="small"?12:t==="mini"?10:14}function If(t){return""+(t??"")}function An(t){if(t==null)return 0;if(typeof t=="number")return Number(t);const e=parseFloat(t);return Zm(e)?0:e}function Oc(t){if(t==null)return 0;if(typeof t=="number")return Math.trunc(Number(t));const e=parseInt(t);return Zm(e)?0:e}function bE(t,e){const r=An(t),n=r;if(r){e=e===void 0?0:e;const a=If(r).split("."),s=a[0],l=a[1]===void 0?"":a[1],u=l.substring(0,e+1),c=s+(u?"."+u:"");if(e>=l.length)return An(c);if(e>0){const o=Math.pow(10,e);return Math.floor(r*o)/o}else return Math.floor(r)}return n}let EE=1,du=2;function OE(){return du=EE++,du}function AE(){return du}function pu(...t){let e=Object.assign({},...t);for(let r of t)for(let[n,i]of Object.entries(r))typeof i=="object"&&(e[n]=pu(e[n],i));return e}let nd=class{constructor(e,r,n){fe(this,"index");fe(this,"width");fe(this,"visible");this.index=e,this.width=r,this.visible=n}};class id{constructor(e,r,n){fe(this,"index");fe(this,"height");fe(this,"visible");this.index=e,this.height=r,this.visible=n}}let Ac=class{constructor(e,r,n,i,a,s,l,u,c,o,f,h,d,p,g,m,v,b,C,A,O,w,S,N){fe(this,"row");fe(this,"col");fe(this,"rowSpan");fe(this,"colSpan");fe(this,"fd");fe(this,"se");fe(this,"v");fe(this,"mv");fe(this,"ss");fe(this,"st");fe(this,"bgt");fe(this,"bg");fe(this,"fg");fe(this,"bdl");fe(this,"bdt");fe(this,"bdr");fe(this,"bdb");fe(this,"b");fe(this,"i");fe(this,"u");fe(this,"ff");fe(this,"fs");fe(this,"g");fe(this,"gf");this.row=e,this.col=r,this.rowSpan=n,this.colSpan=i,this.v=a,this.mv=s,this.fd=l,this.se=u,this.ss=c,this.st=o,this.bgt=f,this.bg=h,this.fg=d,this.bdl=p,this.bdt=g,this.bdr=m,this.bdb=v,this.b=b,this.i=C,this.u=A,this.ff=O,this.fs=w,this.g=S,this.gf=N}};function CE(t,e=0,{start:r=!0,middle:n=!0,once:i=!1}={}){let a=0,s,l=!1;function u(...c){if(l)return;const o=Date.now()-a;a=Date.now(),r?(r=!1,t.apply(this,c),i&&u.cancel()):(n&&o<e||!n)&&(clearTimeout(s),s=setTimeout(()=>{a=Date.now(),t.apply(this,c),i&&u.cancel()},n?e-o:e))}return u.cancel=()=>{clearTimeout(s),l=!0},u}function gu(t,e=0,{start:r=!1,middle:n=!1,once:i=!1}={}){return CE(t,e,{start:r,middle:n,once:i})}let ad;const $i=[],wE=500;function SE(){$i.length&&($i.forEach(t=>{t.targetList.forEach(e=>{const{target:r,width:n,height:i}=e,a=r.clientWidth,s=r.clientHeight;(a&&n!==a||s&&i!==s)&&(e.width=a,e.height=s,setTimeout(t.callback))})}),i0())}function i0(){clearTimeout(ad),ad=setTimeout(SE,wE)}let TE=class{constructor(e){fe(this,"targetList",[]);fe(this,"callback");this.callback=e}observe(e){if(e){const{targetList:r}=this;r.some(n=>n.target===e)||r.push({target:e,width:e.clientWidth,height:e.clientHeight}),$i.length||i0(),$i.some(n=>n===this)||$i.push(this)}}disconnect(){$i.length=0}};function mu(t){return window.ResizeObserver?new window.ResizeObserver(t):new TE(t)}var Ce=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Df(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var vu={exports:{}};(function(t,e){const r={defaultResult:"ศูนย์บาทถ้วน",singleUnitStrs:["","หนึ่ง","สอง","สาม","สี่","ห้า","หก","เจ็ด","แปด","เก้า"],placeNameStrs:["","สิบ","ร้อย","พัน","หมื่น","แสน","ล้าน"]};function n(l){let u="";const c=l.length,o=7;if(c>o){const f=c-o+1,h=l.slice(0,f),d=l.slice(f);return n(h)+"ล้าน"+n(d)}else for(let f=0;f<c;f++){const h=l[f];h>0&&(u+=r.singleUnitStrs[h]+r.placeNameStrs[c-f-1])}return u}function i(l){return l.replace(/หนึ่งสิบ/g,"สิบ").replace(/สองสิบ/g,"ยี่สิบ").replace(/สิบหนึ่ง/g,"สิบเอ็ด")}function a(l,u){return!l&&!u?r.defaultResult:l&&!u?l+"บาทถ้วน":!l&&u?u+"สตางค์":l+"บาท"+u+"สตางค์"}function s(l){if(!l||typeof l=="boolean"||isNaN(Number(l))||l<Number.MIN_SAFE_INTEGER||l>Number.MAX_SAFE_INTEGER)return r.defaultResult;const u=Math.abs(l),c=Math.floor(u).toString(),o=(u%1*100).toFixed(0),f=Array.from(c).map(Number),h=Array.from(o).map(Number);let d=n(f),p=n(h);d=i(d),p=i(p);const g=a(d,p);return l>=0?g:"ลบ"+g}t.exports!=null&&(t.exports={bahttext:s,bahtxtNum2Word:n,bahtxtGrammarFix:i,bahtxtCombine:a},e.default={bahttext:s})})(vu,vu.exports);var RE=vu.exports;const M={NUMBER:0,ARRAY:1,BOOLEAN:2,STRING:3,RANGE_REF:4,CELL_REF:5,COLLECTIONS:6,NUMBER_NO_BOOLEAN:10},Yt=class Yt extends Error{constructor(r,n,i){super(n);fe(this,"_error");fe(this,"_details");if(n==null&&i==null&&Yt.errorMap.has(r))return Yt.errorMap.get(r);n==null&&i==null?(this._error=r,Yt.errorMap.set(r,this)):this._error=r,this._details=i}get details(){return this._details}set details(r){this._details=r}get error(){return this._error}get name(){return this._error}equals(r){return r instanceof Yt&&r._error===this._error}toString(){return this._error}};fe(Yt,"errorMap",new Map),fe(Yt,"DIV0"),fe(Yt,"NA"),fe(Yt,"NAME"),fe(Yt,"NULL"),fe(Yt,"NUM"),fe(Yt,"REF"),fe(Yt,"VALUE"),fe(Yt,"NOT_IMPLEMENTED"),fe(Yt,"TOO_MANY_ARGS"),fe(Yt,"ARG_MISSING"),fe(Yt,"ERROR");let B=Yt;B.errorMap=new Map;B.DIV0=new B("#DIV/0!");B.NA=new B("#N/A");B.NAME=new B("#NAME?");B.NULL=new B("#NULL!");B.NUM=new B("#NUM!");B.REF=new B("#REF!");B.VALUE=new B("#VALUE!");B.NOT_IMPLEMENTED=t=>new B("#NAME?",`Function ${t} is not implemented.`);B.TOO_MANY_ARGS=t=>new B("#N/A",`Function ${t} has too many arguments.`);B.ARG_MISSING=t=>new B("#N/A",`Argument type ${t.map(e=>M[e]).join(", ")} is missing.`);B.ERROR=(t,e)=>new B("#ERROR!",t,e);class mi{constructor(e,r){fe(this,"_data");fe(this,"_refs");if(e==null&&r==null)this._data=[],this._refs=[];else{if(e.length!==r.length)throw Error("Collection: data length should match references length.");this._data=e,this._refs=r}}get data(){return this._data}get refs(){return this._refs}get length(){return this._data.length}add(e,r){this._data.push(e),this._refs.push(r)}}const a0=[1,1,2,6,24,120,720,5040,40320,362880,3628800,39916800,479001600,6227020800,87178291200,1307674368e3,20922789888e3,355687428096e3,6402373705728e3,121645100408832e3,243290200817664e4,5109094217170944e4,11240007277776077e5,2585201673888498e7,6204484017332394e8,15511210043330986e9,40329146112660565e10,10888869450418352e12,30488834461171387e13,8841761993739702e15,26525285981219107e16,8222838654177922e18,2631308369336935e20,8683317618811886e21,29523279903960416e22,10333147966386145e24,37199332678990125e25,13763753091226346e27,5230226174666011e29,20397882081197444e30,8159152832478977e32,3345252661316381e34,140500611775288e37,6041526306337383e37,2658271574788449e39,11962222086548019e40,5502622159812089e42,25862324151116818e43,12413915592536073e45,6082818640342675e47,30414093201713376e48,15511187532873822e50,8065817517094388e52,42748832840600255e53,2308436973392414e56,12696403353658276e57,7109985878048635e59,40526919504877214e60,23505613312828785e62,13868311854568984e64,832098711274139e67,5075802138772248e68,3146997326038794e70,198260831540444e73,12688693218588417e73,8247650592082472e75,5443449390774431e77,3647111091818868e79,24800355424368305e80,1711224524281413e83,11978571669969892e84,8504785885678623e86,61234458376886085e87,44701154615126844e89,3307885441519386e92,248091408113954e95,18854947016660504e95,14518309202828587e97,11324281178206297e99,8946182130782976e101,7156945704626381e103,5797126020747368e105,4753643337012842e107,3945523969720659e109,3314240134565353e111,281710411438055e114,24227095383672734e114,2107757298379528e117,18548264225739844e118,1650795516090846e121,14857159644817615e122,1352001527678403e125,12438414054641308e126,11567725070816416e128,1087366156656743e131,1032997848823906e133,9916779348709496e134,9619275968248212e136,9426890448883248e138,9332621544394415e140,9332621544394415e142],NE={};Object.keys(M).forEach(t=>{NE[M[t]]=t});const vi={isRangeRef:t=>t.ref&&t.ref.from,isCellRef:t=>t.ref&&!t.ref.from,columnNumberToName:t=>{let e=t,r="",n=0;for(;e>0;)n=(e-1)%26,r=String.fromCharCode(65+n)+r,e=Math.floor((e-n)/26);return r},columnNameToNumber:t=>{t=t.toUpperCase();const e=t.length;let r=0;for(let n=0;n<e;n++){const i=t.charCodeAt(n);isNaN(i)||(r+=(i-64)*26**(e-n-1))}return r},extend:(t,e)=>{if(e==null)return t;let r,n;if(vi.isCellRef(t))r=0,n=0;else if(vi.isRangeRef(t))r=t.ref.to.row-t.ref.from.row,n=t.ref.to.col-t.ref.from.col;else throw Error("Address.extend should not reach here.");return vi.isCellRef(e)?(r>0||n>0)&&(e={ref:{from:{col:e.ref.col,row:e.ref.row},to:{row:e.ref.row+r,col:e.ref.col+n}}}):(e.ref.to.row=e.ref.from.row+r,e.ref.to.col=e.ref.from.col+n),e}};class xE{constructor(){fe(this,"_Types");fe(this,"type2Number");fe(this,"checkFunctionResult",e=>{if(typeof e==="number"){if(isNaN(e))return B.VALUE;if(!isFinite(e))return B.NUM}return e??B.NULL});fe(this,"isRangeRef",e=>e.ref&&e.ref.from);fe(this,"isCellRef",e=>e.ref&&!e.ref.from);fe(this,"retrieveArg",(e,r)=>{if(r===null)return{value:0,isArray:!1,omitted:!0};const n=e.utils.extractRefValue(r);return{value:n.val,isArray:n.isArray,ref:r.ref}});this._Types=M,this.type2Number={number:M.NUMBER,boolean:M.BOOLEAN,string:M.STRING,object:-1}}get Types(){return this._Types}set Types(e){this._Types=e}flattenDeep(e){return e.reduce((r,n)=>Array.isArray(n)?r.concat(this.flattenDeep(n)):r.concat(n),[])}acceptNumber(e,r=!0,n=!0){if(e instanceof B)return e;let i;if(typeof e=="number")i=e;else if(typeof e=="boolean")if(n)i=Number(e);else throw B.VALUE;else if(typeof e=="string"){if(e.length===0||(i=Number(e),i!==i))throw B.VALUE}else if(Array.isArray(e))if(r)i=this.acceptNumber(e[0][0]);else if(e[0].length===1)i=this.acceptNumber(e[0][0]);else throw B.VALUE;else throw Error("Unknown type in FormulaHelpers.acceptNumber");return i}flattenParams(e,r,n,i,a=null,s=1){if(e.length<s)throw B.ARG_MISSING([r]);a==null&&(a=r===M.NUMBER?0:r==null?null:""),e.forEach(l=>{const{isCellRef:u,isRangeRef:c,isArray:o}=l,f=l.value instanceof mi,h=!u&&!c&&!o&&!f,d={isLiteral:h,isCellRef:u,isRangeRef:c,isArray:o,isUnion:f};if(h)l.omitted?l=a:l=this.accept(l,r,a),i(l,d);else if(u)i(l.value,d);else if(f){if(!n)throw B.VALUE;l=l.value.data,l=this.flattenDeep(l),l.forEach(p=>{i(p,d)})}else(c||o)&&(l=this.flattenDeep(l.value),l.forEach(p=>{i(p,d)}))})}accept(e,r=null,n,i=!0,a=!1){if(Array.isArray(r)&&(r=r[0]),e==null&&n===void 0)throw B.ARG_MISSING([r]);if(e==null)return n;if(typeof e!="object"||Array.isArray(e))return e;const s=e.isArray;if(e.value!=null&&(e=e.value),r==null)return e;if(e instanceof B)throw e;if(r===M.ARRAY){if(Array.isArray(e))return i?this.flattenDeep(e):e;if(e instanceof mi)throw B.VALUE;if(a)return i?[e]:[[e]];throw B.VALUE}else if(r===M.COLLECTIONS)return e;s&&(e=e[0][0]);const l=this.type(e);if(r===M.STRING)l===M.BOOLEAN?e=e?"TRUE":"FALSE":e=`${e}`;else if(r===M.BOOLEAN){if(l===M.STRING)throw B.VALUE;l===M.NUMBER&&(e=!!e)}else if(r===M.NUMBER)e=this.acceptNumber(e,!1);else if(r===M.NUMBER_NO_BOOLEAN)e=this.acceptNumber(e,!1,!1);else throw B.VALUE;return e}type(e){let r=this.type2Number[typeof e];return r===-1&&(Array.isArray(e)?r=M.ARRAY:e.ref?e.ref.from?r=M.RANGE_REF:r=M.CELL_REF:e instanceof mi&&(r=M.COLLECTIONS)),r}retrieveRanges(e,r,n){return n=vi.extend(r,n),r=this.retrieveArg(e,r),r=this.accept(r,M.ARRAY,void 0,!1,!0),n!==r?(n=this.retrieveArg(e,n),n=this.accept(n,M.ARRAY,void 0,!1,!0)):n=r,[r,n]}}const St=new xE,tn={isWildCard:t=>typeof t=="string"?/[*?]/.test(t):!1,toRegex:(t,e)=>RegExp(t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/([^~]??)[?]/g,"$1.").replace(/([^~]??)[*]/g,"$1.*").replace(/~([?*])/g,"$1"),e)},yu={parse:t=>{const e=typeof t;if(e==="string"){const r=t.toUpperCase();if(r==="TRUE"||r==="FALSE")return{op:"=",value:r==="TRUE"};const n=t.match(/(<>|>=|<=|>|<|=)(.*)/);if(n){const i=n[1];let a;if(isNaN(n[2])){const s=n[2].toUpperCase();if(s==="TRUE"||s==="FALSE")a=s==="TRUE";else if(/#NULL!|#DIV\/0!|#VALUE!|#NAME\?|#NUM!|#N\/A|#REF!/.test(n[2]))a=new B(n[2]);else if(a=n[2],tn.isWildCard(a))return{op:"wc",value:tn.toRegex(a),match:i==="="}}else a=Number(n[2]);return{op:i,value:a}}return tn.isWildCard(t)?{op:"wc",value:tn.toRegex(t),match:!0}:{op:"=",value:t}}if(e==="boolean"||e==="number"||Array.isArray(t)||t instanceof B)return{op:"=",value:t};throw Error(`Criteria.parse: type ${typeof t} not support`)}};var Xa={},ME=function(e){e.version="0.11.2";function r(E){for(var G="",U=E.length-1;U>=0;)G+=E.charAt(U--);return G}function n(E,G){for(var U="";U.length<G;)U+=E;return U}function i(E,G){var U=""+E;return U.length>=G?U:n("0",G-U.length)+U}function a(E,G){var U=""+E;return U.length>=G?U:n(" ",G-U.length)+U}function s(E,G){var U=""+E;return U.length>=G?U:U+n(" ",G-U.length)}function l(E,G){var U=""+Math.round(E);return U.length>=G?U:n("0",G-U.length)+U}function u(E,G){var U=""+E;return U.length>=G?U:n("0",G-U.length)+U}var c=Math.pow(2,32);function o(E,G){if(E>c||E<-c)return l(E,G);var U=Math.round(E);return u(U,G)}function f(E,G){return G=G||0,E.length>=7+G&&(E.charCodeAt(G)|32)===103&&(E.charCodeAt(G+1)|32)===101&&(E.charCodeAt(G+2)|32)===110&&(E.charCodeAt(G+3)|32)===101&&(E.charCodeAt(G+4)|32)===114&&(E.charCodeAt(G+5)|32)===97&&(E.charCodeAt(G+6)|32)===108}var h=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],d=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function p(E){E[0]="General",E[1]="0",E[2]="0.00",E[3]="#,##0",E[4]="#,##0.00",E[9]="0%",E[10]="0.00%",E[11]="0.00E+00",E[12]="# ?/?",E[13]="# ??/??",E[14]="m/d/yy",E[15]="d-mmm-yy",E[16]="d-mmm",E[17]="mmm-yy",E[18]="h:mm AM/PM",E[19]="h:mm:ss AM/PM",E[20]="h:mm",E[21]="h:mm:ss",E[22]="m/d/yy h:mm",E[37]="#,##0 ;(#,##0)",E[38]="#,##0 ;[Red](#,##0)",E[39]="#,##0.00;(#,##0.00)",E[40]="#,##0.00;[Red](#,##0.00)",E[45]="mm:ss",E[46]="[h]:mm:ss",E[47]="mmss.0",E[48]="##0.0E+0",E[49]="@",E[56]='"上午/下午 "hh"時"mm"分"ss"秒 "'}var g={};p(g);var m=[],v=0;for(v=5;v<=8;++v)m[v]=32+v;for(v=23;v<=26;++v)m[v]=0;for(v=27;v<=31;++v)m[v]=14;for(v=50;v<=58;++v)m[v]=14;for(v=59;v<=62;++v)m[v]=v-58;for(v=67;v<=68;++v)m[v]=v-58;for(v=72;v<=75;++v)m[v]=v-58;for(v=67;v<=68;++v)m[v]=v-57;for(v=76;v<=78;++v)m[v]=v-56;for(v=79;v<=81;++v)m[v]=v-34;var b={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function C(E,G,U){for(var ue=E<0?-1:1,V=E*ue,ee=0,L=1,Z=0,K=1,H=0,ie=0,pe=Math.floor(V);H<G&&(pe=Math.floor(V),Z=pe*L+ee,ie=pe*H+K,!(V-pe<5e-8));)V=1/(V-pe),ee=L,L=Z,K=H,H=ie;if(ie>G&&(H>G?(ie=K,Z=ee):(ie=H,Z=L)),!U)return[0,ue*Z,ie];var ye=Math.floor(ue*Z/ie);return[ye,ue*Z-ye*ie,ie]}function A(E,G,U){if(E>2958465||E<0)return null;var ue=E|0,V=Math.floor(86400*(E-ue)),ee=0,L=[],Z={D:ue,T:V,u:86400*(E-ue)-V,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(Z.u)<1e-6&&(Z.u=0),G&&G.date1904&&(ue+=1462),Z.u>.9999&&(Z.u=0,++V==86400&&(Z.T=V=0,++ue,++Z.D)),ue===60)L=U?[1317,10,29]:[1900,2,29],ee=3;else if(ue===0)L=U?[1317,8,29]:[1900,1,0],ee=6;else{ue>60&&--ue;var K=new Date(1900,0,1);K.setDate(K.getDate()+ue-1),L=[K.getFullYear(),K.getMonth()+1,K.getDate()],ee=K.getDay(),ue<60&&(ee=(ee+6)%7),U&&(ee=Y(K,L))}return Z.y=L[0],Z.m=L[1],Z.d=L[2],Z.S=V%60,V=Math.floor(V/60),Z.M=V%60,V=Math.floor(V/60),Z.H=V,Z.q=ee,Z}e.parse_date_code=A;var O=new Date(1899,11,31,0,0,0),w=O.getTime(),S=new Date(1900,2,1,0,0,0);function N(E,G){var U=E.getTime();return G?U-=1461*24*60*60*1e3:E>=S&&(U+=24*60*60*1e3),(U-(w+(E.getTimezoneOffset()-O.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function R(E){return E.toString(10)}e._general_int=R;var k=function(){var G=/(?:\.0*|(\.\d*[1-9])0+)$/;function U(H){return H.indexOf(".")==-1?H:H.replace(G,"$1")}var ue=/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,V=/(E[+-])(\d)$/;function ee(H){return H.indexOf("E")==-1?H:H.replace(ue,"$1E").replace(V,"$10$2")}function L(H){var ie=H<0?12:11,pe=U(H.toFixed(12));return pe.length<=ie||(pe=H.toPrecision(10),pe.length<=ie)?pe:H.toExponential(5)}function Z(H){var ie=U(H.toFixed(11));return ie.length>(H<0?12:11)||ie==="0"||ie==="-0"?H.toPrecision(6):ie}function K(H){var ie=Math.floor(Math.log(Math.abs(H))*Math.LOG10E),pe;return ie>=-4&&ie<=-1?pe=H.toPrecision(10+ie):Math.abs(ie)<=9?pe=L(H):ie===10?pe=H.toFixed(10).substr(0,12):pe=Z(H),U(ee(pe.toUpperCase()))}return K}();e._general_num=k;function z(E,G){switch(typeof E){case"string":return E;case"boolean":return E?"TRUE":"FALSE";case"number":return(E|0)===E?E.toString(10):k(E);case"undefined":return"";case"object":if(E==null)return"";if(E instanceof Date)return _e(14,N(E,G&&G.date1904),G)}throw new Error("unsupported value in General format: "+E)}e._general=z;function Y(E,G){G[0]-=581;var U=E.getDay();return E<60&&(U=(U+6)%7),U}function re(E,G,U,ue){var V="",ee=0,L=0,Z=U.y,K,H=0;switch(E){case 98:Z=U.y+543;case 121:switch(G.length){case 1:case 2:K=Z%100,H=2;break;default:K=Z%1e4,H=4;break}break;case 109:switch(G.length){case 1:case 2:K=U.m,H=G.length;break;case 3:return d[U.m-1][1];case 5:return d[U.m-1][0];default:return d[U.m-1][2]}break;case 100:switch(G.length){case 1:case 2:K=U.d,H=G.length;break;case 3:return h[U.q][0];default:return h[U.q][1]}break;case 104:switch(G.length){case 1:case 2:K=1+(U.H+11)%12,H=G.length;break;default:throw"bad hour format: "+G}break;case 72:switch(G.length){case 1:case 2:K=U.H,H=G.length;break;default:throw"bad hour format: "+G}break;case 77:switch(G.length){case 1:case 2:K=U.M,H=G.length;break;default:throw"bad minute format: "+G}break;case 115:if(G!="s"&&G!="ss"&&G!=".0"&&G!=".00"&&G!=".000")throw"bad second format: "+G;return U.u===0&&(G=="s"||G=="ss")?i(U.S,G.length):(ue>=2?L=ue===3?1e3:100:L=ue===1?10:1,ee=Math.round(L*(U.S+U.u)),ee>=60*L&&(ee=0),G==="s"?ee===0?"0":""+ee/L:(V=i(ee,2+ue),G==="ss"?V.substr(0,2):"."+V.substr(2,G.length-1)));case 90:switch(G){case"[h]":case"[hh]":K=U.D*24+U.H;break;case"[m]":case"[mm]":K=(U.D*24+U.H)*60+U.M;break;case"[s]":case"[ss]":K=((U.D*24+U.H)*60+U.M)*60+Math.round(U.S+U.u);break;default:throw"bad abstime format: "+G}H=G.length===3?1:2;break;case 101:K=Z,H=1;break}var ie=H>0?i(K,H):"";return ie}function Q(E){var G=3;if(E.length<=G)return E;for(var U=E.length%G,ue=E.substr(0,U);U!=E.length;U+=G)ue+=(ue.length>0?",":"")+E.substr(U,G);return ue}var ae=function(){var G=/%/g;function U(me,F,y){var D=F.replace(G,""),x=F.length-D.length;return ae(me,D,y*Math.pow(10,2*x))+n("%",x)}function ue(me,F,y){for(var D=F.length-1;F.charCodeAt(D-1)===44;)--D;return ae(me,F.substr(0,D),y/Math.pow(10,3*(F.length-D)))}function V(me,F){var y,D=me.indexOf("E")-me.indexOf(".")-1;if(me.match(/^#+0.0E\+0$/)){if(F==0)return"0.0E+0";if(F<0)return"-"+V(me,-F);var x=me.indexOf(".");x===-1&&(x=me.indexOf("E"));var _=Math.floor(Math.log(F)*Math.LOG10E)%x;if(_<0&&(_+=x),y=(F/Math.pow(10,_)).toPrecision(D+1+(x+_)%x),y.indexOf("e")===-1){var $=Math.floor(Math.log(F)*Math.LOG10E);for(y.indexOf(".")===-1?y=y.charAt(0)+"."+y.substr(1)+"E+"+($-y.length+_):y+="E+"+($-_);y.substr(0,2)==="0.";)y=y.charAt(0)+y.substr(2,x)+"."+y.substr(2+x),y=y.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");y=y.replace(/\+-/,"-")}y=y.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(j,ce,I,T){return ce+I+T.substr(0,(x+_)%x)+"."+T.substr(_)+"E"})}else y=F.toExponential(D);return me.match(/E\+00$/)&&y.match(/e[+-]\d$/)&&(y=y.substr(0,y.length-1)+"0"+y.charAt(y.length-1)),me.match(/E\-/)&&y.match(/e\+/)&&(y=y.replace(/e\+/,"e")),y.replace("e","E")}var ee=/# (\?+)( ?)\/( ?)(\d+)/;function L(me,F,y){var D=parseInt(me[4],10),x=Math.round(F*D),_=Math.floor(x/D),$=x-_*D,j=D;return y+(_===0?"":""+_)+" "+($===0?n(" ",me[1].length+1+me[4].length):a($,me[1].length)+me[2]+"/"+me[3]+i(j,me[4].length))}function Z(me,F,y){return y+(F===0?"":""+F)+n(" ",me[1].length+2+me[4].length)}var K=/^#*0*\.([0#]+)/,H=/\).*[0#]/,ie=/\(###\) ###\\?-####/;function pe(me){for(var F="",y,D=0;D!=me.length;++D)switch(y=me.charCodeAt(D)){case 35:break;case 63:F+=" ";break;case 48:F+="0";break;default:F+=String.fromCharCode(y)}return F}function ye(me,F){var y=Math.pow(10,F);return""+Math.round(me*y)/y}function we(me,F){var y=me-Math.floor(me),D=Math.pow(10,F);return F<(""+Math.round(y*D)).length?0:Math.round(y*D)}function Ue(me,F){return F<(""+Math.round((me-Math.floor(me))*Math.pow(10,F))).length?1:0}function De(me){return me<2147483647&&me>-2147483648?""+(me>=0?me|0:me-1|0):""+Math.floor(me)}function Ie(me,F,y){if(me.charCodeAt(0)===40&&!F.match(H)){var D=F.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return y>=0?Ie("n",D,y):"("+Ie("n",D,-y)+")"}if(F.charCodeAt(F.length-1)===44)return ue(me,F,y);if(F.indexOf("%")!==-1)return U(me,F,y);if(F.indexOf("E")!==-1)return V(F,y);if(F.charCodeAt(0)===36)return"$"+Ie(me,F.substr(F.charAt(1)==" "?2:1),y);var x,_,$,j,ce=Math.abs(y),I=y<0?"-":"";if(F.match(/^00+$/))return I+o(ce,F.length);if(F.match(/^[#?]+$/))return x=o(y,0),x==="0"&&(x=""),x.length>F.length?x:pe(F.substr(0,F.length-x.length))+x;if(_=F.match(ee))return L(_,ce,I);if(F.match(/^#+0+$/))return I+o(ce,F.length-F.indexOf("0"));if(_=F.match(K))return x=ye(y,_[1].length).replace(/^([^\.]+)$/,"$1."+pe(_[1])).replace(/\.$/,"."+pe(_[1])).replace(/\.(\d*)$/,function(te,q){return"."+q+n("0",pe(_[1]).length-q.length)}),F.indexOf("0.")!==-1?x:x.replace(/^0\./,".");if(F=F.replace(/^#+([0.])/,"$1"),_=F.match(/^(0*)\.(#*)$/))return I+ye(ce,_[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,_[1].length?"0.":".");if(_=F.match(/^#{1,3},##0(\.?)$/))return I+Q(o(ce,0));if(_=F.match(/^#,##0\.([#0]*0)$/))return y<0?"-"+Ie(me,F,-y):Q(""+(Math.floor(y)+Ue(y,_[1].length)))+"."+i(we(y,_[1].length),_[1].length);if(_=F.match(/^#,#*,#0/))return Ie(me,F.replace(/^#,#*,/,""),y);if(_=F.match(/^([0#]+)(\\?-([0#]+))+$/))return x=r(Ie(me,F.replace(/[\\-]/g,""),y)),$=0,r(r(F.replace(/\\/g,"")).replace(/[0#]/g,function(te){return $<x.length?x.charAt($++):te==="0"?"0":""}));if(F.match(ie))return x=Ie(me,"##########",y),"("+x.substr(0,3)+") "+x.substr(3,3)+"-"+x.substr(6);var T="";if(_=F.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return $=Math.min(_[4].length,7),j=C(ce,Math.pow(10,$)-1,!1),x=""+I,T=ae("n",_[1],j[1]),T.charAt(T.length-1)==" "&&(T=T.substr(0,T.length-1)+"0"),x+=T+_[2]+"/"+_[3],T=s(j[2],$),T.length<_[4].length&&(T=pe(_[4].substr(_[4].length-T.length))+T),x+=T,x;if(_=F.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return $=Math.min(Math.max(_[1].length,_[4].length),7),j=C(ce,Math.pow(10,$)-1,!0),I+(j[0]||(j[1]?"":"0"))+" "+(j[1]?a(j[1],$)+_[2]+"/"+_[3]+s(j[2],$):n(" ",2*$+1+_[2].length+_[3].length));if(_=F.match(/^[#0?]+$/))return x=o(y,0),F.length<=x.length?x:pe(F.substr(0,F.length-x.length))+x;if(_=F.match(/^([#0?]+)\.([#0]+)$/)){x=""+y.toFixed(Math.min(_[2].length,10)).replace(/([^0])0+$/,"$1"),$=x.indexOf(".");var P=F.indexOf(".")-$,W=F.length-x.length-P;return pe(F.substr(0,P)+x+F.substr(F.length-W))}if(_=F.match(/^00,000\.([#0]*0)$/))return $=we(y,_[1].length),y<0?"-"+Ie(me,F,-y):Q(De(y)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(te){return"00,"+(te.length<3?i(0,3-te.length):"")+te})+"."+i($,_[1].length);switch(F){case"###,##0.00":return Ie(me,"#,##0.00",y);case"###,###":case"##,###":case"#,###":var oe=Q(o(ce,0));return oe!=="0"?I+oe:"";case"###,###.00":return Ie(me,"###,##0.00",y).replace(/^0\./,".");case"#,###.00":return Ie(me,"#,##0.00",y).replace(/^0\./,".")}throw new Error("unsupported format |"+F+"|")}function We(me,F,y){for(var D=F.length-1;F.charCodeAt(D-1)===44;)--D;return ae(me,F.substr(0,D),y/Math.pow(10,3*(F.length-D)))}function Xe(me,F,y){var D=F.replace(G,""),x=F.length-D.length;return ae(me,D,y*Math.pow(10,2*x))+n("%",x)}function Qe(me,F){var y,D=me.indexOf("E")-me.indexOf(".")-1;if(me.match(/^#+0.0E\+0$/)){if(F==0)return"0.0E+0";if(F<0)return"-"+Qe(me,-F);var x=me.indexOf(".");x===-1&&(x=me.indexOf("E"));var _=Math.floor(Math.log(F)*Math.LOG10E)%x;if(_<0&&(_+=x),y=(F/Math.pow(10,_)).toPrecision(D+1+(x+_)%x),!y.match(/[Ee]/)){var $=Math.floor(Math.log(F)*Math.LOG10E);y.indexOf(".")===-1?y=y.charAt(0)+"."+y.substr(1)+"E+"+($-y.length+_):y+="E+"+($-_),y=y.replace(/\+-/,"-")}y=y.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(j,ce,I,T){return ce+I+T.substr(0,(x+_)%x)+"."+T.substr(_)+"E"})}else y=F.toExponential(D);return me.match(/E\+00$/)&&y.match(/e[+-]\d$/)&&(y=y.substr(0,y.length-1)+"0"+y.charAt(y.length-1)),me.match(/E\-/)&&y.match(/e\+/)&&(y=y.replace(/e\+/,"e")),y.replace("e","E")}function Me(me,F,y){if(me.charCodeAt(0)===40&&!F.match(H)){var D=F.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return y>=0?Me("n",D,y):"("+Me("n",D,-y)+")"}if(F.charCodeAt(F.length-1)===44)return We(me,F,y);if(F.indexOf("%")!==-1)return Xe(me,F,y);if(F.indexOf("E")!==-1)return Qe(F,y);if(F.charCodeAt(0)===36)return"$"+Me(me,F.substr(F.charAt(1)==" "?2:1),y);var x,_,$,j,ce=Math.abs(y),I=y<0?"-":"";if(F.match(/^00+$/))return I+i(ce,F.length);if(F.match(/^[#?]+$/))return x=""+y,y===0&&(x=""),x.length>F.length?x:pe(F.substr(0,F.length-x.length))+x;if(_=F.match(ee))return Z(_,ce,I);if(F.match(/^#+0+$/))return I+i(ce,F.length-F.indexOf("0"));if(_=F.match(K))return x=(""+y).replace(/^([^\.]+)$/,"$1."+pe(_[1])).replace(/\.$/,"."+pe(_[1])),x=x.replace(/\.(\d*)$/,function(te,q){return"."+q+n("0",pe(_[1]).length-q.length)}),F.indexOf("0.")!==-1?x:x.replace(/^0\./,".");if(F=F.replace(/^#+([0.])/,"$1"),_=F.match(/^(0*)\.(#*)$/))return I+(""+ce).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,_[1].length?"0.":".");if(_=F.match(/^#{1,3},##0(\.?)$/))return I+Q(""+ce);if(_=F.match(/^#,##0\.([#0]*0)$/))return y<0?"-"+Me(me,F,-y):Q(""+y)+"."+n("0",_[1].length);if(_=F.match(/^#,#*,#0/))return Me(me,F.replace(/^#,#*,/,""),y);if(_=F.match(/^([0#]+)(\\?-([0#]+))+$/))return x=r(Me(me,F.replace(/[\\-]/g,""),y)),$=0,r(r(F.replace(/\\/g,"")).replace(/[0#]/g,function(te){return $<x.length?x.charAt($++):te==="0"?"0":""}));if(F.match(ie))return x=Me(me,"##########",y),"("+x.substr(0,3)+") "+x.substr(3,3)+"-"+x.substr(6);var T="";if(_=F.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return $=Math.min(_[4].length,7),j=C(ce,Math.pow(10,$)-1,!1),x=""+I,T=ae("n",_[1],j[1]),T.charAt(T.length-1)==" "&&(T=T.substr(0,T.length-1)+"0"),x+=T+_[2]+"/"+_[3],T=s(j[2],$),T.length<_[4].length&&(T=pe(_[4].substr(_[4].length-T.length))+T),x+=T,x;if(_=F.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return $=Math.min(Math.max(_[1].length,_[4].length),7),j=C(ce,Math.pow(10,$)-1,!0),I+(j[0]||(j[1]?"":"0"))+" "+(j[1]?a(j[1],$)+_[2]+"/"+_[3]+s(j[2],$):n(" ",2*$+1+_[2].length+_[3].length));if(_=F.match(/^[#0?]+$/))return x=""+y,F.length<=x.length?x:pe(F.substr(0,F.length-x.length))+x;if(_=F.match(/^([#0]+)\.([#0]+)$/)){x=""+y.toFixed(Math.min(_[2].length,10)).replace(/([^0])0+$/,"$1"),$=x.indexOf(".");var P=F.indexOf(".")-$,W=F.length-x.length-P;return pe(F.substr(0,P)+x+F.substr(F.length-W))}if(_=F.match(/^00,000\.([#0]*0)$/))return y<0?"-"+Me(me,F,-y):Q(""+y).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(te){return"00,"+(te.length<3?i(0,3-te.length):"")+te})+"."+i(0,_[1].length);switch(F){case"###,###":case"##,###":case"#,###":var oe=Q(""+ce);return oe!=="0"?I+oe:"";default:if(F.match(/\.[0#?]*$/))return Me(me,F.slice(0,F.lastIndexOf(".")),y)+pe(F.slice(F.lastIndexOf(".")))}throw new Error("unsupported format |"+F+"|")}return function(F,y,D){return(D|0)===D?Me(F,y,D):Ie(F,y,D)}}();function ve(E){for(var G=[],U=!1,ue=0,V=0;ue<E.length;++ue)switch(E.charCodeAt(ue)){case 34:U=!U;break;case 95:case 42:case 92:++ue;break;case 59:G[G.length]=E.substr(V,ue-V),V=ue+1}if(G[G.length]=E.substr(V),U===!0)throw new Error("Format |"+E+"| unterminated string ");return G}e._split=ve;var J=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function ne(E){for(var G=0,U="",ue="";G<E.length;)switch(U=E.charAt(G)){case"G":f(E,G)&&(G+=6),G++;break;case'"':for(;E.charCodeAt(++G)!==34&&G<E.length;);++G;break;case"\\":G+=2;break;case"_":G+=2;break;case"@":++G;break;case"B":case"b":if(E.charAt(G+1)==="1"||E.charAt(G+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"上":if(E.substr(G,3).toUpperCase()==="A/P"||E.substr(G,5).toUpperCase()==="AM/PM"||E.substr(G,5).toUpperCase()==="上午/下午")return!0;++G;break;case"[":for(ue=U;E.charAt(G++)!=="]"&&G<E.length;)ue+=E.charAt(G);if(ue.match(J))return!0;break;case".":case"0":case"#":for(;G<E.length&&("0#?.,E+-%".indexOf(U=E.charAt(++G))>-1||U=="\\"&&E.charAt(G+1)=="-"&&"0#".indexOf(E.charAt(G+2))>-1););break;case"?":for(;E.charAt(++G)===U;);break;case"*":++G,(E.charAt(G)==" "||E.charAt(G)=="*")&&++G;break;case"(":case")":++G;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;G<E.length&&"0123456789".indexOf(E.charAt(++G))>-1;);break;case" ":++G;break;default:++G;break}return!1}e.is_date=ne;function se(E,G,U,ue){for(var V=[],ee="",L=0,Z="",K="t",H,ie,pe,ye="H";L<E.length;)switch(Z=E.charAt(L)){case"G":if(!f(E,L))throw new Error("unrecognized character "+Z+" in "+E);V[V.length]={t:"G",v:"General"},L+=7;break;case'"':for(ee="";(pe=E.charCodeAt(++L))!==34&&L<E.length;)ee+=String.fromCharCode(pe);V[V.length]={t:"t",v:ee},++L;break;case"\\":var we=E.charAt(++L),Ue=we==="("||we===")"?we:"t";V[V.length]={t:Ue,v:we},++L;break;case"_":V[V.length]={t:"t",v:" "},L+=2;break;case"@":V[V.length]={t:"T",v:G},++L;break;case"B":case"b":if(E.charAt(L+1)==="1"||E.charAt(L+1)==="2"){if(H==null&&(H=A(G,U,E.charAt(L+1)==="2"),H==null))return"";V[V.length]={t:"X",v:E.substr(L,2)},K=Z,L+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":Z=Z.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(G<0||H==null&&(H=A(G,U),H==null))return"";for(ee=Z;++L<E.length&&E.charAt(L).toLowerCase()===Z;)ee+=Z;Z==="m"&&K.toLowerCase()==="h"&&(Z="M"),Z==="h"&&(Z=ye),V[V.length]={t:Z,v:ee},K=Z;break;case"A":case"a":case"上":var De={t:Z,v:Z};if(H==null&&(H=A(G,U)),E.substr(L,3).toUpperCase()==="A/P"?(H!=null&&(De.v=H.H>=12?E.charAt(L+2):Z),De.t="T",ye="h",L+=3):E.substr(L,5).toUpperCase()==="AM/PM"?(H!=null&&(De.v=H.H>=12?"PM":"AM"),De.t="T",L+=5,ye="h"):E.substr(L,5).toUpperCase()==="上午/下午"?(H!=null&&(De.v=H.H>=12?"下午":"上午"),De.t="T",L+=5,ye="h"):(De.t="t",++L),H==null&&De.t==="T")return"";V[V.length]=De,K=Z;break;case"[":for(ee=Z;E.charAt(L++)!=="]"&&L<E.length;)ee+=E.charAt(L);if(ee.slice(-1)!=="]")throw'unterminated "[" block: |'+ee+"|";if(ee.match(J)){if(H==null&&(H=A(G,U),H==null))return"";V[V.length]={t:"Z",v:ee.toLowerCase()},K=ee.charAt(1)}else ee.indexOf("$")>-1&&(ee=(ee.match(/\$([^-\[\]]*)/)||[])[1]||"$",ne(E)||(V[V.length]={t:"t",v:ee}));break;case".":if(H!=null){for(ee=Z;++L<E.length&&(Z=E.charAt(L))==="0";)ee+=Z;V[V.length]={t:"s",v:ee};break}case"0":case"#":for(ee=Z;++L<E.length&&"0#?.,E+-%".indexOf(Z=E.charAt(L))>-1;)ee+=Z;V[V.length]={t:"n",v:ee};break;case"?":for(ee=Z;E.charAt(++L)===Z;)ee+=Z;V[V.length]={t:Z,v:ee},K=Z;break;case"*":++L,(E.charAt(L)==" "||E.charAt(L)=="*")&&++L;break;case"(":case")":V[V.length]={t:ue===1?"t":Z,v:Z},++L;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(ee=Z;L<E.length&&"0123456789".indexOf(E.charAt(++L))>-1;)ee+=E.charAt(L);V[V.length]={t:"D",v:ee};break;case" ":V[V.length]={t:Z,v:Z},++L;break;case"$":V[V.length]={t:"t",v:"$"},++L;break;default:if(",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(Z)===-1)throw new Error("unrecognized character "+Z+" in "+E);V[V.length]={t:"t",v:Z},++L;break}var Ie=0,We=0,Xe;for(L=V.length-1,K="t";L>=0;--L)switch(V[L].t){case"h":case"H":V[L].t=ye,K="h",Ie<1&&(Ie=1);break;case"s":(Xe=V[L].v.match(/\.0+$/))&&(We=Math.max(We,Xe[0].length-1)),Ie<3&&(Ie=3);case"d":case"y":case"M":case"e":K=V[L].t;break;case"m":K==="s"&&(V[L].t="M",Ie<2&&(Ie=2));break;case"X":break;case"Z":Ie<1&&V[L].v.match(/[Hh]/)&&(Ie=1),Ie<2&&V[L].v.match(/[Mm]/)&&(Ie=2),Ie<3&&V[L].v.match(/[Ss]/)&&(Ie=3)}switch(Ie){case 0:break;case 1:H.u>=.5&&(H.u=0,++H.S),H.S>=60&&(H.S=0,++H.M),H.M>=60&&(H.M=0,++H.H);break;case 2:H.u>=.5&&(H.u=0,++H.S),H.S>=60&&(H.S=0,++H.M);break}var Qe="",Me;for(L=0;L<V.length;++L)switch(V[L].t){case"t":case"T":case" ":case"D":break;case"X":V[L].v="",V[L].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":V[L].v=re(V[L].t.charCodeAt(0),V[L].v,H,We),V[L].t="t";break;case"n":case"?":for(Me=L+1;V[Me]!=null&&((Z=V[Me].t)==="?"||Z==="D"||(Z===" "||Z==="t")&&V[Me+1]!=null&&(V[Me+1].t==="?"||V[Me+1].t==="t"&&V[Me+1].v==="/")||V[L].t==="("&&(Z===" "||Z==="n"||Z===")")||Z==="t"&&(V[Me].v==="/"||V[Me].v===" "&&V[Me+1]!=null&&V[Me+1].t=="?"));)V[L].v+=V[Me].v,V[Me]={v:"",t:";"},++Me;Qe+=V[L].v,L=Me-1;break;case"G":V[L].t="t",V[L].v=z(G,U);break}var me="",F,y;if(Qe.length>0){Qe.charCodeAt(0)==40?(F=G<0&&Qe.charCodeAt(0)===45?-G:G,y=ae("n",Qe,F)):(F=G<0&&ue>1?-G:G,y=ae("n",Qe,F),F<0&&V[0]&&V[0].t=="t"&&(y=y.substr(1),V[0].v="-"+V[0].v)),Me=y.length-1;var D=V.length;for(L=0;L<V.length;++L)if(V[L]!=null&&V[L].t!="t"&&V[L].v.indexOf(".")>-1){D=L;break}var x=V.length;if(D===V.length&&y.indexOf("E")===-1){for(L=V.length-1;L>=0;--L)V[L]==null||"n?".indexOf(V[L].t)===-1||(Me>=V[L].v.length-1?(Me-=V[L].v.length,V[L].v=y.substr(Me+1,V[L].v.length)):Me<0?V[L].v="":(V[L].v=y.substr(0,Me+1),Me=-1),V[L].t="t",x=L);Me>=0&&x<V.length&&(V[x].v=y.substr(0,Me+1)+V[x].v)}else if(D!==V.length&&y.indexOf("E")===-1){for(Me=y.indexOf(".")-1,L=D;L>=0;--L)if(!(V[L]==null||"n?".indexOf(V[L].t)===-1)){for(ie=V[L].v.indexOf(".")>-1&&L===D?V[L].v.indexOf(".")-1:V[L].v.length-1,me=V[L].v.substr(ie+1);ie>=0;--ie)Me>=0&&(V[L].v.charAt(ie)==="0"||V[L].v.charAt(ie)==="#")&&(me=y.charAt(Me--)+me);V[L].v=me,V[L].t="t",x=L}for(Me>=0&&x<V.length&&(V[x].v=y.substr(0,Me+1)+V[x].v),Me=y.indexOf(".")+1,L=D;L<V.length;++L)if(!(V[L]==null||"n?(".indexOf(V[L].t)===-1&&L!==D)){for(ie=V[L].v.indexOf(".")>-1&&L===D?V[L].v.indexOf(".")+1:0,me=V[L].v.substr(0,ie);ie<V[L].v.length;++ie)Me<y.length&&(me+=y.charAt(Me++));V[L].v=me,V[L].t="t",x=L}}}for(L=0;L<V.length;++L)V[L]!=null&&"n?".indexOf(V[L].t)>-1&&(F=ue>1&&G<0&&L>0&&V[L-1].v==="-"?-G:G,V[L].v=ae(V[L].t,V[L].v,F),V[L].t="t");var _="";for(L=0;L!==V.length;++L)V[L]!=null&&(_+=V[L].v);return _}e._eval=se;var de=/\[[=<>]/,be=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function Ae(E,G){if(G==null)return!1;var U=parseFloat(G[2]);switch(G[1]){case"=":if(E==U)return!0;break;case">":if(E>U)return!0;break;case"<":if(E<U)return!0;break;case"<>":if(E!=U)return!0;break;case">=":if(E>=U)return!0;break;case"<=":if(E<=U)return!0;break}return!1}function Te(E,G){var U=ve(E),ue=U.length,V=U[ue-1].indexOf("@");if(ue<4&&V>-1&&--ue,U.length>4)throw new Error("cannot find right format for |"+U.join("|")+"|");if(typeof G!="number")return[4,U.length===4||V>-1?U[U.length-1]:"@"];switch(U.length){case 1:U=V>-1?["General","General","General",U[0]]:[U[0],U[0],U[0],"@"];break;case 2:U=V>-1?[U[0],U[0],U[0],U[1]]:[U[0],U[1],U[0],"@"];break;case 3:U=V>-1?[U[0],U[1],U[0],U[2]]:[U[0],U[1],U[2],"@"];break}var ee=G>0?U[0]:G<0?U[1]:U[2];if(U[0].indexOf("[")===-1&&U[1].indexOf("[")===-1)return[ue,ee];if(U[0].match(de)!=null||U[1].match(de)!=null){var L=U[0].match(be),Z=U[1].match(be);return Ae(G,L)?[ue,U[0]]:Ae(G,Z)?[ue,U[1]]:[ue,U[L!=null&&Z!=null?2:1]]}return[ue,ee]}function _e(E,G,U){U==null&&(U={});var ue="";switch(typeof E){case"string":E=="m/d/yy"&&U.dateNF?ue=U.dateNF:ue=E;break;case"number":E==14&&U.dateNF?ue=U.dateNF:ue=(U.table!=null?U.table:g)[E],ue==null&&(ue=U.table&&U.table[m[E]]||g[m[E]]),ue==null&&(ue=b[E]||"General");break}if(f(ue,0))return z(G,U);G instanceof Date&&(G=N(G,U.date1904));var V=Te(ue,G);if(f(V[1]))return z(G,U);if(G===!0)G="TRUE";else if(G===!1)G="FALSE";else if(G===""||G==null)return"";return se(V[1],G,U,V[0])}function ke(E,G){if(typeof G!="number"){G=+G||-1;for(var U=0;U<392;++U){if(g[U]==null){G<0&&(G=U);continue}if(g[U]==E){G=U;break}}G<0&&(G=391)}return g[G]=E,G}e.load=ke,e._table=g,e.get_table=function(){return g},e.load_table=function(G){for(var U=0;U!=392;++U)G[U]!==void 0&&ke(G[U],U)},e.init_table=p,e.format=_e};ME(Xa);const Ye=St,sd={latin:{halfRE:/[!-~]/g,fullRE:/[！-～]/g,delta:65248},hangul1:{halfRE:/[ﾡ-ﾾ]/g,fullRE:/[ᆨ-ᇂ]/g,delta:-60921},hangul2:{halfRE:/[ￂ-ￜ]/g,fullRE:/[ᅡ-ᅵ]/g,delta:-61025},kana:{delta:0,half:"｡｢｣､･ｦｧｨｩｪｫｬｭｮｯｰｱｲｳｴｵｶｷｸｹｺｻｼｽｾｿﾀﾁﾂﾃﾄﾅﾆﾇﾈﾉﾊﾋﾌﾍﾎﾏﾐﾑﾒﾓﾔﾕﾖﾗﾘﾙﾚﾛﾜﾝﾞﾟ",full:"。「」、・ヲァィゥェォャュョッーアイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワン゛゜"},extras:{delta:0,half:"¢£¬¯¦¥₩ |←↑→↓■°",full:"￠￡￢￣￤￥￦　￨￩￪￫￬￭￮"}},_E=t=>e=>t.delta?String.fromCharCode(e.charCodeAt(0)+t.delta):[...t.full][[...t.half].indexOf(e)],kE=t=>e=>t.delta?String.fromCharCode(e.charCodeAt(0)-t.delta):[...t.half][[...t.full].indexOf(e)],s0=(t,e)=>t[`${e}RE`]||new RegExp(`[${t[e]}]`,"g"),o0=Object.keys(sd).map(t=>sd[t]),PE=t=>o0.reduce((e,r)=>e.replace(s0(r,"half"),_E(r)),t),IE=t=>o0.reduce((e,r)=>e.replace(s0(r,"full"),kE(r)),t),$t={ASC:t=>(t=Ye.accept(t,M.STRING),IE(t)),BAHTTEXT:t=>{t=Ye.accept(t,M.NUMBER);try{return RE.bahttext(t)}catch(e){throw Error(`Error in https://github.com/jojoee/bahttext 
${e.toString()}`)}},CHAR:t=>{if(t=Ye.accept(t,M.NUMBER),t>255||t<1)throw B.VALUE;return String.fromCharCode(t)},CLEAN:t=>(t=Ye.accept(t,M.STRING),t.replace(/[\x00-\x1F]/g,"")),CODE:t=>{if(t=Ye.accept(t,M.STRING),t.length===0)throw B.VALUE;return t.charCodeAt(0)},CONCAT:(...t)=>{let e="";return Ye.flattenParams(t,M.STRING,!1,r=>{r=Ye.accept(r,M.STRING),e+=r}),e},CONCATENATE:(...t)=>{let e="";if(t.length===0)throw Error("CONCATENATE need at least one argument.");return t.forEach(r=>{r=Ye.accept(r,M.STRING),e+=r}),e},DBCS:t=>(t=Ye.accept(t,M.STRING),PE(t)),DOLLAR:(t,e)=>{t=Ye.accept(t,M.NUMBER),e=Ye.accept(e,M.NUMBER,2);const r=Array(e).fill("0").join("");return Xa.format(`$#,##0.${r}_);($#,##0.${r})`,t).trim()},EXACT:(t,e)=>(t=Ye.accept(t,[M.STRING]),e=Ye.accept(e,[M.STRING]),t===e),FIND:(t,e,r)=>{if(t=Ye.accept(t,M.STRING),e=Ye.accept(e,M.STRING),r=Ye.accept(r,M.NUMBER,1),r<1||r>e.length)throw B.VALUE;const n=e.indexOf(t,r-1);if(n===-1)throw B.VALUE;return n+1},FINDB:(t,e,r)=>$t.FIND(t,e,r),FIXED:(t,e,r)=>{t=Ye.accept(t,M.NUMBER),e=Ye.accept(e,M.NUMBER,2),r=Ye.accept(r,M.BOOLEAN,!1);const n=Array(e).fill("0").join(""),i=r?"":"#,";return Xa.format(`${i}##0.${n}_);(${i}##0.${n})`,t).trim()},LEFT:(t,e)=>{if(t=Ye.accept(t,M.STRING),e=Ye.accept(e,M.NUMBER,1),e<0)throw B.VALUE;return e>t.length?t:t.slice(0,e)},LEFTB:(t,e)=>$t.LEFT(t,e),LEN:t=>(t=Ye.accept(t,M.STRING),t.length),LENB:t=>$t.LEN(t),LOWER:t=>(t=Ye.accept(t,M.STRING),t.toLowerCase()),MID:(t,e,r)=>{if(t=Ye.accept(t,M.STRING),e=Ye.accept(e,M.NUMBER),r=Ye.accept(r,M.NUMBER),e>t.length)return"";if(e<1||r<1)throw B.VALUE;return t.slice(e-1,e+r-1)},MIDB:(t,e,r)=>$t.MID(t,e,r),NUMBERVALUE:(t,e,r)=>{if(t=Ye.accept(t,M.STRING),e=Ye.accept(e,M.STRING,"."),r=Ye.accept(r,M.STRING,","),t.length===0)return 0;if(e.length===0||r.length===0||(e=e[0],r=r[0],e===r||t.indexOf(e)<t.lastIndexOf(r)))throw B.VALUE;const n=t.replace(r,"").replace(e,".").replace(/[^\-0-9.%()]/g,"").match(/([(-]*)([0-9]*[.]*[0-9]+)([)]?)([%]*)/);if(!n)throw B.VALUE;const i=n[1].length,a=n[3].length,s=n[4].length;let l=Number(n[2]);if(i>1||i&&!a||!i&&a||isNaN(l))throw B.VALUE;return l/=100**s,i?-l:l},PHONETIC:()=>{},PROPER:t=>(t=Ye.accept(t,[M.STRING]),t=t.toLowerCase(),t=t.charAt(0).toUpperCase()+t.slice(1),t.replace(/(?:[^a-zA-Z])([a-zA-Z])/g,e=>e.toUpperCase())),REPLACE:(t,e,r,n)=>{t=Ye.accept(t,[M.STRING]),e=Ye.accept(e,[M.NUMBER]),r=Ye.accept(r,[M.NUMBER]),n=Ye.accept(n,[M.STRING]);const i=t.split("");return i.splice(e-1,r,n),i.join("")},REPLACEB:(t,e,r,n)=>$t.REPLACE(t,e,r,n),REPT:(t,e)=>{t=Ye.accept(t,M.STRING),e=Ye.accept(e,M.NUMBER);let r="";for(let n=0;n<e;n++)r+=t;return r},RIGHT:(t,e)=>{if(t=Ye.accept(t,M.STRING),e=Ye.accept(e,M.NUMBER,1),e<0)throw B.VALUE;const r=t.length;return e>r?t:t.slice(r-e)},RIGHTB:(t,e)=>$t.RIGHT(t,e),SEARCH:(t,e,r)=>{if(t=Ye.accept(t,M.STRING),e=Ye.accept(e,M.STRING),r=Ye.accept(r,M.NUMBER,1),r<1||r>e.length)throw B.VALUE;const n=tn.isWildCard(t)?tn.toRegex(t,"i"):t,i=e.slice(r-1).search(n);if(i===-1)throw B.VALUE;return i+r},SEARCHB:(t,e,r)=>$t.SEARCH(t,e,r),SUBSTITUTE:(...t)=>{throw console.log(t),B.NOT_IMPLEMENTED("SUBSTITUTE")},T:t=>(t=Ye.accept(t),typeof t=="string"?t:""),TEXT:(t,e)=>{t=Ye.accept(t,M.NUMBER),e=Ye.accept(e,M.STRING);try{return Xa.format(e,t)}catch(r){throw console.error(r),B.VALUE}},TEXTJOIN:(...t)=>{throw console.log(t),B.NOT_IMPLEMENTED("TEXTJOIN")},TRIM:t=>(t=Ye.accept(t,[M.STRING]),t.replace(/^\s+|\s+$/g,"")),UNICHAR:t=>{if(t=Ye.accept(t,[M.NUMBER]),t<=0)throw B.VALUE;return String.fromCharCode(t)},UNICODE:t=>$t.CODE(t),UPPER:t=>(t=Ye.accept(t,M.STRING),t.toUpperCase())},Lt=St,Hs=1e3*60*60*24,bu=new Date(Date.UTC(1900,0,1)),DE=[void 0,0,1,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,1,2,3,4,5,6,0],LE=[void 0,[1,2,3,4,5,6,7],[7,1,2,3,4,5,6],[6,0,1,2,3,4,5],void 0,void 0,void 0,void 0,void 0,void 0,void 0,[7,1,2,3,4,5,6],[6,7,1,2,3,4,5],[5,6,7,1,2,3,4],[4,5,6,7,1,2,3],[3,4,5,6,7,1,2],[2,3,4,5,6,7,1],[1,2,3,4,5,6,7]],od=[void 0,[6,0],[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],void 0,void 0,void 0,[0],[1],[2],[3],[4],[5],[6]],BE=/^\s*(\d\d?)\s*(:\s*\d\d?)?\s*(:\s*\d\d?)?\s*(pm|am)?\s*$/i,UE=/^\s*((\d\d?)\s*([-/])\s*(\d\d?))([\d:.apm\s]*)$/i,$E=/^\s*((\d\d?)\s*([-/])\s*(jan\w*|feb\w*|mar\w*|apr\w*|may\w*|jun\w*|jul\w*|aug\w*|sep\w*|oct\w*|nov\w*|dec\w*))([\d:.apm\s]*)$/i,FE=/^\s*((jan\w*|feb\w*|mar\w*|apr\w*|may\w*|jun\w*|jul\w*|aug\w*|sep\w*|oct\w*|nov\w*|dec\w*)\s*([-/])\s*(\d\d?))([\d:.apm\s]*)$/i;function VE(t){const e=t.match(UE),r=t.match($E),n=t.match(FE);return e?t=e[1]+e[3]+new Date().getFullYear()+e[5]:r?t=r[1]+r[3]+new Date().getFullYear()+r[5]:n&&(t=n[1]+n[3]+new Date().getFullYear()+n[5]),new Date(Date.parse(`${t} UTC`))}function WE(t){const e=t.match(BE);if(!e)return null;const r=e[2]?e[2]:":00",n=e[3]?e[3]:":00",i=e[4]?` ${e[4]}`:"",a=new Date(Date.parse(`1/1/1900 ${e[1]+r+n+i} UTC`));let s=new Date;return s=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds())),new Date(Date.UTC(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()))}function ii(t){const e=t>-22038912e5?2:1;return Math.floor((t-bu.getTime())/864e5)+e}function HE(t){if(t<0)throw B.VALUE;return t<=60?new Date(bu.getTime()+(t-1)*864e5):new Date(bu.getTime()+(t-2)*864e5)}function l0(t){if(t instanceof Date)return{date:t};t=Lt.accept(t);let e=!0,r;return isNaN(t)?(r=WE(t),r?e=!1:r=VE(t)):(t=Number(t),r=HE(t)),{date:r,isDateGiven:e}}function ft(t){return l0(t).date}function Cc(t,e){return t.getUTCFullYear()===e.getUTCFullYear()&&t.getUTCMonth()===e.getUTCMonth()&&t.getUTCDate()===e.getUTCDate()}function GE(t){return t===1900?!0:new Date(t,1,29).getMonth()===1}const In={DATE:(t,e,r)=>{if(t=Lt.accept(t,M.NUMBER),e=Lt.accept(e,M.NUMBER),r=Lt.accept(r,M.NUMBER),t<0||t>=1e4)throw B.NUM;return t<1900&&(t+=1900),ii(Date.UTC(t,e-1,r))},DATEDIF:(t,e,r)=>{if(t=ft(t),e=ft(e),r=Lt.accept(r,M.STRING).toLowerCase(),t>e)throw B.NUM;const n=e.getUTCFullYear()-t.getUTCFullYear(),i=e.getUTCMonth()-t.getUTCMonth(),a=e.getUTCDate()-t.getUTCDate();let s;switch(r){case"y":return s=i<0||i===0&&a<0?-1:0,s+n;case"m":return s=a<0?-1:0,n*12+i+s;case"d":return Math.floor(e-t)/Hs;case"md":return t.setUTCFullYear(e.getUTCFullYear()),a<0?t.setUTCMonth(e.getUTCMonth()-1):t.setUTCMonth(e.getUTCMonth()),Math.floor(e-t)/Hs;case"ym":return s=a<0?-1:0,(s+n*12+i)%12;case"yd":return i<0||i===0&&a<0?t.setUTCFullYear(e.getUTCFullYear()-1):t.setUTCFullYear(e.getUTCFullYear()),Math.floor(e-t)/Hs}},DATEVALUE:t=>{t=Lt.accept(t,M.STRING);const{date:e,isDateGiven:r}=l0(t);if(!r)return 0;const n=ii(e);if(n<0||n>2958465)throw B.VALUE;return n},DAY:t=>ft(t).getUTCDate(),DAYS:(t,e)=>{t=ft(t),e=ft(e);let r=0;return e<-22038912e5&&t>-22038912e5&&(r=1),Math.floor(t-e)/Hs+r},DAYS360:(t,e,r)=>{t=ft(t),e=ft(e),r=Lt.accept(r,M.BOOLEAN,!1),t.getUTCDate()===31&&t.setUTCDate(30),!r&&t.getUTCDate()<30&&e.getUTCDate()>30?e.setUTCMonth(e.getUTCMonth()+1,1):e.getUTCDate()===31&&e.setUTCDate(30);const n=e.getUTCFullYear()-t.getUTCFullYear(),i=e.getUTCMonth()-t.getUTCMonth(),a=e.getUTCDate()-t.getUTCDate();return i*30+a+n*12*30},EDATE:(t,e)=>(t=ft(t),e=Lt.accept(e,M.NUMBER),t.setUTCMonth(t.getUTCMonth()+e),ii(t)),EOMONTH:(t,e)=>(t=ft(t),e=Lt.accept(e,M.NUMBER),t.setUTCMonth(t.getUTCMonth()+e+1,0),ii(t)),HOUR:t=>ft(t).getUTCHours(),ISOWEEKNUM:t=>{const e=ft(t),r=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),n=r.getUTCDay();r.setUTCDate(r.getUTCDate()+4-n);const i=new Date(Date.UTC(r.getUTCFullYear(),0,1));return Math.ceil(((r.getTime()-i.getTime())/864e5+1)/7)},MINUTE:t=>ft(t).getUTCMinutes(),MONTH:t=>ft(t).getUTCMonth()+1,NETWORKDAYS:(t,e,r)=>{t=ft(t),e=ft(e);let n=1;if(t>e){n=-1;const s=t;t=e,e=s}const i=[];r!=null&&Lt.flattenParams([r],M.NUMBER,!1,s=>{i.push(ft(s))});let a=0;for(;t<=e;){if(t.getUTCDay()!==0&&t.getUTCDay()!==6){let s=!1;for(let l=0;l<i.length;l++)if(Cc(t,i[l])){s=!0;break}s||a++}t.setUTCDate(t.getUTCDate()+1)}return n*a},"NETWORKDAYS.INTL":(t,e,r,n)=>{t=ft(t),e=ft(e);let i=1;if(t>e){i=-1;const l=t;t=e,e=l}if(r=Lt.accept(r,null,1),r==="1111111")return 0;if(typeof r=="string"&&Number(r).toString()!==r){if(r.length!==7)throw B.VALUE;r=r.charAt(6)+r.slice(0,6);const l=[];for(let u=0;u<r.length;u++)r.charAt(u)==="1"&&l.push(u);r=l}else{if(typeof r!="number")throw B.VALUE;r=od[r]}const a=[];n!=null&&Lt.flattenParams([n],M.NUMBER,!1,l=>{a.push(ft(l))});let s=0;for(;t<=e;){let l=!1;for(let u=0;u<r.length;u++)if(r[u]===t.getUTCDay()){l=!0;break}if(!l){let u=!1;for(let c=0;c<a.length;c++)if(Cc(t,a[c])){u=!0;break}u||s++}t.setUTCDate(t.getUTCDate()+1)}return i*s},NOW:()=>{const t=new Date;return ii(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()))+(3600*t.getHours()+60*t.getMinutes()+t.getSeconds())/86400},SECOND:t=>ft(t).getUTCSeconds(),TIME:(t,e,r)=>{if(t=Lt.accept(t,M.NUMBER),e=Lt.accept(e,M.NUMBER),r=Lt.accept(r,M.NUMBER),t<0||t>32767||e<0||e>32767||r<0||r>32767)throw B.NUM;return(3600*t+60*e+r)/86400},TIMEVALUE:t=>(t=ft(t),(3600*t.getUTCHours()+60*t.getUTCMinutes()+t.getUTCSeconds())/86400),TODAY:()=>{const t=new Date;return ii(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()))},WEEKDAY:(t,e)=>{const r=ft(t);e=Lt.accept(e,M.NUMBER,1);const n=r.getUTCDay(),i=LE[e];if(!i)throw B.NUM;return i[n]},WEEKNUM:(t,e)=>{const r=ft(t);if(e=Lt.accept(e,M.NUMBER,1),e===21)return In.ISOWEEKNUM(t);const n=DE[e],i=new Date(Date.UTC(r.getUTCFullYear(),0,1)),a=i.getUTCDay()<n?1:0;return Math.ceil(((r-i.getTime())/864e5+1)/7)+a},WORKDAY:(t,e,r)=>In["WORKDAY.INTL"](t,e,1,r),"WORKDAY.INTL":(t,e,r,n)=>{if(t=ft(t),e=Lt.accept(e,M.NUMBER),r=Lt.accept(r,null,1),r==="1111111")throw B.VALUE;if(typeof r=="string"&&Number(r).toString()!==r){if(r.length!==7)throw B.VALUE;r=r.charAt(6)+r.slice(0,6);const s=[];for(let l=0;l<r.length;l++)r.charAt(l)==="1"&&s.push(l);r=s}else{if(typeof r!="number")throw B.VALUE;if(r=od[r],r==null)throw B.NUM}const i=[];n!=null&&Lt.flattenParams([n],M.NUMBER,!1,s=>{i.push(ft(s))}),t.setUTCDate(t.getUTCDate()+1);let a=0;for(;a<e;){let s=!1;for(let l=0;l<r.length;l++)if(r[l]===t.getUTCDay()){s=!0;break}if(!s){let l=!1;for(let u=0;u<i.length;u++)if(Cc(t,i[u])){l=!0;break}l||a++}t.setUTCDate(t.getUTCDate()+1)}return ii(t)-1},YEAR:t=>ft(t).getUTCFullYear(),YEARFRAC:(t,e,r)=>{if(t=ft(t),e=ft(e),t>e){const c=t;t=e,e=c}if(r=Lt.accept(r,M.NUMBER,0),r=Math.trunc(r),r<0||r>4)throw B.VALUE;let n=t.getUTCDate();const i=t.getUTCMonth()+1,a=t.getUTCFullYear();let s=e.getUTCDate();const l=e.getUTCMonth()+1,u=e.getUTCFullYear();switch(r){case 0:return n===31&&s===31?(n=30,s=30):n===31?n=30:n===30&&s===31&&(s=30),Math.abs(s+l*30+u*360-(n+i*30+a*360))/360;case 1:if(u-a<2){const h=GE(a)&&a!==1900?366:365;return In.DAYS(e,t)/h}const c=u-a+1,f=(new Date(u+1,0,1).getTime()-new Date(a,0,1).getTime())/1e3/60/60/24/c;return In.DAYS(e,t)/f;case 2:return Math.abs(In.DAYS(e,t)/360);case 3:return Math.abs(In.DAYS(e,t)/365);case 4:return Math.abs(s+l*30+u*360-(n+i*30+a*360))/360}throw B.VALUE}},zE={unaryOp:(t,e,r)=>{let n=1;if(t.forEach(i=>{if(i!=="+")if(i==="-")n=-n;else throw new Error(`Unrecognized prefix: ${i}`)}),e==null&&(e=0),n===1)return e;try{e=St.acceptNumber(e,r)}catch(i){if(i instanceof B)Array.isArray(e)&&(e=e[0][0]);else throw i}return typeof e=="number"&&isNaN(e)?B.VALUE:-e}},qE={percentOp:(t,e,r)=>{try{t=St.acceptNumber(t,r)}catch(n){if(n instanceof B)return n;throw n}if(e==="%")return t/100;throw new Error(`Unrecognized postfix: ${e}`)}},Pn={boolean:3,string:2,number:1},Hi={compareOp:(t,e,r,n,i)=>{t==null&&(t=0),r==null&&(r=0),n&&(t=t[0][0]),i&&(r=r[0][0]);const a=typeof t,s=typeof r;if(a===s)switch(e){case"=":return t===r;case">":return t>r;case"<":return t<r;case"<>":return t!==r;case"<=":return t<=r;case">=":return t>=r}else switch(e){case"=":return!1;case">":return Pn[a]>Pn[s];case"<":return Pn[a]<Pn[s];case"<>":return!0;case"<=":return Pn[a]<=Pn[s];case">=":return Pn[a]>=Pn[s]}throw Error("Infix.compareOp: Should not reach here.")},concatOp:(t,e,r,n,i)=>{console.log(e),t==null&&(t=""),r==null&&(r=""),n&&(t=t[0][0]),i&&(r=r[0][0]);const a=typeof t,s=typeof r;return a==="boolean"&&(t=t?"TRUE":"FALSE"),s==="boolean"&&(r=r?"TRUE":"FALSE"),`${t}${r}`},mathOp:(t,e,r,n,i)=>{t==null&&(t=0),r==null&&(r=0);try{t=St.acceptNumber(t,n),r=St.acceptNumber(r,i)}catch(a){if(a instanceof B)return a;throw a}switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return r===0?B.DIV0:t/r;case"^":return t**r}throw Error("Infix.mathOp: Should not reach here.")}},wc={compareOp:["<",">","=","<>","<=",">="],concatOp:["&"],mathOp:["+","-","*","/","^"]},Ne=St,Sc=[],Tc=[];function Ao(t){return t<=100?a0[t]:Sc[t]>0?Sc[t]:Sc[t]=Ao(t-1)*t}function c0(t){return t===1||t===0?1:t===2?2:Tc[t]>0?Tc[t]:Tc[t]=c0(t-2)*t}const Wt={ABS:t=>(t=Ne.accept(t,M.NUMBER),Math.abs(t)),AGGREGATE:(t,e,r,...n)=>{throw console.log(t,e,r,n),B.NOT_IMPLEMENTED("SWITCH")},ARABIC:t=>{if(t=Ne.accept(t,M.STRING).toUpperCase(),!/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/.test(t))throw new B("#VALUE!","Invalid roman numeral in ARABIC evaluation.");let e=0;const r={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};return t.replace(/[MDLV]|C[MD]?|X[CL]?|I[XV]?/g,n=>{e+=r[n]}),e},BASE:(t,e,r)=>{if(t=Ne.accept(t,M.NUMBER),t<0||t>=2**53||(e=Ne.accept(e,M.NUMBER),e<2||e>36)||(r=Ne.accept(r,M.NUMBER,0),r<0))throw B.NUM;const n=t.toString(e).toUpperCase();return new Array(Math.max(r+1-n.length,0)).join("0")+n},CEILING:(t,e)=>{if(t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER),e===0)return 0;if(t/e%1===0)return t;const r=Math.abs(e),n=Math.floor(Math.abs(t)/r);return t<0?e<0?-r*(n+1):-r*n:(n+1)*r},"CEILING.MATH":(t,e,r)=>{if(t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER,t>0?1:-1),r=Ne.accept(r,M.NUMBER,0),t>=0)return Wt.CEILING(t,e);const n=r?e:0;return Wt.CEILING(t,e)-n},"CEILING.PRECISE":(t,e)=>(t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER,1),Wt.CEILING(t,Math.abs(e))),COMBIN:(t,e)=>{if(t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER),t<0||e<0||t<e)throw B.NUM;const r=Wt.FACT(t),n=Wt.FACT(e);return r/n/Wt.FACT(t-e)},COMBINA:(t,e)=>{if(t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER),(t===0||t===1)&&e===0)return 1;if(t<0||e<0)throw B.NUM;return Wt.COMBIN(t+e-1,t-1)},DECIMAL:(t,e)=>{if(t=Ne.accept(t,M.STRING),e=Ne.accept(e,M.NUMBER),e=Math.trunc(e),e<2||e>36)throw B.NUM;const r=parseInt(t,e);if(isNaN(r))throw B.NUM;return r},DEGREES:t=>(t=Ne.accept(t,M.NUMBER),t*(180/Math.PI)),EVEN:t=>Wt.CEILING(t,-2),EXP:t=>(t=Ne.accept(t,M.NUMBER),Math.exp(t)),FACT:t=>{if(t=Ne.accept(t,M.NUMBER),t=Math.trunc(t),t>170||t<0)throw B.NUM;return t<=100?a0[t]:Ao(t)},FACTDOUBLE:t=>{if(t=Ne.accept(t,M.NUMBER),t=Math.trunc(t),t<-1)throw B.NUM;return t===-1?1:c0(t)},FLOOR:(t,e)=>{if(t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER),e===0)return 0;if(t>0&&e<0)throw B.NUM;if(t/e%1===0)return t;const r=Math.abs(e),n=Math.floor(Math.abs(t)/r);return t<0?e<0?-r*n:-r*(n+1):n*r},"FLOOR.MATH":(t,e,r)=>(t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER,t>0?1:-1),r=Ne.accept(r,M.NUMBER,0),r===0||t>=0?Wt.FLOOR(t,Math.abs(e)):Wt.FLOOR(t,e)+e),"FLOOR.PRECISE":(t,e)=>(t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER,1),Wt.FLOOR(t,Math.abs(e))),GCD:(...t)=>{const e=[];Ne.flattenParams(t,null,!1,s=>{if(s=typeof s=="boolean"?NaN:Number(s),isNaN(s))throw B.VALUE;if(s<0||s>9007199254740990)throw B.NUM;e.push(Math.trunc(s))},0);let r,n;const i=t.length;let a=Math.abs(e[0]);for(r=1;r<i;r++){for(n=Math.abs(e[r]);a&&n;)a>n?a%=n:n%=a;a+=n}return a},INT:t=>(t=Ne.accept(t,M.NUMBER),Math.floor(t)),"ISO.CEILING":(t,e)=>Wt["CEILING.PRECISE"](t,e),LCM:(...t)=>{const e=[];Ne.flattenParams(t,null,!1,i=>{if(i=typeof i=="boolean"?NaN:Number(i),isNaN(i))throw B.VALUE;if(i<0||i>9007199254740990)throw B.NUM;e.push(Math.trunc(i))},1);const r=e.length;let n=Math.abs(e[0]);for(let i=1;i<r;i++){let a=Math.abs(e[i]);const s=n;for(;n&&a;)n>a?n%=a:a%=n;n=Math.abs(s*e[i])/(n+a)}return n},LN:t=>(t=Ne.accept(t,M.NUMBER),Math.log(t)),LOG:(t,e)=>(t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER,10),Math.log(t)/Math.log(e)),LOG10:t=>(t=Ne.accept(t,M.NUMBER),Math.log10(t)),MDETERM:t=>{if(t=Ne.accept(t,M.ARRAY,void 0,!1,!0),t[0].length!==t.length)throw B.VALUE;const e=t.length,r=t[0].length;let n=0,i,a;if(e===1)return t[0][0];if(e===2)return t[0][0]*t[1][1]-t[0][1]*t[1][0];for(let s=0;s<r;s++){i=t[0][s],a=t[0][s];for(let l=1;l<e;l++)a*=t[l][((s+l)%r+r)%r],i*=t[l][((s-l)%r+r)%r];n+=a-i}return n},MINVERSE:t=>{throw console.log(t),B.NOT_IMPLEMENTED("MINVERSE")},MMULT:(t,e)=>{t=Ne.accept(t,M.ARRAY,void 0,!1,!0),e=Ne.accept(e,M.ARRAY,void 0,!1,!0);const r=t.length,n=t[0].length,i=e.length,a=e[0].length,s=new Array(r);if(n!==i)throw B.VALUE;for(let l=0;l<r;l++){s[l]=new Array(a);for(let u=0;u<a;u++){s[l][u]=0;for(let c=0;c<n;c++){const o=t[l][c],f=e[c][u];if(typeof o!="number"||typeof f!="number")throw B.VALUE;s[l][u]+=t[l][c]*e[c][u]}}}return s},MOD:(t,e)=>{if(t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER),e===0)throw B.DIV0;return t-e*Wt.INT(t/e)},MROUND:(t,e)=>{if(t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER),e===0)return 0;if(t>0&&e<0||t<0&&e>0)throw B.NUM;return t/e%1===0?t:Math.round(t/e)*e},MULTINOMIAL:(...t)=>{let e=0,r=1;return Ne.flattenParams(t,M.NUMBER,!1,n=>{if(n<0)throw B.NUM;e+=n,r*=Ao(n)}),Ao(e)/r},MUNIT:t=>{t=Ne.accept(t,M.NUMBER);const e=[];for(let r=0;r<t;r++){const n=[];for(let i=0;i<t;i++)r===i?n.push(1):n.push(0);e.push(n)}return e},ODD:t=>{if(t=Ne.accept(t,M.NUMBER),t===0)return 1;let e=Math.ceil(Math.abs(t));return e=e&1?e:e+1,t>0?e:-e},PI:()=>Math.PI,POWER:(t,e)=>(t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER),t**e),PRODUCT:(...t)=>{let e=1;return Ne.flattenParams(t,null,!0,(r,n)=>{const i=Number(r);n.isLiteral&&!isNaN(i)?e*=i:typeof r=="number"&&(e*=r)},1),e},QUOTIENT:(t,e)=>(t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER),Math.trunc(t/e)),RADIANS:t=>(t=Ne.accept(t,M.NUMBER),t/180*Math.PI),RAND:()=>Math.random(),RANDBETWEEN:(t,e)=>(t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER),Math.floor(Math.random()*(e-t+1)+t)),ROMAN:(t,e)=>{if(t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER,0),e!==0)throw Error("ROMAN: only allows form=0 (classic form).");const r=String(t).split(""),n=["","C","CC","CCC","CD","D","DC","DCC","DCCC","CM","","X","XX","XXX","XL","L","LX","LXX","LXXX","XC","","I","II","III","IV","V","VI","VII","VIII","IX"];let i="",a=3;for(;a--;)i=(n[+r.pop()+a*10]||"")+i;return new Array(+r.join("")+1).join("M")+i},ROUND:(t,e)=>{t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER);const r=Math.pow(10,Math.abs(e)),n=t>0?1:-1;return e>0?n*Math.round(Math.abs(t)*r)/r:e===0?n*Math.round(Math.abs(t)):n*Math.round(Math.abs(t)/r)*r},ROUNDDOWN:(t,e)=>{t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER);const r=Math.pow(10,Math.abs(e)),n=t>0?1:-1;if(e>0){const a=1/r*.5;return n*Math.round((Math.abs(t)-a)*r)/r}if(e===0)return n*Math.round(Math.abs(t)-.5);const i=r*.5;return n*Math.round((Math.abs(t)-i)/r)*r},ROUNDUP:(t,e)=>{t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER);const r=Math.pow(10,Math.abs(e)),n=t>0?1:-1;if(e>0){const a=1/r*.5;return n*Math.round((Math.abs(t)+a)*r)/r}if(e===0)return n*Math.round(Math.abs(t)+.5);const i=r*.5;return n*Math.round((Math.abs(t)+i)/r)*r},SERIESSUM:(t,e,r,n)=>{t=Ne.accept(t,M.NUMBER),e=Ne.accept(e,M.NUMBER),r=Ne.accept(r,M.NUMBER);let i=0,a;return Ne.flattenParams([n],M.NUMBER,!1,s=>{if(typeof s!="number")throw B.VALUE;i===0?a=s*Math.pow(t,e):a+=s*Math.pow(t,e+i*r),i++}),a},SIGN:t=>(t=Ne.accept(t,M.NUMBER),t>0?1:t===0?0:-1),SQRT:t=>{if(t=Ne.accept(t,M.NUMBER),t<0)throw B.NUM;return Math.sqrt(t)},SQRTPI:t=>{if(t=Ne.accept(t,M.NUMBER),t<0)throw B.NUM;return Math.sqrt(t*Math.PI)},SUBTOTAL:()=>{},SUM:(...t)=>{let e=0;return Ne.flattenParams(t,M.NUMBER,!0,(r,n)=>{n.isLiteral||typeof r=="number"?e+=r:Uo(r)&&(e+=Number(r))}),e},SUMIF:(t,e,r,n)=>{const i=Ne.retrieveRanges(t,e,n);e=i[0],n=i[1],r=Ne.retrieveArg(t,r);const a=r.isArray;r=yu.parse(Ne.accept(r));let s=0;return e.forEach((l,u)=>{l.forEach((c,o)=>{const f=n[u][o];typeof f=="number"&&(r.op==="wc"?r.match===r.value.test(c)&&(s+=f):Hi.compareOp(c,r.op,r.value,Array.isArray(c),a)&&(s+=f))})}),s},SUMIFS:()=>{},SUMPRODUCT:(t,...e)=>{t=Ne.accept(t,M.ARRAY,void 0,!1,!0),e.forEach(n=>{if(n=Ne.accept(n,M.ARRAY,void 0,!1,!0),t[0].length!==n[0].length||t.length!==n.length)throw B.VALUE;for(let i=0;i<t.length;i++)for(let a=0;a<t[0].length;a++)typeof t[i][a]!="number"&&(t[i][a]=0),typeof n[i][a]!="number"&&(n[i][a]=0),t[i][a]*=n[i][a]});let r=0;return t.forEach(n=>{n.forEach(i=>{r+=i})}),r},SUMSQ:(...t)=>{let e=0;return Ne.flattenParams(t,M.NUMBER,!0,(r,n)=>{(n.isLiteral||typeof r=="number")&&(e+=r**2)}),e},SUMX2MY2:(t,e)=>{const r=[],n=[];let i=0;if(Ne.flattenParams([t],null,!1,(a,s)=>{console.log(s),r.push(a)}),Ne.flattenParams([e],null,!1,(a,s)=>{console.log(s),n.push(a)}),r.length!==n.length)throw B.NA;for(let a=0;a<r.length;a++)typeof r[a]=="number"&&typeof n[a]=="number"&&(i+=r[a]**2-n[a]**2);return i},SUMX2PY2:(t,e)=>{const r=[],n=[];let i=0;if(Ne.flattenParams([t],null,!1,(a,s)=>{console.log(s),r.push(a)}),Ne.flattenParams([e],null,!1,(a,s)=>{console.log(s),n.push(a)}),r.length!==n.length)throw B.NA;for(let a=0;a<r.length;a++)typeof r[a]=="number"&&typeof n[a]=="number"&&(i+=r[a]**2+n[a]**2);return i},SUMXMY2:(t,e)=>{const r=[],n=[];let i=0;if(Ne.flattenParams([t],null,!1,(a,s)=>{console.log(s),r.push(a)}),Ne.flattenParams([e],null,!1,(a,s)=>{console.log(s),n.push(a)}),r.length!==n.length)throw B.NA;for(let a=0;a<r.length;a++)typeof r[a]=="number"&&typeof n[a]=="number"&&(i+=(r[a]-n[a])**2);return i},TRUNC:t=>(t=Ne.accept(t,M.NUMBER),Math.trunc(t))},kt=St,Ii=2**27-1,ld={ACOS:t=>{if(t=kt.accept(t,M.NUMBER),t>1||t<-1)throw B.NUM;return Math.acos(t)},ACOSH:t=>{if(t=kt.accept(t,M.NUMBER),t<1)throw B.NUM;return Math.acosh(t)},ACOT:t=>(t=kt.accept(t,M.NUMBER),Math.PI/2-Math.atan(t)),ACOTH:t=>{if(t=kt.accept(t,M.NUMBER),Math.abs(t)<=1)throw B.NUM;return Math.atanh(1/t)},ASIN:t=>{if(t=kt.accept(t,M.NUMBER),t>1||t<-1)throw B.NUM;return Math.asin(t)},ASINH:t=>(t=kt.accept(t,M.NUMBER),Math.asinh(t)),ATAN:t=>(t=kt.accept(t,M.NUMBER),Math.atan(t)),ATAN2:(t,e)=>{if(t=kt.accept(t,M.NUMBER),e=kt.accept(e,M.NUMBER),e===0&&t===0)throw B.DIV0;return Math.atan2(e,t)},ATANH:t=>{if(t=kt.accept(t,M.NUMBER),Math.abs(t)>1)throw B.NUM;return Math.atanh(t)},COS:t=>{if(t=kt.accept(t,M.NUMBER),Math.abs(t)>Ii)throw B.NUM;return Math.cos(t)},COSH:t=>(t=kt.accept(t,M.NUMBER),Math.cosh(t)),COT:t=>{if(t=kt.accept(t,M.NUMBER),Math.abs(t)>Ii)throw B.NUM;if(t===0)throw B.DIV0;return 1/Math.tan(t)},COTH:t=>{if(t=kt.accept(t,M.NUMBER),t===0)throw B.DIV0;return 1/Math.tanh(t)},CSC:t=>{if(t=kt.accept(t,M.NUMBER),Math.abs(t)>Ii)throw B.NUM;return 1/Math.sin(t)},CSCH:t=>{if(t=kt.accept(t,M.NUMBER),t===0)throw B.DIV0;return 1/Math.sinh(t)},SEC:t=>{if(t=kt.accept(t,M.NUMBER),Math.abs(t)>Ii)throw B.NUM;return 1/Math.cos(t)},SECH:t=>(t=kt.accept(t,M.NUMBER),1/Math.cosh(t)),SIN:t=>{if(t=kt.accept(t,M.NUMBER),Math.abs(t)>Ii)throw B.NUM;return Math.sin(t)},SINH:t=>(t=kt.accept(t,M.NUMBER),Math.sinh(t)),TAN:t=>{if(t=kt.accept(t,M.NUMBER),Math.abs(t)>Ii)throw B.NUM;return Math.tan(t)},TANH:t=>(t=kt.accept(t,M.NUMBER),Math.tanh(t))},Ur=St;function Rc(t){let e=0,r=0;return Ur.flattenParams(t,null,!0,n=>{const i=typeof n;i==="string"?n==="TRUE"?n=!0:n==="FALSE"&&(n=!1):i==="number"&&(n=!!n),typeof n=="boolean"&&(n===!0?e++:r++)}),[e,r]}const cd={AND:(...t)=>{const[e,r]=Rc(t);return e===0&&r===0?B.VALUE:e>0&&r===0},FALSE:()=>!1,IF:(t,e,r,n)=>(console.log(t),e=Ur.accept(e,M.BOOLEAN),r=Ur.accept(r),n=Ur.accept(n,null,!1),e?r:n),IFERROR:(t,e)=>t.value instanceof B?Ur.accept(e):Ur.accept(t),IFNA(t,e){if(arguments.length>2)throw B.TOO_MANY_ARGS("IFNA");return B.NA.equals(t.value)?Ur.accept(e):Ur.accept(t)},IFS:(...t)=>{if(t.length%2!==0)return new B("#N/A","IFS expects all arguments after position 0 to be in pairs.");for(let e=0;e<t.length/2;e++){const r=Ur.accept(t[e*2],M.BOOLEAN),n=Ur.accept(t[e*2+1]);if(r)return n}return B.NA},NOT:t=>(t=Ur.accept(t,M.BOOLEAN),!t),OR:(...t)=>{const[e,r]=Rc(t);return e===0&&r===0?B.VALUE:e>0},SWITCH:(...t)=>{throw console.log(t),B.NOT_IMPLEMENTED("SWITCH")},TRUE:()=>!0,XOR:(...t)=>{const[e,r]=Rc(t);return e===0&&r===0?B.VALUE:e%2===1}};var u0={};(function(t){(function(e){e(typeof DO_NOT_EXPORT_BESSEL>"u"?t:{})})(function(e){e.version="1.0.2";var r=Math;function n(o,f){for(var h=0,d=0;h<o.length;++h)d=f*d+o[h];return d}function i(o,f,h,d,p){if(f===0)return h;if(f===1)return d;for(var g=2/o,m=d,v=1;v<f;++v)m=d*v*g+p*h,h=d,d=m;return m}function a(o,f,h,d,p){return function(m,v){if(d){if(m===0)return d==1?-1/0:1/0;if(m<0)return NaN}if(v===0)return o(m);if(v===1)return f(m);if(v<0)return NaN;v|=0;var b=o(m),C=f(m);return i(m,v,b,C,p)}}var s=function(){var o=.636619772,f=[57568490574,-13362590354,6516196407e-1,-1121442418e-2,77392.33017,-184.9052456].reverse(),h=[57568490411,1029532985,9494680718e-3,59272.64853,267.8532712,1].reverse(),d=[1,-.001098628627,2734510407e-14,-2073370639e-15,2093887211e-16].reverse(),p=[-.01562499995,.0001430488765,-6911147651e-15,7621095161e-16,-934935152e-16].reverse();function g(O){var w=0,S=0,N=0,R=O*O;if(O<8)S=n(f,R),N=n(h,R),w=S/N;else{var k=O-.785398164;R=64/R,S=n(d,R),N=n(p,R),w=r.sqrt(o/O)*(r.cos(k)*S-r.sin(k)*N*8/O)}return w}var m=[72362614232,-7895059235,2423968531e-1,-2972611439e-3,15704.4826,-30.16036606].reverse(),v=[144725228442,2300535178,1858330474e-2,99447.43394,376.9991397,1].reverse(),b=[1,.00183105,-3516396496e-14,2457520174e-15,-240337019e-15].reverse(),C=[.04687499995,-.0002002690873,8449199096e-15,-88228987e-14,105787412e-15].reverse();function A(O){var w=0,S=0,N=0,R=O*O,k=r.abs(O)-2.356194491;return Math.abs(O)<8?(S=O*n(m,R),N=n(v,R),w=S/N):(R=64/R,S=n(b,R),N=n(C,R),w=r.sqrt(o/r.abs(O))*(r.cos(k)*S-r.sin(k)*N*8/r.abs(O)),O<0&&(w=-w)),w}return function O(w,S){if(S=Math.round(S),!isFinite(w))return isNaN(w)?w:0;if(S<0)return(S%2?-1:1)*O(w,-S);if(w<0)return(S%2?-1:1)*O(-w,S);if(S===0)return g(w);if(S===1)return A(w);if(w===0)return 0;var N=0;if(w>S)N=i(w,S,g(w),A(w),-1);else{for(var R=2*r.floor((S+r.floor(r.sqrt(40*S)))/2),k=!1,z=0,Y=0,re=1,Q=0,ae=2/w,ve=R;ve>0;ve--)Q=ve*ae*re-z,z=re,re=Q,r.abs(re)>1e10&&(re*=1e-10,z*=1e-10,N*=1e-10,Y*=1e-10),k&&(Y+=re),k=!k,ve==S&&(N=z);Y=2*Y-re,N/=Y}return N}}(),l=function(){var o=.636619772,f=[-2957821389,7062834065,-5123598036e-1,1087988129e-2,-86327.92757,228.4622733].reverse(),h=[40076544269,7452499648e-1,7189466438e-3,47447.2647,226.1030244,1].reverse(),d=[1,-.001098628627,2734510407e-14,-2073370639e-15,2093887211e-16].reverse(),p=[-.01562499995,.0001430488765,-6911147651e-15,7621095161e-16,-934945152e-16].reverse();function g(O){var w=0,S=0,N=0,R=O*O,k=O-.785398164;return O<8?(S=n(f,R),N=n(h,R),w=S/N+o*s(O,0)*r.log(O)):(R=64/R,S=n(d,R),N=n(p,R),w=r.sqrt(o/O)*(r.sin(k)*S+r.cos(k)*N*8/O)),w}var m=[-4900604943e3,127527439e4,-51534381390,7349264551e-1,-4237922726e-3,8511.937935].reverse(),v=[249958057e5,424441966400,3733650367,2245904002e-2,102042.605,354.9632885,1].reverse(),b=[1,.00183105,-3516396496e-14,2457520174e-15,-240337019e-15].reverse(),C=[.04687499995,-.0002002690873,8449199096e-15,-88228987e-14,105787412e-15].reverse();function A(O){var w=0,S=0,N=0,R=O*O,k=O-2.356194491;return O<8?(S=O*n(m,R),N=n(v,R),w=S/N+o*(s(O,1)*r.log(O)-1/O)):(R=64/R,S=n(b,R),N=n(C,R),w=r.sqrt(o/O)*(r.sin(k)*S+r.cos(k)*N*8/O)),w}return a(g,A,"BESSELY",1,-1)}(),u=function(){var o=[1,3.5156229,3.0899424,1.2067492,.2659732,.0360768,.0045813].reverse(),f=[.39894228,.01328592,.00225319,-.00157565,.00916281,-.02057706,.02635537,-.01647633,.00392377].reverse();function h(m){return m<=3.75?n(o,m*m/(3.75*3.75)):r.exp(r.abs(m))/r.sqrt(r.abs(m))*n(f,3.75/r.abs(m))}var d=[.5,.87890594,.51498869,.15084934,.02658733,.00301532,32411e-8].reverse(),p=[.39894228,-.03988024,-.00362018,.00163801,-.01031555,.02282967,-.02895312,.01787654,-.00420059].reverse();function g(m){return m<3.75?m*n(d,m*m/(3.75*3.75)):(m<0?-1:1)*r.exp(r.abs(m))/r.sqrt(r.abs(m))*n(p,3.75/r.abs(m))}return function m(v,b){if(b=Math.round(b),b===0)return h(v);if(b===1)return g(v);if(b<0)return NaN;if(r.abs(v)===0)return 0;if(v==1/0)return 1/0;var C=0,A,O=2/r.abs(v),w=0,S=1,N=0,R=2*r.round((b+r.round(r.sqrt(40*b)))/2);for(A=R;A>0;A--)N=A*O*S+w,w=S,S=N,r.abs(S)>1e10&&(S*=1e-10,w*=1e-10,C*=1e-10),A==b&&(C=w);return C*=m(v,0)/S,v<0&&b%2?-C:C}}(),c=function(){var o=[-.57721566,.4227842,.23069756,.0348859,.00262698,1075e-7,74e-7].reverse(),f=[1.25331414,-.07832358,.02189568,-.01062446,.00587872,-.0025154,53208e-8].reverse();function h(m){return m<=2?-r.log(m/2)*u(m,0)+n(o,m*m/4):r.exp(-m)/r.sqrt(m)*n(f,2/m)}var d=[1,.15443144,-.67278579,-.18156897,-.01919402,-.00110404,-4686e-8].reverse(),p=[1.25331414,.23498619,-.0365562,.01504268,-.00780353,.00325614,-68245e-8].reverse();function g(m){return m<=2?r.log(m/2)*u(m,1)+1/m*n(d,m*m/4):r.exp(-m)/r.sqrt(m)*n(p,2/m)}return a(h,g,"BESSELK",2,1)}();e.besselj=s,e.bessely=l,e.besseli=u,e.besselk=c})})(u0);const Gs=Df(u0);var f0={exports:{}};(function(t,e){(function(r,n){t.exports=n()})(Ce,function(){var r=function(n,i){var a=Array.prototype.concat,s=Array.prototype.slice,l=Object.prototype.toString;function u(b,C){var A=b>C?b:C;return n.pow(10,17-~~(n.log(A>0?A:-A)*n.LOG10E))}var c=Array.isArray||function(C){return l.call(C)==="[object Array]"};function o(b){return l.call(b)==="[object Function]"}function f(b){return typeof b=="number"?b-b===0:!1}function h(b){return a.apply([],b)}function d(){return new d._init(arguments)}d.fn=d.prototype,d._init=function(C){if(c(C[0]))if(c(C[0][0])){o(C[1])&&(C[0]=d.map(C[0],C[1]));for(var A=0;A<C[0].length;A++)this[A]=C[0][A];this.length=C[0].length}else this[0]=o(C[1])?d.map(C[0],C[1]):C[0],this.length=1;else if(f(C[0]))this[0]=d.seq.apply(null,C),this.length=1;else{if(C[0]instanceof d)return d(C[0].toArray());this[0]=[],this.length=1}return this},d._init.prototype=d.prototype,d._init.constructor=d,d.utils={calcRdx:u,isArray:c,isFunction:o,isNumber:f,toVector:h},d._random_fn=n.random,d.setRandom=function(C){if(typeof C!="function")throw new TypeError("fn is not a function");d._random_fn=C},d.extend=function(C){var A,O;if(arguments.length===1){for(O in C)d[O]=C[O];return this}for(A=1;A<arguments.length;A++)for(O in arguments[A])C[O]=arguments[A][O];return C},d.rows=function(C){return C.length||1},d.cols=function(C){return C[0].length||1},d.dimensions=function(C){return{rows:d.rows(C),cols:d.cols(C)}},d.row=function(C,A){return c(A)?A.map(function(O){return d.row(C,O)}):C[A]},d.rowa=function(C,A){return d.row(C,A)},d.col=function(C,A){if(c(A)){var O=d.arange(C.length).map(function(){return new Array(A.length)});return A.forEach(function(N,R){d.arange(C.length).forEach(function(k){O[k][R]=C[k][N]})}),O}for(var w=new Array(C.length),S=0;S<C.length;S++)w[S]=[C[S][A]];return w},d.cola=function(C,A){return d.col(C,A).map(function(O){return O[0]})},d.diag=function(C){for(var A=d.rows(C),O=new Array(A),w=0;w<A;w++)O[w]=[C[w][w]];return O},d.antidiag=function(C){for(var A=d.rows(C)-1,O=new Array(A),w=0;A>=0;A--,w++)O[w]=[C[w][A]];return O},d.transpose=function(C){var A=[],O,w,S,N,R;for(c(C[0])||(C=[C]),w=C.length,S=C[0].length,R=0;R<S;R++){for(O=new Array(w),N=0;N<w;N++)O[N]=C[N][R];A.push(O)}return A.length===1?A[0]:A},d.map=function(C,A,O){var w,S,N,R,k;for(c(C[0])||(C=[C]),S=C.length,N=C[0].length,R=O?C:new Array(S),w=0;w<S;w++)for(R[w]||(R[w]=new Array(N)),k=0;k<N;k++)R[w][k]=A(C[w][k],w,k);return R.length===1?R[0]:R},d.cumreduce=function(C,A,O){var w,S,N,R,k;for(c(C[0])||(C=[C]),S=C.length,N=C[0].length,R=O?C:new Array(S),w=0;w<S;w++)for(R[w]||(R[w]=new Array(N)),N>0&&(R[w][0]=C[w][0]),k=1;k<N;k++)R[w][k]=A(R[w][k-1],C[w][k]);return R.length===1?R[0]:R},d.alter=function(C,A){return d.map(C,A,!0)},d.create=function(C,A,O){var w=new Array(C),S,N;for(o(A)&&(O=A,A=C),S=0;S<C;S++)for(w[S]=new Array(A),N=0;N<A;N++)w[S][N]=O(S,N);return w};function p(){return 0}d.zeros=function(C,A){return f(A)||(A=C),d.create(C,A,p)};function g(){return 1}d.ones=function(C,A){return f(A)||(A=C),d.create(C,A,g)},d.rand=function(C,A){return f(A)||(A=C),d.create(C,A,d._random_fn)};function m(b,C){return b===C?1:0}d.identity=function(C,A){return f(A)||(A=C),d.create(C,A,m)},d.symmetric=function(C){var A=C.length,O,w;if(C.length!==C[0].length)return!1;for(O=0;O<A;O++)for(w=0;w<A;w++)if(C[w][O]!==C[O][w])return!1;return!0},d.clear=function(C){return d.alter(C,p)},d.seq=function(C,A,O,w){o(w)||(w=!1);var S=[],N=u(C,A),R=(A*N-C*N)/((O-1)*N),k=C,z;for(z=0;k<=A&&z<O;z++,k=(C*N+R*N*z)/N)S.push(w?w(k,z):k);return S},d.arange=function(C,A,O){var w=[],S;if(O=O||1,A===i&&(A=C,C=0),C===A||O===0)return[];if(C<A&&O<0)return[];if(C>A&&O>0)return[];if(O>0)for(S=C;S<A;S+=O)w.push(S);else for(S=C;S>A;S+=O)w.push(S);return w},d.slice=function(){function b(A,O,w,S){var N,R=[],k=A.length;if(O===i&&w===i&&S===i)return d.copy(A);if(O=O||0,w=w||A.length,O=O>=0?O:k+O,w=w>=0?w:k+w,S=S||1,O===w||S===0)return[];if(O<w&&S<0)return[];if(O>w&&S>0)return[];if(S>0)for(N=O;N<w;N+=S)R.push(A[N]);else for(N=O;N>w;N+=S)R.push(A[N]);return R}function C(A,O){var w,S;if(O=O||{},f(O.row)){if(f(O.col))return A[O.row][O.col];var N=d.rowa(A,O.row);return w=O.col||{},b(N,w.start,w.end,w.step)}if(f(O.col)){var R=d.cola(A,O.col);return S=O.row||{},b(R,S.start,S.end,S.step)}S=O.row||{},w=O.col||{};var k=b(A,S.start,S.end,S.step);return k.map(function(z){return b(z,w.start,w.end,w.step)})}return C}(),d.sliceAssign=function(C,A,O){var w,S;if(f(A.row)){if(f(A.col))return C[A.row][A.col]=O;A.col=A.col||{},A.col.start=A.col.start||0,A.col.end=A.col.end||C[0].length,A.col.step=A.col.step||1,w=d.arange(A.col.start,n.min(C.length,A.col.end),A.col.step);var N=A.row;return w.forEach(function(k,z){C[N][k]=O[z]}),C}if(f(A.col)){A.row=A.row||{},A.row.start=A.row.start||0,A.row.end=A.row.end||C.length,A.row.step=A.row.step||1,S=d.arange(A.row.start,n.min(C[0].length,A.row.end),A.row.step);var R=A.col;return S.forEach(function(k,z){C[k][R]=O[z]}),C}return O[0].length===i&&(O=[O]),A.row.start=A.row.start||0,A.row.end=A.row.end||C.length,A.row.step=A.row.step||1,A.col.start=A.col.start||0,A.col.end=A.col.end||C[0].length,A.col.step=A.col.step||1,S=d.arange(A.row.start,n.min(C.length,A.row.end),A.row.step),w=d.arange(A.col.start,n.min(C[0].length,A.col.end),A.col.step),S.forEach(function(k,z){w.forEach(function(Y,re){C[k][Y]=O[z][re]})}),C},d.diagonal=function(C){var A=d.zeros(C.length,C.length);return C.forEach(function(O,w){A[w][w]=O}),A},d.copy=function(C){return C.map(function(A){return f(A)?A:A.map(function(O){return O})})};var v=d.prototype;return v.length=0,v.push=Array.prototype.push,v.sort=Array.prototype.sort,v.splice=Array.prototype.splice,v.slice=Array.prototype.slice,v.toArray=function(){return this.length>1?s.call(this):s.call(this)[0]},v.map=function(C,A){return d(d.map(this,C,A))},v.cumreduce=function(C,A){return d(d.cumreduce(this,C,A))},v.alter=function(C){return d.alter(this,C),this},function(b){for(var C=0;C<b.length;C++)(function(A){v[A]=function(O){var w=this,S;return O?(setTimeout(function(){O.call(w,v[A].call(w))}),this):(S=d[A](this),c(S)?d(S):S)}})(b[C])}("transpose clear symmetric rows cols dimensions diag antidiag".split(" ")),function(b){for(var C=0;C<b.length;C++)(function(A){v[A]=function(O,w){var S=this;return w?(setTimeout(function(){w.call(S,v[A].call(S,O))}),this):d(d[A](this,O))}})(b[C])}("row col".split(" ")),function(b){for(var C=0;C<b.length;C++)(function(A){v[A]=function(){return d(d[A].apply(null,arguments))}})(b[C])}("create zeros ones rand identity".split(" ")),d}(Math);return function(n,i){var a=n.utils.isFunction;function s(c,o){return c-o}function l(c,o,f){return i.max(o,i.min(c,f))}n.sum=function(o){for(var f=0,h=o.length;--h>=0;)f+=o[h];return f},n.sumsqrd=function(o){for(var f=0,h=o.length;--h>=0;)f+=o[h]*o[h];return f},n.sumsqerr=function(o){for(var f=n.mean(o),h=0,d=o.length,p;--d>=0;)p=o[d]-f,h+=p*p;return h},n.sumrow=function(o){for(var f=0,h=o.length;--h>=0;)f+=o[h];return f},n.product=function(o){for(var f=1,h=o.length;--h>=0;)f*=o[h];return f},n.min=function(o){for(var f=o[0],h=0;++h<o.length;)o[h]<f&&(f=o[h]);return f},n.max=function(o){for(var f=o[0],h=0;++h<o.length;)o[h]>f&&(f=o[h]);return f},n.unique=function(o){for(var f={},h=[],d=0;d<o.length;d++)f[o[d]]||(f[o[d]]=!0,h.push(o[d]));return h},n.mean=function(o){return n.sum(o)/o.length},n.meansqerr=function(o){return n.sumsqerr(o)/o.length},n.geomean=function(o){var f=o.map(i.log),h=n.mean(f);return i.exp(h)},n.median=function(o){var f=o.length,h=o.slice().sort(s);return f&1?h[f/2|0]:(h[f/2-1]+h[f/2])/2},n.cumsum=function(o){return n.cumreduce(o,function(f,h){return f+h})},n.cumprod=function(o){return n.cumreduce(o,function(f,h){return f*h})},n.diff=function(o){var f=[],h=o.length,d;for(d=1;d<h;d++)f.push(o[d]-o[d-1]);return f},n.rank=function(c){var o,f=[],h={};for(o=0;o<c.length;o++){var d=c[o];h[d]?h[d]++:(h[d]=1,f.push(d))}var p=f.sort(s),g={},m=1;for(o=0;o<p.length;o++){var d=p[o],v=h[d],b=m,C=m+v-1,A=(b+C)/2;g[d]=A,m+=v}return c.map(function(O){return g[O]})},n.mode=function(o){var f=o.length,h=o.slice().sort(s),d=1,p=0,g=0,m=[],v;for(v=0;v<f;v++)h[v]===h[v+1]?d++:(d>p?(m=[h[v]],p=d,g=0):d===p&&(m.push(h[v]),g++),d=1);return g===0?m[0]:m},n.range=function(o){return n.max(o)-n.min(o)},n.variance=function(o,f){return n.sumsqerr(o)/(o.length-(f?1:0))},n.pooledvariance=function(o){var f=o.reduce(function(d,p){return d+n.sumsqerr(p)},0),h=o.reduce(function(d,p){return d+p.length},0);return f/(h-o.length)},n.deviation=function(c){for(var o=n.mean(c),f=c.length,h=new Array(f),d=0;d<f;d++)h[d]=c[d]-o;return h},n.stdev=function(o,f){return i.sqrt(n.variance(o,f))},n.pooledstdev=function(o){return i.sqrt(n.pooledvariance(o))},n.meandev=function(o){for(var f=n.mean(o),h=[],d=o.length-1;d>=0;d--)h.push(i.abs(o[d]-f));return n.mean(h)},n.meddev=function(o){for(var f=n.median(o),h=[],d=o.length-1;d>=0;d--)h.push(i.abs(o[d]-f));return n.median(h)},n.coeffvar=function(o){return n.stdev(o)/n.mean(o)},n.quartiles=function(o){var f=o.length,h=o.slice().sort(s);return[h[i.round(f/4)-1],h[i.round(f/2)-1],h[i.round(f*3/4)-1]]},n.quantiles=function(o,f,h,d){var p=o.slice().sort(s),g=[f.length],m=o.length,v,b,C,A,O,w;for(typeof h>"u"&&(h=3/8),typeof d>"u"&&(d=3/8),v=0;v<f.length;v++)b=f[v],C=h+b*(1-h-d),A=m*b+C,O=i.floor(l(A,1,m-1)),w=l(A-O,0,1),g[v]=(1-w)*p[O-1]+w*p[O];return g},n.percentile=function(o,f,h){var d=o.slice().sort(s),p=f*(d.length+(h?1:-1))+(h?0:1),g=parseInt(p),m=p-g;return g+1<d.length?d[g-1]+m*(d[g]-d[g-1]):d[g-1]},n.percentileOfScore=function(o,f,h){var d=0,p=o.length,g=!1,m,v;for(h==="strict"&&(g=!0),v=0;v<p;v++)m=o[v],(g&&m<f||!g&&m<=f)&&d++;return d/p},n.histogram=function(o,f){f=f||4;var h=n.min(o),d=(n.max(o)-h)/f,p=o.length,g=[],m;for(m=0;m<f;m++)g[m]=0;for(m=0;m<p;m++)g[i.min(i.floor((o[m]-h)/d),f-1)]+=1;return g},n.covariance=function(o,f){var h=n.mean(o),d=n.mean(f),p=o.length,g=new Array(p),m;for(m=0;m<p;m++)g[m]=(o[m]-h)*(f[m]-d);return n.sum(g)/(p-1)},n.corrcoeff=function(o,f){return n.covariance(o,f)/n.stdev(o,1)/n.stdev(f,1)},n.spearmancoeff=function(c,o){return c=n.rank(c),o=n.rank(o),n.corrcoeff(c,o)},n.stanMoment=function(o,f){for(var h=n.mean(o),d=n.stdev(o),p=o.length,g=0,m=0;m<p;m++)g+=i.pow((o[m]-h)/d,f);return g/o.length},n.skewness=function(o){return n.stanMoment(o,3)},n.kurtosis=function(o){return n.stanMoment(o,4)-3};var u=n.prototype;(function(c){for(var o=0;o<c.length;o++)(function(f){u[f]=function(h,d){var p=[],g=0,m=this;if(a(h)&&(d=h,h=!1),d)return setTimeout(function(){d.call(m,u[f].call(m,h))}),this;if(this.length>1){for(m=h===!0?this:this.transpose();g<m.length;g++)p[g]=n[f](m[g]);return p}return n[f](this[0],h)}})(c[o])})("cumsum cumprod".split(" ")),function(c){for(var o=0;o<c.length;o++)(function(f){u[f]=function(h,d){var p=[],g=0,m=this;if(a(h)&&(d=h,h=!1),d)return setTimeout(function(){d.call(m,u[f].call(m,h))}),this;if(this.length>1){for(f!=="sumrow"&&(m=h===!0?this:this.transpose());g<m.length;g++)p[g]=n[f](m[g]);return h===!0?n[f](n.utils.toVector(p)):p}return n[f](this[0],h)}})(c[o])}("sum sumsqrd sumsqerr sumrow product min max unique mean meansqerr geomean median diff rank mode range variance deviation stdev meandev meddev coeffvar quartiles histogram skewness kurtosis".split(" ")),function(c){for(var o=0;o<c.length;o++)(function(f){u[f]=function(){var h=[],d=0,p=this,g=Array.prototype.slice.call(arguments),m;if(a(g[g.length-1])){m=g[g.length-1];var v=g.slice(0,g.length-1);return setTimeout(function(){m.call(p,u[f].apply(p,v))}),this}else{m=void 0;var b=function(A){return n[f].apply(p,[A].concat(g))}}if(this.length>1){for(p=p.transpose();d<p.length;d++)h[d]=b(p[d]);return h}return b(this[0])}})(c[o])}("quantiles percentileOfScore".split(" "))}(r,Math),function(n,i){n.gammaln=function(s){var l=0,u=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18],c=1.000000000190015,o,f,h;for(h=(f=o=s)+5.5,h-=(o+.5)*i.log(h);l<6;l++)c+=u[l]/++f;return i.log(2.5066282746310007*c/o)-h},n.loggam=function(s){var l,u,c,o,f,h,d,p=[.08333333333333333,-.002777777777777778,.0007936507936507937,-.0005952380952380952,.0008417508417508418,-.001917526917526918,.00641025641025641,-.02955065359477124,.1796443723688307,-1.3924322169059];if(l=s,d=0,s==1||s==2)return 0;for(s<=7&&(d=i.floor(7-s),l=s+d),u=1/(l*l),c=2*i.PI,f=p[9],h=8;h>=0;h--)f*=u,f+=p[h];if(o=f/l+.5*i.log(c)+(l-.5)*i.log(l)-l,s<=7)for(h=1;h<=d;h++)o-=i.log(l-1),l-=1;return o},n.gammafn=function(s){var l=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],u=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535],c=!1,o=0,f=0,h=0,d=s,p,g,m,v;if(s>171.6243769536076)return 1/0;if(d<=0)if(v=d%1+36e-17,v)c=(d&1?-1:1)*i.PI/i.sin(i.PI*v),d=1-d;else return 1/0;for(m=d,d<1?g=d++:g=(d-=o=(d|0)-1)-1,p=0;p<8;++p)h=(h+l[p])*g,f=f*g+u[p];if(v=h/f+1,m<d)v/=m;else if(m>d)for(p=0;p<o;++p)v*=d,d++;return c&&(v=c/v),v},n.gammap=function(s,l){return n.lowRegGamma(s,l)*n.gammafn(s)},n.lowRegGamma=function(s,l){var u=n.gammaln(s),c=s,o=1/s,f=o,h=l+1-s,d=1/1e-30,p=1/h,g=p,m=1,v=-~(i.log(s>=1?s:1/s)*8.5+s*.4+17),b;if(l<0||s<=0)return NaN;if(l<s+1){for(;m<=v;m++)o+=f*=l/++c;return o*i.exp(-l+s*i.log(l)-u)}for(;m<=v;m++)b=-m*(m-s),h+=2,p=b*p+h,d=h+b/d,p=1/p,g*=p*d;return 1-g*i.exp(-l+s*i.log(l)-u)},n.factorialln=function(s){return s<0?NaN:n.gammaln(s+1)},n.factorial=function(s){return s<0?NaN:n.gammafn(s+1)},n.combination=function(s,l){return s>170||l>170?i.exp(n.combinationln(s,l)):n.factorial(s)/n.factorial(l)/n.factorial(s-l)},n.combinationln=function(s,l){return n.factorialln(s)-n.factorialln(l)-n.factorialln(s-l)},n.permutation=function(s,l){return n.factorial(s)/n.factorial(s-l)},n.betafn=function(s,l){if(!(s<=0||l<=0))return s+l>170?i.exp(n.betaln(s,l)):n.gammafn(s)*n.gammafn(l)/n.gammafn(s+l)},n.betaln=function(s,l){return n.gammaln(s)+n.gammaln(l)-n.gammaln(s+l)},n.betacf=function(s,l,u){var c=1e-30,o=1,f=l+u,h=l+1,d=l-1,p=1,g=1-f*s/h,m,v,b,C;for(i.abs(g)<c&&(g=c),g=1/g,C=g;o<=100&&(m=2*o,v=o*(u-o)*s/((d+m)*(l+m)),g=1+v*g,i.abs(g)<c&&(g=c),p=1+v/p,i.abs(p)<c&&(p=c),g=1/g,C*=g*p,v=-(l+o)*(f+o)*s/((l+m)*(h+m)),g=1+v*g,i.abs(g)<c&&(g=c),p=1+v/p,i.abs(p)<c&&(p=c),g=1/g,b=g*p,C*=b,!(i.abs(b-1)<3e-7));o++);return C},n.gammapinv=function(s,l){var u=0,c=l-1,o=1e-8,f=n.gammaln(l),h,d,p,g,m,v,b;if(s>=1)return i.max(100,l+100*i.sqrt(l));if(s<=0)return 0;for(l>1?(v=i.log(c),b=i.exp(c*(v-1)-f),m=s<.5?s:1-s,p=i.sqrt(-2*i.log(m)),h=(2.30753+p*.27061)/(1+p*(.99229+p*.04481))-p,s<.5&&(h=-h),h=i.max(.001,l*i.pow(1-1/(9*l)-h/(3*i.sqrt(l)),3))):(p=1-l*(.253+l*.12),s<p?h=i.pow(s/p,1/l):h=1-i.log(1-(s-p)/(1-p)));u<12;u++){if(h<=0)return 0;if(d=n.lowRegGamma(l,h)-s,l>1?p=b*i.exp(-(h-c)+c*(i.log(h)-v)):p=i.exp(-h+c*i.log(h)-f),g=d/p,h-=p=g/(1-.5*i.min(1,g*((l-1)/h-1))),h<=0&&(h=.5*(h+p)),i.abs(p)<o*h)break}return h},n.erf=function(s){var l=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18],u=l.length-1,c=!1,o=0,f=0,h,d,p,g;for(s<0&&(s=-s,c=!0),h=2/(2+s),d=4*h-2;u>0;u--)p=o,o=d*o-f+l[u],f=p;return g=h*i.exp(-s*s+.5*(l[0]+d*o)-f),c?g-1:1-g},n.erfc=function(s){return 1-n.erf(s)},n.erfcinv=function(s){var l=0,u,c,o,f;if(s>=2)return-100;if(s<=0)return 100;for(f=s<1?s:2-s,o=i.sqrt(-2*i.log(f/2)),u=-.70711*((2.30753+o*.27061)/(1+o*(.99229+o*.04481))-o);l<2;l++)c=n.erfc(u)-f,u+=c/(1.1283791670955126*i.exp(-u*u)-u*c);return s<1?u:-u},n.ibetainv=function(s,l,u){var c=1e-8,o=l-1,f=u-1,h=0,d,p,g,m,v,b,C,A,O,w,S;if(s<=0)return 0;if(s>=1)return 1;for(l>=1&&u>=1?(g=s<.5?s:1-s,m=i.sqrt(-2*i.log(g)),C=(2.30753+m*.27061)/(1+m*(.99229+m*.04481))-m,s<.5&&(C=-C),A=(C*C-3)/6,O=2/(1/(2*l-1)+1/(2*u-1)),w=C*i.sqrt(A+O)/O-(1/(2*u-1)-1/(2*l-1))*(A+5/6-2/(3*O)),C=l/(l+u*i.exp(2*w))):(d=i.log(l/(l+u)),p=i.log(u/(l+u)),m=i.exp(l*d)/l,v=i.exp(u*p)/u,w=m+v,s<m/w?C=i.pow(l*w*s,1/l):C=1-i.pow(u*w*(1-s),1/u)),S=-n.gammaln(l)-n.gammaln(u)+n.gammaln(l+u);h<10;h++){if(C===0||C===1)return C;if(b=n.ibeta(C,l,u)-s,m=i.exp(o*i.log(C)+f*i.log(1-C)+S),v=b/m,C-=m=v/(1-.5*i.min(1,v*(o/C-f/(1-C)))),C<=0&&(C=.5*(C+m)),C>=1&&(C=.5*(C+m+1)),i.abs(m)<c*C&&h>0)break}return C},n.ibeta=function(s,l,u){var c=s===0||s===1?0:i.exp(n.gammaln(l+u)-n.gammaln(l)-n.gammaln(u)+l*i.log(s)+u*i.log(1-s));return s<0||s>1?!1:s<(l+1)/(l+u+2)?c*n.betacf(s,l,u)/l:1-c*n.betacf(1-s,u,l)/u},n.randn=function(s,l){var u,c,o,f,h;if(l||(l=s),s)return n.create(s,l,function(){return n.randn()});do u=n._random_fn(),c=1.7156*(n._random_fn()-.5),o=u-.449871,f=i.abs(c)+.386595,h=o*o+f*(.196*f-.25472*o);while(h>.27597&&(h>.27846||c*c>-4*i.log(u)*u*u));return c/u},n.randg=function(s,l,u){var c=s,o,f,h,d,p,g;if(u||(u=l),s||(s=1),l)return g=n.zeros(l,u),g.alter(function(){return n.randg(s)}),g;s<1&&(s+=1),o=s-1/3,f=1/i.sqrt(9*o);do{do p=n.randn(),d=1+f*p;while(d<=0);d=d*d*d,h=n._random_fn()}while(h>1-.331*i.pow(p,4)&&i.log(h)>.5*p*p+o*(1-d+i.log(d)));if(s==c)return o*d;do h=n._random_fn();while(h===0);return i.pow(h,1/c)*o*d},function(a){for(var s=0;s<a.length;s++)(function(l){n.fn[l]=function(){return n(n.map(this,function(u){return n[l](u)}))}})(a[s])}("gammaln gammafn factorial factorialln".split(" ")),function(a){for(var s=0;s<a.length;s++)(function(l){n.fn[l]=function(){return n(n[l].apply(null,arguments))}})(a[s])}("randn".split(" "))}(r,Math),function(n,i){(function(c){for(var o=0;o<c.length;o++)(function(f){n[f]=function h(d,p,g){return this instanceof h?(this._a=d,this._b=p,this._c=g,this):new h(d,p,g)},n.fn[f]=function(h,d,p){var g=n[f](h,d,p);return g.data=this,g},n[f].prototype.sample=function(h){var d=this._a,p=this._b,g=this._c;return h?n.alter(h,function(){return n[f].sample(d,p,g)}):n[f].sample(d,p,g)},function(h){for(var d=0;d<h.length;d++)(function(p){n[f].prototype[p]=function(g){var m=this._a,v=this._b,b=this._c;return!g&&g!==0&&(g=this.data),typeof g!="number"?n.fn.map.call(g,function(C){return n[f][p](C,m,v,b)}):n[f][p](g,m,v,b)}})(h[d])}("pdf cdf inv".split(" ")),function(h){for(var d=0;d<h.length;d++)(function(p){n[f].prototype[p]=function(){return n[f][p](this._a,this._b,this._c)}})(h[d])}("mean median mode variance".split(" "))})(c[o])})("beta centralF cauchy chisquare exponential gamma invgamma kumaraswamy laplace lognormal noncentralt normal pareto studentt weibull uniform binomial negbin hypgeom poisson triangular tukey arcsine".split(" ")),n.extend(n.beta,{pdf:function(o,f,h){return o>1||o<0?0:f==1&&h==1?1:f<512&&h<512?i.pow(o,f-1)*i.pow(1-o,h-1)/n.betafn(f,h):i.exp((f-1)*i.log(o)+(h-1)*i.log(1-o)-n.betaln(f,h))},cdf:function(o,f,h){return o>1||o<0?(o>1)*1:n.ibeta(o,f,h)},inv:function(o,f,h){return n.ibetainv(o,f,h)},mean:function(o,f){return o/(o+f)},median:function(o,f){return n.ibetainv(.5,o,f)},mode:function(o,f){return(o-1)/(o+f-2)},sample:function(o,f){var h=n.randg(o);return h/(h+n.randg(f))},variance:function(o,f){return o*f/(i.pow(o+f,2)*(o+f+1))}}),n.extend(n.centralF,{pdf:function(o,f,h){var d,p,g;return o<0?0:f<=2?o===0&&f<2?1/0:o===0&&f===2?1:1/n.betafn(f/2,h/2)*i.pow(f/h,f/2)*i.pow(o,f/2-1)*i.pow(1+f/h*o,-(f+h)/2):(d=f*o/(h+o*f),p=h/(h+o*f),g=f*p/2,g*n.binomial.pdf((f-2)/2,(f+h-2)/2,d))},cdf:function(o,f,h){return o<0?0:n.ibeta(f*o/(f*o+h),f/2,h/2)},inv:function(o,f,h){return h/(f*(1/n.ibetainv(o,f/2,h/2)-1))},mean:function(o,f){return f>2?f/(f-2):void 0},mode:function(o,f){return o>2?f*(o-2)/(o*(f+2)):void 0},sample:function(o,f){var h=n.randg(o/2)*2,d=n.randg(f/2)*2;return h/o/(d/f)},variance:function(o,f){if(!(f<=4))return 2*f*f*(o+f-2)/(o*(f-2)*(f-2)*(f-4))}}),n.extend(n.cauchy,{pdf:function(o,f,h){return h<0?0:h/(i.pow(o-f,2)+i.pow(h,2))/i.PI},cdf:function(o,f,h){return i.atan((o-f)/h)/i.PI+.5},inv:function(c,o,f){return o+f*i.tan(i.PI*(c-.5))},median:function(o){return o},mode:function(o){return o},sample:function(o,f){return n.randn()*i.sqrt(1/(2*n.randg(.5)))*f+o}}),n.extend(n.chisquare,{pdf:function(o,f){return o<0?0:o===0&&f===2?.5:i.exp((f/2-1)*i.log(o)-o/2-f/2*i.log(2)-n.gammaln(f/2))},cdf:function(o,f){return o<0?0:n.lowRegGamma(f/2,o/2)},inv:function(c,o){return 2*n.gammapinv(c,.5*o)},mean:function(c){return c},median:function(o){return o*i.pow(1-2/(9*o),3)},mode:function(o){return o-2>0?o-2:0},sample:function(o){return n.randg(o/2)*2},variance:function(o){return 2*o}}),n.extend(n.exponential,{pdf:function(o,f){return o<0?0:f*i.exp(-f*o)},cdf:function(o,f){return o<0?0:1-i.exp(-f*o)},inv:function(c,o){return-i.log(1-c)/o},mean:function(c){return 1/c},median:function(c){return 1/c*i.log(2)},mode:function(){return 0},sample:function(o){return-1/o*i.log(n._random_fn())},variance:function(c){return i.pow(c,-2)}}),n.extend(n.gamma,{pdf:function(o,f,h){return o<0?0:o===0&&f===1?1/h:i.exp((f-1)*i.log(o)-o/h-n.gammaln(f)-f*i.log(h))},cdf:function(o,f,h){return o<0?0:n.lowRegGamma(f,o/h)},inv:function(c,o,f){return n.gammapinv(c,o)*f},mean:function(c,o){return c*o},mode:function(o,f){if(o>1)return(o-1)*f},sample:function(o,f){return n.randg(o)*f},variance:function(o,f){return o*f*f}}),n.extend(n.invgamma,{pdf:function(o,f,h){return o<=0?0:i.exp(-(f+1)*i.log(o)-h/o-n.gammaln(f)+f*i.log(h))},cdf:function(o,f,h){return o<=0?0:1-n.lowRegGamma(f,h/o)},inv:function(c,o,f){return f/n.gammapinv(1-c,o)},mean:function(c,o){return c>1?o/(c-1):void 0},mode:function(o,f){return f/(o+1)},sample:function(o,f){return f/n.randg(o)},variance:function(o,f){if(!(o<=2))return f*f/((o-1)*(o-1)*(o-2))}}),n.extend(n.kumaraswamy,{pdf:function(o,f,h){return o===0&&f===1?h:o===1&&h===1?f:i.exp(i.log(f)+i.log(h)+(f-1)*i.log(o)+(h-1)*i.log(1-i.pow(o,f)))},cdf:function(o,f,h){return o<0?0:o>1?1:1-i.pow(1-i.pow(o,f),h)},inv:function(o,f,h){return i.pow(1-i.pow(1-o,1/h),1/f)},mean:function(c,o){return o*n.gammafn(1+1/c)*n.gammafn(o)/n.gammafn(1+1/c+o)},median:function(o,f){return i.pow(1-i.pow(2,-1/f),1/o)},mode:function(o,f){if(o>=1&&f>=1&&o!==1&&f!==1)return i.pow((o-1)/(o*f-1),1/o)},variance:function(){throw new Error("variance not yet implemented")}}),n.extend(n.lognormal,{pdf:function(o,f,h){return o<=0?0:i.exp(-i.log(o)-.5*i.log(2*i.PI)-i.log(h)-i.pow(i.log(o)-f,2)/(2*h*h))},cdf:function(o,f,h){return o<0?0:.5+.5*n.erf((i.log(o)-f)/i.sqrt(2*h*h))},inv:function(c,o,f){return i.exp(-1.4142135623730951*f*n.erfcinv(2*c)+o)},mean:function(o,f){return i.exp(o+f*f/2)},median:function(o){return i.exp(o)},mode:function(o,f){return i.exp(o-f*f)},sample:function(o,f){return i.exp(n.randn()*f+o)},variance:function(o,f){return(i.exp(f*f)-1)*i.exp(2*o+f*f)}}),n.extend(n.noncentralt,{pdf:function(o,f,h){var d=1e-14;return i.abs(h)<d?n.studentt.pdf(o,f):i.abs(o)<d?i.exp(n.gammaln((f+1)/2)-h*h/2-.5*i.log(i.PI*f)-n.gammaln(f/2)):f/o*(n.noncentralt.cdf(o*i.sqrt(1+2/f),f+2,h)-n.noncentralt.cdf(o,f,h))},cdf:function(o,f,h){var d=1e-14,p=200;if(i.abs(h)<d)return n.studentt.cdf(o,f);var g=!1;o<0&&(g=!0,h=-h);for(var m=n.normal.cdf(-h,0,1),v=d+1,b=v,C=o*o/(o*o+f),A=0,O=i.exp(-h*h/2),w=i.exp(-h*h/2-.5*i.log(2)-n.gammaln(3/2))*h;A<p||b>d||v>d;)b=v,A>0&&(O*=h*h/(2*A),w*=h*h/(2*(A+1/2))),v=O*n.beta.cdf(C,A+.5,f/2)+w*n.beta.cdf(C,A+1,f/2),m+=.5*v,A++;return g?1-m:m}}),n.extend(n.normal,{pdf:function(o,f,h){return i.exp(-.5*i.log(2*i.PI)-i.log(h)-i.pow(o-f,2)/(2*h*h))},cdf:function(o,f,h){return .5*(1+n.erf((o-f)/i.sqrt(2*h*h)))},inv:function(c,o,f){return-1.4142135623730951*f*n.erfcinv(2*c)+o},mean:function(c){return c},median:function(o){return o},mode:function(c){return c},sample:function(o,f){return n.randn()*f+o},variance:function(c,o){return o*o}}),n.extend(n.pareto,{pdf:function(o,f,h){return o<f?0:h*i.pow(f,h)/i.pow(o,h+1)},cdf:function(o,f,h){return o<f?0:1-i.pow(f/o,h)},inv:function(o,f,h){return f/i.pow(1-o,1/h)},mean:function(o,f){if(!(f<=1))return f*i.pow(o,f)/(f-1)},median:function(o,f){return o*(f*i.SQRT2)},mode:function(o){return o},variance:function(c,o){if(!(o<=2))return c*c*o/(i.pow(o-1,2)*(o-2))}}),n.extend(n.studentt,{pdf:function(o,f){return f=f>1e100?1e100:f,1/(i.sqrt(f)*n.betafn(.5,f/2))*i.pow(1+o*o/f,-((f+1)/2))},cdf:function(o,f){var h=f/2;return n.ibeta((o+i.sqrt(o*o+f))/(2*i.sqrt(o*o+f)),h,h)},inv:function(c,o){var f=n.ibetainv(2*i.min(c,1-c),.5*o,.5);return f=i.sqrt(o*(1-f)/f),c>.5?f:-f},mean:function(o){return o>1?0:void 0},median:function(){return 0},mode:function(){return 0},sample:function(o){return n.randn()*i.sqrt(o/(2*n.randg(o/2)))},variance:function(o){return o>2?o/(o-2):o>1?1/0:void 0}}),n.extend(n.weibull,{pdf:function(o,f,h){return o<0||f<0||h<0?0:h/f*i.pow(o/f,h-1)*i.exp(-i.pow(o/f,h))},cdf:function(o,f,h){return o<0?0:1-i.exp(-i.pow(o/f,h))},inv:function(c,o,f){return o*i.pow(-i.log(1-c),1/f)},mean:function(c,o){return c*n.gammafn(1+1/o)},median:function(o,f){return o*i.pow(i.log(2),1/f)},mode:function(o,f){return f<=1?0:o*i.pow((f-1)/f,1/f)},sample:function(o,f){return o*i.pow(-i.log(n._random_fn()),1/f)},variance:function(o,f){return o*o*n.gammafn(1+2/f)-i.pow(n.weibull.mean(o,f),2)}}),n.extend(n.uniform,{pdf:function(o,f,h){return o<f||o>h?0:1/(h-f)},cdf:function(o,f,h){return o<f?0:o<h?(o-f)/(h-f):1},inv:function(c,o,f){return o+c*(f-o)},mean:function(o,f){return .5*(o+f)},median:function(o,f){return n.mean(o,f)},mode:function(){throw new Error("mode is not yet implemented")},sample:function(o,f){return o/2+f/2+(f/2-o/2)*(2*n._random_fn()-1)},variance:function(o,f){return i.pow(f-o,2)/12}});function a(c,o,f,h){for(var d=0,p=1,g=1,m=1,v=0,b=0,C;i.abs((g-b)/g)>h;)b=g,C=-(o+v)*(o+f+v)*c/(o+2*v)/(o+2*v+1),d=g+C*d,p=m+C*p,v=v+1,C=v*(f-v)*c/(o+2*v-1)/(o+2*v),g=d+C*g,m=p+C*m,d=d/m,p=p/m,g=g/m,m=1;return g/o}n.extend(n.binomial,{pdf:function(o,f,h){return h===0||h===1?f*h===o?1:0:n.combination(f,o)*i.pow(h,o)*i.pow(1-h,f-o)},cdf:function(o,f,h){var d,p=1e-10;if(o<0)return 0;if(o>=f)return 1;if(h<0||h>1||f<=0)return NaN;o=i.floor(o);var g=h,m=o+1,v=f-o,b=m+v,C=i.exp(n.gammaln(b)-n.gammaln(v)-n.gammaln(m)+m*i.log(g)+v*i.log(1-g));return g<(m+1)/(b+2)?d=C*a(g,m,v,p):d=1-C*a(1-g,v,m,p),i.round((1-d)*(1/p))/(1/p)}}),n.extend(n.negbin,{pdf:function(o,f,h){return o!==o>>>0?!1:o<0?0:n.combination(o+f-1,f-1)*i.pow(1-h,o)*i.pow(h,f)},cdf:function(o,f,h){var d=0,p=0;if(o<0)return 0;for(;p<=o;p++)d+=n.negbin.pdf(p,f,h);return d}}),n.extend(n.hypgeom,{pdf:function(o,f,h,d){if(o!==o|0)return!1;if(o<0||o<h-(f-d))return 0;if(o>d||o>h)return 0;if(h*2>f)return d*2>f?n.hypgeom.pdf(f-h-d+o,f,f-h,f-d):n.hypgeom.pdf(d-o,f,f-h,d);if(d*2>f)return n.hypgeom.pdf(h-o,f,h,f-d);if(h<d)return n.hypgeom.pdf(o,f,d,h);for(var p=1,g=0,m=0;m<o;m++){for(;p>1&&g<d;)p*=1-h/(f-g),g++;p*=(d-m)*(h-m)/((m+1)*(f-h-d+m+1))}for(;g<d;g++)p*=1-h/(f-g);return i.min(1,i.max(0,p))},cdf:function(o,f,h,d){if(o<0||o<h-(f-d))return 0;if(o>=d||o>=h)return 1;if(h*2>f)return d*2>f?n.hypgeom.cdf(f-h-d+o,f,f-h,f-d):1-n.hypgeom.cdf(d-o-1,f,f-h,d);if(d*2>f)return 1-n.hypgeom.cdf(h-o-1,f,h,f-d);if(h<d)return n.hypgeom.cdf(o,f,d,h);for(var p=1,g=1,m=0,v=0;v<o;v++){for(;p>1&&m<d;){var b=1-h/(f-m);g*=b,p*=b,m++}g*=(d-v)*(h-v)/((v+1)*(f-h-d+v+1)),p+=g}for(;m<d;m++)p*=1-h/(f-m);return i.min(1,i.max(0,p))}}),n.extend(n.poisson,{pdf:function(o,f){return f<0||o%1!==0||o<0?0:i.pow(f,o)*i.exp(-f)/n.factorial(o)},cdf:function(o,f){var h=[],d=0;if(o<0)return 0;for(;d<=o;d++)h.push(n.poisson.pdf(d,f));return n.sum(h)},mean:function(c){return c},variance:function(c){return c},sampleSmall:function(o){var f=1,h=0,d=i.exp(-o);do h++,f*=n._random_fn();while(f>d);return h-1},sampleLarge:function(o){var f=o,h,d,p,g,m,v,b,C,A,O;for(g=i.sqrt(f),m=i.log(f),b=.931+2.53*g,v=-.059+.02483*b,C=1.1239+1.1328/(b-3.4),A=.9277-3.6224/(b-2);;){if(d=i.random()-.5,p=i.random(),O=.5-i.abs(d),h=i.floor((2*v/O+b)*d+f+.43),O>=.07&&p<=A)return h;if(!(h<0||O<.013&&p>O)&&i.log(p)+i.log(C)-i.log(v/(O*O)+b)<=-f+h*m-n.loggam(h+1))return h}},sample:function(o){return o<10?this.sampleSmall(o):this.sampleLarge(o)}}),n.extend(n.triangular,{pdf:function(o,f,h,d){return h<=f||d<f||d>h?NaN:o<f||o>h?0:o<d?2*(o-f)/((h-f)*(d-f)):o===d?2/(h-f):2*(h-o)/((h-f)*(h-d))},cdf:function(o,f,h,d){return h<=f||d<f||d>h?NaN:o<=f?0:o>=h?1:o<=d?i.pow(o-f,2)/((h-f)*(d-f)):1-i.pow(h-o,2)/((h-f)*(h-d))},inv:function(o,f,h,d){return h<=f||d<f||d>h?NaN:o<=(d-f)/(h-f)?f+(h-f)*i.sqrt(o*((d-f)/(h-f))):f+(h-f)*(1-i.sqrt((1-o)*(1-(d-f)/(h-f))))},mean:function(o,f,h){return(o+f+h)/3},median:function(o,f,h){if(h<=(o+f)/2)return f-i.sqrt((f-o)*(f-h))/i.sqrt(2);if(h>(o+f)/2)return o+i.sqrt((f-o)*(h-o))/i.sqrt(2)},mode:function(o,f,h){return h},sample:function(o,f,h){var d=n._random_fn();return d<(h-o)/(f-o)?o+i.sqrt(d*(f-o)*(h-o)):f-i.sqrt((1-d)*(f-o)*(f-h))},variance:function(o,f,h){return(o*o+f*f+h*h-o*f-o*h-f*h)/18}}),n.extend(n.arcsine,{pdf:function(o,f,h){return h<=f?NaN:o<=f||o>=h?0:2/i.PI*i.pow(i.pow(h-f,2)-i.pow(2*o-f-h,2),-.5)},cdf:function(o,f,h){return o<f?0:o<h?2/i.PI*i.asin(i.sqrt((o-f)/(h-f))):1},inv:function(c,o,f){return o+(.5-.5*i.cos(i.PI*c))*(f-o)},mean:function(o,f){return f<=o?NaN:(o+f)/2},median:function(o,f){return f<=o?NaN:(o+f)/2},mode:function(){throw new Error("mode is not yet implemented")},sample:function(o,f){return(o+f)/2+(f-o)/2*i.sin(2*i.PI*n.uniform.sample(0,1))},variance:function(o,f){return f<=o?NaN:i.pow(f-o,2)/8}});function s(c){return c/i.abs(c)}n.extend(n.laplace,{pdf:function(o,f,h){return h<=0?0:i.exp(-i.abs(o-f)/h)/(2*h)},cdf:function(o,f,h){return h<=0?0:o<f?.5*i.exp((o-f)/h):1-.5*i.exp(-(o-f)/h)},mean:function(c){return c},median:function(c){return c},mode:function(c){return c},variance:function(c,o){return 2*o*o},sample:function(o,f){var h=n._random_fn()-.5;return o-f*s(h)*i.log(1-2*i.abs(h))}});function l(c,o,f){var h=12,d=6,p=-30,g=-50,m=60,v=8,b=3,C=2,A=3,O=[.9815606342467192,.9041172563704749,.7699026741943047,.5873179542866175,.3678314989981802,.1252334085114689],w=[.04717533638651183,.10693932599531843,.16007832854334622,.20316742672306592,.2334925365383548,.24914704581340277],S=c*.5;if(S>=v)return 1;var N=2*n.normal.cdf(S,0,1,1,0)-1;N>=i.exp(g/f)?N=i.pow(N,f):N=0;var R;c>b?R=C:R=A;for(var k=S,z=(v-S)/R,Y=k+z,re=0,Q=f-1,ae=1;ae<=R;ae++){for(var ve=0,J=.5*(Y+k),ne=.5*(Y-k),se=1;se<=h;se++){var de,be;d<se?(de=h-se+1,be=O[de-1]):(de=se,be=-O[de-1]);var Ae=ne*be,Te=J+Ae,_e=Te*Te;if(_e>m)break;var ke=2*n.normal.cdf(Te,0,1,1,0),E=2*n.normal.cdf(Te,c,1,1,0),G=ke*.5-E*.5;G>=i.exp(p/Q)&&(G=w[de-1]*i.exp(-(.5*_e))*i.pow(G,Q),ve+=G)}ve*=2*ne*f/i.sqrt(2*i.PI),re+=ve,k=Y,Y+=z}return N+=re,N<=i.exp(p/o)?0:(N=i.pow(N,o),N>=1?1:N)}function u(c,o,f){var h=.322232421088,d=.099348462606,p=-1,g=.588581570495,m=-.342242088547,v=.531103462366,b=-.204231210125,C=.10353775285,A=-453642210148e-16,O=.0038560700634,w=.8832,S=.2368,N=1.214,R=1.208,k=1.4142,z=120,Y=.5-.5*c,re=i.sqrt(i.log(1/(Y*Y))),Q=re+((((re*A+b)*re+m)*re+p)*re+h)/((((re*O+C)*re+v)*re+g)*re+d);f<z&&(Q+=(Q*Q*Q+Q)/f/4);var ae=w-S*Q;return f<z&&(ae+=-N/f+R*Q/f),Q*(ae*i.log(o-1)+k)}n.extend(n.tukey,{cdf:function(o,f,h){var d=1,p=f,g=16,m=8,v=-30,b=1e-14,C=100,A=800,O=5e3,w=25e3,S=1,N=.5,R=.25,k=.125,z=[.9894009349916499,.9445750230732326,.8656312023878318,.755404408355003,.6178762444026438,.45801677765722737,.2816035507792589,.09501250983763744],Y=[.027152459411754096,.062253523938647894,.09515851168249279,.12462897125553388,.14959598881657674,.16915651939500254,.18260341504492358,.1894506104550685];if(o<=0)return 0;if(h<2||d<1||p<2)return NaN;if(!Number.isFinite(o))return 1;if(h>w)return l(o,d,p);var re=h*.5,Q=re*i.log(h)-h*i.log(2)-n.gammaln(re),ae=re-1,ve=h*.25,J;h<=C?J=S:h<=A?J=N:h<=O?J=R:J=k,Q+=i.log(J);for(var ne=0,se=1;se<=50;se++){for(var de=0,be=(2*se-1)*J,Ae=1;Ae<=g;Ae++){var Te,_e;m<Ae?(Te=Ae-m-1,_e=Q+ae*i.log(be+z[Te]*J)-(z[Te]*J+be)*ve):(Te=Ae-1,_e=Q+ae*i.log(be-z[Te]*J)+(z[Te]*J-be)*ve);var ke;if(_e>=v){m<Ae?ke=o*i.sqrt((z[Te]*J+be)*.5):ke=o*i.sqrt((-(z[Te]*J)+be)*.5);var E=l(ke,d,p),G=E*Y[Te]*i.exp(_e);de+=G}}if(se*J>=1&&de<=b)break;ne+=de}if(de>b)throw new Error("tukey.cdf failed to converge");return ne>1&&(ne=1),ne},inv:function(c,o,f){var h=1,d=o,p=1e-4,g=50;if(f<2||h<1||d<2)return NaN;if(c<0||c>1)return NaN;if(c===0)return 0;if(c===1)return 1/0;var m=u(c,d,f),v=n.tukey.cdf(m,o,f)-c,b;v>0?b=i.max(0,m-1):b=m+1;for(var C=n.tukey.cdf(b,o,f)-c,A,O=1;O<g;O++){A=b-C*(b-m)/(C-v),v=C,m=b,A<0&&(A=0,C=-c),C=n.tukey.cdf(A,o,f)-c,b=A;var w=i.abs(b-m);if(w<p)return A}throw new Error("tukey.inv failed to converge")}})}(r,Math),function(n,i){var a=Array.prototype.push,s=n.utils.isArray;function l(u){return s(u)||u instanceof n}n.extend({add:function(c,o){return l(o)?(l(o[0])||(o=[o]),n.map(c,function(f,h,d){return f+o[h][d]})):n.map(c,function(f){return f+o})},subtract:function(c,o){return l(o)?(l(o[0])||(o=[o]),n.map(c,function(f,h,d){return f-o[h][d]||0})):n.map(c,function(f){return f-o})},divide:function(c,o){return l(o)?(l(o[0])||(o=[o]),n.multiply(c,n.inv(o))):n.map(c,function(f){return f/o})},multiply:function(c,o){var f,h,d,p,g,m,v,b;if(c.length===void 0&&o.length===void 0)return c*o;if(g=c.length,m=c[0].length,v=n.zeros(g,d=l(o)?o[0].length:m),b=0,l(o)){for(;b<d;b++)for(f=0;f<g;f++){for(p=0,h=0;h<m;h++)p+=c[f][h]*o[h][b];v[f][b]=p}return g===1&&b===1?v[0][0]:v}return n.map(c,function(C){return C*o})},outer:function(c,o){return n.multiply(c.map(function(f){return[f]}),[o])},dot:function(c,o){l(c[0])||(c=[c]),l(o[0])||(o=[o]);for(var f=c[0].length===1&&c.length!==1?n.transpose(c):c,h=o[0].length===1&&o.length!==1?n.transpose(o):o,d=[],p=0,g=f.length,m=f[0].length,v,b;p<g;p++){for(d[p]=[],v=0,b=0;b<m;b++)v+=f[p][b]*h[p][b];d[p]=v}return d.length===1?d[0]:d},pow:function(c,o){return n.map(c,function(f){return i.pow(f,o)})},exp:function(c){return n.map(c,function(o){return i.exp(o)})},log:function(c){return n.map(c,function(o){return i.log(o)})},abs:function(c){return n.map(c,function(o){return i.abs(o)})},norm:function(c,o){var f=0,h=0;for(isNaN(o)&&(o=2),l(c[0])&&(c=c[0]);h<c.length;h++)f+=i.pow(i.abs(c[h]),o);return i.pow(f,1/o)},angle:function(c,o){return i.acos(n.dot(c,o)/(n.norm(c)*n.norm(o)))},aug:function(c,o){var f=[],h;for(h=0;h<c.length;h++)f.push(c[h].slice());for(h=0;h<f.length;h++)a.apply(f[h],o[h]);return f},inv:function(c){for(var o=c.length,f=c[0].length,h=n.identity(o,f),d=n.gauss_jordan(c,h),p=[],g=0,m;g<o;g++)for(p[g]=[],m=f;m<d[0].length;m++)p[g][m-f]=d[g][m];return p},det:function u(c){if(c.length===2)return c[0][0]*c[1][1]-c[0][1]*c[1][0];for(var o=0,f=0;f<c.length;f++){for(var h=[],d=1;d<c.length;d++){h[d-1]=[];for(var p=0;p<c.length;p++)p<f?h[d-1][p]=c[d][p]:p>f&&(h[d-1][p-1]=c[d][p])}var g=f%2?-1:1;o+=u(h)*c[0][f]*g}return o},gauss_elimination:function(c,o){var f=0,h=0,d=c.length,p=c[0].length,g=1,m=0,v=[],b,C,A,O;for(c=n.aug(c,o),b=c[0].length,f=0;f<d;f++){for(C=c[f][f],h=f,O=f+1;O<p;O++)C<i.abs(c[O][f])&&(C=c[O][f],h=O);if(h!=f)for(O=0;O<b;O++)A=c[f][O],c[f][O]=c[h][O],c[h][O]=A;for(h=f+1;h<d;h++)for(g=c[h][f]/c[f][f],O=f;O<b;O++)c[h][O]=c[h][O]-g*c[f][O]}for(f=d-1;f>=0;f--){for(m=0,h=f+1;h<=d-1;h++)m=m+v[h]*c[f][h];v[f]=(c[f][b-1]-m)/c[f][f]}return v},gauss_jordan:function(c,o){var f=n.aug(c,o),h=f.length,d=f[0].length,p=0,g,m,v;for(m=0;m<h;m++){var b=m;for(v=m+1;v<h;v++)i.abs(f[v][m])>i.abs(f[b][m])&&(b=v);var C=f[m];for(f[m]=f[b],f[b]=C,v=m+1;v<h;v++)for(p=f[v][m]/f[m][m],g=m;g<d;g++)f[v][g]-=f[m][g]*p}for(m=h-1;m>=0;m--){for(p=f[m][m],v=0;v<m;v++)for(g=d-1;g>m-1;g--)f[v][g]-=f[m][g]*f[v][m]/p;for(f[m][m]/=p,g=h;g<d;g++)f[m][g]/=p}return f},triaUpSolve:function(c,o){var f=c[0].length,h=n.zeros(1,f)[0],d,p=!1;return o[0].length!=null&&(o=o.map(function(g){return g[0]}),p=!0),n.arange(f-1,-1,-1).forEach(function(g){d=n.arange(g+1,f).map(function(m){return h[m]*c[g][m]}),h[g]=(o[g]-n.sum(d))/c[g][g]}),p?h.map(function(g){return[g]}):h},triaLowSolve:function(c,o){var f=c[0].length,h=n.zeros(1,f)[0],d,p=!1;return o[0].length!=null&&(o=o.map(function(g){return g[0]}),p=!0),n.arange(f).forEach(function(g){d=n.arange(g).map(function(m){return c[g][m]*h[m]}),h[g]=(o[g]-n.sum(d))/c[g][g]}),p?h.map(function(g){return[g]}):h},lu:function(c){var o=c.length,f=n.identity(o),h=n.zeros(c.length,c[0].length),d;return n.arange(o).forEach(function(p){h[0][p]=c[0][p]}),n.arange(1,o).forEach(function(p){n.arange(p).forEach(function(g){d=n.arange(g).map(function(m){return f[p][m]*h[m][g]}),f[p][g]=(c[p][g]-n.sum(d))/h[g][g]}),n.arange(p,o).forEach(function(g){d=n.arange(p).map(function(m){return f[p][m]*h[m][g]}),h[p][g]=c[d.length][g]-n.sum(d)})}),[f,h]},cholesky:function(c){var o=c.length,f=n.zeros(c.length,c[0].length),h;return n.arange(o).forEach(function(d){h=n.arange(d).map(function(p){return i.pow(f[d][p],2)}),f[d][d]=i.sqrt(c[d][d]-n.sum(h)),n.arange(d+1,o).forEach(function(p){h=n.arange(d).map(function(g){return f[d][g]*f[p][g]}),f[p][d]=(c[d][p]-n.sum(h))/f[d][d]})}),f},gauss_jacobi:function(c,o,f,h){for(var d=0,p=0,g=c.length,m=[],v=[],b=[],C,A,O,w;d<g;d++)for(m[d]=[],v[d]=[],b[d]=[],p=0;p<g;p++)d>p?(m[d][p]=c[d][p],v[d][p]=b[d][p]=0):d<p?(v[d][p]=c[d][p],m[d][p]=b[d][p]=0):(b[d][p]=c[d][p],m[d][p]=v[d][p]=0);for(O=n.multiply(n.multiply(n.inv(b),n.add(m,v)),-1),A=n.multiply(n.inv(b),o),C=f,w=n.add(n.multiply(O,f),A),d=2;i.abs(n.norm(n.subtract(w,C)))>h;)C=w,w=n.add(n.multiply(O,C),A),d++;return w},gauss_seidel:function(c,o,f,h){for(var d=0,p=c.length,g=[],m=[],v=[],b,C,A,O,w;d<p;d++)for(g[d]=[],m[d]=[],v[d]=[],b=0;b<p;b++)d>b?(g[d][b]=c[d][b],m[d][b]=v[d][b]=0):d<b?(m[d][b]=c[d][b],g[d][b]=v[d][b]=0):(v[d][b]=c[d][b],g[d][b]=m[d][b]=0);for(O=n.multiply(n.multiply(n.inv(n.add(v,g)),m),-1),A=n.multiply(n.inv(n.add(v,g)),o),C=f,w=n.add(n.multiply(O,f),A),d=2;i.abs(n.norm(n.subtract(w,C)))>h;)C=w,w=n.add(n.multiply(O,C),A),d=d+1;return w},SOR:function(c,o,f,h,d){for(var p=0,g=c.length,m=[],v=[],b=[],C,A,O,w,S;p<g;p++)for(m[p]=[],v[p]=[],b[p]=[],C=0;C<g;C++)p>C?(m[p][C]=c[p][C],v[p][C]=b[p][C]=0):p<C?(v[p][C]=c[p][C],m[p][C]=b[p][C]=0):(b[p][C]=c[p][C],m[p][C]=v[p][C]=0);for(w=n.multiply(n.inv(n.add(b,n.multiply(m,d))),n.subtract(n.multiply(b,1-d),n.multiply(v,d))),O=n.multiply(n.multiply(n.inv(n.add(b,n.multiply(m,d))),o),d),A=f,S=n.add(n.multiply(w,f),O),p=2;i.abs(n.norm(n.subtract(S,A)))>h;)A=S,S=n.add(n.multiply(w,A),O),p++;return S},householder:function(c){for(var o=c.length,f=c[0].length,h=0,d=[],p=[],g,m,v,b,C;h<o-1;h++){for(g=0,b=h+1;b<f;b++)g+=c[b][h]*c[b][h];for(C=c[h+1][h]>0?-1:1,g=C*i.sqrt(g),m=i.sqrt((g*g-c[h+1][h]*g)/2),d=n.zeros(o,1),d[h+1][0]=(c[h+1][h]-g)/(2*m),v=h+2;v<o;v++)d[v][0]=c[v][h]/(2*m);p=n.subtract(n.identity(o,f),n.multiply(n.multiply(d,n.transpose(d)),2)),c=n.multiply(p,n.multiply(c,p))}return c},QR:function(){var u=n.sum,c=n.arange;function o(f){var h=f.length,d=f[0].length,p=n.zeros(d,d);f=n.copy(f);var g,m,v;for(m=0;m<d;m++){for(p[m][m]=i.sqrt(u(c(h).map(function(b){return f[b][m]*f[b][m]}))),g=0;g<h;g++)f[g][m]=f[g][m]/p[m][m];for(v=m+1;v<d;v++)for(p[m][v]=u(c(h).map(function(b){return f[b][m]*f[b][v]})),g=0;g<h;g++)f[g][v]=f[g][v]-f[g][m]*p[m][v]}return[f,p]}return o}(),lstsq:function(){function u(o){o=n.copy(o);var f=o.length,h=n.identity(f);return n.arange(f-1,-1,-1).forEach(function(d){n.sliceAssign(h,{row:d},n.divide(n.slice(h,{row:d}),o[d][d])),n.sliceAssign(o,{row:d},n.divide(n.slice(o,{row:d}),o[d][d])),n.arange(d).forEach(function(p){var g=n.multiply(o[p][d],-1),m=n.slice(o,{row:p}),v=n.multiply(n.slice(o,{row:d}),g);n.sliceAssign(o,{row:p},n.add(m,v));var b=n.slice(h,{row:p}),C=n.multiply(n.slice(h,{row:d}),g);n.sliceAssign(h,{row:p},n.add(b,C))})}),h}function c(o,f){var h=!1;f[0].length===void 0&&(f=f.map(function(w){return[w]}),h=!0);var d=n.QR(o),p=d[0],g=d[1],m=o[0].length,v=n.slice(p,{col:{end:m}}),b=n.slice(g,{row:{end:m}}),C=u(b),A=n.transpose(v);A[0].length===void 0&&(A=[A]);var O=n.multiply(n.multiply(C,A),f);return O.length===void 0&&(O=[[O]]),h?O.map(function(w){return w[0]}):O}return c}(),jacobi:function(c){for(var o=1,f=c.length,h=n.identity(f,f),d=[],p,g,m,v,b,C,A,O;o===1;){for(C=c[0][1],v=0,b=1,g=0;g<f;g++)for(m=0;m<f;m++)g!=m&&C<i.abs(c[g][m])&&(C=i.abs(c[g][m]),v=g,b=m);for(c[v][v]===c[b][b]?A=c[v][b]>0?i.PI/4:-i.PI/4:A=i.atan(2*c[v][b]/(c[v][v]-c[b][b]))/2,O=n.identity(f,f),O[v][v]=i.cos(A),O[v][b]=-i.sin(A),O[b][v]=i.sin(A),O[b][b]=i.cos(A),h=n.multiply(h,O),p=n.multiply(n.multiply(n.inv(O),c),O),c=p,o=0,g=1;g<f;g++)for(m=1;m<f;m++)g!=m&&i.abs(c[g][m])>.001&&(o=1)}for(g=0;g<f;g++)d.push(c[g][g]);return[h,d]},rungekutta:function(c,o,f,h,d,p){var g,m,v,b,C;if(p===2)for(;h<=f;)g=o*c(h,d),m=o*c(h+o,d+g),v=d+(g+m)/2,d=v,h=h+o;if(p===4)for(;h<=f;)g=o*c(h,d),m=o*c(h+o/2,d+g/2),b=o*c(h+o/2,d+m/2),C=o*c(h+o,d+b),v=d+(g+2*m+2*b+C)/6,d=v,h=h+o;return d},romberg:function(c,o,f,h){for(var d=0,p=(f-o)/2,g=[],m=[],v=[],b,C,A,O,w;d<h/2;){for(w=c(o),A=o,O=0;A<=f;A=A+p,O++)g[O]=A;for(b=g.length,A=1;A<b-1;A++)w+=(A%2!==0?4:2)*c(g[A]);w=p/3*(w+c(f)),v[d]=w,p/=2,d++}for(C=v.length,b=1;C!==1;){for(A=0;A<C-1;A++)m[A]=(i.pow(4,b)*v[A+1]-v[A])/(i.pow(4,b)-1);C=m.length,v=m,m=[],b++}return v},richardson:function(c,o,f,h){function d(S,N){for(var R=0,k=S.length,z;R<k;R++)S[R]===N&&(z=R);return z}for(var p=i.abs(f-c[d(c,f)+1]),g=0,m=[],v=[],b,C,A,O,w;h>=p;)b=d(c,f+h),C=d(c,f),m[g]=(o[b]-2*o[C]+o[2*C-b])/(h*h),h/=2,g++;for(O=m.length,A=1;O!=1;){for(w=0;w<O-1;w++)v[w]=(i.pow(4,A)*m[w+1]-m[w])/(i.pow(4,A)-1);O=v.length,m=v,v=[],A++}return m},simpson:function(c,o,f,h){for(var d=(f-o)/h,p=c(o),g=[],m=o,v=0,b=1,C;m<=f;m=m+d,v++)g[v]=m;for(C=g.length;b<C-1;b++)p+=(b%2!==0?4:2)*c(g[b]);return d/3*(p+c(f))},hermite:function(c,o,f,h){for(var d=c.length,p=0,g=0,m=[],v=[],b=[],C=[],A;g<d;g++){for(m[g]=1,A=0;A<d;A++)g!=A&&(m[g]*=(h-c[A])/(c[g]-c[A]));for(v[g]=0,A=0;A<d;A++)g!=A&&(v[g]+=1/(c[g]-c[A]));b[g]=(1-2*(h-c[g])*v[g])*(m[g]*m[g]),C[g]=(h-c[g])*(m[g]*m[g]),p+=b[g]*o[g]+C[g]*f[g]}return p},lagrange:function(c,o,f){for(var h=0,d=0,p,g,m=c.length;d<m;d++){for(g=o[d],p=0;p<m;p++)d!=p&&(g*=(f-c[p])/(c[d]-c[p]));h+=g}return h},cubic_spline:function(c,o,f){for(var h=c.length,d=0,p,g=[],m=[],v=[],b=[],C=[],A=[],O=[];d<h-1;d++)C[d]=c[d+1]-c[d];for(v[0]=0,d=1;d<h-1;d++)v[d]=3/C[d]*(o[d+1]-o[d])-3/C[d-1]*(o[d]-o[d-1]);for(d=1;d<h-1;d++)g[d]=[],m[d]=[],g[d][d-1]=C[d-1],g[d][d]=2*(C[d-1]+C[d]),g[d][d+1]=C[d],m[d][0]=v[d];for(b=n.multiply(n.inv(g),m),p=0;p<h-1;p++)A[p]=(o[p+1]-o[p])/C[p]-C[p]*(b[p+1][0]+2*b[p][0])/3,O[p]=(b[p+1][0]-b[p][0])/(3*C[p]);for(p=0;p<h&&!(c[p]>f);p++);return p-=1,o[p]+(f-c[p])*A[p]+n.sq(f-c[p])*b[p]+(f-c[p])*n.sq(f-c[p])*O[p]},gauss_quadrature:function(){throw new Error("gauss_quadrature not yet implemented")},PCA:function(c){var o=c.length,f=c[0].length,h=0,d,p,g=[],m=[],v=[],b=[],C=[],A=[],O=[],w=[],S=[],N=[];for(h=0;h<o;h++)g[h]=n.sum(c[h])/f;for(h=0;h<f;h++)for(O[h]=[],d=0;d<o;d++)O[h][d]=c[d][h]-g[d];for(O=n.transpose(O),h=0;h<o;h++)for(w[h]=[],d=0;d<o;d++)w[h][d]=n.dot([O[h]],[O[d]])/(f-1);for(v=n.jacobi(w),S=v[0],m=v[1],N=n.transpose(S),h=0;h<m.length;h++)for(d=h;d<m.length;d++)m[h]<m[d]&&(p=m[h],m[h]=m[d],m[d]=p,b=N[h],N[h]=N[d],N[d]=b);for(A=n.transpose(O),h=0;h<o;h++)for(C[h]=[],d=0;d<A.length;d++)C[h][d]=n.dot([N[h]],[A[d]]);return[c,m,N,C]}}),function(u){for(var c=0;c<u.length;c++)(function(o){n.fn[o]=function(f,h){var d=this;return h?(setTimeout(function(){h.call(d,n.fn[o].call(d,f))},15),this):typeof n[o](this,f)=="number"?n[o](this,f):n(n[o](this,f))}})(u[c])}("add divide multiply subtract dot pow exp log abs norm angle".split(" "))}(r,Math),function(n,i){var a=[].slice,s=n.utils.isNumber,l=n.utils.isArray;n.extend({zscore:function(){var o=a.call(arguments);return s(o[1])?(o[0]-o[1])/o[2]:(o[0]-n.mean(o[1]))/n.stdev(o[1],o[2])},ztest:function(){var o=a.call(arguments),f;return l(o[1])?(f=n.zscore(o[0],o[1],o[3]),o[2]===1?n.normal.cdf(-i.abs(f),0,1):n.normal.cdf(-i.abs(f),0,1)*2):o.length>2?(f=n.zscore(o[0],o[1],o[2]),o[3]===1?n.normal.cdf(-i.abs(f),0,1):n.normal.cdf(-i.abs(f),0,1)*2):(f=o[0],o[1]===1?n.normal.cdf(-i.abs(f),0,1):n.normal.cdf(-i.abs(f),0,1)*2)}}),n.extend(n.fn,{zscore:function(o,f){return(o-this.mean())/this.stdev(f)},ztest:function(o,f,h){var d=i.abs(this.zscore(o,h));return f===1?n.normal.cdf(-d,0,1):n.normal.cdf(-d,0,1)*2}}),n.extend({tscore:function(){var o=a.call(arguments);return o.length===4?(o[0]-o[1])/(o[2]/i.sqrt(o[3])):(o[0]-n.mean(o[1]))/(n.stdev(o[1],!0)/i.sqrt(o[1].length))},ttest:function(){var o=a.call(arguments),f;return o.length===5?(f=i.abs(n.tscore(o[0],o[1],o[2],o[3])),o[4]===1?n.studentt.cdf(-f,o[3]-1):n.studentt.cdf(-f,o[3]-1)*2):s(o[1])?(f=i.abs(o[0]),o[2]==1?n.studentt.cdf(-f,o[1]-1):n.studentt.cdf(-f,o[1]-1)*2):(f=i.abs(n.tscore(o[0],o[1])),o[2]==1?n.studentt.cdf(-f,o[1].length-1):n.studentt.cdf(-f,o[1].length-1)*2)}}),n.extend(n.fn,{tscore:function(o){return(o-this.mean())/(this.stdev(!0)/i.sqrt(this.cols()))},ttest:function(o,f){return f===1?1-n.studentt.cdf(i.abs(this.tscore(o)),this.cols()-1):n.studentt.cdf(-i.abs(this.tscore(o)),this.cols()-1)*2}}),n.extend({anovafscore:function(){var o=a.call(arguments),f,h,d,p,g,m,v,b;if(o.length===1){for(g=new Array(o[0].length),v=0;v<o[0].length;v++)g[v]=o[0][v];o=g}for(h=new Array,v=0;v<o.length;v++)h=h.concat(o[v]);for(d=n.mean(h),f=0,v=0;v<o.length;v++)f=f+o[v].length*i.pow(n.mean(o[v])-d,2);for(f/=o.length-1,m=0,v=0;v<o.length;v++)for(p=n.mean(o[v]),b=0;b<o[v].length;b++)m+=i.pow(o[v][b]-p,2);return m/=h.length-o.length,f/m},anovaftest:function(){var o=a.call(arguments),f,h,d,p;if(s(o[0]))return 1-n.centralF.cdf(o[0],o[1],o[2]);var g=n.anovafscore(o);for(f=o.length-1,d=0,p=0;p<o.length;p++)d=d+o[p].length;return h=d-f-1,1-n.centralF.cdf(g,f,h)},ftest:function(o,f,h){return 1-n.centralF.cdf(o,f,h)}}),n.extend(n.fn,{anovafscore:function(){return n.anovafscore(this.toArray())},anovaftes:function(){var o=0,f;for(f=0;f<this.length;f++)o=o+this[f].length;return n.ftest(this.anovafscore(),this.length-1,o-this.length)}}),n.extend({qscore:function(){var o=a.call(arguments),f,h,d,p,g;return s(o[0])?(f=o[0],h=o[1],d=o[2],p=o[3],g=o[4]):(f=n.mean(o[0]),h=n.mean(o[1]),d=o[0].length,p=o[1].length,g=o[2]),i.abs(f-h)/(g*i.sqrt((1/d+1/p)/2))},qtest:function(){var o=a.call(arguments),f;o.length===3?(f=o[0],o=o.slice(1)):o.length===7?(f=n.qscore(o[0],o[1],o[2],o[3],o[4]),o=o.slice(5)):(f=n.qscore(o[0],o[1],o[2]),o=o.slice(3));var h=o[0],d=o[1];return 1-n.tukey.cdf(f,d,h-d)},tukeyhsd:function(o){for(var f=n.pooledstdev(o),h=o.map(function(b){return n.mean(b)}),d=o.reduce(function(b,C){return b+C.length},0),p=[],g=0;g<o.length;++g)for(var m=g+1;m<o.length;++m){var v=n.qtest(h[g],h[m],o[g].length,o[m].length,f,d,o.length);p.push([[g,m],v])}return p}}),n.extend({normalci:function(){var o=a.call(arguments),f=new Array(2),h;return o.length===4?h=i.abs(n.normal.inv(o[1]/2,0,1)*o[2]/i.sqrt(o[3])):h=i.abs(n.normal.inv(o[1]/2,0,1)*n.stdev(o[2])/i.sqrt(o[2].length)),f[0]=o[0]-h,f[1]=o[0]+h,f},tci:function(){var o=a.call(arguments),f=new Array(2),h;return o.length===4?h=i.abs(n.studentt.inv(o[1]/2,o[3]-1)*o[2]/i.sqrt(o[3])):h=i.abs(n.studentt.inv(o[1]/2,o[2].length-1)*n.stdev(o[2],!0)/i.sqrt(o[2].length)),f[0]=o[0]-h,f[1]=o[0]+h,f},significant:function(o,f){return o<f}}),n.extend(n.fn,{normalci:function(o,f){return n.normalci(o,f,this.toArray())},tci:function(o,f){return n.tci(o,f,this.toArray())}});function u(c,o,f,h){if(c>1||f>1||c<=0||f<=0)throw new Error("Proportions should be greater than 0 and less than 1");var d=(c*o+f*h)/(o+h),p=i.sqrt(d*(1-d)*(1/o+1/h));return(c-f)/p}n.extend(n.fn,{oneSidedDifferenceOfProportions:function(o,f,h,d){var p=u(o,f,h,d);return n.ztest(p,1)},twoSidedDifferenceOfProportions:function(o,f,h,d){var p=u(o,f,h,d);return n.ztest(p,2)}})}(r,Math),r.models=function(){function n(u){var c=u[0].length,o=r.arange(c).map(function(f){var h=r.arange(c).filter(function(d){return d!==f});return i(r.col(u,f).map(function(d){return d[0]}),r.col(u,h))});return o}function i(u,c){var o=u.length,f=c[0].length-1,h=o-f-1,d=r.lstsq(c,u),p=r.multiply(c,d.map(function(O){return[O]})).map(function(O){return O[0]}),g=r.subtract(u,p),m=r.mean(u),v=r.sum(p.map(function(O){return Math.pow(O-m,2)})),b=r.sum(u.map(function(O,w){return Math.pow(O-p[w],2)})),C=v+b,A=v/C;return{exog:c,endog:u,nobs:o,df_model:f,df_resid:h,coef:d,predict:p,resid:g,ybar:m,SST:C,SSE:v,SSR:b,R2:A}}function a(u){var c=n(u.exog),o=Math.sqrt(u.SSR/u.df_resid),f=c.map(function(m){var v=m.SST,b=m.R2;return o/Math.sqrt(v*(1-b))}),h=u.coef.map(function(m,v){return(m-0)/f[v]}),d=h.map(function(m){var v=r.studentt.cdf(m,u.df_resid);return(v>.5?1-v:v)*2}),p=r.studentt.inv(.975,u.df_resid),g=u.coef.map(function(m,v){var b=p*f[v];return[m-b,m+b]});return{se:f,t:h,p:d,sigmaHat:o,interval95:g}}function s(u){var c=u.R2/u.df_model/((1-u.R2)/u.df_resid),o=function(h,d,p){return r.beta.cdf(h/(p/d+h),d/2,p/2)},f=1-o(c,u.df_model,u.df_resid);return{F_statistic:c,pvalue:f}}function l(u,c){var o=i(u,c),f=a(o),h=s(o),d=1-(1-o.R2)*((o.nobs-1)/o.df_resid);return o.t=f,o.f=h,o.adjust_R2=d,o}return{ols:l}}(),r.extend({buildxmatrix:function(){for(var i=new Array(arguments.length),a=0;a<arguments.length;a++){var s=[1];i[a]=s.concat(arguments[a])}return r(i)},builddxmatrix:function(){for(var i=new Array(arguments[0].length),a=0;a<arguments[0].length;a++){var s=[1];i[a]=s.concat(arguments[0][a])}return r(i)},buildjxmatrix:function(i){for(var a=new Array(i.length),s=0;s<i.length;s++)a[s]=i[s];return r.builddxmatrix(a)},buildymatrix:function(i){return r(i).transpose()},buildjymatrix:function(i){return i.transpose()},matrixmult:function(i,a){var s,l,u,c,o;if(i.cols()==a.rows()){if(a.rows()>1){for(c=[],s=0;s<i.rows();s++)for(c[s]=[],l=0;l<a.cols();l++){for(o=0,u=0;u<i.cols();u++)o+=i.toArray()[s][u]*a.toArray()[u][l];c[s][l]=o}return r(c)}for(c=[],s=0;s<i.rows();s++)for(c[s]=[],l=0;l<a.cols();l++){for(o=0,u=0;u<i.cols();u++)o+=i.toArray()[s][u]*a.toArray()[l];c[s][l]=o}return r(c)}},regress:function(i,a){var s=r.xtranspxinv(i),l=i.transpose(),u=r.matrixmult(r(s),l);return r.matrixmult(u,a)},regresst:function(i,a,s){var l=r.regress(i,a),u={};u.anova={};var c=r.jMatYBar(i,l);u.yBar=c;var o=a.mean();u.anova.residuals=r.residuals(a,c),u.anova.ssr=r.ssr(c,o),u.anova.msr=u.anova.ssr/(i[0].length-1),u.anova.sse=r.sse(a,c),u.anova.mse=u.anova.sse/(a.length-(i[0].length-1)-1),u.anova.sst=r.sst(a,o),u.anova.mst=u.anova.sst/(a.length-1),u.anova.r2=1-u.anova.sse/u.anova.sst,u.anova.r2<0&&(u.anova.r2=0),u.anova.fratio=u.anova.msr/u.anova.mse,u.anova.pvalue=r.anovaftest(u.anova.fratio,i[0].length-1,a.length-(i[0].length-1)-1),u.anova.rmse=Math.sqrt(u.anova.mse),u.anova.r2adj=1-u.anova.mse/u.anova.mst,u.anova.r2adj<0&&(u.anova.r2adj=0),u.stats=new Array(i[0].length);for(var f=r.xtranspxinv(i),h,d,p,g=0;g<l.length;g++)h=Math.sqrt(u.anova.mse*Math.abs(f[g][g])),d=Math.abs(l[g]/h),p=r.ttest(d,a.length-i[0].length-1,s),u.stats[g]=[l[g],h,d,p];return u.regress=l,u},xtranspx:function(i){return r.matrixmult(i.transpose(),i)},xtranspxinv:function(i){var a=r.matrixmult(i.transpose(),i),s=r.inv(a);return s},jMatYBar:function(i,a){var s=r.matrixmult(i,a);return new r(s)},residuals:function(i,a){return r.matrixsubtract(i,a)},ssr:function(i,a){for(var s=0,l=0;l<i.length;l++)s+=Math.pow(i[l]-a,2);return s},sse:function(i,a){for(var s=0,l=0;l<i.length;l++)s+=Math.pow(i[l]-a[l],2);return s},sst:function(i,a){for(var s=0,l=0;l<i.length;l++)s+=Math.pow(i[l]-a,2);return s},matrixsubtract:function(i,a){for(var s=new Array(i.length),l=0;l<i.length;l++){s[l]=new Array(i[l].length);for(var u=0;u<i[l].length;u++)s[l][u]=i[l][u]-a[l][u]}return r(s)}}),r.jStat=r,r})})(f0);var YE=f0.exports;const Ve=Df(YE),Ge=St,XE=536870911,QE=-536870912,Nc=511,zs=-512,KE=/^\s?[+-]?\s?[0-9]+[.]?[0-9]*([eE][+-][0-9]+)?\s?$/,jE=/^\s?([+-]?\s?([0-9]+[.]?[0-9]*([eE][+-][0-9]+)?)?)\s?[ij]\s?$/,ZE=/^\s?([+-]?\s?[0-9]+[.]?[0-9]*([eE][+-][0-9]+)?)\s?([+-]?\s?([0-9]+[.]?[0-9]*([eE][+-][0-9]+)?)?)\s?[ij]\s?$/;function Rt(t){t=Ge.accept(t);let e=0,r=0,n="i";if(typeof t=="number")return{real:t,im:r,unit:n};if(typeof t=="boolean")throw B.VALUE;let i=t.match(KE);if(i)return e=Number(i[0]),{real:e,im:r,unit:n};if(i=t.match(jE),i)return r=Number(/^\s?[+-]?\s?$/.test(i[1])?`${i[1]}1`:i[1]),n=i[0].slice(-1),{real:e,im:r,unit:n};if(i=t.match(ZE),i)return e=Number(i[1]),r=Number(/^\s?[+-]?\s?$/.test(i[3])?`${i[3]}1`:i[3]),n=i[0].slice(-1),{real:e,im:r,unit:n};throw B.NUM}const je={BESSELI:(t,e)=>{if(t=Ge.accept(t,M.NUMBER_NO_BOOLEAN),e=Ge.accept(e,M.NUMBER_NO_BOOLEAN),e=Math.trunc(e),e<0)throw B.NUM;return Gs.besseli(t,e)},BESSELJ:(t,e)=>{if(t=Ge.accept(t,M.NUMBER_NO_BOOLEAN),e=Ge.accept(e,M.NUMBER_NO_BOOLEAN),e=Math.trunc(e),e<0)throw B.NUM;return Gs.besselj(t,e)},BESSELK:(t,e)=>{if(t=Ge.accept(t,M.NUMBER_NO_BOOLEAN),e=Ge.accept(e,M.NUMBER_NO_BOOLEAN),e=Math.trunc(e),e<0)throw B.NUM;return Gs.besselk(t,e)},BESSELY:(t,e)=>{if(t=Ge.accept(t,M.NUMBER_NO_BOOLEAN),e=Ge.accept(e,M.NUMBER_NO_BOOLEAN),e=Math.trunc(e),e<0)throw B.NUM;return Gs.bessely(t,e)},BIN2DEC:t=>{t=Ge.accept(t,M.NUMBER_NO_BOOLEAN);const e=t.toString();if(e.length>10)throw B.NUM;return e.length===10&&e.substring(0,1)==="1"?parseInt(e.substring(1),2)+zs:parseInt(e,2)},BIN2HEX:(t,e)=>{t=Ge.accept(t,M.NUMBER_NO_BOOLEAN),e=Ge.accept(e,M.NUMBER_NO_BOOLEAN,null);const r=t.toString();if(r.length>10)throw B.NUM;if(r.length===10&&r.substring(0,1)==="1")return(parseInt(r.substring(1),2)+0xfffffffe00).toString(16).toUpperCase();const n=parseInt(t,2).toString(16);if(e==null)return n.toUpperCase();if(e<0)throw B.NUM;if(e=Math.trunc(e),e>=n.length)return($t.REPT("0",e-n.length)+n).toUpperCase();throw B.NUM},BIN2OCT:(t,e)=>{t=Ge.accept(t,M.NUMBER_NO_BOOLEAN),e=Ge.accept(e,M.NUMBER,null);const r=t.toString();if(r.length>10)throw B.NUM;if(r.length===10&&r.substr(0,1)==="1")return(parseInt(r.substr(1),2)+1073741312).toString(8);const n=parseInt(t,2).toString(8);if(e==null)return n.toUpperCase();if(e<0)throw B.NUM;if(e=Math.trunc(e),e>=n.length)return $t.REPT("0",e-n.length)+n;throw B.NUM},BITAND:(t,e)=>{if(t=Ge.accept(t,M.NUMBER),e=Ge.accept(e,M.NUMBER),t<0||e<0||Math.floor(t)!==t||Math.floor(e)!==e||t>0xffffffffffff||e>0xffffffffffff)throw B.NUM;return t&e},BITLSHIFT:(t,e)=>{if(t=Ge.accept(t,M.NUMBER),e=Ge.accept(e,M.NUMBER),e=Math.trunc(e),Math.abs(e)>53||t<0||Math.floor(t)!==t||t>0xffffffffffff)throw B.NUM;const r=e>=0?t*2**e:Math.trunc(t/2**-e);if(r>0xffffffffffff)throw B.NUM;return r},BITOR:(t,e)=>{if(t=Ge.accept(t,M.NUMBER),e=Ge.accept(e,M.NUMBER),t<0||e<0||Math.floor(t)!==t||Math.floor(e)!==e||t>0xffffffffffff||e>0xffffffffffff)throw B.NUM;return t|e},BITRSHIFT:(t,e)=>(t=Ge.accept(t,M.NUMBER),e=Ge.accept(e,M.NUMBER),je.BITLSHIFT(t,-e)),BITXOR:(t,e)=>{if(t=Ge.accept(t,M.NUMBER),e=Ge.accept(e,M.NUMBER),t<0||t>0xffffffffffff||Math.floor(t)!==t||e<0||e>0xffffffffffff||Math.floor(e)!==e)throw B.NUM;return t^e},COMPLEX:(t,e,r)=>{if(t=Ge.accept(t,M.NUMBER_NO_BOOLEAN),e=Ge.accept(e,M.NUMBER_NO_BOOLEAN),r=Ge.accept(r,M.STRING,"i"),r!=="i"&&r!=="j")throw B.VALUE;if(t===0&&e===0)return 0;if(t===0)return e===1?r:e===-1?`-${r}`:e.toString()+r;if(e===0)return t.toString();const n=e>0?"+":"";return e===1?t.toString()+n+r:e===-1?`${t.toString()+n}-${r}`:t.toString()+n+e.toString()+r},DEC2BIN:(t,e)=>{if(t=Ge.accept(t,M.NUMBER),e=Ge.accept(e,M.NUMBER,null),t<zs||t>Nc)throw B.NUM;if(t<0)return`1${$t.REPT("0",9-(512+t).toString(2).length)}${(512+t).toString(2)}`;const r=parseInt(t,10).toString(2);if(e==null)return r;if(e=Math.trunc(e),e<=0||e<r.length)throw B.NUM;return $t.REPT("0",e-r.length)+r},DEC2HEX:(t,e)=>{if(t=Ge.accept(t,M.NUMBER),e=Ge.accept(e,M.NUMBER,null),t<-549755813888||t>549755813888)throw B.NUM;if(t<0)return(1099511627776+t).toString(16).toUpperCase();const r=parseInt(t,10).toString(16);if(e==null)return r.toUpperCase();if(e=Math.trunc(e),e<=0||e<r.length)throw B.NUM;return $t.REPT("0",e-r.length)+r.toUpperCase()},DEC2OCT:(t,e)=>{if(t=Ge.accept(t,M.NUMBER),e=Ge.accept(e,M.NUMBER,null),t<-536870912||t>536870912)throw B.NUM;if(t<0)return(t+1073741824).toString(8);const r=parseInt(t,10).toString(8);if(e==null)return r.toUpperCase();if(e=Math.trunc(e),e<=0||e<r.length)throw B.NUM;return $t.REPT("0",e-r.length)+r},DELTA:(t,e)=>(t=Ge.accept(t,M.NUMBER_NO_BOOLEAN),e=Ge.accept(e,M.NUMBER_NO_BOOLEAN,0),t===e?1:0),ERF:(t,e)=>(t=Ge.accept(t,M.NUMBER_NO_BOOLEAN),e=Ge.accept(e,M.NUMBER_NO_BOOLEAN,0),Ve.erf(t)),ERFC:t=>(t=Ge.accept(t,M.NUMBER_NO_BOOLEAN),Ve.erfc(t)),GESTEP:(t,e)=>(t=Ge.accept(t,M.NUMBER_NO_BOOLEAN),e=Ge.accept(e,M.NUMBER_NO_BOOLEAN,0),t>=e?1:0),HEX2BIN:(t,e)=>{if(t=Ge.accept(t,M.STRING),e=Ge.accept(e,M.NUMBER,null),t.length>10||!/^[0-9a-fA-F]*$/.test(t))throw B.NUM;const r=t.length===10&&t.substr(0,1).toLowerCase()==="f",n=r?parseInt(t,16)-1099511627776:parseInt(t,16);if(n<zs||n>Nc)throw B.NUM;if(r)return`1${$t.REPT("0",9-(n+512).toString(2).length)}${(n+512).toString(2)}`;const i=n.toString(2);if(e==null)return i;if(e=Math.trunc(e),e<=0||e<i.length)throw B.NUM;return $t.REPT("0",e-i.length)+i},HEX2DEC:t=>{if(t=Ge.accept(t,M.STRING),t.length>10||!/^[0-9a-fA-F]*$/.test(t))throw B.NUM;const e=parseInt(t,16);return e>=549755813888?e-1099511627776:e},HEX2OCT:(t,e)=>{if(t=Ge.accept(t,M.STRING),t.length>10||!/^[0-9a-fA-F]*$/.test(t))throw B.NUM;const r=je.HEX2DEC(t);if(r>XE||r<QE)throw B.NUM;return je.DEC2OCT(r,e)},IMABS:t=>{const{real:e,im:r}=Rt(t);return Math.sqrt(Math.pow(e,2)+Math.pow(r,2))},IMAGINARY:t=>Rt(t).im,IMARGUMENT:t=>{const{real:e,im:r}=Rt(t);if(e===0&&r===0)throw B.DIV0;return e===0&&r>0?Math.PI/2:e===0&&r<0?-Math.PI/2:e<0&&r===0?Math.PI:e>0&&r===0?0:e>0?Math.atan(r/e):e<0&&r>0?Math.atan(r/e)+Math.PI:Math.atan(r/e)-Math.PI},IMCONJUGATE:t=>{const{real:e,im:r,unit:n}=Rt(t);return r!==0?je.COMPLEX(e,-r,n):`${e}`},IMCOS:t=>{const{real:e,im:r,unit:n}=Rt(t),i=Math.cos(e)*(Math.exp(r)+Math.exp(-r))/2,a=-Math.sin(e)*(Math.exp(r)-Math.exp(-r))/2;return je.COMPLEX(i,a,n)},IMCOSH:t=>{const{real:e,im:r,unit:n}=Rt(t),i=Math.cos(r)*(Math.exp(e)+Math.exp(-e))/2,a=-Math.sin(r)*(Math.exp(e)-Math.exp(-e))/2;return je.COMPLEX(i,-a,n)},IMCOT:t=>{t=Ge.accept(t);const e=je.IMCOS(t),r=je.IMSIN(t);return je.IMDIV(e,r)},IMCSC:t=>(t=Ge.accept(t),je.IMDIV("1",je.IMSIN(t))),IMCSCH:t=>(t=Ge.accept(t),je.IMDIV("1",je.IMSINH(t))),IMDIV:(t,e)=>{const r=Rt(t),n=r.real,i=r.im,a=r.unit,s=Rt(e),l=s.real,u=s.im,c=s.unit;if(l===0&&u===0||a!==c)throw B.NUM;const o=a,f=Math.pow(l,2)+Math.pow(u,2);return je.COMPLEX((n*l+i*u)/f,(i*l-n*u)/f,o)},IMEXP:t=>{const{real:e,im:r,unit:n}=Rt(t),i=Math.exp(e);return je.COMPLEX(i*Math.cos(r),i*Math.sin(r),n)},IMLN:t=>{const{real:e,im:r,unit:n}=Rt(t);return je.COMPLEX(Math.log(Math.sqrt(Math.pow(e,2)+Math.pow(r,2))),Math.atan(r/e),n)},IMLOG10:t=>{const{real:e,im:r,unit:n}=Rt(t),i=Math.log(Math.sqrt(Math.pow(e,2)+Math.pow(r,2)))/Math.log(10),a=Math.atan(r/e)/Math.log(10);return je.COMPLEX(i,a,n)},IMLOG2:t=>{const{real:e,im:r,unit:n}=Rt(t),i=Math.log(Math.sqrt(Math.pow(e,2)+Math.pow(r,2)))/Math.log(2),a=Math.atan(r/e)/Math.log(2);return je.COMPLEX(i,a,n)},IMPOWER:(t,e)=>{const{unit:r}=Rt(t);e=Ge.accept(e,M.NUMBER_NO_BOOLEAN);const n=Math.pow(je.IMABS(t),e),i=je.IMARGUMENT(t),a=n*Math.cos(e*i),s=n*Math.sin(e*i);return je.COMPLEX(a,s,r)},IMPRODUCT:(...t)=>{let e,r=0;return Ge.flattenParams(t,null,!1,n=>{if(r===0)e=Ge.accept(n),Rt(e);else{const i=Rt(e),a=i.real,s=i.im,l=i.unit,u=Rt(n),c=u.real,o=u.im,f=u.unit;if(l!==f)throw B.VALUE;e=je.COMPLEX(a*c-s*o,a*o+s*c)}r++},1),e},IMREAL:t=>Rt(t).real,IMSEC:t=>je.IMDIV("1",je.IMCOS(t)),IMSECH:t=>je.IMDIV("1",je.IMCOSH(t)),IMSIN:t=>{const{real:e,im:r,unit:n}=Rt(t),i=Math.sin(e)*(Math.exp(r)+Math.exp(-r))/2,a=Math.cos(e)*(Math.exp(r)-Math.exp(-r))/2;return je.COMPLEX(i,a,n)},IMSINH:t=>{const{real:e,im:r,unit:n}=Rt(t),i=Math.cos(r)*(Math.exp(e)-Math.exp(-e))/2,a=Math.sin(r)*(Math.exp(e)+Math.exp(-e))/2;return je.COMPLEX(i,a,n)},IMSQRT:t=>{const{unit:e}=Rt(t),r=Math.sqrt(je.IMABS(t)),n=je.IMARGUMENT(t);return je.COMPLEX(r*Math.cos(n/2),r*Math.sin(n/2),e)},IMSUB:(t,e)=>{const r=Rt(t),n=r.real,i=r.im,a=r.unit,s=Rt(e),l=s.real,u=s.im,c=s.unit;if(a!==c)throw B.VALUE;return je.COMPLEX(n-l,i-u,a)},IMSUM:(...t)=>{let e=0,r=0,n;return Ge.flattenParams(t,null,!1,i=>{const{real:a,im:s,unit:l}=Rt(i);if(n||(n=l),n!==l)throw B.VALUE;e+=a,r+=s}),je.COMPLEX(e,r,n)},IMTAN:t=>je.IMDIV(je.IMSIN(t),je.IMCOS(t)),OCT2BIN:(t,e)=>{if(t=Ge.accept(t,M.STRING),e=Ge.accept(e,M.NUMBER,null),t.length>10||e>10||e!==null&&e<0)throw B.NUM;e=Math.trunc(e);const r=t.length===10&&t.substring(0,1)==="7",n=je.OCT2DEC(t);if(n<zs||n>Nc)return B.NUM;if(r)return`1${$t.REPT("0",9-(512+n).toString(2).length)}${(512+n).toString(2)}`;const i=n.toString(2);if(e===0)return i;if(e<i.length)throw B.NUM;return $t.REPT("0",e-i.length)+i},OCT2DEC:t=>{if(t=Ge.accept(t,M.STRING),t.length>10)throw B.NUM;for(const r of t)if(r<"0"||r>"7")throw B.NUM;const e=parseInt(t,8);return e>=536870912?e-1073741824:e},OCT2HEX:(t,e)=>{if(t=Ge.accept(t,M.STRING),e=Ge.accept(e,M.NUMBER_NO_BOOLEAN,null),t.length>10)throw B.NUM;for(const i of t)if(i<"0"||i>"7")throw B.NUM;if(e=Math.trunc(e),e<0||e>10)throw B.NUM;const r=je.OCT2DEC(t),n=je.DEC2HEX(r);if(e===0)return n;if(e<n.length)throw B.NUM;return $t.REPT("0",e-n.length)+n}},lt=St,ud={ADDRESS:(t,e,r,n,i)=>{if(t=lt.accept(t,M.NUMBER),e=lt.accept(e,M.NUMBER),r=lt.accept(r,M.NUMBER,1),n=lt.accept(n,M.BOOLEAN,!0),i=lt.accept(i,M.STRING,""),t<1||e<1||r<1||r>4)throw B.VALUE;let a="";return i.length>0&&(/[^A-Za-z_.\d\u007F-\uFFFF]/.test(i)?a+=`'${i}'!`:a+=`${i}!`),n?(a+=r===1||r===3?"$":"",a+=vi.columnNumberToName(e),a+=r===1||r===2?"$":"",a+=t):(a+="R",a+=r===4||r===3?`[${t}]`:t,a+="C",a+=r===4||r===2?`[${e}]`:e),a},AREAS:t=>(t=lt.accept(t),t instanceof mi?t.length:1),CHOOSE:(t,...e)=>{throw console.log(t,e),B.NOT_IMPLEMENTED("SWITCH")},COLUMN:(t,e)=>{if(e==null){if(t.position.col!=null)return t.position.col;throw Error("FormulaParser.parse is called without position parameter.")}else{if(typeof e!="object"||Array.isArray(e))throw B.VALUE;if(lt.isCellRef(e))return e.ref.col;if(lt.isRangeRef(e))return e.ref.from.col;throw Error("ReferenceFunctions.COLUMN should not reach here.")}},COLUMNS:(t,e)=>{if(console.log(t),e==null)throw Error("COLUMNS requires one argument");if(typeof e!="object"||Array.isArray(e))throw B.VALUE;if(lt.isCellRef(e))return 1;if(lt.isRangeRef(e))return Math.abs(e.ref.from.col-e.ref.to.col)+1;throw Error("ReferenceFunctions.COLUMNS should not reach here.")},HLOOKUP:(t,e,r,n)=>{t=lt.accept(t);try{e=lt.accept(e,M.ARRAY,void 0,!1)}catch(s){throw s instanceof B?B.NA:s}if(r=lt.accept(r,M.NUMBER),n=lt.accept(n,M.BOOLEAN,!0),r<1)throw B.VALUE;if(e[r-1]===void 0)throw B.REF;const i=typeof t;if(n){let s=i===typeof e[0][0]?e[0][0]:null;for(let l=1;l<e[0].length;l++){const u=e[0][l];if(typeof u===i){if(s>t&&u>t)throw B.NA;if(u===t)return e[r-1][l];if(s!=null&&u>t&&s<=t)return e[r-1][l-1];s=u}}if(s==null)throw B.NA;return e[0].length===1?e[r-1][0]:s}let a=-1;if(tn.isWildCard(t)?a=e[0].findIndex(s=>tn.toRegex(t,"i").test(s)):a=e[0].findIndex(s=>s===t),a===-1)throw B.NA;return e[r-1][a]},INDEX:(t,e,r,n,i)=>{r=t.utils.extractRefValue(r),r={value:r.val,isArray:r.isArray},r=lt.accept(r,M.NUMBER),r=Math.trunc(r),n==null?n=1:(n=t.utils.extractRefValue(n),n={value:n.val,isArray:n.isArray},n=lt.accept(n,M.NUMBER,1),n=Math.trunc(n)),i==null?i=1:(i=t.utils.extractRefValue(i),i={value:i.val,isArray:i.isArray},i=lt.accept(i,M.NUMBER,1),i=Math.trunc(i));let a=e;if(e instanceof mi)a=e.refs[i-1];else if(i>1)throw B.REF;if(r===0&&n===0)return a;if(r===0){if(lt.isRangeRef(a)){if(a.ref.to.col-a.ref.from.col<n-1)throw B.REF;return a.ref.from.col+=n-1,a.ref.to.col=a.ref.from.col,a}if(Array.isArray(a)){const s=[];return a.forEach(l=>s.push([l[n-1]])),s}}if(n===0){if(lt.isRangeRef(a)){if(a.ref.to.row-a.ref.from.row<r-1)throw B.REF;return a.ref.from.row+=r-1,a.ref.to.row=a.ref.from.row,a}if(Array.isArray(a))return a[n-1]}if(r!==0&&n!==0){if(lt.isRangeRef(a)){if(a=a.ref,a.to.row-a.from.row<r-1||a.to.col-a.from.col<n-1)throw B.REF;return{ref:{row:a.from.row+r-1,col:a.from.col+n-1}}}if(lt.isCellRef(a)){if(a=a.ref,r>1||n>1)throw B.REF;return{ref:{row:a.row+r-1,col:a.col+n-1}}}if(Array.isArray(a)){if(a.length<r||a[0].length<n)throw B.REF;return a[r-1][n-1]}}},MATCH:()=>{},ROW:(t,e)=>{if(e==null){if(t.position.row!=null)return t.position.row;throw Error("FormulaParser.parse is called without position parameter.")}else{if(typeof e!="object"||Array.isArray(e))throw B.VALUE;if(lt.isCellRef(e))return e.ref.row;if(lt.isRangeRef(e))return e.ref.from.row;throw Error("ReferenceFunctions.ROW should not reach here.")}},ROWS:(t,e)=>{if(console.log(t),e==null)throw Error("ROWS requires one argument");if(typeof e!="object"||Array.isArray(e))throw B.VALUE;if(lt.isCellRef(e))return 1;if(lt.isRangeRef(e))return Math.abs(e.ref.from.row-e.ref.to.row)+1;throw Error("ReferenceFunctions.ROWS should not reach here.")},TRANSPOSE:t=>{t=lt.accept(t,M.ARRAY,void 0,!1);const e=[];for(let r=0;r<t[0].length;r++){e[r]=[];for(let n=0;n<t.length;n++)e[r][n]=t[n][r]}return e},VLOOKUP:(t,e,r,n)=>{t=lt.accept(t);try{e=lt.accept(e,M.ARRAY,void 0,!1)}catch(s){throw s instanceof B?B.NA:s}if(r=lt.accept(r,M.NUMBER),n=lt.accept(n,M.BOOLEAN,!0),r<1)throw B.VALUE;if(e[0][r-1]===void 0)throw B.REF;const i=typeof t;if(n){let s=i===typeof e[0][0]?e[0][0]:null;for(let l=1;l<e.length;l++){const u=e[l],c=e[l][0];if(typeof c===i){if(s>t&&c>t)throw B.NA;if(c===t)return u[r-1];if(s!=null&&c>t&&s<=t)return e[l-1][r-1];s=c}}if(s==null)throw B.NA;return e.length===1?e[0][r-1]:s}let a=-1;if(tn.isWildCard(t)?a=e.findIndex(s=>tn.toRegex(t,"i").test(s[0])):a=e.findIndex(s=>s[0]===t),a===-1)throw B.NA;return e[a][r-1]}},Kt=St,JE={"#NULL!":1,"#DIV/0!":2,"#VALUE!":3,"#REF!":4,"#NAME?":5,"#NUM!":6,"#N/A":7},fd={CELL:(t,e)=>{throw console.log(t,e),B.NOT_IMPLEMENTED("CELL")},"ERROR.TYPE":t=>{if(t=Kt.accept(t),t instanceof B)return JE[t.toString()];throw B.NA},INFO:()=>{},ISBLANK:t=>t.ref?t.value==null||t.value==="":!1,ISERR:t=>(t=Kt.accept(t),t instanceof B&&t.toString()!=="#N/A"),ISERROR:t=>(t=Kt.accept(t),t instanceof B),ISEVEN:t=>(t=Kt.accept(t,M.NUMBER),t=Math.trunc(t),t%2===0),ISLOGICAL:t=>(t=Kt.accept(t),typeof t=="boolean"),ISNA:t=>(t=Kt.accept(t),t instanceof B&&t.toString()==="#N/A"),ISNONTEXT:t=>(t=Kt.accept(t),typeof t!="string"),ISNUMBER:t=>(t=Kt.accept(t),typeof t=="number"),ISREF:t=>!t.ref||Kt.isCellRef(t)&&(t.ref.row>1048576||t.ref.col>16384)||Kt.isRangeRef(t)&&(t.ref.from.row>1048576||t.ref.from.col>16384||t.ref.to.row>1048576||t.ref.to.col>16384)?!1:(t=Kt.accept(t),!(t instanceof B&&t.toString()==="#REF!")),ISTEXT:t=>(t=Kt.accept(t),typeof t=="string"),N:t=>{t=Kt.accept(t);const e=typeof t;if(e==="number")return t;if(e==="boolean")return Number(t);if(t instanceof B)throw t;return 0},NA:()=>{throw B.NA},TYPE:t=>{if(t.ref){if(Kt.isRangeRef(t))return 16;if(Kt.isCellRef(t)&&(t=Kt.accept(t),typeof t=="string"&&t.length===0))return 1}t=Kt.accept(t);const e=typeof t;if(e==="number")return 1;if(e==="string")return 2;if(e==="boolean")return 4;if(t instanceof B)return 16;if(Array.isArray(t))return 64;throw B.VALUE}},ge=St,eO=2.5066282746310002,h0={"BETA.DIST":(t,e,r,n,i,a)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),n=ge.accept(n,M.BOOLEAN),i=ge.accept(i,M.NUMBER,0),a=ge.accept(a,M.NUMBER,1),e<=0||r<=0||t<i||t>a||i===a)throw B.NUM;return t=(t-i)/(a-i),n?Ve.beta.cdf(t,e,r):Ve.beta.pdf(t,e,r)/(a-i)},"BETA.INV":(t,e,r,n,i)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),n=ge.accept(n,M.NUMBER,0),i=ge.accept(i,M.NUMBER,1),e<=0||r<=0||t<=0||t>1)throw B.NUM;return Ve.beta.inv(t,e,r)*(i-n)+n},"BINOM.DIST":(t,e,r,n)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),n=ge.accept(n,M.BOOLEAN),e<0||r<0||r>1||t<0||t>e)throw B.NUM;return n?Ve.binomial.cdf(t,e,r):Ve.binomial.pdf(t,e,r)},"BINOM.DIST.RANGE":(t,e,r,n)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),n=ge.accept(n,M.NUMBER,r),t<0||e<0||e>1||r<0||r>t||n<r||n>t)throw B.NUM;let i=0;for(let a=r;a<=n;a++)i+=Wt.COMBIN(t,a)*Math.pow(e,a)*Math.pow(1-e,t-a);return i},"BINOM.INV":(t,e,r)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),t<0||e<0||e>1||r<0||r>1)throw B.NUM;let n=0;for(;n<=t;){if(Ve.binomial.cdf(n,t,e)>=r)return n;n++}throw B.NUM},"CHISQ.DIST":(t,e,r)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),e=Math.trunc(e),t<0||e<1||e>10**10)throw B.NUM;return r?Ve.chisquare.cdf(t,e):Ve.chisquare.pdf(t,e)},"CHISQ.DIST.RT":(t,e)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),e=Math.trunc(e),t<0||e<1||e>10**10)throw B.NUM;return 1-Ve.chisquare.cdf(t,e)},"CHISQ.INV":(t,e)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),e=Math.trunc(e),t<0||t>1||e<1||e>10**10)throw B.NUM;return Ve.chisquare.inv(t,e)},"CHISQ.INV.RT":(t,e)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),e=Math.trunc(e),t<0||t>1||e<1||e>10**10)throw B.NUM;return Ve.chisquare.inv(1-t,e)},"CHISQ.TEST":(t,e)=>{const r=ge.accept(t,M.ARRAY,void 0,!1,!1),n=ge.accept(e,M.ARRAY,void 0,!1,!1);if(r.length!==n.length||r[0].length!==n[0].length||r.length===1&&r[0].length===1)throw B.NA;const i=r.length,a=r[0].length;let s=(i-1)*(a-1);i===1?s=a-1:s=i-1;let l=0;for(let h=0;h<i;h++)for(let d=0;d<a;d++)if(!(typeof r[h][d]!="number"||typeof n[h][d]!="number")){if(n[h][d]===0)throw B.DIV0;l+=Math.pow(r[h][d]-n[h][d],2)/n[h][d]}let u=Math.exp(-.5*l);s%2===1&&(u*=Math.sqrt(2*l/Math.PI));let c=s;for(;c>=2;)u=u*l/c,c-=2;let o=u,f=s;for(;o>1e-15*u;)f+=2,o=o*l/f,u+=o;return 1-u},"CONFIDENCE.NORM":(t,e,r)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),r=Math.trunc(r),t<=0||t>=1||e<=0||r<1)throw B.NUM;return Ve.normalci(1,t,e,r)[1]-1},"CONFIDENCE.T":(t,e,r)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),r=Math.trunc(r),t<=0||t>=1||e<=0||r<1)throw B.NUM;if(r===1)throw B.DIV0;return Ve.tci(1,t,e,r)[1]-1},CORREL:(t,e)=>{if(t=ge.accept(t,M.ARRAY,void 0,!0,!0),e=ge.accept(e,M.ARRAY,void 0,!0,!0),t.length!==e.length)throw B.NA;const r=[],n=[];for(let i=0;i<t.length;i++)typeof t[i]!="number"||typeof e[i]!="number"||(r.push(t[i]),n.push(e[i]));if(r.length<=1)throw B.DIV0;return Ve.corrcoeff(r,n)},"COVARIANCE.P":(t,e)=>{if(t=ge.accept(t,M.ARRAY,void 0,!0,!0),e=ge.accept(e,M.ARRAY,void 0,!0,!0),t.length!==e.length)throw B.NA;const r=[],n=[];for(let l=0;l<t.length;l++)typeof t[l]!="number"||typeof e[l]!="number"||(r.push(t[l]),n.push(e[l]));const i=Ve.mean(r),a=Ve.mean(n);let s=0;for(let l=0;l<r.length;l++)s+=(r[l]-i)*(n[l]-a);return s/r.length},"COVARIANCE.S":(t,e)=>{if(t=ge.accept(t,M.ARRAY,void 0,!0,!0),e=ge.accept(e,M.ARRAY,void 0,!0,!0),t.length!==e.length)throw B.NA;const r=[],n=[];for(let i=0;i<t.length;i++)typeof t[i]!="number"||typeof e[i]!="number"||(r.push(t[i]),n.push(e[i]));if(r.length<=1)throw B.DIV0;return Ve.covariance(r,n)},DEVSQ:(...t)=>{let e=0;const r=[];ge.flattenParams(t,M.NUMBER,!0,(i,a)=>{console.log(a),typeof i=="number"&&(e+=i,r.push(i))});const n=e/r.length;e=0;for(let i=0;i<r.length;i++)e+=(r[i]-n)**2;return e},"EXPON.DIST":(t,e,r)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.BOOLEAN),t<0||e<=0)throw B.NUM;return r?Ve.exponential.cdf(t,e):Ve.exponential.pdf(t,e)},"F.DIST":(t,e,r,n)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),n=ge.accept(n,M.BOOLEAN),t<0||e<1||r<1)throw B.NUM;return e=Math.trunc(e),r=Math.trunc(r),n?Ve.centralF.cdf(t,e,r):Ve.centralF.pdf(t,e,r)},"F.DIST.RT":(t,e,r)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),t<0||e<1||r<1)throw B.NUM;return e=Math.trunc(e),r=Math.trunc(r),1-Ve.centralF.cdf(t,e,r)},"F.INV":(t,e,r)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),t<0||t>1||e<1||r<1)throw B.NUM;return e=Math.trunc(e),r=Math.trunc(r),Ve.centralF.inv(t,e,r)},"F.INV.RT":(t,e,r)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),t<0||t>1||e<1||e>=Math.pow(10,10)||r<1||r>=Math.pow(10,10))throw B.NUM;return e=Math.trunc(e),r=Math.trunc(r),Ve.centralF.inv(1-t,e,r)},"F.TEST":(t,e)=>{t=ge.accept(t,M.ARRAY,void 0,!0,!0),e=ge.accept(e,M.ARRAY,void 0,!0,!0);const r=[],n=[];let i=0,a=0;for(let u=0;u<Math.max(t.length,e.length);u++)typeof t[u]=="number"&&(r.push(t[u]),i+=t[u]),typeof e[u]=="number"&&(n.push(e[u]),a+=e[u]);if(r.length<=1||n.length<=1)throw B.DIV0;i/=r.length,a/=n.length;let s=0,l=0;for(let u=0;u<r.length;u++)s+=(i-r[u])**2;s/=r.length-1;for(let u=0;u<n.length;u++)l+=(a-n[u])**2;return l/=n.length-1,Ve.centralF.cdf(s/l,r.length-1,n.length-1)*2},FISHER:t=>{if(t=ge.accept(t,M.NUMBER),t<=-1||t>=1)throw B.NUM;return Math.log((1+t)/(1-t))/2},FISHERINV:t=>{t=ge.accept(t,M.NUMBER);const e=Math.exp(2*t);return(e-1)/(e+1)},FORECAST:(t,e,r)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.ARRAY,void 0,!0,!0),r=ge.accept(r,M.ARRAY,void 0,!0,!0),r.length!==e.length)throw B.NA;const n=[],i=[];let a=!0;for(let h=0;h<e.length;h++)typeof e[h]!="number"||typeof r[h]!="number"||(n.push(e[h]),i.push(r[h]),r[h]!==r[0]&&(a=!1));if(a)throw B.DIV0;const s=Ve.mean(n),l=Ve.mean(i);let u=0,c=0;for(let h=0;h<n.length;h++)u+=(i[h]-l)*(n[h]-s),c+=(i[h]-l)**2;const o=u/c;return s-o*l+o*t},"FORECAST.ETS":()=>{},"FORECAST.ETS.CONFINT":()=>{},"FORECAST.ETS.SEASONALITY":()=>{},"FORECAST.ETS.STAT":()=>{},"FORECAST.LINEAR":(t,e,r)=>h0.FORECAST(t,e,r),FREQUENCY:(t,e)=>{t=ge.accept(t,M.ARRAY,void 0,!0,!0),e=ge.accept(e,M.ARRAY,void 0,!0,!0);const r=[];for(let i=0;i<e.length;i++)typeof e[i]=="number"&&r.push(e[i]);r.sort(),r.push(1/0);const n=[];for(let i=0;i<r.length;i++){n[i]=[],n[i][0]=0;for(let a=0;a<t.length;a++){if(typeof t[a]!="number")continue;t[a]<=r[i]&&(n[i][0]++,t[a]=null)}}return n},GAMMA:t=>{if(t=ge.accept(t,M.NUMBER),t===0||t<0&&t===Math.trunc(t))throw B.NUM;return Ve.gammafn(t)},"GAMMA.DIST":(t,e,r,n)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),n=ge.accept(n,M.BOOLEAN),t<0||e<=0||r<=0)throw B.NUM;return n?Ve.gamma.cdf(t,e,r,!0):Ve.gamma.pdf(t,e,r,!1)},"GAMMA.INV":(t,e,r)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),t<0||t>1||e<=0||r<=0)throw B.NUM;return Ve.gamma.inv(t,e,r)},GAMMALN:t=>{if(t=ge.accept(t,M.NUMBER),t<=0)throw B.NUM;return Ve.gammaln(t)},"GAMMALN.PRECISE":t=>{if(t=ge.accept(t,M.NUMBER),t<=0)throw B.NUM;return Ve.gammaln(t)},GAUSS:t=>(t=ge.accept(t,M.NUMBER),Ve.normal.cdf(t,0,1)-.5),GEOMEAN:(...t)=>{const e=[];return ge.flattenParams(t,M.NUMBER,!0,(r,n)=>{console.log(n),typeof r=="number"&&e.push(r)}),Ve.geomean(e)},GROWTH:(t,e,r,n)=>{t=ge.accept(t,M.ARRAY,void 0,!0,!0);for(let d=0;d<t.length;d++)if(typeof t[d]!="number")throw B.VALUE;e=ge.accept(e,M.ARRAY,null,!0,!0);const i=e==null;if(e==null){e=[];for(let d=1;d<=t.length;d++)e.push(d)}else{if(e.length!==t.length)throw B.REF;for(let d=0;d<e.length;d++)if(typeof e[d]!="number")throw B.VALUE}if(r=ge.accept(r,M.ARRAY,null,!1,!0),r==null&&i){r=[];for(let d=1;d<=t.length;d++)r.push(d);r=[r]}else r==null&&(r=Array.isArray(e[0])?e:[e]);n=ge.accept(n,M.BOOLEAN,!0);const a=t.length;let s=0,l=0,u=0,c=0;for(let d=0;d<a;d++){const p=e[d],g=Math.log(t[d]);s+=p,l+=g,u+=p*g,c+=p*p}s/=a,l/=a,u/=a,c/=a;let o,f;n?(o=(u-s*l)/(c-s*s),f=l-o*s):(o=u/c,f=0);const h=[];for(let d=0;d<r.length;d++){h[d]=[];for(let p=0;p<r[0].length;p++){if(typeof r[d][p]!="number")throw B.VALUE;h[d][p]=Math.exp(f+o*r[d][p])}}return h},HARMEAN:(...t)=>{let e=0,r=0;return ge.flattenParams(t,M.NUMBER,!0,(n,i)=>{console.log(i),typeof n=="number"&&(r+=1/n,e++)}),e/r},"HYPGEOM.DIST":(t,e,r,n,i)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),n=ge.accept(n,M.NUMBER),i=ge.accept(i,M.BOOLEAN),t=Math.trunc(t),e=Math.trunc(e),r=Math.trunc(r),n=Math.trunc(n),n<=0||t<0||e<=0||r<=0||e>n||r>n||e<t||r<t||t<e-n+r)throw B.NUM;function a(l,u,c,o){return Wt.COMBIN(c,l)*Wt.COMBIN(o-c,u-l)/Wt.COMBIN(o,u)}function s(l,u,c,o){let f=0;for(let h=0;h<=l;h++)f+=a(h,u,c,o);return f}return i?s(t,e,r,n):a(t,e,r,n)},INTERCEPT:(t,e)=>{if(t=ge.accept(t,M.ARRAY,void 0,!0,!0),e=ge.accept(e,M.ARRAY,void 0,!0,!0),e.length!==t.length)throw B.NA;const r=[],n=[];for(let c=0;c<t.length;c++)typeof t[c]!="number"||typeof e[c]!="number"||(r.push(t[c]),n.push(e[c]));if(r.length<=1)throw B.DIV0;const i=Ve.mean(r),a=Ve.mean(n);let s=0,l=0;for(let c=0;c<r.length;c++)s+=(n[c]-a)*(r[c]-i),l+=(n[c]-a)**2;const u=s/l;return i-u*a},KURT:(...t)=>{let e=0;const r=[];ge.flattenParams(t,M.NUMBER,!0,(a,s)=>{console.log(s),typeof a=="number"&&(e+=a,r.push(a))});const n=r.length;e/=n;let i=0;for(let a=0;a<n;a++)i+=Math.pow(r[a]-e,4);return i/=Math.pow(Ve.stdev(r,!0),4),n*(n+1)/((n-1)*(n-2)*(n-3))*i-3*(n-1)*(n-1)/((n-2)*(n-3))},LINEST:()=>{},LOGEST:()=>{},"LOGNORM.DIST":(t,e,r,n)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),n=ge.accept(n,M.BOOLEAN),t<=0||r<=0)throw B.NUM;return n?Ve.lognormal.cdf(t,e,r):Ve.lognormal.pdf(t,e,r)},"LOGNORM.INV":(t,e,r)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),t<=0||t>=1||r<=0)throw B.NUM;return Ve.lognormal.inv(t,e,r)},"MODE.MULT":()=>{},"MODE.SNGL":()=>{},"NEGBINOM.DIST":(t,e,r,n)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),n=ge.accept(n,M.BOOLEAN),t=Math.trunc(t),e=Math.trunc(e),r<0||r>1||t<0||e<1)throw B.NUM;return n?Ve.negbin.cdf(t,e,r):Ve.negbin.pdf(t,e,r)},"NORM.DIST":(t,e,r,n)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),n=ge.accept(n,M.BOOLEAN),r<=0)throw B.NUM;return n?Ve.normal.cdf(t,e,r):Ve.normal.pdf(t,e,r)},"NORM.INV":(t,e,r)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),t<=0||t>=1||r<=0)throw B.NUM;return Ve.normal.inv(t,e,r)},"NORM.S.DIST":(t,e)=>(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.BOOLEAN),e?Ve.normal.cdf(t,0,1):Ve.normal.pdf(t,0,1)),"NORM.S.INV":t=>{if(t=ge.accept(t,M.NUMBER),t<=0||t>=1)throw B.NUM;return Ve.normal.inv(t,0,1)},PEARSON:()=>{},"PERCENTILE.EXC":()=>{},"PERCENTILE.INC":()=>{},"PERCENTRANK.EXC":()=>{},"PERCENTRANK.INC":()=>{},PERMUTATIONA:()=>{},PHI:t=>(t=ge.accept(t,M.NUMBER),Math.exp(-.5*t*t)/eO),"POISSON.DIST":(t,e,r)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.BOOLEAN),t<0||e<0)throw B.NUM;return t=Math.trunc(t),r?Ve.poisson.cdf(t,e):Ve.poisson.pdf(t,e)},PROB:()=>{},"QUARTILE.EXC":()=>{},"QUARTILE.INC":()=>{},"RANK.AVG":()=>{},"RANK.EQ":()=>{},RSQ:()=>{},SKEW:()=>{},"SKEW.P":()=>{},SLOPE:()=>{},STANDARDIZE:(t,e,r)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),r<=0)throw B.NUM;return(t-e)/r},"STDEV.P":()=>{},"STDEV.S":()=>{},STDEVA:()=>{},STDEVPA:()=>{},STEYX:()=>{},"T.DIST":(t,e,r)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.BOOLEAN),e<1)throw B.NUM;return r?Ve.studentt.cdf(t,e):Ve.studentt.pdf(t,e)},"T.DIST.2T":(t,e)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),e<1||t<0)throw B.NUM;return(1-Ve.studentt.cdf(t,e))*2},"T.DIST.RT":(t,e)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),e<1)throw B.NUM;return 1-Ve.studentt.cdf(t,e)},"T.INV":(t,e)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),t<=0||t>1||e<1)throw B.NUM;return e=e%1===0?e:Math.trunc(e),Ve.studentt.inv(t,e)},"T.INV.2T":(t,e)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),t<=0||t>1||e<1)throw B.NUM;return e=e%1===0?e:Math.trunc(e),Math.abs(Ve.studentt.inv(t/2,e))},"T.TEST":()=>{},TREND:()=>{},TRIMMEAN:()=>{},"VAR.P":()=>{},"VAR.S":()=>{},VARA:()=>{},VARPA:()=>{},"WEIBULL.DIST":(t,e,r,n)=>{if(t=ge.accept(t,M.NUMBER),e=ge.accept(e,M.NUMBER),r=ge.accept(r,M.NUMBER),n=ge.accept(n,M.BOOLEAN),t<0||e<=0||r<=0)throw B.NUM;return n?1-Math.exp(-Math.pow(t/r,e)):Math.pow(t,e-1)*Math.exp(-Math.pow(t/r,e))*e/Math.pow(r,e)},"Z.TEST":()=>{}},En=St,Eu={AVEDEV:(...t)=>{let e=0;const r=[];En.flattenParams(t,M.NUMBER,!0,(i,a)=>{console.log(a),typeof i=="number"&&(e+=i,r.push(i))});const n=e/r.length;e=0;for(let i=0;i<r.length;i++)e+=Math.abs(r[i]-n);return e/r.length},AVERAGE:(...t)=>{let e=0,r=0;return En.flattenParams(t,M.NUMBER,!0,(n,i)=>{console.log(i),typeof n=="number"&&(e+=n,r++)}),e/r},AVERAGEA:(...t)=>{let e=0,r=0;return En.flattenParams(t,M.NUMBER,!0,(n,i)=>{console.log(i);const a=typeof n;a==="number"?(e+=n,r++):a==="string"&&r++}),e/r},AVERAGEIF:(t,e,r,n)=>{const i=En.retrieveRanges(t,e,n);e=i[0],n=i[1],r=En.retrieveArg(t,r);const a=r.isArray;r=yu.parse(En.accept(r));let s=0,l=0;if(e.forEach((u,c)=>{u.forEach((o,f)=>{const h=n[c][f];typeof h=="number"&&(r.op==="wc"?r.match===r.value.test(o)&&(s+=h,l++):Hi.compareOp(o,r.op,r.value,Array.isArray(o),a)&&(s+=h,l++))})}),l===0)throw B.DIV0;return s/l},AVERAGEIFS:()=>{},COUNT:(...t)=>{let e=0;return En.flattenParams(t,null,!0,(r,n)=>{(n.isLiteral&&!isNaN(r)||typeof r=="number")&&e++}),e},COUNTIF:(t,e)=>{t=En.accept(t,M.ARRAY,void 0,!1,!0);const r=e.isArray;e=En.accept(e);let n=0;return e=yu.parse(e),t.forEach(i=>{i.forEach(a=>{e.op==="wc"?e.match===e.value.test(a)&&n++:Hi.compareOp(a,e.op,e.value,Array.isArray(a),r)&&n++})}),n},LARGE:()=>{},MAX:()=>{},MAXA:()=>{},MAXIFS:()=>{},MEDIAN:()=>{},MIN:()=>{},MINA:()=>{},MINIFS:()=>{},PERMUT:()=>{},PERMUTATIONA:()=>{},SMALL:()=>{}};Object.assign(Eu,h0);const tO=St,rO={ENCODEURL:t=>encodeURIComponent(tO.accept(t,M.STRING)),FILTERXML:()=>{},WEBSERVICE:(t,e)=>{throw B.ERROR("WEBSERVICE is not supported in sync mode.")}};var d0={},gs={};Object.defineProperty(gs,"__esModule",{value:!0});gs.VERSION=void 0;gs.VERSION="10.5.0";var xc={},nO=Object.prototype;function iO(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||nO;return t===r}var ms=iO;function aO(t,e){return function(r){return t(e(r))}}var p0=aO,sO=p0,oO=sO(Object.keys,Object),lO=oO,cO=ms,uO=lO,fO=Object.prototype,hO=fO.hasOwnProperty;function dO(t){if(!cO(t))return uO(t);var e=[];for(var r in Object(t))hO.call(t,r)&&r!="constructor"&&e.push(r);return e}var g0=dO,pO=typeof Ce=="object"&&Ce&&Ce.Object===Object&&Ce,m0=pO,gO=m0,mO=typeof self=="object"&&self&&self.Object===Object&&self,vO=gO||mO||Function("return this")(),un=vO,yO=un,bO=yO.Symbol,ia=bO,hd=ia,v0=Object.prototype,EO=v0.hasOwnProperty,OO=v0.toString,Sa=hd?hd.toStringTag:void 0;function AO(t){var e=EO.call(t,Sa),r=t[Sa];try{t[Sa]=void 0;var n=!0}catch{}var i=OO.call(t);return n&&(e?t[Sa]=r:delete t[Sa]),i}var CO=AO,wO=Object.prototype,SO=wO.toString;function TO(t){return SO.call(t)}var RO=TO,dd=ia,NO=CO,xO=RO,MO="[object Null]",_O="[object Undefined]",pd=dd?dd.toStringTag:void 0;function kO(t){return t==null?t===void 0?_O:MO:pd&&pd in Object(t)?NO(t):xO(t)}var Ti=kO;function PO(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var fn=PO,IO=Ti,DO=fn,LO="[object AsyncFunction]",BO="[object Function]",UO="[object GeneratorFunction]",$O="[object Proxy]";function FO(t){if(!DO(t))return!1;var e=IO(t);return e==BO||e==UO||e==LO||e==$O}var vs=FO,VO=un,WO=VO["__core-js_shared__"],HO=WO,Mc=HO,gd=function(){var t=/[^.]+$/.exec(Mc&&Mc.keys&&Mc.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function GO(t){return!!gd&&gd in t}var zO=GO,qO=Function.prototype,YO=qO.toString;function XO(t){if(t!=null){try{return YO.call(t)}catch{}try{return t+""}catch{}}return""}var y0=XO,QO=vs,KO=zO,jO=fn,ZO=y0,JO=/[\\^$.*+?()[\]{}|]/g,eA=/^\[object .+?Constructor\]$/,tA=Function.prototype,rA=Object.prototype,nA=tA.toString,iA=rA.hasOwnProperty,aA=RegExp("^"+nA.call(iA).replace(JO,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function sA(t){if(!jO(t)||KO(t))return!1;var e=QO(t)?aA:eA;return e.test(ZO(t))}var oA=sA;function lA(t,e){return t==null?void 0:t[e]}var cA=lA,uA=oA,fA=cA;function hA(t,e){var r=fA(t,e);return uA(r)?r:void 0}var Ri=hA,dA=Ri,pA=un,gA=dA(pA,"DataView"),mA=gA,vA=Ri,yA=un,bA=vA(yA,"Map"),Lf=bA,EA=Ri,OA=un,AA=EA(OA,"Promise"),CA=AA,wA=Ri,SA=un,TA=wA(SA,"Set"),b0=TA,RA=Ri,NA=un,xA=RA(NA,"WeakMap"),MA=xA,Ou=mA,Au=Lf,Cu=CA,wu=b0,Su=MA,E0=Ti,aa=y0,md="[object Map]",_A="[object Object]",vd="[object Promise]",yd="[object Set]",bd="[object WeakMap]",Ed="[object DataView]",kA=aa(Ou),PA=aa(Au),IA=aa(Cu),DA=aa(wu),LA=aa(Su),ci=E0;(Ou&&ci(new Ou(new ArrayBuffer(1)))!=Ed||Au&&ci(new Au)!=md||Cu&&ci(Cu.resolve())!=vd||wu&&ci(new wu)!=yd||Su&&ci(new Su)!=bd)&&(ci=function(t){var e=E0(t),r=e==_A?t.constructor:void 0,n=r?aa(r):"";if(n)switch(n){case kA:return Ed;case PA:return md;case IA:return vd;case DA:return yd;case LA:return bd}return e});var ys=ci;function BA(t){return t!=null&&typeof t=="object"}var hn=BA,UA=Ti,$A=hn,FA="[object Arguments]";function VA(t){return $A(t)&&UA(t)==FA}var WA=VA,Od=WA,HA=hn,O0=Object.prototype,GA=O0.hasOwnProperty,zA=O0.propertyIsEnumerable,qA=Od(function(){return arguments}())?Od:function(t){return HA(t)&&GA.call(t,"callee")&&!zA.call(t,"callee")},Ol=qA,YA=Array.isArray,dt=YA,XA=9007199254740991;function QA(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=XA}var Bf=QA,KA=vs,jA=Bf;function ZA(t){return t!=null&&jA(t.length)&&!KA(t)}var dn=ZA,$o={exports:{}};function JA(){return!1}var eC=JA;$o.exports;(function(t,e){var r=un,n=eC,i=e&&!e.nodeType&&e,a=i&&!0&&t&&!t.nodeType&&t,s=a&&a.exports===i,l=s?r.Buffer:void 0,u=l?l.isBuffer:void 0,c=u||n;t.exports=c})($o,$o.exports);var Al=$o.exports,tC=Ti,rC=Bf,nC=hn,iC="[object Arguments]",aC="[object Array]",sC="[object Boolean]",oC="[object Date]",lC="[object Error]",cC="[object Function]",uC="[object Map]",fC="[object Number]",hC="[object Object]",dC="[object RegExp]",pC="[object Set]",gC="[object String]",mC="[object WeakMap]",vC="[object ArrayBuffer]",yC="[object DataView]",bC="[object Float32Array]",EC="[object Float64Array]",OC="[object Int8Array]",AC="[object Int16Array]",CC="[object Int32Array]",wC="[object Uint8Array]",SC="[object Uint8ClampedArray]",TC="[object Uint16Array]",RC="[object Uint32Array]",Et={};Et[bC]=Et[EC]=Et[OC]=Et[AC]=Et[CC]=Et[wC]=Et[SC]=Et[TC]=Et[RC]=!0;Et[iC]=Et[aC]=Et[vC]=Et[sC]=Et[yC]=Et[oC]=Et[lC]=Et[cC]=Et[uC]=Et[fC]=Et[hC]=Et[dC]=Et[pC]=Et[gC]=Et[mC]=!1;function NC(t){return nC(t)&&rC(t.length)&&!!Et[tC(t)]}var xC=NC;function MC(t){return function(e){return t(e)}}var bs=MC,Fo={exports:{}};Fo.exports;(function(t,e){var r=m0,n=e&&!e.nodeType&&e,i=n&&!0&&t&&!t.nodeType&&t,a=i&&i.exports===n,s=a&&r.process,l=function(){try{var u=i&&i.require&&i.require("util").types;return u||s&&s.binding&&s.binding("util")}catch{}}();t.exports=l})(Fo,Fo.exports);var Cl=Fo.exports,_C=xC,kC=bs,Ad=Cl,Cd=Ad&&Ad.isTypedArray,PC=Cd?kC(Cd):_C,Uf=PC,IC=g0,DC=ys,LC=Ol,BC=dt,UC=dn,$C=Al,FC=ms,VC=Uf,WC="[object Map]",HC="[object Set]",GC=Object.prototype,zC=GC.hasOwnProperty;function qC(t){if(t==null)return!0;if(UC(t)&&(BC(t)||typeof t=="string"||typeof t.splice=="function"||$C(t)||VC(t)||LC(t)))return!t.length;var e=DC(t);if(e==WC||e==HC)return!t.size;if(FC(t))return!IC(t).length;for(var r in t)if(zC.call(t,r))return!1;return!0}var zr=qC;function YC(t,e){for(var r=-1,n=t==null?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}var Es=YC;function XC(){this.__data__=[],this.size=0}var QC=XC;function KC(t,e){return t===e||t!==t&&e!==e}var Os=KC,jC=Os;function ZC(t,e){for(var r=t.length;r--;)if(jC(t[r][0],e))return r;return-1}var wl=ZC,JC=wl,ew=Array.prototype,tw=ew.splice;function rw(t){var e=this.__data__,r=JC(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():tw.call(e,r,1),--this.size,!0}var nw=rw,iw=wl;function aw(t){var e=this.__data__,r=iw(e,t);return r<0?void 0:e[r][1]}var sw=aw,ow=wl;function lw(t){return ow(this.__data__,t)>-1}var cw=lw,uw=wl;function fw(t,e){var r=this.__data__,n=uw(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}var hw=fw,dw=QC,pw=nw,gw=sw,mw=cw,vw=hw;function sa(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}sa.prototype.clear=dw;sa.prototype.delete=pw;sa.prototype.get=gw;sa.prototype.has=mw;sa.prototype.set=vw;var Sl=sa,yw=Sl;function bw(){this.__data__=new yw,this.size=0}var Ew=bw;function Ow(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}var Aw=Ow;function Cw(t){return this.__data__.get(t)}var ww=Cw;function Sw(t){return this.__data__.has(t)}var Tw=Sw,Rw=Ri,Nw=Rw(Object,"create"),Tl=Nw,wd=Tl;function xw(){this.__data__=wd?wd(null):{},this.size=0}var Mw=xw;function _w(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var kw=_w,Pw=Tl,Iw="__lodash_hash_undefined__",Dw=Object.prototype,Lw=Dw.hasOwnProperty;function Bw(t){var e=this.__data__;if(Pw){var r=e[t];return r===Iw?void 0:r}return Lw.call(e,t)?e[t]:void 0}var Uw=Bw,$w=Tl,Fw=Object.prototype,Vw=Fw.hasOwnProperty;function Ww(t){var e=this.__data__;return $w?e[t]!==void 0:Vw.call(e,t)}var Hw=Ww,Gw=Tl,zw="__lodash_hash_undefined__";function qw(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Gw&&e===void 0?zw:e,this}var Yw=qw,Xw=Mw,Qw=kw,Kw=Uw,jw=Hw,Zw=Yw;function oa(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}oa.prototype.clear=Xw;oa.prototype.delete=Qw;oa.prototype.get=Kw;oa.prototype.has=jw;oa.prototype.set=Zw;var Jw=oa,Sd=Jw,eS=Sl,tS=Lf;function rS(){this.size=0,this.__data__={hash:new Sd,map:new(tS||eS),string:new Sd}}var nS=rS;function iS(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var aS=iS,sS=aS;function oS(t,e){var r=t.__data__;return sS(e)?r[typeof e=="string"?"string":"hash"]:r.map}var Rl=oS,lS=Rl;function cS(t){var e=lS(this,t).delete(t);return this.size-=e?1:0,e}var uS=cS,fS=Rl;function hS(t){return fS(this,t).get(t)}var dS=hS,pS=Rl;function gS(t){return pS(this,t).has(t)}var mS=gS,vS=Rl;function yS(t,e){var r=vS(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}var bS=yS,ES=nS,OS=uS,AS=dS,CS=mS,wS=bS;function la(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}la.prototype.clear=ES;la.prototype.delete=OS;la.prototype.get=AS;la.prototype.has=CS;la.prototype.set=wS;var $f=la,SS=Sl,TS=Lf,RS=$f,NS=200;function xS(t,e){var r=this.__data__;if(r instanceof SS){var n=r.__data__;if(!TS||n.length<NS-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new RS(n)}return r.set(t,e),this.size=r.size,this}var MS=xS,_S=Sl,kS=Ew,PS=Aw,IS=ww,DS=Tw,LS=MS;function ca(t){var e=this.__data__=new _S(t);this.size=e.size}ca.prototype.clear=kS;ca.prototype.delete=PS;ca.prototype.get=IS;ca.prototype.has=DS;ca.prototype.set=LS;var Ff=ca,BS="__lodash_hash_undefined__";function US(t){return this.__data__.set(t,BS),this}var $S=US;function FS(t){return this.__data__.has(t)}var VS=FS,WS=$f,HS=$S,GS=VS;function Vo(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new WS;++e<r;)this.add(t[e])}Vo.prototype.add=Vo.prototype.push=HS;Vo.prototype.has=GS;var Vf=Vo;function zS(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}var A0=zS;function qS(t,e){return t.has(e)}var Wf=qS,YS=Vf,XS=A0,QS=Wf,KS=1,jS=2;function ZS(t,e,r,n,i,a){var s=r&KS,l=t.length,u=e.length;if(l!=u&&!(s&&u>l))return!1;var c=a.get(t),o=a.get(e);if(c&&o)return c==e&&o==t;var f=-1,h=!0,d=r&jS?new YS:void 0;for(a.set(t,e),a.set(e,t);++f<l;){var p=t[f],g=e[f];if(n)var m=s?n(g,p,f,e,t,a):n(p,g,f,t,e,a);if(m!==void 0){if(m)continue;h=!1;break}if(d){if(!XS(e,function(v,b){if(!QS(d,b)&&(p===v||i(p,v,r,n,a)))return d.push(b)})){h=!1;break}}else if(!(p===g||i(p,g,r,n,a))){h=!1;break}}return a.delete(t),a.delete(e),h}var C0=ZS,JS=un,eT=JS.Uint8Array,w0=eT;function tT(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}var rT=tT;function nT(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var Hf=nT,Td=ia,Rd=w0,iT=Os,aT=C0,sT=rT,oT=Hf,lT=1,cT=2,uT="[object Boolean]",fT="[object Date]",hT="[object Error]",dT="[object Map]",pT="[object Number]",gT="[object RegExp]",mT="[object Set]",vT="[object String]",yT="[object Symbol]",bT="[object ArrayBuffer]",ET="[object DataView]",Nd=Td?Td.prototype:void 0,_c=Nd?Nd.valueOf:void 0;function OT(t,e,r,n,i,a,s){switch(r){case ET:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case bT:return!(t.byteLength!=e.byteLength||!a(new Rd(t),new Rd(e)));case uT:case fT:case pT:return iT(+t,+e);case hT:return t.name==e.name&&t.message==e.message;case gT:case vT:return t==e+"";case dT:var l=sT;case mT:var u=n&lT;if(l||(l=oT),t.size!=e.size&&!u)return!1;var c=s.get(t);if(c)return c==e;n|=cT,s.set(t,e);var o=aT(l(t),l(e),n,i,a,s);return s.delete(t),o;case yT:if(_c)return _c.call(t)==_c.call(e)}return!1}var AT=OT;function CT(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}var Gf=CT,wT=Gf,ST=dt;function TT(t,e,r){var n=e(t);return ST(t)?n:wT(n,r(t))}var S0=TT;function RT(t,e){for(var r=-1,n=t==null?0:t.length,i=0,a=[];++r<n;){var s=t[r];e(s,r,t)&&(a[i++]=s)}return a}var zf=RT;function NT(){return[]}var T0=NT,xT=zf,MT=T0,_T=Object.prototype,kT=_T.propertyIsEnumerable,xd=Object.getOwnPropertySymbols,PT=xd?function(t){return t==null?[]:(t=Object(t),xT(xd(t),function(e){return kT.call(t,e)}))}:MT,qf=PT;function IT(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}var DT=IT,LT=9007199254740991,BT=/^(?:0|[1-9]\d*)$/;function UT(t,e){var r=typeof t;return e=e??LT,!!e&&(r=="number"||r!="symbol"&&BT.test(t))&&t>-1&&t%1==0&&t<e}var Nl=UT,$T=DT,FT=Ol,VT=dt,WT=Al,HT=Nl,GT=Uf,zT=Object.prototype,qT=zT.hasOwnProperty;function YT(t,e){var r=VT(t),n=!r&&FT(t),i=!r&&!n&&WT(t),a=!r&&!n&&!i&&GT(t),s=r||n||i||a,l=s?$T(t.length,String):[],u=l.length;for(var c in t)(e||qT.call(t,c))&&!(s&&(c=="length"||i&&(c=="offset"||c=="parent")||a&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||HT(c,u)))&&l.push(c);return l}var R0=YT,XT=R0,QT=g0,KT=dn;function jT(t){return KT(t)?XT(t):QT(t)}var Dr=jT,ZT=S0,JT=qf,eR=Dr;function tR(t){return ZT(t,eR,JT)}var N0=tR,Md=N0,rR=1,nR=Object.prototype,iR=nR.hasOwnProperty;function aR(t,e,r,n,i,a){var s=r&rR,l=Md(t),u=l.length,c=Md(e),o=c.length;if(u!=o&&!s)return!1;for(var f=u;f--;){var h=l[f];if(!(s?h in e:iR.call(e,h)))return!1}var d=a.get(t),p=a.get(e);if(d&&p)return d==e&&p==t;var g=!0;a.set(t,e),a.set(e,t);for(var m=s;++f<u;){h=l[f];var v=t[h],b=e[h];if(n)var C=s?n(b,v,h,e,t,a):n(v,b,h,t,e,a);if(!(C===void 0?v===b||i(v,b,r,n,a):C)){g=!1;break}m||(m=h=="constructor")}if(g&&!m){var A=t.constructor,O=e.constructor;A!=O&&"constructor"in t&&"constructor"in e&&!(typeof A=="function"&&A instanceof A&&typeof O=="function"&&O instanceof O)&&(g=!1)}return a.delete(t),a.delete(e),g}var sR=aR,kc=Ff,oR=C0,lR=AT,cR=sR,_d=ys,kd=dt,Pd=Al,uR=Uf,fR=1,Id="[object Arguments]",Dd="[object Array]",qs="[object Object]",hR=Object.prototype,Ld=hR.hasOwnProperty;function dR(t,e,r,n,i,a){var s=kd(t),l=kd(e),u=s?Dd:_d(t),c=l?Dd:_d(e);u=u==Id?qs:u,c=c==Id?qs:c;var o=u==qs,f=c==qs,h=u==c;if(h&&Pd(t)){if(!Pd(e))return!1;s=!0,o=!1}if(h&&!o)return a||(a=new kc),s||uR(t)?oR(t,e,r,n,i,a):lR(t,e,u,r,n,i,a);if(!(r&fR)){var d=o&&Ld.call(t,"__wrapped__"),p=f&&Ld.call(e,"__wrapped__");if(d||p){var g=d?t.value():t,m=p?e.value():e;return a||(a=new kc),i(g,m,r,n,a)}}return h?(a||(a=new kc),cR(t,e,r,n,i,a)):!1}var pR=dR,gR=pR,Bd=hn;function x0(t,e,r,n,i){return t===e?!0:t==null||e==null||!Bd(t)&&!Bd(e)?t!==t&&e!==e:gR(t,e,r,n,x0,i)}var M0=x0,mR=Ff,vR=M0,yR=1,bR=2;function ER(t,e,r,n){var i=r.length,a=i,s=!n;if(t==null)return!a;for(t=Object(t);i--;){var l=r[i];if(s&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++i<a;){l=r[i];var u=l[0],c=t[u],o=l[1];if(s&&l[2]){if(c===void 0&&!(u in t))return!1}else{var f=new mR;if(n)var h=n(c,o,u,t,e,f);if(!(h===void 0?vR(o,c,yR|bR,n,f):h))return!1}}return!0}var OR=ER,AR=fn;function CR(t){return t===t&&!AR(t)}var _0=CR,wR=_0,SR=Dr;function TR(t){for(var e=SR(t),r=e.length;r--;){var n=e[r],i=t[n];e[r]=[n,i,wR(i)]}return e}var RR=TR;function NR(t,e){return function(r){return r==null?!1:r[t]===e&&(e!==void 0||t in Object(r))}}var k0=NR,xR=OR,MR=RR,_R=k0;function kR(t){var e=MR(t);return e.length==1&&e[0][2]?_R(e[0][0],e[0][1]):function(r){return r===t||xR(r,t,e)}}var PR=kR,IR=Ti,DR=hn,LR="[object Symbol]";function BR(t){return typeof t=="symbol"||DR(t)&&IR(t)==LR}var xl=BR,UR=dt,$R=xl,FR=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,VR=/^\w*$/;function WR(t,e){if(UR(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||$R(t)?!0:VR.test(t)||!FR.test(t)||e!=null&&t in Object(e)}var Yf=WR,P0=$f,HR="Expected a function";function Xf(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(HR);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],a=r.cache;if(a.has(i))return a.get(i);var s=t.apply(this,n);return r.cache=a.set(i,s)||a,s};return r.cache=new(Xf.Cache||P0),r}Xf.Cache=P0;var GR=Xf,zR=GR,qR=500;function YR(t){var e=zR(t,function(n){return r.size===qR&&r.clear(),n}),r=e.cache;return e}var XR=YR,QR=XR,KR=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,jR=/\\(\\)?/g,ZR=QR(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(KR,function(r,n,i,a){e.push(i?a.replace(jR,"$1"):n||r)}),e}),JR=ZR,Ud=ia,eN=Es,tN=dt,rN=xl,nN=1/0,$d=Ud?Ud.prototype:void 0,Fd=$d?$d.toString:void 0;function I0(t){if(typeof t=="string")return t;if(tN(t))return eN(t,I0)+"";if(rN(t))return Fd?Fd.call(t):"";var e=t+"";return e=="0"&&1/t==-nN?"-0":e}var iN=I0,aN=iN;function sN(t){return t==null?"":aN(t)}var D0=sN,oN=dt,lN=Yf,cN=JR,uN=D0;function fN(t,e){return oN(t)?t:lN(t,e)?[t]:cN(uN(t))}var Ml=fN,hN=xl,dN=1/0;function pN(t){if(typeof t=="string"||hN(t))return t;var e=t+"";return e=="0"&&1/t==-dN?"-0":e}var As=pN,gN=Ml,mN=As;function vN(t,e){e=gN(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[mN(e[r++])];return r&&r==n?t:void 0}var Qf=vN,yN=Qf;function bN(t,e,r){var n=t==null?void 0:yN(t,e);return n===void 0?r:n}var EN=bN;function ON(t,e){return t!=null&&e in Object(t)}var AN=ON,CN=Ml,wN=Ol,SN=dt,TN=Nl,RN=Bf,NN=As;function xN(t,e,r){e=CN(e,t);for(var n=-1,i=e.length,a=!1;++n<i;){var s=NN(e[n]);if(!(a=t!=null&&r(t,s)))break;t=t[s]}return a||++n!=i?a:(i=t==null?0:t.length,!!i&&RN(i)&&TN(s,i)&&(SN(t)||wN(t)))}var L0=xN,MN=AN,_N=L0;function kN(t,e){return t!=null&&_N(t,e,MN)}var PN=kN,IN=M0,DN=EN,LN=PN,BN=Yf,UN=_0,$N=k0,FN=As,VN=1,WN=2;function HN(t,e){return BN(t)&&UN(e)?$N(FN(t),e):function(r){var n=DN(r,t);return n===void 0&&n===e?LN(r,t):IN(e,n,VN|WN)}}var GN=HN;function zN(t){return t}var Cs=zN;function qN(t){return function(e){return e==null?void 0:e[t]}}var YN=qN,XN=Qf;function QN(t){return function(e){return XN(e,t)}}var KN=QN,jN=YN,ZN=KN,JN=Yf,ex=As;function tx(t){return JN(t)?jN(ex(t)):ZN(t)}var rx=tx,nx=PR,ix=GN,ax=Cs,sx=dt,ox=rx;function lx(t){return typeof t=="function"?t:t==null?ax:typeof t=="object"?sx(t)?ix(t[0],t[1]):nx(t):ox(t)}var pn=lx;function cx(t){return function(e,r,n){for(var i=-1,a=Object(e),s=n(e),l=s.length;l--;){var u=s[t?l:++i];if(r(a[u],u,a)===!1)break}return e}}var ux=cx,fx=ux,hx=fx(),dx=hx,px=dx,gx=Dr;function mx(t,e){return t&&px(t,e,gx)}var vx=mx,yx=dn;function bx(t,e){return function(r,n){if(r==null)return r;if(!yx(r))return t(r,n);for(var i=r.length,a=e?i:-1,s=Object(r);(e?a--:++a<i)&&n(s[a],a,s)!==!1;);return r}}var Ex=bx,Ox=vx,Ax=Ex,Cx=Ax(Ox),Ni=Cx,wx=Ni,Sx=dn;function Tx(t,e){var r=-1,n=Sx(t)?Array(t.length):[];return wx(t,function(i,a,s){n[++r]=e(i,a,s)}),n}var Rx=Tx,Nx=Es,xx=pn,Mx=Rx,_x=dt;function kx(t,e){var r=_x(t)?Nx:Mx;return r(t,xx(e))}var br=kx;function Px(t,e){for(var r=-1,n=t==null?0:t.length;++r<n&&e(t[r],r,t)!==!1;);return t}var B0=Px,Ix=Cs;function Dx(t){return typeof t=="function"?t:Ix}var Lx=Dx,Bx=B0,Ux=Ni,$x=Lx,Fx=dt;function Vx(t,e){var r=Fx(t)?Bx:Ux;return r(t,$x(e))}var lr=Vx,Wx=Es;function Hx(t,e){return Wx(e,function(r){return t[r]})}var Gx=Hx,zx=Gx,qx=Dr;function Yx(t){return t==null?[]:zx(t,qx(t))}var Nn=Yx,Xx=Object.prototype,Qx=Xx.hasOwnProperty;function Kx(t,e){return t!=null&&Qx.call(t,e)}var jx=Kx,Zx=jx,Jx=L0;function eM(t,e){return t!=null&&Jx(t,e,Zx)}var Lr=eM,tM=Ri,rM=function(){try{var t=tM(Object,"defineProperty");return t({},"",{}),t}catch{}}(),U0=rM,Vd=U0;function nM(t,e,r){e=="__proto__"&&Vd?Vd(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var Kf=nM,iM=Kf,aM=Os,sM=Object.prototype,oM=sM.hasOwnProperty;function lM(t,e,r){var n=t[e];(!(oM.call(t,e)&&aM(n,r))||r===void 0&&!(e in t))&&iM(t,e,r)}var _l=lM,cM=_l,uM=Kf;function fM(t,e,r,n){var i=!r;r||(r={});for(var a=-1,s=e.length;++a<s;){var l=e[a],u=n?n(r[l],t[l],l,r,t):void 0;u===void 0&&(u=t[l]),i?uM(r,l,u):cM(r,l,u)}return r}var ws=fM,hM=ws,dM=Dr;function pM(t,e){return t&&hM(e,dM(e),t)}var gM=pM;function mM(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var vM=mM,yM=fn,bM=ms,EM=vM,OM=Object.prototype,AM=OM.hasOwnProperty;function CM(t){if(!yM(t))return EM(t);var e=bM(t),r=[];for(var n in t)n=="constructor"&&(e||!AM.call(t,n))||r.push(n);return r}var wM=CM,SM=R0,TM=wM,RM=dn;function NM(t){return RM(t)?SM(t,!0):TM(t)}var kl=NM,xM=ws,MM=kl;function _M(t,e){return t&&xM(e,MM(e),t)}var kM=_M,Wo={exports:{}};Wo.exports;(function(t,e){var r=un,n=e&&!e.nodeType&&e,i=n&&!0&&t&&!t.nodeType&&t,a=i&&i.exports===n,s=a?r.Buffer:void 0,l=s?s.allocUnsafe:void 0;function u(c,o){if(o)return c.slice();var f=c.length,h=l?l(f):new c.constructor(f);return c.copy(h),h}t.exports=u})(Wo,Wo.exports);var PM=Wo.exports;function IM(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}var DM=IM,LM=ws,BM=qf;function UM(t,e){return LM(t,BM(t),e)}var $M=UM,FM=p0,VM=FM(Object.getPrototypeOf,Object),$0=VM,WM=Gf,HM=$0,GM=qf,zM=T0,qM=Object.getOwnPropertySymbols,YM=qM?function(t){for(var e=[];t;)WM(e,GM(t)),t=HM(t);return e}:zM,F0=YM,XM=ws,QM=F0;function KM(t,e){return XM(t,QM(t),e)}var jM=KM,ZM=S0,JM=F0,e_=kl;function t_(t){return ZM(t,e_,JM)}var V0=t_,r_=Object.prototype,n_=r_.hasOwnProperty;function i_(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&n_.call(t,"index")&&(r.index=t.index,r.input=t.input),r}var a_=i_,Wd=w0;function s_(t){var e=new t.constructor(t.byteLength);return new Wd(e).set(new Wd(t)),e}var jf=s_,o_=jf;function l_(t,e){var r=e?o_(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}var c_=l_,u_=/\w*$/;function f_(t){var e=new t.constructor(t.source,u_.exec(t));return e.lastIndex=t.lastIndex,e}var h_=f_,Hd=ia,Gd=Hd?Hd.prototype:void 0,zd=Gd?Gd.valueOf:void 0;function d_(t){return zd?Object(zd.call(t)):{}}var p_=d_,g_=jf;function m_(t,e){var r=e?g_(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var v_=m_,y_=jf,b_=c_,E_=h_,O_=p_,A_=v_,C_="[object Boolean]",w_="[object Date]",S_="[object Map]",T_="[object Number]",R_="[object RegExp]",N_="[object Set]",x_="[object String]",M_="[object Symbol]",__="[object ArrayBuffer]",k_="[object DataView]",P_="[object Float32Array]",I_="[object Float64Array]",D_="[object Int8Array]",L_="[object Int16Array]",B_="[object Int32Array]",U_="[object Uint8Array]",$_="[object Uint8ClampedArray]",F_="[object Uint16Array]",V_="[object Uint32Array]";function W_(t,e,r){var n=t.constructor;switch(e){case __:return y_(t);case C_:case w_:return new n(+t);case k_:return b_(t,r);case P_:case I_:case D_:case L_:case B_:case U_:case $_:case F_:case V_:return A_(t,r);case S_:return new n;case T_:case x_:return new n(t);case R_:return E_(t);case N_:return new n;case M_:return O_(t)}}var H_=W_,G_=fn,qd=Object.create,z_=function(){function t(){}return function(e){if(!G_(e))return{};if(qd)return qd(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),q_=z_,Y_=q_,X_=$0,Q_=ms;function K_(t){return typeof t.constructor=="function"&&!Q_(t)?Y_(X_(t)):{}}var j_=K_,Z_=ys,J_=hn,ek="[object Map]";function tk(t){return J_(t)&&Z_(t)==ek}var rk=tk,nk=rk,ik=bs,Yd=Cl,Xd=Yd&&Yd.isMap,ak=Xd?ik(Xd):nk,sk=ak,ok=ys,lk=hn,ck="[object Set]";function uk(t){return lk(t)&&ok(t)==ck}var fk=uk,hk=fk,dk=bs,Qd=Cl,Kd=Qd&&Qd.isSet,pk=Kd?dk(Kd):hk,gk=pk,mk=Ff,vk=B0,yk=_l,bk=gM,Ek=kM,Ok=PM,Ak=DM,Ck=$M,wk=jM,Sk=N0,Tk=V0,Rk=ys,Nk=a_,xk=H_,Mk=j_,_k=dt,kk=Al,Pk=sk,Ik=fn,Dk=gk,Lk=Dr,Bk=kl,Uk=1,$k=2,Fk=4,W0="[object Arguments]",Vk="[object Array]",Wk="[object Boolean]",Hk="[object Date]",Gk="[object Error]",H0="[object Function]",zk="[object GeneratorFunction]",qk="[object Map]",Yk="[object Number]",G0="[object Object]",Xk="[object RegExp]",Qk="[object Set]",Kk="[object String]",jk="[object Symbol]",Zk="[object WeakMap]",Jk="[object ArrayBuffer]",eP="[object DataView]",tP="[object Float32Array]",rP="[object Float64Array]",nP="[object Int8Array]",iP="[object Int16Array]",aP="[object Int32Array]",sP="[object Uint8Array]",oP="[object Uint8ClampedArray]",lP="[object Uint16Array]",cP="[object Uint32Array]",mt={};mt[W0]=mt[Vk]=mt[Jk]=mt[eP]=mt[Wk]=mt[Hk]=mt[tP]=mt[rP]=mt[nP]=mt[iP]=mt[aP]=mt[qk]=mt[Yk]=mt[G0]=mt[Xk]=mt[Qk]=mt[Kk]=mt[jk]=mt[sP]=mt[oP]=mt[lP]=mt[cP]=!0;mt[Gk]=mt[H0]=mt[Zk]=!1;function Co(t,e,r,n,i,a){var s,l=e&Uk,u=e&$k,c=e&Fk;if(r&&(s=i?r(t,n,i,a):r(t)),s!==void 0)return s;if(!Ik(t))return t;var o=_k(t);if(o){if(s=Nk(t),!l)return Ak(t,s)}else{var f=Rk(t),h=f==H0||f==zk;if(kk(t))return Ok(t,l);if(f==G0||f==W0||h&&!i){if(s=u||h?{}:Mk(t),!l)return u?wk(t,Ek(s,t)):Ck(t,bk(s,t))}else{if(!mt[f])return i?t:{};s=xk(t,f,l)}}a||(a=new mk);var d=a.get(t);if(d)return d;a.set(t,s),Dk(t)?t.forEach(function(m){s.add(Co(m,e,r,m,t,a))}):Pk(t)&&t.forEach(function(m,v){s.set(v,Co(m,e,r,v,t,a))});var p=c?u?Tk:Sk:u?Bk:Lk,g=o?void 0:p(t);return vk(g||t,function(m,v){g&&(v=m,m=t[v]),yk(s,v,Co(m,e,r,v,t,a))}),s}var uP=Co,fP=uP,hP=4;function dP(t){return fP(t,hP)}var Zn=dP,ua={},Zi={};Object.defineProperty(Zi,"__esModule",{value:!0});Zi.PRINT_WARNING=Zi.PRINT_ERROR=void 0;function pP(t){console&&console.error&&console.error("Error: ".concat(t))}Zi.PRINT_ERROR=pP;function gP(t){console&&console.warn&&console.warn("Warning: ".concat(t))}Zi.PRINT_WARNING=gP;var Pl={};Object.defineProperty(Pl,"__esModule",{value:!0});Pl.timer=void 0;function mP(t){var e=new Date().getTime(),r=t(),n=new Date().getTime(),i=n-e;return{time:i,value:r}}Pl.timer=mP;var Il={};Object.defineProperty(Il,"__esModule",{value:!0});Il.toFastProperties=void 0;function vP(t){function e(){}e.prototype=t;var r=new e;function n(){return typeof r.bar}return n(),n(),t}Il.toFastProperties=vP;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.toFastProperties=t.timer=t.PRINT_ERROR=t.PRINT_WARNING=void 0;var e=Zi;Object.defineProperty(t,"PRINT_WARNING",{enumerable:!0,get:function(){return e.PRINT_WARNING}}),Object.defineProperty(t,"PRINT_ERROR",{enumerable:!0,get:function(){return e.PRINT_ERROR}});var r=Pl;Object.defineProperty(t,"timer",{enumerable:!0,get:function(){return r.timer}});var n=Il;Object.defineProperty(t,"toFastProperties",{enumerable:!0,get:function(){return n.toFastProperties}})})(ua);var rn={},fa={};function yP(t,e,r){var n=-1,i=t.length;e<0&&(e=-e>i?0:i+e),r=r>i?i:r,r<0&&(r+=i),i=e>r?0:r-e>>>0,e>>>=0;for(var a=Array(i);++n<i;)a[n]=t[n+e];return a}var Zf=yP,bP=/\s/;function EP(t){for(var e=t.length;e--&&bP.test(t.charAt(e)););return e}var OP=EP,AP=OP,CP=/^\s+/;function wP(t){return t&&t.slice(0,AP(t)+1).replace(CP,"")}var SP=wP,TP=SP,jd=fn,RP=xl,Zd=NaN,NP=/^[-+]0x[0-9a-f]+$/i,xP=/^0b[01]+$/i,MP=/^0o[0-7]+$/i,_P=parseInt;function kP(t){if(typeof t=="number")return t;if(RP(t))return Zd;if(jd(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=jd(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=TP(t);var r=xP.test(t);return r||MP.test(t)?_P(t.slice(2),r?2:8):NP.test(t)?Zd:+t}var PP=kP,IP=PP,Jd=1/0,DP=17976931348623157e292;function LP(t){if(!t)return t===0?t:0;if(t=IP(t),t===Jd||t===-Jd){var e=t<0?-1:1;return e*DP}return t===t?t:0}var BP=LP,UP=BP;function $P(t){var e=UP(t),r=e%1;return e===e?r?e-r:e:0}var Ss=$P,FP=Zf,VP=Ss;function WP(t,e,r){var n=t==null?0:t.length;return n?(e=r||e===void 0?1:VP(e),FP(t,e<0?0:e,n)):[]}var Jf=WP,Ut={},ct={},HP=Ti,GP=dt,zP=hn,qP="[object String]";function YP(t){return typeof t=="string"||!GP(t)&&zP(t)&&HP(t)==qP}var Dl=YP,XP=Ti,QP=hn,KP="[object RegExp]";function jP(t){return QP(t)&&XP(t)==KP}var ZP=jP,JP=ZP,e2=bs,ep=Cl,tp=ep&&ep.isRegExp,t2=tp?e2(tp):JP,z0=t2,r2=_l,n2=Ml,i2=Nl,rp=fn,a2=As;function s2(t,e,r,n){if(!rp(t))return t;e=n2(e,t);for(var i=-1,a=e.length,s=a-1,l=t;l!=null&&++i<a;){var u=a2(e[i]),c=r;if(u==="__proto__"||u==="constructor"||u==="prototype")return t;if(i!=s){var o=l[u];c=n?n(o,u,l):void 0,c===void 0&&(c=rp(o)?o:i2(e[i+1])?[]:{})}r2(l,u,c),l=l[u]}return t}var o2=s2,l2=Qf,c2=o2,u2=Ml;function f2(t,e,r){for(var n=-1,i=e.length,a={};++n<i;){var s=e[n],l=l2(t,s);r(l,s)&&c2(a,u2(s,t),l)}return a}var h2=f2,d2=Es,p2=pn,g2=h2,m2=V0;function v2(t,e){if(t==null)return{};var r=d2(m2(t),function(n){return[n]});return e=p2(e),g2(t,r,function(n,i){return e(n,i[0])})}var q0=v2;function y2(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}var b2=y2,E2=b2,np=Math.max;function O2(t,e,r){return e=np(e===void 0?t.length-1:e,0),function(){for(var n=arguments,i=-1,a=np(n.length-e,0),s=Array(a);++i<a;)s[i]=n[e+i];i=-1;for(var l=Array(e+1);++i<e;)l[i]=n[i];return l[e]=r(s),E2(t,this,l)}}var A2=O2;function C2(t){return function(){return t}}var w2=C2,S2=w2,ip=U0,T2=Cs,R2=ip?function(t,e){return ip(t,"toString",{configurable:!0,enumerable:!1,value:S2(e),writable:!0})}:T2,N2=R2,x2=800,M2=16,_2=Date.now;function k2(t){var e=0,r=0;return function(){var n=_2(),i=M2-(n-r);if(r=n,i>0){if(++e>=x2)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var P2=k2,I2=N2,D2=P2,L2=D2(I2),B2=L2,U2=Cs,$2=A2,F2=B2;function V2(t,e){return F2($2(t,e,U2),t+"")}var eh=V2,W2=Os,H2=dn,G2=Nl,z2=fn;function q2(t,e,r){if(!z2(r))return!1;var n=typeof e;return(n=="number"?H2(r)&&G2(e,r.length):n=="string"&&e in r)?W2(r[e],t):!1}var Ll=q2,Y2=eh,X2=Ll;function Q2(t){return Y2(function(e,r){var n=-1,i=r.length,a=i>1?r[i-1]:void 0,s=i>2?r[2]:void 0;for(a=t.length>3&&typeof a=="function"?(i--,a):void 0,s&&X2(r[0],r[1],s)&&(a=i<3?void 0:a,i=1),e=Object(e);++n<i;){var l=r[n];l&&t(e,l,n,a)}return e})}var K2=Q2,j2=_l,Z2=ws,J2=K2,eI=dn,tI=ms,rI=Dr,nI=Object.prototype,iI=nI.hasOwnProperty,aI=J2(function(t,e){if(tI(e)||eI(e)){Z2(e,rI(e),t);return}for(var r in e)iI.call(e,r)&&j2(t,r,e[r])}),Bl=aI,xn=Ce&&Ce.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),ha=Ce&&Ce.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ct,"__esModule",{value:!0});ct.serializeProduction=ct.serializeGrammar=ct.Terminal=ct.Alternation=ct.RepetitionWithSeparator=ct.Repetition=ct.RepetitionMandatoryWithSeparator=ct.RepetitionMandatory=ct.Option=ct.Alternative=ct.Rule=ct.NonTerminal=ct.AbstractProduction=void 0;var Y0=ha(br),sI=ha(lr),Tu=ha(Dl),oI=ha(z0),gn=ha(q0),mn=ha(Bl);function lI(t){return cI(t)?t.LABEL:t.name}function cI(t){return(0,Tu.default)(t.LABEL)&&t.LABEL!==""}var vn=function(){function t(e){this._definition=e}return Object.defineProperty(t.prototype,"definition",{get:function(){return this._definition},set:function(e){this._definition=e},enumerable:!1,configurable:!0}),t.prototype.accept=function(e){e.visit(this),(0,sI.default)(this.definition,function(r){r.accept(e)})},t}();ct.AbstractProduction=vn;var X0=function(t){xn(e,t);function e(r){var n=t.call(this,[])||this;return n.idx=1,(0,mn.default)(n,(0,gn.default)(r,function(i){return i!==void 0})),n}return Object.defineProperty(e.prototype,"definition",{get:function(){return this.referencedRule!==void 0?this.referencedRule.definition:[]},set:function(r){},enumerable:!1,configurable:!0}),e.prototype.accept=function(r){r.visit(this)},e}(vn);ct.NonTerminal=X0;var Q0=function(t){xn(e,t);function e(r){var n=t.call(this,r.definition)||this;return n.orgText="",(0,mn.default)(n,(0,gn.default)(r,function(i){return i!==void 0})),n}return e}(vn);ct.Rule=Q0;var K0=function(t){xn(e,t);function e(r){var n=t.call(this,r.definition)||this;return n.ignoreAmbiguities=!1,(0,mn.default)(n,(0,gn.default)(r,function(i){return i!==void 0})),n}return e}(vn);ct.Alternative=K0;var j0=function(t){xn(e,t);function e(r){var n=t.call(this,r.definition)||this;return n.idx=1,(0,mn.default)(n,(0,gn.default)(r,function(i){return i!==void 0})),n}return e}(vn);ct.Option=j0;var Z0=function(t){xn(e,t);function e(r){var n=t.call(this,r.definition)||this;return n.idx=1,(0,mn.default)(n,(0,gn.default)(r,function(i){return i!==void 0})),n}return e}(vn);ct.RepetitionMandatory=Z0;var J0=function(t){xn(e,t);function e(r){var n=t.call(this,r.definition)||this;return n.idx=1,(0,mn.default)(n,(0,gn.default)(r,function(i){return i!==void 0})),n}return e}(vn);ct.RepetitionMandatoryWithSeparator=J0;var ev=function(t){xn(e,t);function e(r){var n=t.call(this,r.definition)||this;return n.idx=1,(0,mn.default)(n,(0,gn.default)(r,function(i){return i!==void 0})),n}return e}(vn);ct.Repetition=ev;var tv=function(t){xn(e,t);function e(r){var n=t.call(this,r.definition)||this;return n.idx=1,(0,mn.default)(n,(0,gn.default)(r,function(i){return i!==void 0})),n}return e}(vn);ct.RepetitionWithSeparator=tv;var rv=function(t){xn(e,t);function e(r){var n=t.call(this,r.definition)||this;return n.idx=1,n.ignoreAmbiguities=!1,n.hasPredicates=!1,(0,mn.default)(n,(0,gn.default)(r,function(i){return i!==void 0})),n}return Object.defineProperty(e.prototype,"definition",{get:function(){return this._definition},set:function(r){this._definition=r},enumerable:!1,configurable:!0}),e}(vn);ct.Alternation=rv;var wo=function(){function t(e){this.idx=1,(0,mn.default)(this,(0,gn.default)(e,function(r){return r!==void 0}))}return t.prototype.accept=function(e){e.visit(this)},t}();ct.Terminal=wo;function uI(t){return(0,Y0.default)(t,Qa)}ct.serializeGrammar=uI;function Qa(t){function e(a){return(0,Y0.default)(a,Qa)}if(t instanceof X0){var r={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return(0,Tu.default)(t.label)&&(r.label=t.label),r}else{if(t instanceof K0)return{type:"Alternative",definition:e(t.definition)};if(t instanceof j0)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof Z0)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof J0)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:Qa(new wo({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof tv)return{type:"RepetitionWithSeparator",idx:t.idx,separator:Qa(new wo({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof ev)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof rv)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof wo){var n={type:"Terminal",name:t.terminalType.name,label:lI(t.terminalType),idx:t.idx};(0,Tu.default)(t.label)&&(n.terminalLabel=t.label);var i=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=(0,oI.default)(i)?i.source:i),n}else{if(t instanceof Q0)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}ct.serializeProduction=Qa;var Ul={};Object.defineProperty(Ul,"__esModule",{value:!0});Ul.GAstVisitor=void 0;var Yr=ct,fI=function(){function t(){}return t.prototype.visit=function(e){var r=e;switch(r.constructor){case Yr.NonTerminal:return this.visitNonTerminal(r);case Yr.Alternative:return this.visitAlternative(r);case Yr.Option:return this.visitOption(r);case Yr.RepetitionMandatory:return this.visitRepetitionMandatory(r);case Yr.RepetitionMandatoryWithSeparator:return this.visitRepetitionMandatoryWithSeparator(r);case Yr.RepetitionWithSeparator:return this.visitRepetitionWithSeparator(r);case Yr.Repetition:return this.visitRepetition(r);case Yr.Alternation:return this.visitAlternation(r);case Yr.Terminal:return this.visitTerminal(r);case Yr.Rule:return this.visitRule(r);default:throw Error("non exhaustive match")}},t.prototype.visitNonTerminal=function(e){},t.prototype.visitAlternative=function(e){},t.prototype.visitOption=function(e){},t.prototype.visitRepetition=function(e){},t.prototype.visitRepetitionMandatory=function(e){},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){},t.prototype.visitRepetitionWithSeparator=function(e){},t.prototype.visitAlternation=function(e){},t.prototype.visitTerminal=function(e){},t.prototype.visitRule=function(e){},t}();Ul.GAstVisitor=fI;var nn={},hI=Ni;function dI(t,e){var r;return hI(t,function(n,i,a){return r=e(n,i,a),!r}),!!r}var pI=dI,gI=A0,mI=pn,vI=pI,yI=dt,bI=Ll;function EI(t,e,r){var n=yI(t)?gI:vI;return r&&bI(t,e,r)&&(e=void 0),n(t,mI(e))}var th=EI;function OI(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(!e(t[r],r,t))return!1;return!0}var AI=OI,CI=Ni;function wI(t,e){var r=!0;return CI(t,function(n,i,a){return r=!!e(n,i,a),r}),r}var SI=wI,TI=AI,RI=SI,NI=pn,xI=dt,MI=Ll;function _I(t,e,r){var n=xI(t)?TI:RI;return r&&MI(t,e,r)&&(e=void 0),n(t,NI(e))}var $l=_I;function kI(t,e,r,n){for(var i=t.length,a=r+(n?1:-1);n?a--:++a<i;)if(e(t[a],a,t))return a;return-1}var nv=kI;function PI(t){return t!==t}var II=PI;function DI(t,e,r){for(var n=r-1,i=t.length;++n<i;)if(t[n]===e)return n;return-1}var LI=DI,BI=nv,UI=II,$I=LI;function FI(t,e,r){return e===e?$I(t,e,r):BI(t,UI,r)}var rh=FI,VI=rh,WI=dn,HI=Dl,GI=Ss,zI=Nn,qI=Math.max;function YI(t,e,r,n){t=WI(t)?t:zI(t),r=r&&!n?GI(r):0;var i=t.length;return r<0&&(r=qI(i+r,0)),HI(t)?r<=i&&t.indexOf(e,r)>-1:!!i&&VI(t,e,r)>-1}var Jn=YI,nh=Ce&&Ce.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(nn,"__esModule",{value:!0});nn.getProductionDslName=nn.isBranchingProd=nn.isOptionalProd=nn.isSequenceProd=void 0;var XI=nh(th),QI=nh($l),KI=nh(Jn),wt=ct;function jI(t){return t instanceof wt.Alternative||t instanceof wt.Option||t instanceof wt.Repetition||t instanceof wt.RepetitionMandatory||t instanceof wt.RepetitionMandatoryWithSeparator||t instanceof wt.RepetitionWithSeparator||t instanceof wt.Terminal||t instanceof wt.Rule}nn.isSequenceProd=jI;function Ru(t,e){e===void 0&&(e=[]);var r=t instanceof wt.Option||t instanceof wt.Repetition||t instanceof wt.RepetitionWithSeparator;return r?!0:t instanceof wt.Alternation?(0,XI.default)(t.definition,function(n){return Ru(n,e)}):t instanceof wt.NonTerminal&&(0,KI.default)(e,t)?!1:t instanceof wt.AbstractProduction?(t instanceof wt.NonTerminal&&e.push(t),(0,QI.default)(t.definition,function(n){return Ru(n,e)})):!1}nn.isOptionalProd=Ru;function ZI(t){return t instanceof wt.Alternation}nn.isBranchingProd=ZI;function JI(t){if(t instanceof wt.NonTerminal)return"SUBRULE";if(t instanceof wt.Option)return"OPTION";if(t instanceof wt.Alternation)return"OR";if(t instanceof wt.RepetitionMandatory)return"AT_LEAST_ONE";if(t instanceof wt.RepetitionMandatoryWithSeparator)return"AT_LEAST_ONE_SEP";if(t instanceof wt.RepetitionWithSeparator)return"MANY_SEP";if(t instanceof wt.Repetition)return"MANY";if(t instanceof wt.Terminal)return"CONSUME";throw Error("non exhaustive match")}nn.getProductionDslName=JI;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.isSequenceProd=t.isBranchingProd=t.isOptionalProd=t.getProductionDslName=t.GAstVisitor=t.serializeProduction=t.serializeGrammar=t.Alternative=t.Alternation=t.RepetitionWithSeparator=t.RepetitionMandatoryWithSeparator=t.RepetitionMandatory=t.Repetition=t.Option=t.NonTerminal=t.Terminal=t.Rule=void 0;var e=ct;Object.defineProperty(t,"Rule",{enumerable:!0,get:function(){return e.Rule}}),Object.defineProperty(t,"Terminal",{enumerable:!0,get:function(){return e.Terminal}}),Object.defineProperty(t,"NonTerminal",{enumerable:!0,get:function(){return e.NonTerminal}}),Object.defineProperty(t,"Option",{enumerable:!0,get:function(){return e.Option}}),Object.defineProperty(t,"Repetition",{enumerable:!0,get:function(){return e.Repetition}}),Object.defineProperty(t,"RepetitionMandatory",{enumerable:!0,get:function(){return e.RepetitionMandatory}}),Object.defineProperty(t,"RepetitionMandatoryWithSeparator",{enumerable:!0,get:function(){return e.RepetitionMandatoryWithSeparator}}),Object.defineProperty(t,"RepetitionWithSeparator",{enumerable:!0,get:function(){return e.RepetitionWithSeparator}}),Object.defineProperty(t,"Alternation",{enumerable:!0,get:function(){return e.Alternation}}),Object.defineProperty(t,"Alternative",{enumerable:!0,get:function(){return e.Alternative}}),Object.defineProperty(t,"serializeGrammar",{enumerable:!0,get:function(){return e.serializeGrammar}}),Object.defineProperty(t,"serializeProduction",{enumerable:!0,get:function(){return e.serializeProduction}});var r=Ul;Object.defineProperty(t,"GAstVisitor",{enumerable:!0,get:function(){return r.GAstVisitor}});var n=nn;Object.defineProperty(t,"getProductionDslName",{enumerable:!0,get:function(){return n.getProductionDslName}}),Object.defineProperty(t,"isOptionalProd",{enumerable:!0,get:function(){return n.isOptionalProd}}),Object.defineProperty(t,"isBranchingProd",{enumerable:!0,get:function(){return n.isBranchingProd}}),Object.defineProperty(t,"isSequenceProd",{enumerable:!0,get:function(){return n.isSequenceProd}})})(Ut);var iv=Ce&&Ce.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(fa,"__esModule",{value:!0});fa.RestWalker=void 0;var eD=iv(Jf),ap=iv(lr),pr=Ut,tD=function(){function t(){}return t.prototype.walk=function(e,r){var n=this;r===void 0&&(r=[]),(0,ap.default)(e.definition,function(i,a){var s=(0,eD.default)(e.definition,a+1);if(i instanceof pr.NonTerminal)n.walkProdRef(i,s,r);else if(i instanceof pr.Terminal)n.walkTerminal(i,s,r);else if(i instanceof pr.Alternative)n.walkFlat(i,s,r);else if(i instanceof pr.Option)n.walkOption(i,s,r);else if(i instanceof pr.RepetitionMandatory)n.walkAtLeastOne(i,s,r);else if(i instanceof pr.RepetitionMandatoryWithSeparator)n.walkAtLeastOneSep(i,s,r);else if(i instanceof pr.RepetitionWithSeparator)n.walkManySep(i,s,r);else if(i instanceof pr.Repetition)n.walkMany(i,s,r);else if(i instanceof pr.Alternation)n.walkOr(i,s,r);else throw Error("non exhaustive match")})},t.prototype.walkTerminal=function(e,r,n){},t.prototype.walkProdRef=function(e,r,n){},t.prototype.walkFlat=function(e,r,n){var i=r.concat(n);this.walk(e,i)},t.prototype.walkOption=function(e,r,n){var i=r.concat(n);this.walk(e,i)},t.prototype.walkAtLeastOne=function(e,r,n){var i=[new pr.Option({definition:e.definition})].concat(r,n);this.walk(e,i)},t.prototype.walkAtLeastOneSep=function(e,r,n){var i=sp(e,r,n);this.walk(e,i)},t.prototype.walkMany=function(e,r,n){var i=[new pr.Option({definition:e.definition})].concat(r,n);this.walk(e,i)},t.prototype.walkManySep=function(e,r,n){var i=sp(e,r,n);this.walk(e,i)},t.prototype.walkOr=function(e,r,n){var i=this,a=r.concat(n);(0,ap.default)(e.definition,function(s){var l=new pr.Alternative({definition:[s]});i.walk(l,a)})},t}();fa.RestWalker=tD;function sp(t,e,r){var n=[new pr.Option({definition:[new pr.Terminal({terminalType:t.separator})].concat(t.definition)})],i=n.concat(e,r);return i}var Fr={},op=ia,rD=Ol,nD=dt,lp=op?op.isConcatSpreadable:void 0;function iD(t){return nD(t)||rD(t)||!!(lp&&t&&t[lp])}var aD=iD,sD=Gf,oD=aD;function av(t,e,r,n,i){var a=-1,s=t.length;for(r||(r=oD),i||(i=[]);++a<s;){var l=t[a];e>0&&r(l)?e>1?av(l,e-1,r,n,i):sD(i,l):n||(i[i.length]=l)}return i}var ih=av,lD=ih;function cD(t){var e=t==null?0:t.length;return e?lD(t,1):[]}var Mn=cD,uD=rh;function fD(t,e){var r=t==null?0:t.length;return!!r&&uD(t,e,0)>-1}var sv=fD;function hD(t,e,r){for(var n=-1,i=t==null?0:t.length;++n<i;)if(r(e,t[n]))return!0;return!1}var ov=hD;function dD(){}var ah=dD,Pc=b0,pD=ah,gD=Hf,mD=1/0,vD=Pc&&1/gD(new Pc([,-0]))[1]==mD?function(t){return new Pc(t)}:pD,yD=vD,bD=Vf,ED=sv,OD=ov,AD=Wf,CD=yD,wD=Hf,SD=200;function TD(t,e,r){var n=-1,i=ED,a=t.length,s=!0,l=[],u=l;if(r)s=!1,i=OD;else if(a>=SD){var c=e?null:CD(t);if(c)return wD(c);s=!1,i=AD,u=new bD}else u=e?[]:l;e:for(;++n<a;){var o=t[n],f=e?e(o):o;if(o=r||o!==0?o:0,s&&f===f){for(var h=u.length;h--;)if(u[h]===f)continue e;e&&u.push(f),l.push(o)}else i(u,f,r)||(u!==l&&u.push(f),l.push(o))}return l}var RD=TD,ND=RD;function xD(t){return t&&t.length?ND(t):[]}var sh=xD,oh=Ce&&Ce.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Fr,"__esModule",{value:!0});Fr.firstForTerminal=Fr.firstForBranching=Fr.firstForSequence=Fr.first=void 0;var MD=oh(Mn),lv=oh(sh),_D=oh(br),cp=Ut,Nu=Ut;function Fl(t){if(t instanceof cp.NonTerminal)return Fl(t.referencedRule);if(t instanceof cp.Terminal)return fv(t);if((0,Nu.isSequenceProd)(t))return cv(t);if((0,Nu.isBranchingProd)(t))return uv(t);throw Error("non exhaustive match")}Fr.first=Fl;function cv(t){for(var e=[],r=t.definition,n=0,i=r.length>n,a,s=!0;i&&s;)a=r[n],s=(0,Nu.isOptionalProd)(a),e=e.concat(Fl(a)),n=n+1,i=r.length>n;return(0,lv.default)(e)}Fr.firstForSequence=cv;function uv(t){var e=(0,_D.default)(t.definition,function(r){return Fl(r)});return(0,lv.default)((0,MD.default)(e))}Fr.firstForBranching=uv;function fv(t){return[t.terminalType]}Fr.firstForTerminal=fv;var Ts={};Object.defineProperty(Ts,"__esModule",{value:!0});Ts.IN=void 0;Ts.IN="_~IN~_";var kD=Ce&&Ce.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),hv=Ce&&Ce.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(rn,"__esModule",{value:!0});rn.buildInProdFollowPrefix=rn.buildBetweenProdsFollowPrefix=rn.computeAllProdsFollows=rn.ResyncFollowsWalker=void 0;var PD=fa,ID=Fr,DD=hv(lr),LD=hv(Bl),dv=Ts,BD=Ut,pv=function(t){kD(e,t);function e(r){var n=t.call(this)||this;return n.topProd=r,n.follows={},n}return e.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},e.prototype.walkTerminal=function(r,n,i){},e.prototype.walkProdRef=function(r,n,i){var a=gv(r.referencedRule,r.idx)+this.topProd.name,s=n.concat(i),l=new BD.Alternative({definition:s}),u=(0,ID.first)(l);this.follows[a]=u},e}(PD.RestWalker);rn.ResyncFollowsWalker=pv;function UD(t){var e={};return(0,DD.default)(t,function(r){var n=new pv(r).startWalking();(0,LD.default)(e,n)}),e}rn.computeAllProdsFollows=UD;function gv(t,e){return t.name+e+dv.IN}rn.buildBetweenProdsFollowPrefix=gv;function $D(t){var e=t.terminalType.name;return e+t.idx+dv.IN}rn.buildInProdFollowPrefix=$D;var xi={};function FD(t){return t===void 0}var da=FD,Ic={},Dc={},mv={exports:{}};(function(t){(function(e,r){t.exports?t.exports=r():e.regexpToAst=r()})(typeof self<"u"?self:Ce,function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(g){this.idx=g.idx,this.input=g.input,this.groupIdx=g.groupIdx},e.prototype.pattern=function(g){this.idx=0,this.input=g,this.groupIdx=0,this.consumeChar("/");var m=this.disjunction();this.consumeChar("/");for(var v={type:"Flags",loc:{begin:this.idx,end:g.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":l(v,"global");break;case"i":l(v,"ignoreCase");break;case"m":l(v,"multiLine");break;case"u":l(v,"unicode");break;case"y":l(v,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:v,value:m,loc:this.loc(0)}},e.prototype.disjunction=function(){var g=[],m=this.idx;for(g.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),g.push(this.alternative());return{type:"Disjunction",value:g,loc:this.loc(m)}},e.prototype.alternative=function(){for(var g=[],m=this.idx;this.isTerm();)g.push(this.term());return{type:"Alternative",value:g,loc:this.loc(m)}},e.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},e.prototype.assertion=function(){var g=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(g)};case"$":return{type:"EndAnchor",loc:this.loc(g)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(g)};case"B":return{type:"NonWordBoundary",loc:this.loc(g)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");var m;switch(this.popChar()){case"=":m="Lookahead";break;case"!":m="NegativeLookahead";break}u(m);var v=this.disjunction();return this.consumeChar(")"),{type:m,value:v,loc:this.loc(g)}}c()},e.prototype.quantifier=function(g){var m,v=this.idx;switch(this.popChar()){case"*":m={atLeast:0,atMost:1/0};break;case"+":m={atLeast:1,atMost:1/0};break;case"?":m={atLeast:0,atMost:1};break;case"{":var b=this.integerIncludingZero();switch(this.popChar()){case"}":m={atLeast:b,atMost:b};break;case",":var C;this.isDigit()?(C=this.integerIncludingZero(),m={atLeast:b,atMost:C}):m={atLeast:b,atMost:1/0},this.consumeChar("}");break}if(g===!0&&m===void 0)return;u(m);break}if(!(g===!0&&m===void 0))return u(m),this.peekChar(0)==="?"?(this.consumeChar("?"),m.greedy=!1):m.greedy=!0,m.type="Quantifier",m.loc=this.loc(v),m},e.prototype.atom=function(){var g,m=this.idx;switch(this.peekChar()){case".":g=this.dotAll();break;case"\\":g=this.atomEscape();break;case"[":g=this.characterClass();break;case"(":g=this.group();break}return g===void 0&&this.isPatternCharacter()&&(g=this.patternCharacter()),u(g),g.loc=this.loc(m),this.isQuantifier()&&(g.quantifier=this.quantifier()),g},e.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[a(`
`),a("\r"),a("\u2028"),a("\u2029")]}},e.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){var g=this.positiveInteger();return{type:"GroupBackReference",value:g}},e.prototype.characterClassEscape=function(){var g,m=!1;switch(this.popChar()){case"d":g=f;break;case"D":g=f,m=!0;break;case"s":g=d;break;case"S":g=d,m=!0;break;case"w":g=h;break;case"W":g=h,m=!0;break}return u(g),{type:"Set",value:g,complement:m}},e.prototype.controlEscapeAtom=function(){var g;switch(this.popChar()){case"f":g=a("\f");break;case"n":g=a(`
`);break;case"r":g=a("\r");break;case"t":g=a("	");break;case"v":g=a("\v");break}return u(g),{type:"Character",value:g}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var g=this.popChar();if(/[a-zA-Z]/.test(g)===!1)throw Error("Invalid ");var m=g.toUpperCase().charCodeAt(0)-64;return{type:"Character",value:m}},e.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:a("\0")}},e.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){var g=this.popChar();return{type:"Character",value:a(g)}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:var g=this.popChar();return{type:"Character",value:a(g)}}},e.prototype.characterClass=function(){var g=[],m=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),m=!0);this.isClassAtom();){var v=this.classAtom(),b=v.type==="Character";if(b&&this.isRangeDash()){this.consumeChar("-");var C=this.classAtom(),A=C.type==="Character";if(A){if(C.value<v.value)throw Error("Range out of order in character class");g.push({from:v.value,to:C.value})}else s(v.value,g),g.push(a("-")),s(C.value,g)}else s(v.value,g)}return this.consumeChar("]"),{type:"Set",complement:m,value:g}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:a("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var g=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),g=!1;break;default:this.groupIdx++;break}var m=this.disjunction();this.consumeChar(")");var v={type:"Group",capturing:g,value:m};return g&&(v.idx=this.groupIdx),v},e.prototype.positiveInteger=function(){var g=this.popChar();if(i.test(g)===!1)throw Error("Expecting a positive integer");for(;n.test(this.peekChar(0));)g+=this.popChar();return parseInt(g,10)},e.prototype.integerIncludingZero=function(){var g=this.popChar();if(n.test(g)===!1)throw Error("Expecting an integer");for(;n.test(this.peekChar(0));)g+=this.popChar();return parseInt(g,10)},e.prototype.patternCharacter=function(){var g=this.popChar();switch(g){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:a(g)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},e.prototype.isRangeDash=function(){return this.peekChar()==="-"&&this.isClassAtom(1)},e.prototype.isDigit=function(){return n.test(this.peekChar(0))},e.prototype.isClassAtom=function(g){switch(g===void 0&&(g=0),this.peekChar(g)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}},e.prototype.isQuantifier=function(){var g=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(g)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.parseHexDigits=function(g){for(var m="",v=0;v<g;v++){var b=this.popChar();if(r.test(b)===!1)throw Error("Expecting a HexDecimal digits");m+=b}var C=parseInt(m,16);return{type:"Character",value:C}},e.prototype.peekChar=function(g){return g===void 0&&(g=0),this.input[this.idx+g]},e.prototype.popChar=function(){var g=this.peekChar(0);return this.consumeChar(),g},e.prototype.consumeChar=function(g){if(g!==void 0&&this.input[this.idx]!==g)throw Error("Expected: '"+g+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++},e.prototype.loc=function(g){return{begin:g,end:this.idx}};var r=/[0-9a-fA-F]/,n=/[0-9]/,i=/[1-9]/;function a(g){return g.charCodeAt(0)}function s(g,m){g.length!==void 0?g.forEach(function(v){m.push(v)}):m.push(g)}function l(g,m){if(g[m]===!0)throw"duplicate flag "+m;g[m]=!0}function u(g){if(g===void 0)throw Error("Internal Error - Should never get here!")}function c(){throw Error("Internal Error - Should never get here!")}var o,f=[];for(o=a("0");o<=a("9");o++)f.push(o);var h=[a("_")].concat(f);for(o=a("a");o<=a("z");o++)h.push(o);for(o=a("A");o<=a("Z");o++)h.push(o);var d=[a(" "),a("\f"),a(`
`),a("\r"),a("	"),a("\v"),a("	"),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a("\u2028"),a("\u2029"),a(" "),a(" "),a("　"),a("\uFEFF")];function p(){}return p.prototype.visitChildren=function(g){for(var m in g){var v=g[m];g.hasOwnProperty(m)&&(v.type!==void 0?this.visit(v):Array.isArray(v)&&v.forEach(function(b){this.visit(b)},this))}},p.prototype.visit=function(g){switch(g.type){case"Pattern":this.visitPattern(g);break;case"Flags":this.visitFlags(g);break;case"Disjunction":this.visitDisjunction(g);break;case"Alternative":this.visitAlternative(g);break;case"StartAnchor":this.visitStartAnchor(g);break;case"EndAnchor":this.visitEndAnchor(g);break;case"WordBoundary":this.visitWordBoundary(g);break;case"NonWordBoundary":this.visitNonWordBoundary(g);break;case"Lookahead":this.visitLookahead(g);break;case"NegativeLookahead":this.visitNegativeLookahead(g);break;case"Character":this.visitCharacter(g);break;case"Set":this.visitSet(g);break;case"Group":this.visitGroup(g);break;case"GroupBackReference":this.visitGroupBackReference(g);break;case"Quantifier":this.visitQuantifier(g);break}this.visitChildren(g)},p.prototype.visitPattern=function(g){},p.prototype.visitFlags=function(g){},p.prototype.visitDisjunction=function(g){},p.prototype.visitAlternative=function(g){},p.prototype.visitStartAnchor=function(g){},p.prototype.visitEndAnchor=function(g){},p.prototype.visitWordBoundary=function(g){},p.prototype.visitNonWordBoundary=function(g){},p.prototype.visitLookahead=function(g){},p.prototype.visitNegativeLookahead=function(g){},p.prototype.visitCharacter=function(g){},p.prototype.visitSet=function(g){},p.prototype.visitGroup=function(g){},p.prototype.visitGroupBackReference=function(g){},p.prototype.visitQuantifier=function(g){},{RegExpParser:e,BaseRegExpVisitor:p,VERSION:"0.5.0"}})})(mv);var lh=mv.exports;function VD(t){return t&&t.length?t[0]:void 0}var WD=VD,Rs=WD;function HD(t){for(var e=-1,r=t==null?0:t.length,n=0,i=[];++e<r;){var a=t[e];a&&(i[n++]=a)}return i}var Vl=HD,GD=Ni;function zD(t,e){var r=[];return GD(t,function(n,i,a){e(n,i,a)&&r.push(n)}),r}var vv=zD,qD="Expected a function";function YD(t){if(typeof t!="function")throw new TypeError(qD);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}var XD=YD,QD=zf,KD=vv,jD=pn,ZD=dt,JD=XD;function eL(t,e){var r=ZD(t)?QD:KD;return r(t,JD(jD(e)))}var ch=eL,tL=Vf,rL=sv,nL=ov,iL=Es,aL=bs,sL=Wf,oL=200;function lL(t,e,r,n){var i=-1,a=rL,s=!0,l=t.length,u=[],c=e.length;if(!l)return u;r&&(e=iL(e,aL(r))),n?(a=nL,s=!1):e.length>=oL&&(a=sL,s=!1,e=new tL(e));e:for(;++i<l;){var o=t[i],f=r==null?o:r(o);if(o=n||o!==0?o:0,s&&f===f){for(var h=c;h--;)if(e[h]===f)continue e;u.push(o)}else a(e,f,n)||u.push(o)}return u}var cL=lL,uL=dn,fL=hn;function hL(t){return fL(t)&&uL(t)}var dL=hL,pL=cL,gL=ih,mL=eh,up=dL,vL=mL(function(t,e){return up(t)?pL(t,gL(e,1,up,!0)):[]}),uh=vL,yL=rh,bL=Ss,EL=Math.max;function OL(t,e,r){var n=t==null?0:t.length;if(!n)return-1;var i=r==null?0:bL(r);return i<0&&(i=EL(n+i,0)),yL(t,e,i)}var AL=OL,CL=pn,wL=dn,SL=Dr;function TL(t){return function(e,r,n){var i=Object(e);if(!wL(e)){var a=CL(r);e=SL(e),r=function(l){return a(i[l],l,i)}}var s=t(e,r,n);return s>-1?i[a?e[s]:s]:void 0}}var RL=TL,NL=nv,xL=pn,ML=Ss,_L=Math.max;function kL(t,e,r){var n=t==null?0:t.length;if(!n)return-1;var i=r==null?0:ML(r);return i<0&&(i=_L(n+i,0)),NL(t,xL(e),i)}var PL=kL,IL=RL,DL=PL,LL=IL(DL),fh=LL,BL=zf,UL=vv,$L=pn,FL=dt;function VL(t,e){var r=FL(t)?BL:UL;return r(t,$L(e))}var hh=VL,WL=eh,HL=Os,GL=Ll,zL=kl,yv=Object.prototype,qL=yv.hasOwnProperty,YL=WL(function(t,e){t=Object(t);var r=-1,n=e.length,i=n>2?e[2]:void 0;for(i&&GL(e[0],e[1],i)&&(n=1);++r<n;)for(var a=e[r],s=zL(a),l=-1,u=s.length;++l<u;){var c=s[l],o=t[c];(o===void 0||HL(o,yv[c])&&!qL.call(t,c))&&(t[c]=a[c])}return t}),bv=YL;function XL(t,e,r,n){var i=-1,a=t==null?0:t.length;for(n&&a&&(r=t[++i]);++i<a;)r=e(r,t[i],i,t);return r}var QL=XL;function KL(t,e,r,n,i){return i(t,function(a,s,l){r=n?(n=!1,a):e(r,a,s,l)}),r}var jL=KL,ZL=QL,JL=Ni,eB=pn,tB=jL,rB=dt;function nB(t,e,r){var n=rB(t)?ZL:tB,i=arguments.length<3;return n(t,eB(e),r,i,JL)}var Mi=nB,Lc={},zn={};Object.defineProperty(zn,"__esModule",{value:!0});zn.clearRegExpParserCache=zn.getRegExpAst=void 0;var iB=lh,So={},aB=new iB.RegExpParser;function sB(t){var e=t.toString();if(So.hasOwnProperty(e))return So[e];var r=aB.pattern(e);return So[e]=r,r}zn.getRegExpAst=sB;function oB(){So={}}zn.clearRegExpParserCache=oB;var fp;function lB(){return fp||(fp=1,function(t){var e=Ce&&Ce.__extends||function(){var w=function(S,N){return w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,k){R.__proto__=k}||function(R,k){for(var z in k)Object.prototype.hasOwnProperty.call(k,z)&&(R[z]=k[z])},w(S,N)};return function(S,N){if(typeof N!="function"&&N!==null)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");w(S,N);function R(){this.constructor=S}S.prototype=N===null?Object.create(N):(R.prototype=N.prototype,new R)}}(),r=Ce&&Ce.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(t,"__esModule",{value:!0}),t.canMatchCharCode=t.firstCharOptimizedIndices=t.getOptimizedStartCodesIndices=t.failedOptimizationPrefixMsg=void 0;var n=lh,i=r(dt),a=r($l),s=r(lr),l=r(fh),u=r(Nn),c=r(Jn),o=ua,f=zn,h=Ev(),d="Complement Sets are not supported for first char optimization";t.failedOptimizationPrefixMsg=`Unable to use "first char" lexer optimizations:
`;function p(w,S){S===void 0&&(S=!1);try{var N=(0,f.getRegExpAst)(w),R=g(N.value,{},N.flags.ignoreCase);return R}catch(z){if(z.message===d)S&&(0,o.PRINT_WARNING)("".concat(t.failedOptimizationPrefixMsg)+"	Unable to optimize: < ".concat(w.toString(),` >
`)+`	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{var k="";S&&(k=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),(0,o.PRINT_ERROR)("".concat(t.failedOptimizationPrefixMsg,`
`)+"	Failed parsing: < ".concat(w.toString(),` >
`)+"	Using the regexp-to-ast library version: ".concat(n.VERSION,`
`)+"	Please open an issue at: https://github.com/bd82/regexp-to-ast/issues"+k)}}return[]}t.getOptimizedStartCodesIndices=p;function g(w,S,N){switch(w.type){case"Disjunction":for(var R=0;R<w.value.length;R++)g(w.value[R],S,N);break;case"Alternative":for(var k=w.value,R=0;R<k.length;R++){var z=k[R];switch(z.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}var Y=z;switch(Y.type){case"Character":m(Y.value,S,N);break;case"Set":if(Y.complement===!0)throw Error(d);(0,s.default)(Y.value,function(ae){if(typeof ae=="number")m(ae,S,N);else{var ve=ae;if(N===!0)for(var J=ve.from;J<=ve.to;J++)m(J,S,N);else{for(var J=ve.from;J<=ve.to&&J<h.minOptimizationVal;J++)m(J,S,N);if(ve.to>=h.minOptimizationVal)for(var ne=ve.from>=h.minOptimizationVal?ve.from:h.minOptimizationVal,se=ve.to,de=(0,h.charCodeToOptimizedIndex)(ne),be=(0,h.charCodeToOptimizedIndex)(se),Ae=de;Ae<=be;Ae++)S[Ae]=Ae}}});break;case"Group":g(Y.value,S,N);break;default:throw Error("Non Exhaustive Match")}var re=Y.quantifier!==void 0&&Y.quantifier.atLeast===0;if(Y.type==="Group"&&C(Y)===!1||Y.type!=="Group"&&re===!1)break}break;default:throw Error("non exhaustive match!")}return(0,u.default)(S)}t.firstCharOptimizedIndices=g;function m(w,S,N){var R=(0,h.charCodeToOptimizedIndex)(w);S[R]=R,N===!0&&v(w,S)}function v(w,S){var N=String.fromCharCode(w),R=N.toUpperCase();if(R!==N){var k=(0,h.charCodeToOptimizedIndex)(R.charCodeAt(0));S[k]=k}else{var z=N.toLowerCase();if(z!==N){var k=(0,h.charCodeToOptimizedIndex)(z.charCodeAt(0));S[k]=k}}}function b(w,S){return(0,l.default)(w.value,function(N){if(typeof N=="number")return(0,c.default)(S,N);var R=N;return(0,l.default)(S,function(k){return R.from<=k&&k<=R.to})!==void 0})}function C(w){var S=w.quantifier;return S&&S.atLeast===0?!0:w.value?(0,i.default)(w.value)?(0,a.default)(w.value,C):C(w.value):!1}var A=function(w){e(S,w);function S(N){var R=w.call(this)||this;return R.targetCharCodes=N,R.found=!1,R}return S.prototype.visitChildren=function(N){if(this.found!==!0){switch(N.type){case"Lookahead":this.visitLookahead(N);return;case"NegativeLookahead":this.visitNegativeLookahead(N);return}w.prototype.visitChildren.call(this,N)}},S.prototype.visitCharacter=function(N){(0,c.default)(this.targetCharCodes,N.value)&&(this.found=!0)},S.prototype.visitSet=function(N){N.complement?b(N,this.targetCharCodes)===void 0&&(this.found=!0):b(N,this.targetCharCodes)!==void 0&&(this.found=!0)},S}(n.BaseRegExpVisitor);function O(w,S){if(S instanceof RegExp){var N=(0,f.getRegExpAst)(S),R=new A(w);return R.visit(N),R.found}else return(0,l.default)(S,function(k){return(0,c.default)(w,k.charCodeAt(0))})!==void 0}t.canMatchCharCode=O}(Lc)),Lc}var hp;function Ev(){return hp||(hp=1,function(t){var e=Ce&&Ce.__extends||function(){var F=function(y,D){return F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,_){x.__proto__=_}||function(x,_){for(var $ in _)Object.prototype.hasOwnProperty.call(_,$)&&(x[$]=_[$])},F(y,D)};return function(y,D){if(typeof D!="function"&&D!==null)throw new TypeError("Class extends value "+String(D)+" is not a constructor or null");F(y,D);function x(){this.constructor=y}y.prototype=D===null?Object.create(D):(x.prototype=D.prototype,new x)}}(),r=Ce&&Ce.__importDefault||function(F){return F&&F.__esModule?F:{default:F}};Object.defineProperty(t,"__esModule",{value:!0}),t.charCodeToOptimizedIndex=t.minOptimizationVal=t.buildLineBreakIssueMessage=t.LineTerminatorOptimizedTester=t.isShortPattern=t.isCustomPattern=t.cloneEmptyGroups=t.performWarningRuntimeChecks=t.performRuntimeChecks=t.addStickyFlag=t.addStartOfInput=t.findUnreachablePatterns=t.findModesThatDoNotExist=t.findInvalidGroupType=t.findDuplicatePatterns=t.findUnsupportedFlags=t.findStartOfInputAnchor=t.findEmptyMatchRegExps=t.findEndOfInputAnchor=t.findInvalidPatterns=t.findMissingPatterns=t.validatePatterns=t.analyzeTokenTypes=t.enableSticky=t.disableSticky=t.SUPPORT_STICKY=t.MODES=t.DEFAULT_MODE=void 0;var n=lh,i=Wl(),a=r(Rs),s=r(zr),l=r(Vl),u=r(dt),c=r(Nn),o=r(Mn),f=r(ch),h=r(uh),d=r(AL),p=r(br),g=r(lr),m=r(Dl),v=r(vs),b=r(da),C=r(fh),A=r(Lr),O=r(Dr),w=r(z0),S=r(hh),N=r(bv),R=r(Mi),k=r(Jn),z=ua,Y=lB(),re=zn,Q="PATTERN";t.DEFAULT_MODE="defaultMode",t.MODES="modes",t.SUPPORT_STICKY=typeof new RegExp("(?:)").sticky=="boolean";function ae(){t.SUPPORT_STICKY=!1}t.disableSticky=ae;function ve(){t.SUPPORT_STICKY=!0}t.enableSticky=ve;function J(F,y){y=(0,N.default)(y,{useSticky:t.SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:function(ze,Le){return Le()}});var D=y.tracer;D("initCharCodeToOptimizedIndexMap",function(){me()});var x;D("Reject Lexer.NA",function(){x=(0,f.default)(F,function(ze){return ze[Q]===i.Lexer.NA})});var _=!1,$;D("Transform Patterns",function(){_=!1,$=(0,p.default)(x,function(ze){var Le=ze[Q];if((0,w.default)(Le)){var bt=Le.source;return bt.length===1&&bt!=="^"&&bt!=="$"&&bt!=="."&&!Le.ignoreCase?bt:bt.length===2&&bt[0]==="\\"&&!(0,k.default)(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],bt[1])?bt[1]:y.useSticky?H(Le):K(Le)}else{if((0,v.default)(Le))return _=!0,{exec:Le};if(typeof Le=="object")return _=!0,Le;if(typeof Le=="string"){if(Le.length===1)return Le;var Er=Le.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),ti=new RegExp(Er);return y.useSticky?H(ti):K(ti)}else throw Error("non exhaustive match")}})});var j,ce,I,T,P;D("misc mapping",function(){j=(0,p.default)(x,function(ze){return ze.tokenTypeIdx}),ce=(0,p.default)(x,function(ze){var Le=ze.GROUP;if(Le!==i.Lexer.SKIPPED){if((0,m.default)(Le))return Le;if((0,b.default)(Le))return!1;throw Error("non exhaustive match")}}),I=(0,p.default)(x,function(ze){var Le=ze.LONGER_ALT;if(Le){var bt=(0,u.default)(Le)?(0,p.default)(Le,function(Er){return(0,d.default)(x,Er)}):[(0,d.default)(x,Le)];return bt}}),T=(0,p.default)(x,function(ze){return ze.PUSH_MODE}),P=(0,p.default)(x,function(ze){return(0,A.default)(ze,"POP_MODE")})});var W;D("Line Terminator Handling",function(){var ze=We(y.lineTerminatorCharacters);W=(0,p.default)(x,function(Le){return!1}),y.positionTracking!=="onlyOffset"&&(W=(0,p.default)(x,function(Le){return(0,A.default)(Le,"LINE_BREAKS")?!!Le.LINE_BREAKS:De(Le,ze)===!1&&(0,Y.canMatchCharCode)(ze,Le.PATTERN)}))});var oe,te,q,he;D("Misc Mapping #2",function(){oe=(0,p.default)(x,we),te=(0,p.default)($,Ue),q=(0,R.default)(x,function(ze,Le){var bt=Le.GROUP;return(0,m.default)(bt)&&bt!==i.Lexer.SKIPPED&&(ze[bt]=[]),ze},{}),he=(0,p.default)($,function(ze,Le){return{pattern:$[Le],longerAlt:I[Le],canLineTerminator:W[Le],isCustom:oe[Le],short:te[Le],group:ce[Le],push:T[Le],pop:P[Le],tokenTypeIdx:j[Le],tokenType:x[Le]}})});var Oe=!0,Ke=[];return y.safeMode||D("First Char Optimization",function(){Ke=(0,R.default)(x,function(ze,Le,bt){if(typeof Le.PATTERN=="string"){var Er=Le.PATTERN.charCodeAt(0),ti=Me(Er);Xe(ze,ti,he[bt])}else if((0,u.default)(Le.START_CHARS_HINT)){var Aa;(0,g.default)(Le.START_CHARS_HINT,function(ri){var $s=typeof ri=="string"?ri.charCodeAt(0):ri,mc=Me($s);Aa!==mc&&(Aa=mc,Xe(ze,mc,he[bt]))})}else if((0,w.default)(Le.PATTERN))if(Le.PATTERN.unicode)Oe=!1,y.ensureOptimizations&&(0,z.PRINT_ERROR)("".concat(Y.failedOptimizationPrefixMsg)+"	Unable to analyze < ".concat(Le.PATTERN.toString(),` > pattern.
`)+`	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{var Ca=(0,Y.getOptimizedStartCodesIndices)(Le.PATTERN,y.ensureOptimizations);(0,s.default)(Ca)&&(Oe=!1),(0,g.default)(Ca,function(ri){Xe(ze,ri,he[bt])})}else y.ensureOptimizations&&(0,z.PRINT_ERROR)("".concat(Y.failedOptimizationPrefixMsg)+"	TokenType: <".concat(Le.name,`> is using a custom token pattern without providing <start_chars_hint> parameter.
`)+`	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),Oe=!1;return ze},[])}),{emptyGroups:q,patternIdxToConfig:he,charCodeToPatternIdxToConfig:Ke,hasCustom:_,canBeOptimized:Oe}}t.analyzeTokenTypes=J;function ne(F,y){var D=[],x=de(F);D=D.concat(x.errors);var _=be(x.valid),$=_.valid;return D=D.concat(_.errors),D=D.concat(se($)),D=D.concat(ue($)),D=D.concat(V($,y)),D=D.concat(ee($)),D}t.validatePatterns=ne;function se(F){var y=[],D=(0,S.default)(F,function(x){return(0,w.default)(x[Q])});return y=y.concat(Te(D)),y=y.concat(E(D)),y=y.concat(G(D)),y=y.concat(U(D)),y=y.concat(_e(D)),y}function de(F){var y=(0,S.default)(F,function(_){return!(0,A.default)(_,Q)}),D=(0,p.default)(y,function(_){return{message:"Token Type: ->"+_.name+"<- missing static 'PATTERN' property",type:i.LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[_]}}),x=(0,h.default)(F,y);return{errors:D,valid:x}}t.findMissingPatterns=de;function be(F){var y=(0,S.default)(F,function(_){var $=_[Q];return!(0,w.default)($)&&!(0,v.default)($)&&!(0,A.default)($,"exec")&&!(0,m.default)($)}),D=(0,p.default)(y,function(_){return{message:"Token Type: ->"+_.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:i.LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[_]}}),x=(0,h.default)(F,y);return{errors:D,valid:x}}t.findInvalidPatterns=be;var Ae=/[^\\][$]/;function Te(F){var y=function(_){e($,_);function $(){var j=_!==null&&_.apply(this,arguments)||this;return j.found=!1,j}return $.prototype.visitEndAnchor=function(j){this.found=!0},$}(n.BaseRegExpVisitor),D=(0,S.default)(F,function(_){var $=_.PATTERN;try{var j=(0,re.getRegExpAst)($),ce=new y;return ce.visit(j),ce.found}catch{return Ae.test($.source)}}),x=(0,p.default)(D,function(_){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+_.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:i.LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[_]}});return x}t.findEndOfInputAnchor=Te;function _e(F){var y=(0,S.default)(F,function(x){var _=x.PATTERN;return _.test("")}),D=(0,p.default)(y,function(x){return{message:"Token Type: ->"+x.name+"<- static 'PATTERN' must not match an empty string",type:i.LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[x]}});return D}t.findEmptyMatchRegExps=_e;var ke=/[^\\[][\^]|^\^/;function E(F){var y=function(_){e($,_);function $(){var j=_!==null&&_.apply(this,arguments)||this;return j.found=!1,j}return $.prototype.visitStartAnchor=function(j){this.found=!0},$}(n.BaseRegExpVisitor),D=(0,S.default)(F,function(_){var $=_.PATTERN;try{var j=(0,re.getRegExpAst)($),ce=new y;return ce.visit(j),ce.found}catch{return ke.test($.source)}}),x=(0,p.default)(D,function(_){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+_.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:i.LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[_]}});return x}t.findStartOfInputAnchor=E;function G(F){var y=(0,S.default)(F,function(x){var _=x[Q];return _ instanceof RegExp&&(_.multiline||_.global)}),D=(0,p.default)(y,function(x){return{message:"Token Type: ->"+x.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:i.LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[x]}});return D}t.findUnsupportedFlags=G;function U(F){var y=[],D=(0,p.default)(F,function($){return(0,R.default)(F,function(j,ce){return $.PATTERN.source===ce.PATTERN.source&&!(0,k.default)(y,ce)&&ce.PATTERN!==i.Lexer.NA&&(y.push(ce),j.push(ce)),j},[])});D=(0,l.default)(D);var x=(0,S.default)(D,function($){return $.length>1}),_=(0,p.default)(x,function($){var j=(0,p.default)($,function(I){return I.name}),ce=(0,a.default)($).PATTERN;return{message:"The same RegExp pattern ->".concat(ce,"<-")+"has been used in all of the following Token Types: ".concat(j.join(", ")," <-"),type:i.LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:$}});return _}t.findDuplicatePatterns=U;function ue(F){var y=(0,S.default)(F,function(x){if(!(0,A.default)(x,"GROUP"))return!1;var _=x.GROUP;return _!==i.Lexer.SKIPPED&&_!==i.Lexer.NA&&!(0,m.default)(_)}),D=(0,p.default)(y,function(x){return{message:"Token Type: ->"+x.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:i.LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[x]}});return D}t.findInvalidGroupType=ue;function V(F,y){var D=(0,S.default)(F,function(_){return _.PUSH_MODE!==void 0&&!(0,k.default)(y,_.PUSH_MODE)}),x=(0,p.default)(D,function(_){var $="Token Type: ->".concat(_.name,"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->").concat(_.PUSH_MODE,"<-")+"which does not exist";return{message:$,type:i.LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[_]}});return x}t.findModesThatDoNotExist=V;function ee(F){var y=[],D=(0,R.default)(F,function(x,_,$){var j=_.PATTERN;return j===i.Lexer.NA||((0,m.default)(j)?x.push({str:j,idx:$,tokenType:_}):(0,w.default)(j)&&Z(j)&&x.push({str:j.source,idx:$,tokenType:_})),x},[]);return(0,g.default)(F,function(x,_){(0,g.default)(D,function($){var j=$.str,ce=$.idx,I=$.tokenType;if(_<ce&&L(j,x.PATTERN)){var T="Token: ->".concat(I.name,`<- can never be matched.
`)+"Because it appears AFTER the Token Type ->".concat(x.name,"<-")+`in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;y.push({message:T,type:i.LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[x,I]})}})}),y}t.findUnreachablePatterns=ee;function L(F,y){if((0,w.default)(y)){var D=y.exec(F);return D!==null&&D.index===0}else{if((0,v.default)(y))return y(F,0,[],{});if((0,A.default)(y,"exec"))return y.exec(F,0,[],{});if(typeof y=="string")return y===F;throw Error("non exhaustive match")}}function Z(F){var y=[".","\\","[","]","|","^","$","(",")","?","*","+","{"];return(0,C.default)(y,function(D){return F.source.indexOf(D)!==-1})===void 0}function K(F){var y=F.ignoreCase?"i":"";return new RegExp("^(?:".concat(F.source,")"),y)}t.addStartOfInput=K;function H(F){var y=F.ignoreCase?"iy":"y";return new RegExp("".concat(F.source),y)}t.addStickyFlag=H;function ie(F,y,D){var x=[];return(0,A.default)(F,t.DEFAULT_MODE)||x.push({message:"A MultiMode Lexer cannot be initialized without a <"+t.DEFAULT_MODE+`> property in its definition
`,type:i.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),(0,A.default)(F,t.MODES)||x.push({message:"A MultiMode Lexer cannot be initialized without a <"+t.MODES+`> property in its definition
`,type:i.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),(0,A.default)(F,t.MODES)&&(0,A.default)(F,t.DEFAULT_MODE)&&!(0,A.default)(F.modes,F.defaultMode)&&x.push({message:"A MultiMode Lexer cannot be initialized with a ".concat(t.DEFAULT_MODE,": <").concat(F.defaultMode,">")+`which does not exist
`,type:i.LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),(0,A.default)(F,t.MODES)&&(0,g.default)(F.modes,function(_,$){(0,g.default)(_,function(j,ce){if((0,b.default)(j))x.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:"+"<".concat($,"> at index: <").concat(ce,`>
`),type:i.LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if((0,A.default)(j,"LONGER_ALT")){var I=(0,u.default)(j.LONGER_ALT)?j.LONGER_ALT:[j.LONGER_ALT];(0,g.default)(I,function(T){!(0,b.default)(T)&&!(0,k.default)(_,T)&&x.push({message:"A MultiMode Lexer cannot be initialized with a longer_alt <".concat(T.name,"> on token <").concat(j.name,"> outside of mode <").concat($,`>
`),type:i.LexerDefinitionErrorType.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),x}t.performRuntimeChecks=ie;function pe(F,y,D){var x=[],_=!1,$=(0,l.default)((0,o.default)((0,c.default)(F.modes))),j=(0,f.default)($,function(I){return I[Q]===i.Lexer.NA}),ce=We(D);return y&&(0,g.default)(j,function(I){var T=De(I,ce);if(T!==!1){var P=Ie(I,T),W={message:P,type:T.issue,tokenType:I};x.push(W)}else(0,A.default)(I,"LINE_BREAKS")?I.LINE_BREAKS===!0&&(_=!0):(0,Y.canMatchCharCode)(ce,I.PATTERN)&&(_=!0)}),y&&!_&&x.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:i.LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),x}t.performWarningRuntimeChecks=pe;function ye(F){var y={},D=(0,O.default)(F);return(0,g.default)(D,function(x){var _=F[x];if((0,u.default)(_))y[x]=[];else throw Error("non exhaustive match")}),y}t.cloneEmptyGroups=ye;function we(F){var y=F.PATTERN;if((0,w.default)(y))return!1;if((0,v.default)(y))return!0;if((0,A.default)(y,"exec"))return!0;if((0,m.default)(y))return!1;throw Error("non exhaustive match")}t.isCustomPattern=we;function Ue(F){return(0,m.default)(F)&&F.length===1?F.charCodeAt(0):!1}t.isShortPattern=Ue,t.LineTerminatorOptimizedTester={test:function(F){for(var y=F.length,D=this.lastIndex;D<y;D++){var x=F.charCodeAt(D);if(x===10)return this.lastIndex=D+1,!0;if(x===13)return F.charCodeAt(D+1)===10?this.lastIndex=D+2:this.lastIndex=D+1,!0}return!1},lastIndex:0};function De(F,y){if((0,A.default)(F,"LINE_BREAKS"))return!1;if((0,w.default)(F.PATTERN)){try{(0,Y.canMatchCharCode)(y,F.PATTERN)}catch(D){return{issue:i.LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:D.message}}return!1}else{if((0,m.default)(F.PATTERN))return!1;if(we(F))return{issue:i.LexerDefinitionErrorType.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function Ie(F,y){if(y.issue===i.LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
`+"	The problem is in the <".concat(F.name,`> Token Type
`)+"	 Root cause: ".concat(y.errMsg,`.
`)+"	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(y.issue===i.LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
`+"	The problem is in the <".concat(F.name,`> Token Type
`)+"	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}t.buildLineBreakIssueMessage=Ie;function We(F){var y=(0,p.default)(F,function(D){return(0,m.default)(D)?D.charCodeAt(0):D});return y}function Xe(F,y,D){F[y]===void 0?F[y]=[D]:F[y].push(D)}t.minOptimizationVal=256;var Qe=[];function Me(F){return F<t.minOptimizationVal?F:Qe[F]}t.charCodeToOptimizedIndex=Me;function me(){if((0,s.default)(Qe)){Qe=new Array(65536);for(var F=0;F<65536;F++)Qe[F]=F>255?255+~~(F/255):F}}}(Dc)),Dc}function cB(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}var dh=cB,_i={};(function(t){var e=Ce&&Ce.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(t,"__esModule",{value:!0}),t.isTokenType=t.hasExtendingTokensTypesMapProperty=t.hasExtendingTokensTypesProperty=t.hasCategoriesProperty=t.hasShortKeyProperty=t.singleAssignCategoriesToksMap=t.assignCategoriesMapProp=t.assignCategoriesTokensProp=t.assignTokenDefaultProps=t.expandCategories=t.augmentTokenTypes=t.tokenIdxToClass=t.tokenShortNameIdx=t.tokenStructuredMatcherNoCategories=t.tokenStructuredMatcher=void 0;var r=e(zr),n=e(Vl),i=e(dt),a=e(Mn),s=e(uh),l=e(br),u=e(lr),c=e(Lr),o=e(Jn),f=e(Zn);function h(R,k){var z=R.tokenTypeIdx;return z===k.tokenTypeIdx?!0:k.isParent===!0&&k.categoryMatchesMap[z]===!0}t.tokenStructuredMatcher=h;function d(R,k){return R.tokenTypeIdx===k.tokenTypeIdx}t.tokenStructuredMatcherNoCategories=d,t.tokenShortNameIdx=1,t.tokenIdxToClass={};function p(R){var k=g(R);m(k),b(k),v(k),(0,u.default)(k,function(z){z.isParent=z.categoryMatches.length>0})}t.augmentTokenTypes=p;function g(R){for(var k=(0,f.default)(R),z=R,Y=!0;Y;){z=(0,n.default)((0,a.default)((0,l.default)(z,function(Q){return Q.CATEGORIES})));var re=(0,s.default)(z,k);k=k.concat(re),(0,r.default)(re)?Y=!1:z=re}return k}t.expandCategories=g;function m(R){(0,u.default)(R,function(k){A(k)||(t.tokenIdxToClass[t.tokenShortNameIdx]=k,k.tokenTypeIdx=t.tokenShortNameIdx++),O(k)&&!(0,i.default)(k.CATEGORIES)&&(k.CATEGORIES=[k.CATEGORIES]),O(k)||(k.CATEGORIES=[]),w(k)||(k.categoryMatches=[]),S(k)||(k.categoryMatchesMap={})})}t.assignTokenDefaultProps=m;function v(R){(0,u.default)(R,function(k){k.categoryMatches=[],(0,u.default)(k.categoryMatchesMap,function(z,Y){k.categoryMatches.push(t.tokenIdxToClass[Y].tokenTypeIdx)})})}t.assignCategoriesTokensProp=v;function b(R){(0,u.default)(R,function(k){C([],k)})}t.assignCategoriesMapProp=b;function C(R,k){(0,u.default)(R,function(z){k.categoryMatchesMap[z.tokenTypeIdx]=!0}),(0,u.default)(k.CATEGORIES,function(z){var Y=R.concat(k);(0,o.default)(Y,z)||C(Y,z)})}t.singleAssignCategoriesToksMap=C;function A(R){return(0,c.default)(R,"tokenTypeIdx")}t.hasShortKeyProperty=A;function O(R){return(0,c.default)(R,"CATEGORIES")}t.hasCategoriesProperty=O;function w(R){return(0,c.default)(R,"categoryMatches")}t.hasExtendingTokensTypesProperty=w;function S(R){return(0,c.default)(R,"categoryMatchesMap")}t.hasExtendingTokensTypesMapProperty=S;function N(R){return(0,c.default)(R,"tokenTypeIdx")}t.isTokenType=N})(_i);var Ns={};Object.defineProperty(Ns,"__esModule",{value:!0});Ns.defaultLexerErrorProvider=void 0;Ns.defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(t){return"Unable to pop Lexer Mode after encountering Token ->".concat(t.image,"<- The Mode Stack is empty")},buildUnexpectedCharactersMessage:function(t,e,r,n,i){return"unexpected character: ->".concat(t.charAt(e),"<- at offset: ").concat(e,",")+" skipped ".concat(r," characters.")}};var dp;function Wl(){return dp||(dp=1,function(t){var e=Ce&&Ce.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(t,"__esModule",{value:!0}),t.Lexer=t.LexerDefinitionErrorType=void 0;var r=Ev(),n=e(ah),i=e(zr),a=e(dt),s=e(dh),l=e(ch),u=e(br),c=e(lr),o=e(Dr),f=e(da),h=e(Cs),d=e(Bl),p=e(Mi),g=e(Zn),m=ua,v=_i,b=Ns,C=zn;(function(w){w[w.MISSING_PATTERN=0]="MISSING_PATTERN",w[w.INVALID_PATTERN=1]="INVALID_PATTERN",w[w.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",w[w.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",w[w.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",w[w.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",w[w.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",w[w.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",w[w.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",w[w.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",w[w.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",w[w.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",w[w.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",w[w.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",w[w.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",w[w.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",w[w.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",w[w.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(t.LexerDefinitionErrorType||(t.LexerDefinitionErrorType={}));var A={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:b.defaultLexerErrorProvider,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(A);var O=function(){function w(S,N){N===void 0&&(N=A);var R=this;if(this.lexerDefinition=S,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=function(z,Y){if(R.traceInitPerf===!0){R.traceInitIndent++;var re=new Array(R.traceInitIndent+1).join("	");R.traceInitIndent<R.traceInitMaxIdent&&console.log("".concat(re,"--> <").concat(z,">"));var Q=(0,m.timer)(Y),ae=Q.time,ve=Q.value,J=ae>10?console.warn:console.log;return R.traceInitIndent<R.traceInitMaxIdent&&J("".concat(re,"<-- <").concat(z,"> time: ").concat(ae,"ms")),R.traceInitIndent--,ve}else return Y()},typeof N=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=(0,d.default)({},A,N);var k=this.config.traceInitPerf;k===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof k=="number"&&(this.traceInitMaxIdent=k,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",function(){var z,Y=!0;R.TRACE_INIT("Lexer Config handling",function(){if(R.config.lineTerminatorsPattern===A.lineTerminatorsPattern)R.config.lineTerminatorsPattern=r.LineTerminatorOptimizedTester;else if(R.config.lineTerminatorCharacters===A.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(N.safeMode&&N.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');R.trackStartLines=/full|onlyStart/i.test(R.config.positionTracking),R.trackEndLines=/full/i.test(R.config.positionTracking),(0,a.default)(S)?z={modes:{defaultMode:(0,g.default)(S)},defaultMode:r.DEFAULT_MODE}:(Y=!1,z=(0,g.default)(S))}),R.config.skipValidations===!1&&(R.TRACE_INIT("performRuntimeChecks",function(){R.lexerDefinitionErrors=R.lexerDefinitionErrors.concat((0,r.performRuntimeChecks)(z,R.trackStartLines,R.config.lineTerminatorCharacters))}),R.TRACE_INIT("performWarningRuntimeChecks",function(){R.lexerDefinitionWarning=R.lexerDefinitionWarning.concat((0,r.performWarningRuntimeChecks)(z,R.trackStartLines,R.config.lineTerminatorCharacters))})),z.modes=z.modes?z.modes:{},(0,c.default)(z.modes,function(ve,J){z.modes[J]=(0,l.default)(ve,function(ne){return(0,f.default)(ne)})});var re=(0,o.default)(z.modes);if((0,c.default)(z.modes,function(ve,J){R.TRACE_INIT("Mode: <".concat(J,"> processing"),function(){if(R.modes.push(J),R.config.skipValidations===!1&&R.TRACE_INIT("validatePatterns",function(){R.lexerDefinitionErrors=R.lexerDefinitionErrors.concat((0,r.validatePatterns)(ve,re))}),(0,i.default)(R.lexerDefinitionErrors)){(0,v.augmentTokenTypes)(ve);var ne;R.TRACE_INIT("analyzeTokenTypes",function(){ne=(0,r.analyzeTokenTypes)(ve,{lineTerminatorCharacters:R.config.lineTerminatorCharacters,positionTracking:N.positionTracking,ensureOptimizations:N.ensureOptimizations,safeMode:N.safeMode,tracer:R.TRACE_INIT})}),R.patternIdxToConfig[J]=ne.patternIdxToConfig,R.charCodeToPatternIdxToConfig[J]=ne.charCodeToPatternIdxToConfig,R.emptyGroups=(0,d.default)({},R.emptyGroups,ne.emptyGroups),R.hasCustom=ne.hasCustom||R.hasCustom,R.canModeBeOptimized[J]=ne.canBeOptimized}})}),R.defaultMode=z.defaultMode,!(0,i.default)(R.lexerDefinitionErrors)&&!R.config.deferDefinitionErrorsHandling){var Q=(0,u.default)(R.lexerDefinitionErrors,function(ve){return ve.message}),ae=Q.join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+ae)}(0,c.default)(R.lexerDefinitionWarning,function(ve){(0,m.PRINT_WARNING)(ve.message)}),R.TRACE_INIT("Choosing sub-methods implementations",function(){if(r.SUPPORT_STICKY?(R.chopInput=h.default,R.match=R.matchWithTest):(R.updateLastIndex=n.default,R.match=R.matchWithExec),Y&&(R.handleModes=n.default),R.trackStartLines===!1&&(R.computeNewColumn=h.default),R.trackEndLines===!1&&(R.updateTokenEndLineColumnLocation=n.default),/full/i.test(R.config.positionTracking))R.createTokenInstance=R.createFullToken;else if(/onlyStart/i.test(R.config.positionTracking))R.createTokenInstance=R.createStartOnlyToken;else if(/onlyOffset/i.test(R.config.positionTracking))R.createTokenInstance=R.createOffsetOnlyToken;else throw Error('Invalid <positionTracking> config option: "'.concat(R.config.positionTracking,'"'));R.hasCustom?(R.addToken=R.addTokenUsingPush,R.handlePayload=R.handlePayloadWithCustom):(R.addToken=R.addTokenUsingMemberAccess,R.handlePayload=R.handlePayloadNoCustom)}),R.TRACE_INIT("Failed Optimization Warnings",function(){var ve=(0,p.default)(R.canModeBeOptimized,function(J,ne,se){return ne===!1&&J.push(se),J},[]);if(N.ensureOptimizations&&!(0,i.default)(ve))throw Error("Lexer Modes: < ".concat(ve.join(", "),` > cannot be optimized.
`)+`	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),R.TRACE_INIT("clearRegExpParserCache",function(){(0,C.clearRegExpParserCache)()}),R.TRACE_INIT("toFastProperties",function(){(0,m.toFastProperties)(R)})})}return w.prototype.tokenize=function(S,N){if(N===void 0&&(N=this.defaultMode),!(0,i.default)(this.lexerDefinitionErrors)){var R=(0,u.default)(this.lexerDefinitionErrors,function(z){return z.message}),k=R.join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+k)}return this.tokenizeInternal(S,N)},w.prototype.tokenizeInternal=function(S,N){var R=this,k,z,Y,re,Q,ae,ve,J,ne,se,de,be,Ae,Te,_e,ke=S,E=ke.length,G=0,U=0,ue=this.hasCustom?0:Math.floor(S.length/10),V=new Array(ue),ee=[],L=this.trackStartLines?1:void 0,Z=this.trackStartLines?1:void 0,K=(0,r.cloneEmptyGroups)(this.emptyGroups),H=this.trackStartLines,ie=this.config.lineTerminatorsPattern,pe=0,ye=[],we=[],Ue=[],De=[];Object.freeze(De);var Ie;function We(){return ye}function Xe(Ke){var ze=(0,r.charCodeToOptimizedIndex)(Ke),Le=we[ze];return Le===void 0?De:Le}var Qe=function(Ke){if(Ue.length===1&&Ke.tokenType.PUSH_MODE===void 0){var ze=R.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Ke);ee.push({offset:Ke.startOffset,line:Ke.startLine,column:Ke.startColumn,length:Ke.image.length,message:ze})}else{Ue.pop();var Le=(0,s.default)(Ue);ye=R.patternIdxToConfig[Le],we=R.charCodeToPatternIdxToConfig[Le],pe=ye.length;var bt=R.canModeBeOptimized[Le]&&R.config.safeMode===!1;we&&bt?Ie=Xe:Ie=We}};function Me(Ke){Ue.push(Ke),we=this.charCodeToPatternIdxToConfig[Ke],ye=this.patternIdxToConfig[Ke],pe=ye.length,pe=ye.length;var ze=this.canModeBeOptimized[Ke]&&this.config.safeMode===!1;we&&ze?Ie=Xe:Ie=We}Me.call(this,N);for(var me,F=this.config.recoveryEnabled;G<E;){ae=null;var y=ke.charCodeAt(G),D=Ie(y),x=D.length;for(k=0;k<x;k++){me=D[k];var _=me.pattern;ve=null;var $=me.short;if($!==!1?y===$&&(ae=_):me.isCustom===!0?(_e=_.exec(ke,G,V,K),_e!==null?(ae=_e[0],_e.payload!==void 0&&(ve=_e.payload)):ae=null):(this.updateLastIndex(_,G),ae=this.match(_,S,G)),ae!==null){if(Q=me.longerAlt,Q!==void 0){var j=Q.length;for(Y=0;Y<j;Y++){var ce=ye[Q[Y]],I=ce.pattern;if(J=null,ce.isCustom===!0?(_e=I.exec(ke,G,V,K),_e!==null?(re=_e[0],_e.payload!==void 0&&(J=_e.payload)):re=null):(this.updateLastIndex(I,G),re=this.match(I,S,G)),re&&re.length>ae.length){ae=re,ve=J,me=ce;break}}}break}}if(ae!==null){if(ne=ae.length,se=me.group,se!==void 0&&(de=me.tokenTypeIdx,be=this.createTokenInstance(ae,G,de,me.tokenType,L,Z,ne),this.handlePayload(be,ve),se===!1?U=this.addToken(V,U,be):K[se].push(be)),S=this.chopInput(S,ne),G=G+ne,Z=this.computeNewColumn(Z,ne),H===!0&&me.canLineTerminator===!0){var T=0,P=void 0,W=void 0;ie.lastIndex=0;do P=ie.test(ae),P===!0&&(W=ie.lastIndex-1,T++);while(P===!0);T!==0&&(L=L+T,Z=ne-W,this.updateTokenEndLineColumnLocation(be,se,W,T,L,Z,ne))}this.handleModes(me,Qe,Me,be)}else{for(var oe=G,te=L,q=Z,he=F===!1;he===!1&&G<E;)for(S=this.chopInput(S,1),G++,z=0;z<pe;z++){var Oe=ye[z],_=Oe.pattern,$=Oe.short;if($!==!1?ke.charCodeAt(G)===$&&(he=!0):Oe.isCustom===!0?he=_.exec(ke,G,V,K)!==null:(this.updateLastIndex(_,G),he=_.exec(S)!==null),he===!0)break}if(Ae=G-oe,Te=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(ke,oe,Ae,te,q),ee.push({offset:oe,line:te,column:q,length:Ae,message:Te}),F===!1)break}}return this.hasCustom||(V.length=U),{tokens:V,groups:K,errors:ee}},w.prototype.handleModes=function(S,N,R,k){if(S.pop===!0){var z=S.push;N(k),z!==void 0&&R.call(this,z)}else S.push!==void 0&&R.call(this,S.push)},w.prototype.chopInput=function(S,N){return S.substring(N)},w.prototype.updateLastIndex=function(S,N){S.lastIndex=N},w.prototype.updateTokenEndLineColumnLocation=function(S,N,R,k,z,Y,re){var Q,ae;N!==void 0&&(Q=R===re-1,ae=Q?-1:0,k===1&&Q===!0||(S.endLine=z+ae,S.endColumn=Y-1+-ae))},w.prototype.computeNewColumn=function(S,N){return S+N},w.prototype.createOffsetOnlyToken=function(S,N,R,k){return{image:S,startOffset:N,tokenTypeIdx:R,tokenType:k}},w.prototype.createStartOnlyToken=function(S,N,R,k,z,Y){return{image:S,startOffset:N,startLine:z,startColumn:Y,tokenTypeIdx:R,tokenType:k}},w.prototype.createFullToken=function(S,N,R,k,z,Y,re){return{image:S,startOffset:N,endOffset:N+re-1,startLine:z,endLine:z,startColumn:Y,endColumn:Y+re-1,tokenTypeIdx:R,tokenType:k}},w.prototype.addTokenUsingPush=function(S,N,R){return S.push(R),N},w.prototype.addTokenUsingMemberAccess=function(S,N,R){return S[N]=R,N++,N},w.prototype.handlePayloadNoCustom=function(S,N){},w.prototype.handlePayloadWithCustom=function(S,N){N!==null&&(S.payload=N)},w.prototype.matchWithTest=function(S,N,R){var k=S.test(N);return k===!0?N.substring(R,S.lastIndex):null},w.prototype.matchWithExec=function(S,N){var R=S.exec(N);return R!==null?R[0]:null},w.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",w.NA=/NOT_APPLICABLE/,w}();t.Lexer=O}(Ic)),Ic}(function(t){var e=Ce&&Ce.__importDefault||function(S){return S&&S.__esModule?S:{default:S}};Object.defineProperty(t,"__esModule",{value:!0}),t.tokenMatcher=t.createTokenInstance=t.EOF=t.createToken=t.hasTokenLabel=t.tokenName=t.tokenLabel=void 0;var r=e(Dl),n=e(Lr),i=e(da),a=Wl(),s=_i;function l(S){return c(S)?S.LABEL:S.name}t.tokenLabel=l;function u(S){return S.name}t.tokenName=u;function c(S){return(0,r.default)(S.LABEL)&&S.LABEL!==""}t.hasTokenLabel=c;var o="parent",f="categories",h="label",d="group",p="push_mode",g="pop_mode",m="longer_alt",v="line_breaks",b="start_chars_hint";function C(S){return A(S)}t.createToken=C;function A(S){var N=S.pattern,R={};if(R.name=S.name,(0,i.default)(N)||(R.PATTERN=N),(0,n.default)(S,o))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return(0,n.default)(S,f)&&(R.CATEGORIES=S[f]),(0,s.augmentTokenTypes)([R]),(0,n.default)(S,h)&&(R.LABEL=S[h]),(0,n.default)(S,d)&&(R.GROUP=S[d]),(0,n.default)(S,g)&&(R.POP_MODE=S[g]),(0,n.default)(S,p)&&(R.PUSH_MODE=S[p]),(0,n.default)(S,m)&&(R.LONGER_ALT=S[m]),(0,n.default)(S,v)&&(R.LINE_BREAKS=S[v]),(0,n.default)(S,b)&&(R.START_CHARS_HINT=S[b]),R}t.EOF=C({name:"EOF",pattern:a.Lexer.NA}),(0,s.augmentTokenTypes)([t.EOF]);function O(S,N,R,k,z,Y,re,Q){return{image:N,startOffset:R,endOffset:k,startLine:z,endLine:Y,startColumn:re,endColumn:Q,tokenTypeIdx:S.tokenTypeIdx,tokenType:S}}t.createTokenInstance=O;function w(S,N){return(0,s.tokenStructuredMatcher)(S,N)}t.tokenMatcher=w})(xi);var pa={};(function(t){var e=Ce&&Ce.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(t,"__esModule",{value:!0}),t.defaultGrammarValidatorErrorProvider=t.defaultGrammarResolverErrorProvider=t.defaultParserErrorProvider=void 0;var r=xi,n=e(Rs),i=e(br),a=e(Mi),s=Ut,l=Ut;t.defaultParserErrorProvider={buildMismatchTokenMessage:function(u){var c=u.expected,o=u.actual;u.previous,u.ruleName;var f=(0,r.hasTokenLabel)(c),h=f?"--> ".concat((0,r.tokenLabel)(c)," <--"):"token of type --> ".concat(c.name," <--"),d="Expecting ".concat(h," but found --> '").concat(o.image,"' <--");return d},buildNotAllInputParsedMessage:function(u){var c=u.firstRedundant;return u.ruleName,"Redundant input, expecting EOF but found: "+c.image},buildNoViableAltMessage:function(u){var c=u.expectedPathsPerAlt,o=u.actual;u.previous;var f=u.customUserDescription;u.ruleName;var h="Expecting: ",d=(0,n.default)(o).image,p=`
but found: '`+d+"'";if(f)return h+f+p;var g=(0,a.default)(c,function(C,A){return C.concat(A)},[]),m=(0,i.default)(g,function(C){return"[".concat((0,i.default)(C,function(A){return(0,r.tokenLabel)(A)}).join(", "),"]")}),v=(0,i.default)(m,function(C,A){return"  ".concat(A+1,". ").concat(C)}),b=`one of these possible Token sequences:
`.concat(v.join(`
`));return h+b+p},buildEarlyExitMessage:function(u){var c=u.expectedIterationPaths,o=u.actual,f=u.customUserDescription;u.ruleName;var h="Expecting: ",d=(0,n.default)(o).image,p=`
but found: '`+d+"'";if(f)return h+f+p;var g=(0,i.default)(c,function(v){return"[".concat((0,i.default)(v,function(b){return(0,r.tokenLabel)(b)}).join(","),"]")}),m=`expecting at least one iteration which starts with one of these possible Token sequences::
  `+"<".concat(g.join(" ,"),">");return h+m+p}},Object.freeze(t.defaultParserErrorProvider),t.defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(u,c){var o="Invalid grammar, reference to a rule which is not defined: ->"+c.nonTerminalName+`<-
inside top level rule: ->`+u.name+"<-";return o}},t.defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(u,c){function o(b){return b instanceof s.Terminal?b.terminalType.name:b instanceof s.NonTerminal?b.nonTerminalName:""}var f=u.name,h=(0,n.default)(c),d=h.idx,p=(0,l.getProductionDslName)(h),g=o(h),m=d>0,v="->".concat(p).concat(m?d:"","<- ").concat(g?"with argument: ->".concat(g,"<-"):"",`
                  appears more than once (`).concat(c.length," times) in the top level rule: ->").concat(f,`<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `);return v=v.replace(/[ \t]+/g," "),v=v.replace(/\s\s+/g,`
`),v},buildNamespaceConflictError:function(u){var c=`Namespace conflict found in grammar.
`+"The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <".concat(u.name,`>.
`)+`To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`;return c},buildAlternationPrefixAmbiguityError:function(u){var c=(0,i.default)(u.prefixPath,function(h){return(0,r.tokenLabel)(h)}).join(", "),o=u.alternation.idx===0?"":u.alternation.idx,f="Ambiguous alternatives: <".concat(u.ambiguityIndices.join(" ,"),`> due to common lookahead prefix
`)+"in <OR".concat(o,"> inside <").concat(u.topLevelRule.name,`> Rule,
`)+"<".concat(c,`> may appears as a prefix path in all these alternatives.
`)+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`;return f},buildAlternationAmbiguityError:function(u){var c=(0,i.default)(u.prefixPath,function(h){return(0,r.tokenLabel)(h)}).join(", "),o=u.alternation.idx===0?"":u.alternation.idx,f="Ambiguous Alternatives Detected: <".concat(u.ambiguityIndices.join(" ,"),"> in <OR").concat(o,">")+" inside <".concat(u.topLevelRule.name,`> Rule,
`)+"<".concat(c,`> may appears as a prefix path in all these alternatives.
`);return f=f+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,f},buildEmptyRepetitionError:function(u){var c=(0,l.getProductionDslName)(u.repetition);u.repetition.idx!==0&&(c+=u.repetition.idx);var o="The repetition <".concat(c,"> within Rule <").concat(u.topLevelRule.name,`> can never consume any tokens.
`)+"This could lead to an infinite loop.";return o},buildTokenNameError:function(u){return"deprecated"},buildEmptyAlternationError:function(u){var c="Ambiguous empty alternative: <".concat(u.emptyChoiceIdx+1,">")+" in <OR".concat(u.alternation.idx,"> inside <").concat(u.topLevelRule.name,`> Rule.
`)+"Only the last alternative may be an empty alternative.";return c},buildTooManyAlternativesError:function(u){var c=`An Alternation cannot have more than 256 alternatives:
`+"<OR".concat(u.alternation.idx,"> inside <").concat(u.topLevelRule.name,`> Rule.
 has `).concat(u.alternation.definition.length+1," alternatives.");return c},buildLeftRecursionError:function(u){var c=u.topLevelRule.name,o=(0,i.default)(u.leftRecursionPath,function(d){return d.name}),f="".concat(c," --> ").concat(o.concat([c]).join(" --> ")),h=`Left Recursion found in grammar.
`+"rule: <".concat(c,`> can be invoked from itself (directly or indirectly)
`)+`without consuming any Tokens. The grammar path that causes this is: 
 `.concat(f,`
`)+` To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`;return h},buildInvalidRuleNameError:function(u){return"deprecated"},buildDuplicateRuleNameError:function(u){var c;u.topLevelRule instanceof s.Rule?c=u.topLevelRule.name:c=u.topLevelRule;var o="Duplicate definition, rule: ->".concat(c,"<- is already defined in the grammar: ->").concat(u.grammarName,"<-");return o}}})(pa);var ai={},si={},pp;function uB(){if(pp)return si;pp=1;var t=Ce&&Ce.__extends||function(){var u=function(c,o){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,h){f.__proto__=h}||function(f,h){for(var d in h)Object.prototype.hasOwnProperty.call(h,d)&&(f[d]=h[d])},u(c,o)};return function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");u(c,o);function f(){this.constructor=c}c.prototype=o===null?Object.create(o):(f.prototype=o.prototype,new f)}}(),e=Ce&&Ce.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(si,"__esModule",{value:!0}),si.GastRefResolverVisitor=si.resolveGrammar=void 0;var r=Rr(),n=e(lr),i=e(Nn),a=Ut;function s(u,c){var o=new l(u,c);return o.resolveRefs(),o.errors}si.resolveGrammar=s;var l=function(u){t(c,u);function c(o,f){var h=u.call(this)||this;return h.nameToTopRule=o,h.errMsgProvider=f,h.errors=[],h}return c.prototype.resolveRefs=function(){var o=this;(0,n.default)((0,i.default)(this.nameToTopRule),function(f){o.currTopLevel=f,f.accept(o)})},c.prototype.visitNonTerminal=function(o){var f=this.nameToTopRule[o.nonTerminalName];if(f)o.referencedRule=f;else{var h=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,o);this.errors.push({message:h,type:r.ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:o.nonTerminalName})}},c}(a.GAstVisitor);return si.GastRefResolverVisitor=l,si}var at={};function fB(t,e,r,n){for(var i=-1,a=t==null?0:t.length;++i<a;){var s=t[i];e(n,s,r(s),t)}return n}var hB=fB,dB=Ni;function pB(t,e,r,n){return dB(t,function(i,a,s){e(n,i,r(i),s)}),n}var gB=pB,mB=hB,vB=gB,yB=pn,bB=dt;function EB(t,e){return function(r,n){var i=bB(r)?mB:vB,a=e?e():{};return i(r,t,yB(n),a)}}var OB=EB,AB=Kf,CB=OB,wB=Object.prototype,SB=wB.hasOwnProperty,TB=CB(function(t,e,r){SB.call(t,r)?t[r].push(e):AB(t,r,[e])}),Ov=TB,RB=ih,NB=br;function xB(t,e){return RB(NB(t,e),1)}var Av=xB,ga={},Mt={},MB=Zf,_B=Ss;function kB(t,e,r){var n=t==null?0:t.length;return n?(e=r||e===void 0?1:_B(e),e=n-e,MB(t,0,e<0?0:e)):[]}var ph=kB,ki=Ce&&Ce.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Pi=Ce&&Ce.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Mt,"__esModule",{value:!0});Mt.nextPossibleTokensAfter=Mt.possiblePathsFrom=Mt.NextTerminalAfterAtLeastOneSepWalker=Mt.NextTerminalAfterAtLeastOneWalker=Mt.NextTerminalAfterManySepWalker=Mt.NextTerminalAfterManyWalker=Mt.AbstractNextTerminalAfterProductionWalker=Mt.NextAfterTokenWalker=Mt.AbstractNextPossibleTokensWalker=void 0;var Cv=fa,Hl=Pi(Rs),Ho=Pi(zr),gp=Pi(ph),ur=Pi(Jf),PB=Pi(dh),IB=Pi(lr),Ei=Pi(Zn),DB=Fr,tt=Ut,wv=function(t){ki(e,t);function e(r,n){var i=t.call(this)||this;return i.topProd=r,i.path=n,i.possibleTokTypes=[],i.nextProductionName="",i.nextProductionOccurrence=0,i.found=!1,i.isAtEndOfPath=!1,i}return e.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=(0,Ei.default)(this.path.ruleStack).reverse(),this.occurrenceStack=(0,Ei.default)(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},e.prototype.walk=function(r,n){n===void 0&&(n=[]),this.found||t.prototype.walk.call(this,r,n)},e.prototype.walkProdRef=function(r,n,i){if(r.referencedRule.name===this.nextProductionName&&r.idx===this.nextProductionOccurrence){var a=n.concat(i);this.updateExpectedNext(),this.walk(r.referencedRule,a)}},e.prototype.updateExpectedNext=function(){(0,Ho.default)(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},e}(Cv.RestWalker);Mt.AbstractNextPossibleTokensWalker=wv;var LB=function(t){ki(e,t);function e(r,n){var i=t.call(this,r,n)||this;return i.path=n,i.nextTerminalName="",i.nextTerminalOccurrence=0,i.nextTerminalName=i.path.lastTok.name,i.nextTerminalOccurrence=i.path.lastTokOccurrence,i}return e.prototype.walkTerminal=function(r,n,i){if(this.isAtEndOfPath&&r.terminalType.name===this.nextTerminalName&&r.idx===this.nextTerminalOccurrence&&!this.found){var a=n.concat(i),s=new tt.Alternative({definition:a});this.possibleTokTypes=(0,DB.first)(s),this.found=!0}},e}(wv);Mt.NextAfterTokenWalker=LB;var xs=function(t){ki(e,t);function e(r,n){var i=t.call(this)||this;return i.topRule=r,i.occurrence=n,i.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},i}return e.prototype.startWalking=function(){return this.walk(this.topRule),this.result},e}(Cv.RestWalker);Mt.AbstractNextTerminalAfterProductionWalker=xs;var BB=function(t){ki(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.walkMany=function(r,n,i){if(r.idx===this.occurrence){var a=(0,Hl.default)(n.concat(i));this.result.isEndOfRule=a===void 0,a instanceof tt.Terminal&&(this.result.token=a.terminalType,this.result.occurrence=a.idx)}else t.prototype.walkMany.call(this,r,n,i)},e}(xs);Mt.NextTerminalAfterManyWalker=BB;var UB=function(t){ki(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.walkManySep=function(r,n,i){if(r.idx===this.occurrence){var a=(0,Hl.default)(n.concat(i));this.result.isEndOfRule=a===void 0,a instanceof tt.Terminal&&(this.result.token=a.terminalType,this.result.occurrence=a.idx)}else t.prototype.walkManySep.call(this,r,n,i)},e}(xs);Mt.NextTerminalAfterManySepWalker=UB;var $B=function(t){ki(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.walkAtLeastOne=function(r,n,i){if(r.idx===this.occurrence){var a=(0,Hl.default)(n.concat(i));this.result.isEndOfRule=a===void 0,a instanceof tt.Terminal&&(this.result.token=a.terminalType,this.result.occurrence=a.idx)}else t.prototype.walkAtLeastOne.call(this,r,n,i)},e}(xs);Mt.NextTerminalAfterAtLeastOneWalker=$B;var FB=function(t){ki(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.walkAtLeastOneSep=function(r,n,i){if(r.idx===this.occurrence){var a=(0,Hl.default)(n.concat(i));this.result.isEndOfRule=a===void 0,a instanceof tt.Terminal&&(this.result.token=a.terminalType,this.result.occurrence=a.idx)}else t.prototype.walkAtLeastOneSep.call(this,r,n,i)},e}(xs);Mt.NextTerminalAfterAtLeastOneSepWalker=FB;function Sv(t,e,r){r===void 0&&(r=[]),r=(0,Ei.default)(r);var n=[],i=0;function a(c){return c.concat((0,ur.default)(t,i+1))}function s(c){var o=Sv(a(c),e,r);return n.concat(o)}for(;r.length<e&&i<t.length;){var l=t[i];if(l instanceof tt.Alternative)return s(l.definition);if(l instanceof tt.NonTerminal)return s(l.definition);if(l instanceof tt.Option)n=s(l.definition);else if(l instanceof tt.RepetitionMandatory){var u=l.definition.concat([new tt.Repetition({definition:l.definition})]);return s(u)}else if(l instanceof tt.RepetitionMandatoryWithSeparator){var u=[new tt.Alternative({definition:l.definition}),new tt.Repetition({definition:[new tt.Terminal({terminalType:l.separator})].concat(l.definition)})];return s(u)}else if(l instanceof tt.RepetitionWithSeparator){var u=l.definition.concat([new tt.Repetition({definition:[new tt.Terminal({terminalType:l.separator})].concat(l.definition)})]);n=s(u)}else if(l instanceof tt.Repetition){var u=l.definition.concat([new tt.Repetition({definition:l.definition})]);n=s(u)}else{if(l instanceof tt.Alternation)return(0,IB.default)(l.definition,function(c){(0,Ho.default)(c.definition)===!1&&(n=s(c.definition))}),n;if(l instanceof tt.Terminal)r.push(l.terminalType);else throw Error("non exhaustive match")}i++}return n.push({partialPath:r,suffixDef:(0,ur.default)(t,i)}),n}Mt.possiblePathsFrom=Sv;function VB(t,e,r,n){var i="EXIT_NONE_TERMINAL",a=[i],s="EXIT_ALTERNATIVE",l=!1,u=e.length,c=u-n-1,o=[],f=[];for(f.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!(0,Ho.default)(f);){var h=f.pop();if(h===s){l&&(0,PB.default)(f).idx<=c&&f.pop();continue}var d=h.def,p=h.idx,g=h.ruleStack,m=h.occurrenceStack;if(!(0,Ho.default)(d)){var v=d[0];if(v===i){var b={idx:p,def:(0,ur.default)(d),ruleStack:(0,gp.default)(g),occurrenceStack:(0,gp.default)(m)};f.push(b)}else if(v instanceof tt.Terminal)if(p<u-1){var C=p+1,A=e[C];if(r(A,v.terminalType)){var b={idx:C,def:(0,ur.default)(d),ruleStack:g,occurrenceStack:m};f.push(b)}}else if(p===u-1)o.push({nextTokenType:v.terminalType,nextTokenOccurrence:v.idx,ruleStack:g,occurrenceStack:m}),l=!0;else throw Error("non exhaustive match");else if(v instanceof tt.NonTerminal){var O=(0,Ei.default)(g);O.push(v.nonTerminalName);var w=(0,Ei.default)(m);w.push(v.idx);var b={idx:p,def:v.definition.concat(a,(0,ur.default)(d)),ruleStack:O,occurrenceStack:w};f.push(b)}else if(v instanceof tt.Option){var S={idx:p,def:(0,ur.default)(d),ruleStack:g,occurrenceStack:m};f.push(S),f.push(s);var N={idx:p,def:v.definition.concat((0,ur.default)(d)),ruleStack:g,occurrenceStack:m};f.push(N)}else if(v instanceof tt.RepetitionMandatory){var R=new tt.Repetition({definition:v.definition,idx:v.idx}),k=v.definition.concat([R],(0,ur.default)(d)),b={idx:p,def:k,ruleStack:g,occurrenceStack:m};f.push(b)}else if(v instanceof tt.RepetitionMandatoryWithSeparator){var z=new tt.Terminal({terminalType:v.separator}),R=new tt.Repetition({definition:[z].concat(v.definition),idx:v.idx}),k=v.definition.concat([R],(0,ur.default)(d)),b={idx:p,def:k,ruleStack:g,occurrenceStack:m};f.push(b)}else if(v instanceof tt.RepetitionWithSeparator){var S={idx:p,def:(0,ur.default)(d),ruleStack:g,occurrenceStack:m};f.push(S),f.push(s);var z=new tt.Terminal({terminalType:v.separator}),Y=new tt.Repetition({definition:[z].concat(v.definition),idx:v.idx}),k=v.definition.concat([Y],(0,ur.default)(d)),N={idx:p,def:k,ruleStack:g,occurrenceStack:m};f.push(N)}else if(v instanceof tt.Repetition){var S={idx:p,def:(0,ur.default)(d),ruleStack:g,occurrenceStack:m};f.push(S),f.push(s);var Y=new tt.Repetition({definition:v.definition,idx:v.idx}),k=v.definition.concat([Y],(0,ur.default)(d)),N={idx:p,def:k,ruleStack:g,occurrenceStack:m};f.push(N)}else if(v instanceof tt.Alternation)for(var re=v.definition.length-1;re>=0;re--){var Q=v.definition[re],ae={idx:p,def:Q.definition.concat((0,ur.default)(d)),ruleStack:g,occurrenceStack:m};f.push(ae),f.push(s)}else if(v instanceof tt.Alternative)f.push({idx:p,def:v.definition.concat((0,ur.default)(d)),ruleStack:g,occurrenceStack:m});else if(v instanceof tt.Rule)f.push(WB(v,p,g,m));else throw Error("non exhaustive match")}}return o}Mt.nextPossibleTokensAfter=VB;function WB(t,e,r,n){var i=(0,Ei.default)(r);i.push(t.name);var a=(0,Ei.default)(n);return a.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:a}}(function(t){var e=Ce&&Ce.__extends||function(){var J=function(ne,se){return J=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(de,be){de.__proto__=be}||function(de,be){for(var Ae in be)Object.prototype.hasOwnProperty.call(be,Ae)&&(de[Ae]=be[Ae])},J(ne,se)};return function(ne,se){if(typeof se!="function"&&se!==null)throw new TypeError("Class extends value "+String(se)+" is not a constructor or null");J(ne,se);function de(){this.constructor=ne}ne.prototype=se===null?Object.create(se):(de.prototype=se.prototype,new de)}}(),r=Ce&&Ce.__importDefault||function(J){return J&&J.__esModule?J:{default:J}};Object.defineProperty(t,"__esModule",{value:!0}),t.areTokenCategoriesNotUsed=t.isStrictPrefixOfPath=t.containsPath=t.getLookaheadPathsForOptionalProd=t.getLookaheadPathsForOr=t.lookAheadSequenceFromAlternatives=t.buildSingleAlternativeLookaheadFunction=t.buildAlternativesLookAheadFunc=t.buildLookaheadFuncForOptionalProd=t.buildLookaheadFuncForOr=t.getLookaheadPaths=t.getProdType=t.PROD_TYPE=void 0;var n=r(zr),i=r(Mn),a=r($l),s=r(br),l=r(lr),u=r(Lr),c=r(Mi),o=Mt,f=fa,h=_i,d=Ut,p=Ut,g;(function(J){J[J.OPTION=0]="OPTION",J[J.REPETITION=1]="REPETITION",J[J.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",J[J.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",J[J.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",J[J.ALTERNATION=5]="ALTERNATION"})(g=t.PROD_TYPE||(t.PROD_TYPE={}));function m(J){if(J instanceof d.Option||J==="Option")return g.OPTION;if(J instanceof d.Repetition||J==="Repetition")return g.REPETITION;if(J instanceof d.RepetitionMandatory||J==="RepetitionMandatory")return g.REPETITION_MANDATORY;if(J instanceof d.RepetitionMandatoryWithSeparator||J==="RepetitionMandatoryWithSeparator")return g.REPETITION_MANDATORY_WITH_SEPARATOR;if(J instanceof d.RepetitionWithSeparator||J==="RepetitionWithSeparator")return g.REPETITION_WITH_SEPARATOR;if(J instanceof d.Alternation||J==="Alternation")return g.ALTERNATION;throw Error("non exhaustive match")}t.getProdType=m;function v(J){var ne=J.occurrence,se=J.rule,de=J.prodType,be=J.maxLookahead,Ae=m(de);return Ae===g.ALTERNATION?Y(ne,se,be):re(ne,se,Ae,be)}t.getLookaheadPaths=v;function b(J,ne,se,de,be,Ae){var Te=Y(J,ne,se),_e=ve(Te)?h.tokenStructuredMatcherNoCategories:h.tokenStructuredMatcher;return Ae(Te,de,_e,be)}t.buildLookaheadFuncForOr=b;function C(J,ne,se,de,be,Ae){var Te=re(J,ne,be,se),_e=ve(Te)?h.tokenStructuredMatcherNoCategories:h.tokenStructuredMatcher;return Ae(Te[0],_e,de)}t.buildLookaheadFuncForOptionalProd=C;function A(J,ne,se,de){var be=J.length,Ae=(0,a.default)(J,function(ke){return(0,a.default)(ke,function(E){return E.length===1})});if(ne)return function(ke){for(var E=(0,s.default)(ke,function(ie){return ie.GATE}),G=0;G<be;G++){var U=J[G],ue=U.length,V=E[G];if(!(V!==void 0&&V.call(this)===!1))e:for(var ee=0;ee<ue;ee++){for(var L=U[ee],Z=L.length,K=0;K<Z;K++){var H=this.LA(K+1);if(se(H,L[K])===!1)continue e}return G}}};if(Ae&&!de){var Te=(0,s.default)(J,function(ke){return(0,i.default)(ke)}),_e=(0,c.default)(Te,function(ke,E,G){return(0,l.default)(E,function(U){(0,u.default)(ke,U.tokenTypeIdx)||(ke[U.tokenTypeIdx]=G),(0,l.default)(U.categoryMatches,function(ue){(0,u.default)(ke,ue)||(ke[ue]=G)})}),ke},{});return function(){var ke=this.LA(1);return _e[ke.tokenTypeIdx]}}else return function(){for(var ke=0;ke<be;ke++){var E=J[ke],G=E.length;e:for(var U=0;U<G;U++){for(var ue=E[U],V=ue.length,ee=0;ee<V;ee++){var L=this.LA(ee+1);if(se(L,ue[ee])===!1)continue e}return ke}}}}t.buildAlternativesLookAheadFunc=A;function O(J,ne,se){var de=(0,a.default)(J,function(E){return E.length===1}),be=J.length;if(de&&!se){var Ae=(0,i.default)(J);if(Ae.length===1&&(0,n.default)(Ae[0].categoryMatches)){var Te=Ae[0],_e=Te.tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===_e}}else{var ke=(0,c.default)(Ae,function(E,G,U){return E[G.tokenTypeIdx]=!0,(0,l.default)(G.categoryMatches,function(ue){E[ue]=!0}),E},[]);return function(){var E=this.LA(1);return ke[E.tokenTypeIdx]===!0}}}else return function(){e:for(var E=0;E<be;E++){for(var G=J[E],U=G.length,ue=0;ue<U;ue++){var V=this.LA(ue+1);if(ne(V,G[ue])===!1)continue e}return!0}return!1}}t.buildSingleAlternativeLookaheadFunction=O;var w=function(J){e(ne,J);function ne(se,de,be){var Ae=J.call(this)||this;return Ae.topProd=se,Ae.targetOccurrence=de,Ae.targetProdType=be,Ae}return ne.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},ne.prototype.checkIsTarget=function(se,de,be,Ae){return se.idx===this.targetOccurrence&&this.targetProdType===de?(this.restDef=be.concat(Ae),!0):!1},ne.prototype.walkOption=function(se,de,be){this.checkIsTarget(se,g.OPTION,de,be)||J.prototype.walkOption.call(this,se,de,be)},ne.prototype.walkAtLeastOne=function(se,de,be){this.checkIsTarget(se,g.REPETITION_MANDATORY,de,be)||J.prototype.walkOption.call(this,se,de,be)},ne.prototype.walkAtLeastOneSep=function(se,de,be){this.checkIsTarget(se,g.REPETITION_MANDATORY_WITH_SEPARATOR,de,be)||J.prototype.walkOption.call(this,se,de,be)},ne.prototype.walkMany=function(se,de,be){this.checkIsTarget(se,g.REPETITION,de,be)||J.prototype.walkOption.call(this,se,de,be)},ne.prototype.walkManySep=function(se,de,be){this.checkIsTarget(se,g.REPETITION_WITH_SEPARATOR,de,be)||J.prototype.walkOption.call(this,se,de,be)},ne}(f.RestWalker),S=function(J){e(ne,J);function ne(se,de,be){var Ae=J.call(this)||this;return Ae.targetOccurrence=se,Ae.targetProdType=de,Ae.targetRef=be,Ae.result=[],Ae}return ne.prototype.checkIsTarget=function(se,de){se.idx===this.targetOccurrence&&this.targetProdType===de&&(this.targetRef===void 0||se===this.targetRef)&&(this.result=se.definition)},ne.prototype.visitOption=function(se){this.checkIsTarget(se,g.OPTION)},ne.prototype.visitRepetition=function(se){this.checkIsTarget(se,g.REPETITION)},ne.prototype.visitRepetitionMandatory=function(se){this.checkIsTarget(se,g.REPETITION_MANDATORY)},ne.prototype.visitRepetitionMandatoryWithSeparator=function(se){this.checkIsTarget(se,g.REPETITION_MANDATORY_WITH_SEPARATOR)},ne.prototype.visitRepetitionWithSeparator=function(se){this.checkIsTarget(se,g.REPETITION_WITH_SEPARATOR)},ne.prototype.visitAlternation=function(se){this.checkIsTarget(se,g.ALTERNATION)},ne}(p.GAstVisitor);function N(J){for(var ne=new Array(J),se=0;se<J;se++)ne[se]=[];return ne}function R(J){for(var ne=[""],se=0;se<J.length;se++){for(var de=J[se],be=[],Ae=0;Ae<ne.length;Ae++){var Te=ne[Ae];be.push(Te+"_"+de.tokenTypeIdx);for(var _e=0;_e<de.categoryMatches.length;_e++){var ke="_"+de.categoryMatches[_e];be.push(Te+ke)}}ne=be}return ne}function k(J,ne,se){for(var de=0;de<J.length;de++)if(de!==se)for(var be=J[de],Ae=0;Ae<ne.length;Ae++){var Te=ne[Ae];if(be[Te]===!0)return!1}return!0}function z(J,ne){for(var se=(0,s.default)(J,function(G){return(0,o.possiblePathsFrom)([G],1)}),de=N(se.length),be=(0,s.default)(se,function(G){var U={};return(0,l.default)(G,function(ue){var V=R(ue.partialPath);(0,l.default)(V,function(ee){U[ee]=!0})}),U}),Ae=se,Te=1;Te<=ne;Te++){var _e=Ae;Ae=N(_e.length);for(var ke=function(G){for(var U=_e[G],ue=0;ue<U.length;ue++){var V=U[ue].partialPath,ee=U[ue].suffixDef,L=R(V),Z=k(be,L,G);if(Z||(0,n.default)(ee)||V.length===ne){var K=de[G];if(Q(K,V)===!1){K.push(V);for(var H=0;H<L.length;H++){var ie=L[H];be[G][ie]=!0}}}else{var pe=(0,o.possiblePathsFrom)(ee,Te+1,V);Ae[G]=Ae[G].concat(pe),(0,l.default)(pe,function(ye){var we=R(ye.partialPath);(0,l.default)(we,function(Ue){be[G][Ue]=!0})})}}},E=0;E<_e.length;E++)ke(E)}return de}t.lookAheadSequenceFromAlternatives=z;function Y(J,ne,se,de){var be=new S(J,g.ALTERNATION,de);return ne.accept(be),z(be.result,se)}t.getLookaheadPathsForOr=Y;function re(J,ne,se,de){var be=new S(J,se);ne.accept(be);var Ae=be.result,Te=new w(ne,J,se),_e=Te.startWalking(),ke=new d.Alternative({definition:Ae}),E=new d.Alternative({definition:_e});return z([ke,E],de)}t.getLookaheadPathsForOptionalProd=re;function Q(J,ne){e:for(var se=0;se<J.length;se++){var de=J[se];if(de.length===ne.length){for(var be=0;be<de.length;be++){var Ae=ne[be],Te=de[be],_e=Ae===Te||Te.categoryMatchesMap[Ae.tokenTypeIdx]!==void 0;if(_e===!1)continue e}return!0}}return!1}t.containsPath=Q;function ae(J,ne){return J.length<ne.length&&(0,a.default)(J,function(se,de){var be=ne[de];return se===be||be.categoryMatchesMap[se.tokenTypeIdx]})}t.isStrictPrefixOfPath=ae;function ve(J){return(0,a.default)(J,function(ne){return(0,a.default)(ne,function(se){return(0,a.default)(se,function(de){return(0,n.default)(de.categoryMatches)})})})}t.areTokenCategoriesNotUsed=ve})(ga);var mp;function Gl(){if(mp)return at;mp=1;var t=Ce&&Ce.__extends||function(){var ee=function(L,Z){return ee=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(K,H){K.__proto__=H}||function(K,H){for(var ie in H)Object.prototype.hasOwnProperty.call(H,ie)&&(K[ie]=H[ie])},ee(L,Z)};return function(L,Z){if(typeof Z!="function"&&Z!==null)throw new TypeError("Class extends value "+String(Z)+" is not a constructor or null");ee(L,Z);function K(){this.constructor=L}L.prototype=Z===null?Object.create(Z):(K.prototype=Z.prototype,new K)}}(),e=Ce&&Ce.__assign||function(){return e=Object.assign||function(ee){for(var L,Z=1,K=arguments.length;Z<K;Z++){L=arguments[Z];for(var H in L)Object.prototype.hasOwnProperty.call(L,H)&&(ee[H]=L[H])}return ee},e.apply(this,arguments)},r=Ce&&Ce.__importDefault||function(ee){return ee&&ee.__esModule?ee:{default:ee}};Object.defineProperty(at,"__esModule",{value:!0}),at.checkPrefixAlternativesAmbiguities=at.validateSomeNonEmptyLookaheadPath=at.validateTooManyAlts=at.RepetitionCollector=at.validateAmbiguousAlternationAlternatives=at.validateEmptyOrAlternative=at.getFirstNoneTerminal=at.validateNoLeftRecursion=at.validateRuleIsOverridden=at.validateRuleDoesNotAlreadyExist=at.OccurrenceValidationCollector=at.identifyProductionForDuplicates=at.validateGrammar=at.validateLookahead=void 0;var n=r(Rs),i=r(zr),a=r(Jf),s=r(Mn),l=r(hh),u=r(ch),c=r(uh),o=r(br),f=r(lr),h=r(Ov),d=r(Mi),p=r(q0),g=r(Nn),m=r(Jn),v=r(Av),b=r(Zn),C=Rr(),A=Ut,O=ga,w=Mt,S=Ut,N=Ut,R=r(ph),k=r(Vl),z=_i;function Y(ee){var L=ee.lookaheadStrategy.validate({rules:ee.rules,tokenTypes:ee.tokenTypes,grammarName:ee.grammarName});return(0,o.default)(L,function(Z){return e({type:C.ParserDefinitionErrorType.CUSTOM_LOOKAHEAD_VALIDATION},Z)})}at.validateLookahead=Y;function re(ee,L,Z,K){var H=(0,v.default)(ee,function(we){return Q(we,Z)}),ie=V(ee,L,Z),pe=(0,v.default)(ee,function(we){return E(we,Z)}),ye=(0,v.default)(ee,function(we){return ne(we,ee,K,Z)});return H.concat(ie,pe,ye)}at.validateGrammar=re;function Q(ee,L){var Z=new J;ee.accept(Z);var K=Z.allProductions,H=(0,h.default)(K,ae),ie=(0,p.default)(H,function(ye){return ye.length>1}),pe=(0,o.default)((0,g.default)(ie),function(ye){var we=(0,n.default)(ye),Ue=L.buildDuplicateFoundError(ee,ye),De=(0,A.getProductionDslName)(we),Ie={message:Ue,type:C.ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:ee.name,dslName:De,occurrence:we.idx},We=ve(we);return We&&(Ie.parameter=We),Ie});return pe}function ae(ee){return"".concat((0,A.getProductionDslName)(ee),"_#_").concat(ee.idx,"_#_").concat(ve(ee))}at.identifyProductionForDuplicates=ae;function ve(ee){return ee instanceof S.Terminal?ee.terminalType.name:ee instanceof S.NonTerminal?ee.nonTerminalName:""}var J=function(ee){t(L,ee);function L(){var Z=ee!==null&&ee.apply(this,arguments)||this;return Z.allProductions=[],Z}return L.prototype.visitNonTerminal=function(Z){this.allProductions.push(Z)},L.prototype.visitOption=function(Z){this.allProductions.push(Z)},L.prototype.visitRepetitionWithSeparator=function(Z){this.allProductions.push(Z)},L.prototype.visitRepetitionMandatory=function(Z){this.allProductions.push(Z)},L.prototype.visitRepetitionMandatoryWithSeparator=function(Z){this.allProductions.push(Z)},L.prototype.visitRepetition=function(Z){this.allProductions.push(Z)},L.prototype.visitAlternation=function(Z){this.allProductions.push(Z)},L.prototype.visitTerminal=function(Z){this.allProductions.push(Z)},L}(N.GAstVisitor);at.OccurrenceValidationCollector=J;function ne(ee,L,Z,K){var H=[],ie=(0,d.default)(L,function(ye,we){return we.name===ee.name?ye+1:ye},0);if(ie>1){var pe=K.buildDuplicateRuleNameError({topLevelRule:ee,grammarName:Z});H.push({message:pe,type:C.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:ee.name})}return H}at.validateRuleDoesNotAlreadyExist=ne;function se(ee,L,Z){var K=[],H;return(0,m.default)(L,ee)||(H="Invalid rule override, rule: ->".concat(ee,"<- cannot be overridden in the grammar: ->").concat(Z,"<-")+"as it is not defined in any of the super grammars ",K.push({message:H,type:C.ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:ee})),K}at.validateRuleIsOverridden=se;function de(ee,L,Z,K){K===void 0&&(K=[]);var H=[],ie=be(L.definition);if((0,i.default)(ie))return[];var pe=ee.name,ye=(0,m.default)(ie,ee);ye&&H.push({message:Z.buildLeftRecursionError({topLevelRule:ee,leftRecursionPath:K}),type:C.ParserDefinitionErrorType.LEFT_RECURSION,ruleName:pe});var we=(0,c.default)(ie,K.concat([ee])),Ue=(0,v.default)(we,function(De){var Ie=(0,b.default)(K);return Ie.push(De),de(ee,De,Z,Ie)});return H.concat(Ue)}at.validateNoLeftRecursion=de;function be(ee){var L=[];if((0,i.default)(ee))return L;var Z=(0,n.default)(ee);if(Z instanceof S.NonTerminal)L.push(Z.referencedRule);else if(Z instanceof S.Alternative||Z instanceof S.Option||Z instanceof S.RepetitionMandatory||Z instanceof S.RepetitionMandatoryWithSeparator||Z instanceof S.RepetitionWithSeparator||Z instanceof S.Repetition)L=L.concat(be(Z.definition));else if(Z instanceof S.Alternation)L=(0,s.default)((0,o.default)(Z.definition,function(pe){return be(pe.definition)}));else if(!(Z instanceof S.Terminal))throw Error("non exhaustive match");var K=(0,A.isOptionalProd)(Z),H=ee.length>1;if(K&&H){var ie=(0,a.default)(ee);return L.concat(be(ie))}else return L}at.getFirstNoneTerminal=be;var Ae=function(ee){t(L,ee);function L(){var Z=ee!==null&&ee.apply(this,arguments)||this;return Z.alternations=[],Z}return L.prototype.visitAlternation=function(Z){this.alternations.push(Z)},L}(N.GAstVisitor);function Te(ee,L){var Z=new Ae;ee.accept(Z);var K=Z.alternations,H=(0,v.default)(K,function(ie){var pe=(0,R.default)(ie.definition);return(0,v.default)(pe,function(ye,we){var Ue=(0,w.nextPossibleTokensAfter)([ye],[],z.tokenStructuredMatcher,1);return(0,i.default)(Ue)?[{message:L.buildEmptyAlternationError({topLevelRule:ee,alternation:ie,emptyChoiceIdx:we}),type:C.ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:ee.name,occurrence:ie.idx,alternative:we+1}]:[]})});return H}at.validateEmptyOrAlternative=Te;function _e(ee,L,Z){var K=new Ae;ee.accept(K);var H=K.alternations;H=(0,u.default)(H,function(pe){return pe.ignoreAmbiguities===!0});var ie=(0,v.default)(H,function(pe){var ye=pe.idx,we=pe.maxLookahead||L,Ue=(0,O.getLookaheadPathsForOr)(ye,ee,we,pe),De=U(Ue,pe,ee,Z),Ie=ue(Ue,pe,ee,Z);return De.concat(Ie)});return ie}at.validateAmbiguousAlternationAlternatives=_e;var ke=function(ee){t(L,ee);function L(){var Z=ee!==null&&ee.apply(this,arguments)||this;return Z.allProductions=[],Z}return L.prototype.visitRepetitionWithSeparator=function(Z){this.allProductions.push(Z)},L.prototype.visitRepetitionMandatory=function(Z){this.allProductions.push(Z)},L.prototype.visitRepetitionMandatoryWithSeparator=function(Z){this.allProductions.push(Z)},L.prototype.visitRepetition=function(Z){this.allProductions.push(Z)},L}(N.GAstVisitor);at.RepetitionCollector=ke;function E(ee,L){var Z=new Ae;ee.accept(Z);var K=Z.alternations,H=(0,v.default)(K,function(ie){return ie.definition.length>255?[{message:L.buildTooManyAlternativesError({topLevelRule:ee,alternation:ie}),type:C.ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:ee.name,occurrence:ie.idx}]:[]});return H}at.validateTooManyAlts=E;function G(ee,L,Z){var K=[];return(0,f.default)(ee,function(H){var ie=new ke;H.accept(ie);var pe=ie.allProductions;(0,f.default)(pe,function(ye){var we=(0,O.getProdType)(ye),Ue=ye.maxLookahead||L,De=ye.idx,Ie=(0,O.getLookaheadPathsForOptionalProd)(De,H,we,Ue),We=Ie[0];if((0,i.default)((0,s.default)(We))){var Xe=Z.buildEmptyRepetitionError({topLevelRule:H,repetition:ye});K.push({message:Xe,type:C.ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:H.name})}})}),K}at.validateSomeNonEmptyLookaheadPath=G;function U(ee,L,Z,K){var H=[],ie=(0,d.default)(ee,function(ye,we,Ue){return L.definition[Ue].ignoreAmbiguities===!0||(0,f.default)(we,function(De){var Ie=[Ue];(0,f.default)(ee,function(We,Xe){Ue!==Xe&&(0,O.containsPath)(We,De)&&L.definition[Xe].ignoreAmbiguities!==!0&&Ie.push(Xe)}),Ie.length>1&&!(0,O.containsPath)(H,De)&&(H.push(De),ye.push({alts:Ie,path:De}))}),ye},[]),pe=(0,o.default)(ie,function(ye){var we=(0,o.default)(ye.alts,function(De){return De+1}),Ue=K.buildAlternationAmbiguityError({topLevelRule:Z,alternation:L,ambiguityIndices:we,prefixPath:ye.path});return{message:Ue,type:C.ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:Z.name,occurrence:L.idx,alternatives:ye.alts}});return pe}function ue(ee,L,Z,K){var H=(0,d.default)(ee,function(pe,ye,we){var Ue=(0,o.default)(ye,function(De){return{idx:we,path:De}});return pe.concat(Ue)},[]),ie=(0,k.default)((0,v.default)(H,function(pe){var ye=L.definition[pe.idx];if(ye.ignoreAmbiguities===!0)return[];var we=pe.idx,Ue=pe.path,De=(0,l.default)(H,function(We){return L.definition[We.idx].ignoreAmbiguities!==!0&&We.idx<we&&(0,O.isStrictPrefixOfPath)(We.path,Ue)}),Ie=(0,o.default)(De,function(We){var Xe=[We.idx+1,we+1],Qe=L.idx===0?"":L.idx,Me=K.buildAlternationPrefixAmbiguityError({topLevelRule:Z,alternation:L,ambiguityIndices:Xe,prefixPath:We.path});return{message:Me,type:C.ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:Z.name,occurrence:Qe,alternatives:Xe}});return Ie}));return ie}at.checkPrefixAlternativesAmbiguities=ue;function V(ee,L,Z){var K=[],H=(0,o.default)(L,function(ie){return ie.name});return(0,f.default)(ee,function(ie){var pe=ie.name;if((0,m.default)(H,pe)){var ye=Z.buildNamespaceConflictError(ie);K.push({message:ye,type:C.ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:pe})}}),K}return at}var vp;function HB(){if(vp)return ai;vp=1;var t=Ce&&Ce.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(ai,"__esModule",{value:!0}),ai.validateGrammar=ai.resolveGrammar=void 0;var e=t(lr),r=t(bv),n=uB(),i=Gl(),a=pa;function s(u){var c=(0,r.default)(u,{errMsgProvider:a.defaultGrammarResolverErrorProvider}),o={};return(0,e.default)(u.rules,function(f){o[f.name]=f}),(0,n.resolveGrammar)(o,c.errMsgProvider)}ai.resolveGrammar=s;function l(u){return u=(0,r.default)(u,{errMsgProvider:a.defaultGrammarValidatorErrorProvider}),(0,i.validateGrammar)(u.rules,u.tokenTypes,u.errMsgProvider,u.grammarName)}return ai.validateGrammar=l,ai}var Bc={},ir={},Ms=Ce&&Ce.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),GB=Ce&&Ce.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ir,"__esModule",{value:!0});ir.EarlyExitException=ir.NotAllInputParsedException=ir.NoViableAltException=ir.MismatchedTokenException=ir.isRecognitionException=void 0;var zB=GB(Jn),Tv="MismatchedTokenException",Rv="NoViableAltException",Nv="EarlyExitException",xv="NotAllInputParsedException",Mv=[Tv,Rv,Nv,xv];Object.freeze(Mv);function qB(t){return(0,zB.default)(Mv,t.name)}ir.isRecognitionException=qB;var zl=function(t){Ms(e,t);function e(r,n){var i=this.constructor,a=t.call(this,r)||this;return a.token=n,a.resyncedTokens=[],Object.setPrototypeOf(a,i.prototype),Error.captureStackTrace&&Error.captureStackTrace(a,a.constructor),a}return e}(Error),YB=function(t){Ms(e,t);function e(r,n,i){var a=t.call(this,r,n)||this;return a.previousToken=i,a.name=Tv,a}return e}(zl);ir.MismatchedTokenException=YB;var XB=function(t){Ms(e,t);function e(r,n,i){var a=t.call(this,r,n)||this;return a.previousToken=i,a.name=Rv,a}return e}(zl);ir.NoViableAltException=XB;var QB=function(t){Ms(e,t);function e(r,n){var i=t.call(this,r,n)||this;return i.name=xv,i}return e}(zl);ir.NotAllInputParsedException=QB;var KB=function(t){Ms(e,t);function e(r,n,i){var a=t.call(this,r,n)||this;return a.previousToken=i,a.name=Nv,a}return e}(zl);ir.EarlyExitException=KB;var yp;function _v(){return yp||(yp=1,function(t){var e=Ce&&Ce.__extends||function(){var b=function(C,A){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(O,w){O.__proto__=w}||function(O,w){for(var S in w)Object.prototype.hasOwnProperty.call(w,S)&&(O[S]=w[S])},b(C,A)};return function(C,A){if(typeof A!="function"&&A!==null)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");b(C,A);function O(){this.constructor=C}C.prototype=A===null?Object.create(A):(O.prototype=A.prototype,new O)}}(),r=Ce&&Ce.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(t,"__esModule",{value:!0}),t.attemptInRepetitionRecovery=t.Recoverable=t.InRuleRecoveryException=t.IN_RULE_RECOVERY_EXCEPTION=t.EOF_FOLLOW_KEY=void 0;var n=xi,i=r(zr),a=r(ph),s=r(Mn),l=r(br),u=r(fh),c=r(Lr),o=r(Jn),f=r(Zn),h=ir,d=Ts,p=Rr();t.EOF_FOLLOW_KEY={},t.IN_RULE_RECOVERY_EXCEPTION="InRuleRecoveryException";var g=function(b){e(C,b);function C(A){var O=b.call(this,A)||this;return O.name=t.IN_RULE_RECOVERY_EXCEPTION,O}return C}(Error);t.InRuleRecoveryException=g;var m=function(){function b(){}return b.prototype.initRecoverable=function(C){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=(0,c.default)(C,"recoveryEnabled")?C.recoveryEnabled:p.DEFAULT_PARSER_CONFIG.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=v)},b.prototype.getTokenToInsert=function(C){var A=(0,n.createTokenInstance)(C,"",NaN,NaN,NaN,NaN,NaN,NaN);return A.isInsertedInRecovery=!0,A},b.prototype.canTokenTypeBeInsertedInRecovery=function(C){return!0},b.prototype.canTokenTypeBeDeletedInRecovery=function(C){return!0},b.prototype.tryInRepetitionRecovery=function(C,A,O,w){for(var S=this,N=this.findReSyncTokenType(),R=this.exportLexerState(),k=[],z=!1,Y=this.LA(1),re=this.LA(1),Q=function(){var ae=S.LA(0),ve=S.errorMessageProvider.buildMismatchTokenMessage({expected:w,actual:Y,previous:ae,ruleName:S.getCurrRuleFullName()}),J=new h.MismatchedTokenException(ve,Y,S.LA(0));J.resyncedTokens=(0,a.default)(k),S.SAVE_ERROR(J)};!z;)if(this.tokenMatcher(re,w)){Q();return}else if(O.call(this)){Q(),C.apply(this,A);return}else this.tokenMatcher(re,N)?z=!0:(re=this.SKIP_TOKEN(),this.addToResyncTokens(re,k));this.importLexerState(R)},b.prototype.shouldInRepetitionRecoveryBeTried=function(C,A,O){return!(O===!1||this.tokenMatcher(this.LA(1),C)||this.isBackTracking()||this.canPerformInRuleRecovery(C,this.getFollowsForInRuleRecovery(C,A)))},b.prototype.getFollowsForInRuleRecovery=function(C,A){var O=this.getCurrentGrammarPath(C,A),w=this.getNextPossibleTokenTypes(O);return w},b.prototype.tryInRuleRecovery=function(C,A){if(this.canRecoverWithSingleTokenInsertion(C,A)){var O=this.getTokenToInsert(C);return O}if(this.canRecoverWithSingleTokenDeletion(C)){var w=this.SKIP_TOKEN();return this.consumeToken(),w}throw new g("sad sad panda")},b.prototype.canPerformInRuleRecovery=function(C,A){return this.canRecoverWithSingleTokenInsertion(C,A)||this.canRecoverWithSingleTokenDeletion(C)},b.prototype.canRecoverWithSingleTokenInsertion=function(C,A){var O=this;if(!this.canTokenTypeBeInsertedInRecovery(C)||(0,i.default)(A))return!1;var w=this.LA(1),S=(0,u.default)(A,function(N){return O.tokenMatcher(w,N)})!==void 0;return S},b.prototype.canRecoverWithSingleTokenDeletion=function(C){if(!this.canTokenTypeBeDeletedInRecovery(C))return!1;var A=this.tokenMatcher(this.LA(2),C);return A},b.prototype.isInCurrentRuleReSyncSet=function(C){var A=this.getCurrFollowKey(),O=this.getFollowSetFromFollowKey(A);return(0,o.default)(O,C)},b.prototype.findReSyncTokenType=function(){for(var C=this.flattenFollowSet(),A=this.LA(1),O=2;;){var w=(0,u.default)(C,function(S){var N=(0,n.tokenMatcher)(A,S);return N});if(w!==void 0)return w;A=this.LA(O),O++}},b.prototype.getCurrFollowKey=function(){if(this.RULE_STACK.length===1)return t.EOF_FOLLOW_KEY;var C=this.getLastExplicitRuleShortName(),A=this.getLastExplicitRuleOccurrenceIndex(),O=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(C),idxInCallingRule:A,inRule:this.shortRuleNameToFullName(O)}},b.prototype.buildFullFollowKeyStack=function(){var C=this,A=this.RULE_STACK,O=this.RULE_OCCURRENCE_STACK;return(0,l.default)(A,function(w,S){return S===0?t.EOF_FOLLOW_KEY:{ruleName:C.shortRuleNameToFullName(w),idxInCallingRule:O[S],inRule:C.shortRuleNameToFullName(A[S-1])}})},b.prototype.flattenFollowSet=function(){var C=this,A=(0,l.default)(this.buildFullFollowKeyStack(),function(O){return C.getFollowSetFromFollowKey(O)});return(0,s.default)(A)},b.prototype.getFollowSetFromFollowKey=function(C){if(C===t.EOF_FOLLOW_KEY)return[n.EOF];var A=C.ruleName+C.idxInCallingRule+d.IN+C.inRule;return this.resyncFollows[A]},b.prototype.addToResyncTokens=function(C,A){return this.tokenMatcher(C,n.EOF)||A.push(C),A},b.prototype.reSyncTo=function(C){for(var A=[],O=this.LA(1);this.tokenMatcher(O,C)===!1;)O=this.SKIP_TOKEN(),this.addToResyncTokens(O,A);return(0,a.default)(A)},b.prototype.attemptInRepetitionRecovery=function(C,A,O,w,S,N,R){},b.prototype.getCurrentGrammarPath=function(C,A){var O=this.getHumanReadableRuleStack(),w=(0,f.default)(this.RULE_OCCURRENCE_STACK),S={ruleStack:O,occurrenceStack:w,lastTok:C,lastTokOccurrence:A};return S},b.prototype.getHumanReadableRuleStack=function(){var C=this;return(0,l.default)(this.RULE_STACK,function(A){return C.shortRuleNameToFullName(A)})},b}();t.Recoverable=m;function v(b,C,A,O,w,S,N){var R=this.getKeyForAutomaticLookahead(O,w),k=this.firstAfterRepMap[R];if(k===void 0){var z=this.getCurrRuleFullName(),Y=this.getGAstProductions()[z],re=new S(Y,w);k=re.startWalking(),this.firstAfterRepMap[R]=k}var Q=k.token,ae=k.occurrence,ve=k.isEndOfRule;this.RULE_STACK.length===1&&ve&&Q===void 0&&(Q=n.EOF,ae=1),!(Q===void 0||ae===void 0)&&this.shouldInRepetitionRecoveryBeTried(Q,ae,N)&&this.tryInRepetitionRecovery(b,C,A,Q)}t.attemptInRepetitionRecovery=v}(Bc)),Bc}var oi={},ql={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.getKeyForAutomaticLookahead=t.AT_LEAST_ONE_SEP_IDX=t.MANY_SEP_IDX=t.AT_LEAST_ONE_IDX=t.MANY_IDX=t.OPTION_IDX=t.OR_IDX=t.BITS_FOR_ALT_IDX=t.BITS_FOR_RULE_IDX=t.BITS_FOR_OCCURRENCE_IDX=t.BITS_FOR_METHOD_TYPE=void 0,t.BITS_FOR_METHOD_TYPE=4,t.BITS_FOR_OCCURRENCE_IDX=8,t.BITS_FOR_RULE_IDX=12,t.BITS_FOR_ALT_IDX=8,t.OR_IDX=1<<t.BITS_FOR_OCCURRENCE_IDX,t.OPTION_IDX=2<<t.BITS_FOR_OCCURRENCE_IDX,t.MANY_IDX=3<<t.BITS_FOR_OCCURRENCE_IDX,t.AT_LEAST_ONE_IDX=4<<t.BITS_FOR_OCCURRENCE_IDX,t.MANY_SEP_IDX=5<<t.BITS_FOR_OCCURRENCE_IDX,t.AT_LEAST_ONE_SEP_IDX=6<<t.BITS_FOR_OCCURRENCE_IDX;function e(r,n,i){return i|n|r}t.getKeyForAutomaticLookahead=e,32-t.BITS_FOR_ALT_IDX})(ql);var Ta={},bp;function kv(){if(bp)return Ta;bp=1;var t=Ce&&Ce.__spreadArray||function(c,o,f){if(f||arguments.length===2)for(var h=0,d=o.length,p;h<d;h++)(p||!(h in o))&&(p||(p=Array.prototype.slice.call(o,0,h)),p[h]=o[h]);return c.concat(p||Array.prototype.slice.call(o))},e=Ce&&Ce.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(Ta,"__esModule",{value:!0}),Ta.LLkLookaheadStrategy=void 0;var r=e(Av),n=e(zr),i=pa,a=Rr(),s=Gl(),l=ga,u=function(){function c(o){var f;this.maxLookahead=(f=o==null?void 0:o.maxLookahead)!==null&&f!==void 0?f:a.DEFAULT_PARSER_CONFIG.maxLookahead}return c.prototype.validate=function(o){var f=this.validateNoLeftRecursion(o.rules);if((0,n.default)(f)){var h=this.validateEmptyOrAlternatives(o.rules),d=this.validateAmbiguousAlternationAlternatives(o.rules,this.maxLookahead),p=this.validateSomeNonEmptyLookaheadPath(o.rules,this.maxLookahead),g=t(t(t(t([],f,!0),h,!0),d,!0),p,!0);return g}return f},c.prototype.validateNoLeftRecursion=function(o){return(0,r.default)(o,function(f){return(0,s.validateNoLeftRecursion)(f,f,i.defaultGrammarValidatorErrorProvider)})},c.prototype.validateEmptyOrAlternatives=function(o){return(0,r.default)(o,function(f){return(0,s.validateEmptyOrAlternative)(f,i.defaultGrammarValidatorErrorProvider)})},c.prototype.validateAmbiguousAlternationAlternatives=function(o,f){return(0,r.default)(o,function(h){return(0,s.validateAmbiguousAlternationAlternatives)(h,f,i.defaultGrammarValidatorErrorProvider)})},c.prototype.validateSomeNonEmptyLookaheadPath=function(o,f){return(0,s.validateSomeNonEmptyLookaheadPath)(o,f,i.defaultGrammarValidatorErrorProvider)},c.prototype.buildLookaheadForAlternation=function(o){return(0,l.buildLookaheadFuncForOr)(o.prodOccurrence,o.rule,o.maxLookahead,o.hasPredicates,o.dynamicTokensEnabled,l.buildAlternativesLookAheadFunc)},c.prototype.buildLookaheadForOptional=function(o){return(0,l.buildLookaheadFuncForOptionalProd)(o.prodOccurrence,o.rule,o.maxLookahead,o.dynamicTokensEnabled,(0,l.getProdType)(o.prodType),l.buildSingleAlternativeLookaheadFunction)},c}();return Ta.LLkLookaheadStrategy=u,Ta}var Ep;function jB(){if(Ep)return oi;Ep=1;var t=Ce&&Ce.__extends||function(){var d=function(p,g){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,v){m.__proto__=v}||function(m,v){for(var b in v)Object.prototype.hasOwnProperty.call(v,b)&&(m[b]=v[b])},d(p,g)};return function(p,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");d(p,g);function m(){this.constructor=p}p.prototype=g===null?Object.create(g):(m.prototype=g.prototype,new m)}}(),e=Ce&&Ce.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(oi,"__esModule",{value:!0}),oi.collectMethods=oi.LooksAhead=void 0;var r=e(lr),n=e(Lr),i=Rr(),a=ql,s=Ut,l=Ut,u=kv(),c=function(){function d(){}return d.prototype.initLooksAhead=function(p){this.dynamicTokensEnabled=(0,n.default)(p,"dynamicTokensEnabled")?p.dynamicTokensEnabled:i.DEFAULT_PARSER_CONFIG.dynamicTokensEnabled,this.maxLookahead=(0,n.default)(p,"maxLookahead")?p.maxLookahead:i.DEFAULT_PARSER_CONFIG.maxLookahead,this.lookaheadStrategy=(0,n.default)(p,"lookaheadStrategy")?p.lookaheadStrategy:new u.LLkLookaheadStrategy({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map},d.prototype.preComputeLookaheadFunctions=function(p){var g=this;(0,r.default)(p,function(m){g.TRACE_INIT("".concat(m.name," Rule Lookahead"),function(){var v=h(m),b=v.alternation,C=v.repetition,A=v.option,O=v.repetitionMandatory,w=v.repetitionMandatoryWithSeparator,S=v.repetitionWithSeparator;(0,r.default)(b,function(N){var R=N.idx===0?"":N.idx;g.TRACE_INIT("".concat((0,l.getProductionDslName)(N)).concat(R),function(){var k=g.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:N.idx,rule:m,maxLookahead:N.maxLookahead||g.maxLookahead,hasPredicates:N.hasPredicates,dynamicTokensEnabled:g.dynamicTokensEnabled}),z=(0,a.getKeyForAutomaticLookahead)(g.fullRuleNameToShort[m.name],a.OR_IDX,N.idx);g.setLaFuncCache(z,k)})}),(0,r.default)(C,function(N){g.computeLookaheadFunc(m,N.idx,a.MANY_IDX,"Repetition",N.maxLookahead,(0,l.getProductionDslName)(N))}),(0,r.default)(A,function(N){g.computeLookaheadFunc(m,N.idx,a.OPTION_IDX,"Option",N.maxLookahead,(0,l.getProductionDslName)(N))}),(0,r.default)(O,function(N){g.computeLookaheadFunc(m,N.idx,a.AT_LEAST_ONE_IDX,"RepetitionMandatory",N.maxLookahead,(0,l.getProductionDslName)(N))}),(0,r.default)(w,function(N){g.computeLookaheadFunc(m,N.idx,a.AT_LEAST_ONE_SEP_IDX,"RepetitionMandatoryWithSeparator",N.maxLookahead,(0,l.getProductionDslName)(N))}),(0,r.default)(S,function(N){g.computeLookaheadFunc(m,N.idx,a.MANY_SEP_IDX,"RepetitionWithSeparator",N.maxLookahead,(0,l.getProductionDslName)(N))})})})},d.prototype.computeLookaheadFunc=function(p,g,m,v,b,C){var A=this;this.TRACE_INIT("".concat(C).concat(g===0?"":g),function(){var O=A.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:g,rule:p,maxLookahead:b||A.maxLookahead,dynamicTokensEnabled:A.dynamicTokensEnabled,prodType:v}),w=(0,a.getKeyForAutomaticLookahead)(A.fullRuleNameToShort[p.name],m,g);A.setLaFuncCache(w,O)})},d.prototype.getKeyForAutomaticLookahead=function(p,g){var m=this.getLastExplicitRuleShortName();return(0,a.getKeyForAutomaticLookahead)(m,p,g)},d.prototype.getLaFuncFromCache=function(p){return this.lookAheadFuncsCache.get(p)},d.prototype.setLaFuncCache=function(p,g){this.lookAheadFuncsCache.set(p,g)},d}();oi.LooksAhead=c;var o=function(d){t(p,d);function p(){var g=d!==null&&d.apply(this,arguments)||this;return g.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},g}return p.prototype.reset=function(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}},p.prototype.visitOption=function(g){this.dslMethods.option.push(g)},p.prototype.visitRepetitionWithSeparator=function(g){this.dslMethods.repetitionWithSeparator.push(g)},p.prototype.visitRepetitionMandatory=function(g){this.dslMethods.repetitionMandatory.push(g)},p.prototype.visitRepetitionMandatoryWithSeparator=function(g){this.dslMethods.repetitionMandatoryWithSeparator.push(g)},p.prototype.visitRepetition=function(g){this.dslMethods.repetition.push(g)},p.prototype.visitAlternation=function(g){this.dslMethods.alternation.push(g)},p}(s.GAstVisitor),f=new o;function h(d){f.reset(),d.accept(f);var p=f.dslMethods;return f.reset(),p}return oi.collectMethods=h,oi}var Ra={},an={};Object.defineProperty(an,"__esModule",{value:!0});an.addNoneTerminalToCst=an.addTerminalToCst=an.setNodeLocationFull=an.setNodeLocationOnlyOffset=void 0;function ZB(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}an.setNodeLocationOnlyOffset=ZB;function JB(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}an.setNodeLocationFull=JB;function eU(t,e,r){t.children[r]===void 0?t.children[r]=[e]:t.children[r].push(e)}an.addTerminalToCst=eU;function tU(t,e,r){t.children[e]===void 0?t.children[e]=[r]:t.children[e].push(r)}an.addNoneTerminalToCst=tU;var Pv={},Yl={};Object.defineProperty(Yl,"__esModule",{value:!0});Yl.defineNameProp=void 0;var rU="name";function nU(t,e){Object.defineProperty(t,rU,{enumerable:!1,configurable:!0,writable:!1,value:e})}Yl.defineNameProp=nU;(function(t){var e=Ce&&Ce.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(t,"__esModule",{value:!0}),t.validateMissingCstMethods=t.validateVisitor=t.CstVisitorDefinitionError=t.createBaseVisitorConstructorWithDefaults=t.createBaseSemanticVisitorConstructor=t.defaultVisit=void 0;var r=e(zr),n=e(Vl),i=e(dt),a=e(br),s=e(lr),l=e(hh),u=e(Dr),c=e(vs),o=e(da),f=Yl;function h(b,C){for(var A=(0,u.default)(b),O=A.length,w=0;w<O;w++)for(var S=A[w],N=b[S],R=N.length,k=0;k<R;k++){var z=N[k];z.tokenTypeIdx===void 0&&this[z.name](z.children,C)}}t.defaultVisit=h;function d(b,C){var A=function(){};(0,f.defineNameProp)(A,b+"BaseSemantics");var O={visit:function(w,S){if((0,i.default)(w)&&(w=w[0]),!(0,o.default)(w))return this[w.name](w.children,S)},validateVisitor:function(){var w=m(this,C);if(!(0,r.default)(w)){var S=(0,a.default)(w,function(N){return N.msg});throw Error("Errors Detected in CST Visitor <".concat(this.constructor.name,`>:
	`)+"".concat(S.join(`

`).replace(/\n/g,`
	`)))}}};return A.prototype=O,A.prototype.constructor=A,A._RULE_NAMES=C,A}t.createBaseSemanticVisitorConstructor=d;function p(b,C,A){var O=function(){};(0,f.defineNameProp)(O,b+"BaseSemanticsWithDefaults");var w=Object.create(A.prototype);return(0,s.default)(C,function(S){w[S]=h}),O.prototype=w,O.prototype.constructor=O,O}t.createBaseVisitorConstructorWithDefaults=p;var g;(function(b){b[b.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",b[b.MISSING_METHOD=1]="MISSING_METHOD"})(g=t.CstVisitorDefinitionError||(t.CstVisitorDefinitionError={}));function m(b,C){var A=v(b,C);return A}t.validateVisitor=m;function v(b,C){var A=(0,l.default)(C,function(w){return(0,c.default)(b[w])===!1}),O=(0,a.default)(A,function(w){return{msg:"Missing visitor method: <".concat(w,"> on ").concat(b.constructor.name," CST Visitor."),type:g.MISSING_METHOD,methodName:w}});return(0,n.default)(O)}t.validateMissingCstMethods=v})(Pv);var Op;function iU(){if(Op)return Ra;Op=1;var t=Ce&&Ce.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(Ra,"__esModule",{value:!0}),Ra.TreeBuilder=void 0;var e=an,r=t(ah),n=t(Lr),i=t(Dr),a=t(da),s=Pv,l=Rr(),u=function(){function c(){}return c.prototype.initTreeBuilder=function(o){if(this.CST_STACK=[],this.outputCst=o.outputCst,this.nodeLocationTracking=(0,n.default)(o,"nodeLocationTracking")?o.nodeLocationTracking:l.DEFAULT_PARSER_CONFIG.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=r.default,this.cstFinallyStateUpdate=r.default,this.cstPostTerminal=r.default,this.cstPostNonTerminal=r.default,this.cstPostRule=r.default;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=e.setNodeLocationFull,this.setNodeLocationFromNode=e.setNodeLocationFull,this.cstPostRule=r.default,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=r.default,this.setNodeLocationFromNode=r.default,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=e.setNodeLocationOnlyOffset,this.setNodeLocationFromNode=e.setNodeLocationOnlyOffset,this.cstPostRule=r.default,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=r.default,this.setNodeLocationFromNode=r.default,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=r.default,this.setNodeLocationFromNode=r.default,this.cstPostRule=r.default,this.setInitialNodeLocation=r.default;else throw Error('Invalid <nodeLocationTracking> config option: "'.concat(o.nodeLocationTracking,'"'))},c.prototype.setInitialNodeLocationOnlyOffsetRecovery=function(o){o.location={startOffset:NaN,endOffset:NaN}},c.prototype.setInitialNodeLocationOnlyOffsetRegular=function(o){o.location={startOffset:this.LA(1).startOffset,endOffset:NaN}},c.prototype.setInitialNodeLocationFullRecovery=function(o){o.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}},c.prototype.setInitialNodeLocationFullRegular=function(o){var f=this.LA(1);o.location={startOffset:f.startOffset,startLine:f.startLine,startColumn:f.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}},c.prototype.cstInvocationStateUpdate=function(o){var f={name:o,children:Object.create(null)};this.setInitialNodeLocation(f),this.CST_STACK.push(f)},c.prototype.cstFinallyStateUpdate=function(){this.CST_STACK.pop()},c.prototype.cstPostRuleFull=function(o){var f=this.LA(0),h=o.location;h.startOffset<=f.startOffset?(h.endOffset=f.endOffset,h.endLine=f.endLine,h.endColumn=f.endColumn):(h.startOffset=NaN,h.startLine=NaN,h.startColumn=NaN)},c.prototype.cstPostRuleOnlyOffset=function(o){var f=this.LA(0),h=o.location;h.startOffset<=f.startOffset?h.endOffset=f.endOffset:h.startOffset=NaN},c.prototype.cstPostTerminal=function(o,f){var h=this.CST_STACK[this.CST_STACK.length-1];(0,e.addTerminalToCst)(h,f,o),this.setNodeLocationFromToken(h.location,f)},c.prototype.cstPostNonTerminal=function(o,f){var h=this.CST_STACK[this.CST_STACK.length-1];(0,e.addNoneTerminalToCst)(h,f,o),this.setNodeLocationFromNode(h.location,o.location)},c.prototype.getBaseCstVisitorConstructor=function(){if((0,a.default)(this.baseCstVisitorConstructor)){var o=(0,s.createBaseSemanticVisitorConstructor)(this.className,(0,i.default)(this.gastProductionsCache));return this.baseCstVisitorConstructor=o,o}return this.baseCstVisitorConstructor},c.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if((0,a.default)(this.baseCstVisitorWithDefaultsConstructor)){var o=(0,s.createBaseVisitorConstructorWithDefaults)(this.className,(0,i.default)(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=o,o}return this.baseCstVisitorWithDefaultsConstructor},c.prototype.getLastExplicitRuleShortName=function(){var o=this.RULE_STACK;return o[o.length-1]},c.prototype.getPreviousExplicitRuleShortName=function(){var o=this.RULE_STACK;return o[o.length-2]},c.prototype.getLastExplicitRuleOccurrenceIndex=function(){var o=this.RULE_OCCURRENCE_STACK;return o[o.length-1]},c}();return Ra.TreeBuilder=u,Ra}var Na={},Ap;function aU(){if(Ap)return Na;Ap=1,Object.defineProperty(Na,"__esModule",{value:!0}),Na.LexerAdapter=void 0;var t=Rr(),e=function(){function r(){}return r.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(r.prototype,"input",{get:function(){return this.tokVector},set:function(n){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=n,this.tokVectorLength=n.length},enumerable:!1,configurable:!0}),r.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):t.END_OF_FILE},r.prototype.LA=function(n){var i=this.currIdx+n;return i<0||this.tokVectorLength<=i?t.END_OF_FILE:this.tokVector[i]},r.prototype.consumeToken=function(){this.currIdx++},r.prototype.exportLexerState=function(){return this.currIdx},r.prototype.importLexerState=function(n){this.currIdx=n},r.prototype.resetLexerState=function(){this.currIdx=-1},r.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},r.prototype.getLexerPosition=function(){return this.exportLexerState()},r}();return Na.LexerAdapter=e,Na}var xa={},Cp;function sU(){if(Cp)return xa;Cp=1;var t=Ce&&Ce.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(xa,"__esModule",{value:!0}),xa.RecognizerApi=void 0;var e=t(Nn),r=t(Jn),n=ir,i=Rr(),a=pa,s=Gl(),l=Ut,u=function(){function c(){}return c.prototype.ACTION=function(o){return o.call(this)},c.prototype.consume=function(o,f,h){return this.consumeInternal(f,o,h)},c.prototype.subrule=function(o,f,h){return this.subruleInternal(f,o,h)},c.prototype.option=function(o,f){return this.optionInternal(f,o)},c.prototype.or=function(o,f){return this.orInternal(f,o)},c.prototype.many=function(o,f){return this.manyInternal(o,f)},c.prototype.atLeastOne=function(o,f){return this.atLeastOneInternal(o,f)},c.prototype.CONSUME=function(o,f){return this.consumeInternal(o,0,f)},c.prototype.CONSUME1=function(o,f){return this.consumeInternal(o,1,f)},c.prototype.CONSUME2=function(o,f){return this.consumeInternal(o,2,f)},c.prototype.CONSUME3=function(o,f){return this.consumeInternal(o,3,f)},c.prototype.CONSUME4=function(o,f){return this.consumeInternal(o,4,f)},c.prototype.CONSUME5=function(o,f){return this.consumeInternal(o,5,f)},c.prototype.CONSUME6=function(o,f){return this.consumeInternal(o,6,f)},c.prototype.CONSUME7=function(o,f){return this.consumeInternal(o,7,f)},c.prototype.CONSUME8=function(o,f){return this.consumeInternal(o,8,f)},c.prototype.CONSUME9=function(o,f){return this.consumeInternal(o,9,f)},c.prototype.SUBRULE=function(o,f){return this.subruleInternal(o,0,f)},c.prototype.SUBRULE1=function(o,f){return this.subruleInternal(o,1,f)},c.prototype.SUBRULE2=function(o,f){return this.subruleInternal(o,2,f)},c.prototype.SUBRULE3=function(o,f){return this.subruleInternal(o,3,f)},c.prototype.SUBRULE4=function(o,f){return this.subruleInternal(o,4,f)},c.prototype.SUBRULE5=function(o,f){return this.subruleInternal(o,5,f)},c.prototype.SUBRULE6=function(o,f){return this.subruleInternal(o,6,f)},c.prototype.SUBRULE7=function(o,f){return this.subruleInternal(o,7,f)},c.prototype.SUBRULE8=function(o,f){return this.subruleInternal(o,8,f)},c.prototype.SUBRULE9=function(o,f){return this.subruleInternal(o,9,f)},c.prototype.OPTION=function(o){return this.optionInternal(o,0)},c.prototype.OPTION1=function(o){return this.optionInternal(o,1)},c.prototype.OPTION2=function(o){return this.optionInternal(o,2)},c.prototype.OPTION3=function(o){return this.optionInternal(o,3)},c.prototype.OPTION4=function(o){return this.optionInternal(o,4)},c.prototype.OPTION5=function(o){return this.optionInternal(o,5)},c.prototype.OPTION6=function(o){return this.optionInternal(o,6)},c.prototype.OPTION7=function(o){return this.optionInternal(o,7)},c.prototype.OPTION8=function(o){return this.optionInternal(o,8)},c.prototype.OPTION9=function(o){return this.optionInternal(o,9)},c.prototype.OR=function(o){return this.orInternal(o,0)},c.prototype.OR1=function(o){return this.orInternal(o,1)},c.prototype.OR2=function(o){return this.orInternal(o,2)},c.prototype.OR3=function(o){return this.orInternal(o,3)},c.prototype.OR4=function(o){return this.orInternal(o,4)},c.prototype.OR5=function(o){return this.orInternal(o,5)},c.prototype.OR6=function(o){return this.orInternal(o,6)},c.prototype.OR7=function(o){return this.orInternal(o,7)},c.prototype.OR8=function(o){return this.orInternal(o,8)},c.prototype.OR9=function(o){return this.orInternal(o,9)},c.prototype.MANY=function(o){this.manyInternal(0,o)},c.prototype.MANY1=function(o){this.manyInternal(1,o)},c.prototype.MANY2=function(o){this.manyInternal(2,o)},c.prototype.MANY3=function(o){this.manyInternal(3,o)},c.prototype.MANY4=function(o){this.manyInternal(4,o)},c.prototype.MANY5=function(o){this.manyInternal(5,o)},c.prototype.MANY6=function(o){this.manyInternal(6,o)},c.prototype.MANY7=function(o){this.manyInternal(7,o)},c.prototype.MANY8=function(o){this.manyInternal(8,o)},c.prototype.MANY9=function(o){this.manyInternal(9,o)},c.prototype.MANY_SEP=function(o){this.manySepFirstInternal(0,o)},c.prototype.MANY_SEP1=function(o){this.manySepFirstInternal(1,o)},c.prototype.MANY_SEP2=function(o){this.manySepFirstInternal(2,o)},c.prototype.MANY_SEP3=function(o){this.manySepFirstInternal(3,o)},c.prototype.MANY_SEP4=function(o){this.manySepFirstInternal(4,o)},c.prototype.MANY_SEP5=function(o){this.manySepFirstInternal(5,o)},c.prototype.MANY_SEP6=function(o){this.manySepFirstInternal(6,o)},c.prototype.MANY_SEP7=function(o){this.manySepFirstInternal(7,o)},c.prototype.MANY_SEP8=function(o){this.manySepFirstInternal(8,o)},c.prototype.MANY_SEP9=function(o){this.manySepFirstInternal(9,o)},c.prototype.AT_LEAST_ONE=function(o){this.atLeastOneInternal(0,o)},c.prototype.AT_LEAST_ONE1=function(o){return this.atLeastOneInternal(1,o)},c.prototype.AT_LEAST_ONE2=function(o){this.atLeastOneInternal(2,o)},c.prototype.AT_LEAST_ONE3=function(o){this.atLeastOneInternal(3,o)},c.prototype.AT_LEAST_ONE4=function(o){this.atLeastOneInternal(4,o)},c.prototype.AT_LEAST_ONE5=function(o){this.atLeastOneInternal(5,o)},c.prototype.AT_LEAST_ONE6=function(o){this.atLeastOneInternal(6,o)},c.prototype.AT_LEAST_ONE7=function(o){this.atLeastOneInternal(7,o)},c.prototype.AT_LEAST_ONE8=function(o){this.atLeastOneInternal(8,o)},c.prototype.AT_LEAST_ONE9=function(o){this.atLeastOneInternal(9,o)},c.prototype.AT_LEAST_ONE_SEP=function(o){this.atLeastOneSepFirstInternal(0,o)},c.prototype.AT_LEAST_ONE_SEP1=function(o){this.atLeastOneSepFirstInternal(1,o)},c.prototype.AT_LEAST_ONE_SEP2=function(o){this.atLeastOneSepFirstInternal(2,o)},c.prototype.AT_LEAST_ONE_SEP3=function(o){this.atLeastOneSepFirstInternal(3,o)},c.prototype.AT_LEAST_ONE_SEP4=function(o){this.atLeastOneSepFirstInternal(4,o)},c.prototype.AT_LEAST_ONE_SEP5=function(o){this.atLeastOneSepFirstInternal(5,o)},c.prototype.AT_LEAST_ONE_SEP6=function(o){this.atLeastOneSepFirstInternal(6,o)},c.prototype.AT_LEAST_ONE_SEP7=function(o){this.atLeastOneSepFirstInternal(7,o)},c.prototype.AT_LEAST_ONE_SEP8=function(o){this.atLeastOneSepFirstInternal(8,o)},c.prototype.AT_LEAST_ONE_SEP9=function(o){this.atLeastOneSepFirstInternal(9,o)},c.prototype.RULE=function(o,f,h){if(h===void 0&&(h=i.DEFAULT_RULE_CONFIG),(0,r.default)(this.definedRulesNames,o)){var d=a.defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:o,grammarName:this.className}),p={message:d,type:i.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:o};this.definitionErrors.push(p)}this.definedRulesNames.push(o);var g=this.defineRule(o,f,h);return this[o]=g,g},c.prototype.OVERRIDE_RULE=function(o,f,h){h===void 0&&(h=i.DEFAULT_RULE_CONFIG);var d=(0,s.validateRuleIsOverridden)(o,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(d);var p=this.defineRule(o,f,h);return this[o]=p,p},c.prototype.BACKTRACK=function(o,f){return function(){this.isBackTrackingStack.push(1);var h=this.saveRecogState();try{return o.apply(this,f),!0}catch(d){if((0,n.isRecognitionException)(d))return!1;throw d}finally{this.reloadRecogState(h),this.isBackTrackingStack.pop()}}},c.prototype.getGAstProductions=function(){return this.gastProductionsCache},c.prototype.getSerializedGastProductions=function(){return(0,l.serializeGrammar)((0,e.default)(this.gastProductionsCache))},c}();return xa.RecognizerApi=u,xa}var Ma={},wp;function oU(){if(wp)return Ma;wp=1;var t=Ce&&Ce.__importDefault||function(A){return A&&A.__esModule?A:{default:A}};Object.defineProperty(Ma,"__esModule",{value:!0}),Ma.RecognizerEngine=void 0;var e=t(zr),r=t(dt),n=t(Mn),i=t($l),a=t(sh),s=t(fn),l=t(Lr),u=t(Nn),c=t(Mi),o=t(Zn),f=ql,h=ir,d=ga,p=Mt,g=Rr(),m=_v(),v=xi,b=_i,C=function(){function A(){}return A.prototype.initRecognizerEngine=function(O,w){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=b.tokenStructuredMatcherNoCategories,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},(0,l.default)(w,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if((0,r.default)(O)){if((0,e.default)(O))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof O[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if((0,r.default)(O))this.tokensMap=(0,c.default)(O,function(z,Y){return z[Y.name]=Y,z},{});else if((0,l.default)(O,"modes")&&(0,i.default)((0,n.default)((0,u.default)(O.modes)),b.isTokenType)){var S=(0,n.default)((0,u.default)(O.modes)),N=(0,a.default)(S);this.tokensMap=(0,c.default)(N,function(z,Y){return z[Y.name]=Y,z},{})}else if((0,s.default)(O))this.tokensMap=(0,o.default)(O);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=v.EOF;var R=(0,l.default)(O,"modes")?(0,n.default)((0,u.default)(O.modes)):(0,u.default)(O),k=(0,i.default)(R,function(z){return(0,e.default)(z.categoryMatches)});this.tokenMatcher=k?b.tokenStructuredMatcherNoCategories:b.tokenStructuredMatcher,(0,b.augmentTokenTypes)((0,u.default)(this.tokensMap))},A.prototype.defineRule=function(O,w,S){if(this.selfAnalysisDone)throw Error("Grammar rule <".concat(O,`> may not be defined after the 'performSelfAnalysis' method has been called'
`)+"Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.");var N=(0,l.default)(S,"resyncEnabled")?S.resyncEnabled:g.DEFAULT_RULE_CONFIG.resyncEnabled,R=(0,l.default)(S,"recoveryValueFunc")?S.recoveryValueFunc:g.DEFAULT_RULE_CONFIG.recoveryValueFunc,k=this.ruleShortNameIdx<<f.BITS_FOR_METHOD_TYPE+f.BITS_FOR_OCCURRENCE_IDX;this.ruleShortNameIdx++,this.shortRuleNameToFull[k]=O,this.fullRuleNameToShort[O]=k;var z;this.outputCst===!0?z=function(){for(var Q=[],ae=0;ae<arguments.length;ae++)Q[ae]=arguments[ae];try{this.ruleInvocationStateUpdate(k,O,this.subruleIdx),w.apply(this,Q);var ve=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(ve),ve}catch(J){return this.invokeRuleCatch(J,N,R)}finally{this.ruleFinallyStateUpdate()}}:z=function(){for(var Q=[],ae=0;ae<arguments.length;ae++)Q[ae]=arguments[ae];try{return this.ruleInvocationStateUpdate(k,O,this.subruleIdx),w.apply(this,Q)}catch(ve){return this.invokeRuleCatch(ve,N,R)}finally{this.ruleFinallyStateUpdate()}};var Y=Object.assign(z,{ruleName:O,originalGrammarAction:w});return Y},A.prototype.invokeRuleCatch=function(O,w,S){var N=this.RULE_STACK.length===1,R=w&&!this.isBackTracking()&&this.recoveryEnabled;if((0,h.isRecognitionException)(O)){var k=O;if(R){var z=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(z))if(k.resyncedTokens=this.reSyncTo(z),this.outputCst){var Y=this.CST_STACK[this.CST_STACK.length-1];return Y.recoveredNode=!0,Y}else return S(O);else{if(this.outputCst){var Y=this.CST_STACK[this.CST_STACK.length-1];Y.recoveredNode=!0,k.partialCstResult=Y}throw k}}else{if(N)return this.moveToTerminatedState(),S(O);throw k}}else throw O},A.prototype.optionInternal=function(O,w){var S=this.getKeyForAutomaticLookahead(f.OPTION_IDX,w);return this.optionInternalLogic(O,w,S)},A.prototype.optionInternalLogic=function(O,w,S){var N=this,R=this.getLaFuncFromCache(S),k;if(typeof O!="function"){k=O.DEF;var z=O.GATE;if(z!==void 0){var Y=R;R=function(){return z.call(N)&&Y.call(N)}}}else k=O;if(R.call(this)===!0)return k.call(this)},A.prototype.atLeastOneInternal=function(O,w){var S=this.getKeyForAutomaticLookahead(f.AT_LEAST_ONE_IDX,O);return this.atLeastOneInternalLogic(O,w,S)},A.prototype.atLeastOneInternalLogic=function(O,w,S){var N=this,R=this.getLaFuncFromCache(S),k;if(typeof w!="function"){k=w.DEF;var z=w.GATE;if(z!==void 0){var Y=R;R=function(){return z.call(N)&&Y.call(N)}}}else k=w;if(R.call(this)===!0)for(var re=this.doSingleRepetition(k);R.call(this)===!0&&re===!0;)re=this.doSingleRepetition(k);else throw this.raiseEarlyExitException(O,d.PROD_TYPE.REPETITION_MANDATORY,w.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[O,w],R,f.AT_LEAST_ONE_IDX,O,p.NextTerminalAfterAtLeastOneWalker)},A.prototype.atLeastOneSepFirstInternal=function(O,w){var S=this.getKeyForAutomaticLookahead(f.AT_LEAST_ONE_SEP_IDX,O);this.atLeastOneSepFirstInternalLogic(O,w,S)},A.prototype.atLeastOneSepFirstInternalLogic=function(O,w,S){var N=this,R=w.DEF,k=w.SEP,z=this.getLaFuncFromCache(S);if(z.call(this)===!0){R.call(this);for(var Y=function(){return N.tokenMatcher(N.LA(1),k)};this.tokenMatcher(this.LA(1),k)===!0;)this.CONSUME(k),R.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[O,k,Y,R,p.NextTerminalAfterAtLeastOneSepWalker],Y,f.AT_LEAST_ONE_SEP_IDX,O,p.NextTerminalAfterAtLeastOneSepWalker)}else throw this.raiseEarlyExitException(O,d.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,w.ERR_MSG)},A.prototype.manyInternal=function(O,w){var S=this.getKeyForAutomaticLookahead(f.MANY_IDX,O);return this.manyInternalLogic(O,w,S)},A.prototype.manyInternalLogic=function(O,w,S){var N=this,R=this.getLaFuncFromCache(S),k;if(typeof w!="function"){k=w.DEF;var z=w.GATE;if(z!==void 0){var Y=R;R=function(){return z.call(N)&&Y.call(N)}}}else k=w;for(var re=!0;R.call(this)===!0&&re===!0;)re=this.doSingleRepetition(k);this.attemptInRepetitionRecovery(this.manyInternal,[O,w],R,f.MANY_IDX,O,p.NextTerminalAfterManyWalker,re)},A.prototype.manySepFirstInternal=function(O,w){var S=this.getKeyForAutomaticLookahead(f.MANY_SEP_IDX,O);this.manySepFirstInternalLogic(O,w,S)},A.prototype.manySepFirstInternalLogic=function(O,w,S){var N=this,R=w.DEF,k=w.SEP,z=this.getLaFuncFromCache(S);if(z.call(this)===!0){R.call(this);for(var Y=function(){return N.tokenMatcher(N.LA(1),k)};this.tokenMatcher(this.LA(1),k)===!0;)this.CONSUME(k),R.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[O,k,Y,R,p.NextTerminalAfterManySepWalker],Y,f.MANY_SEP_IDX,O,p.NextTerminalAfterManySepWalker)}},A.prototype.repetitionSepSecondInternal=function(O,w,S,N,R){for(;S();)this.CONSUME(w),N.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[O,w,S,N,R],S,f.AT_LEAST_ONE_SEP_IDX,O,R)},A.prototype.doSingleRepetition=function(O){var w=this.getLexerPosition();O.call(this);var S=this.getLexerPosition();return S>w},A.prototype.orInternal=function(O,w){var S=this.getKeyForAutomaticLookahead(f.OR_IDX,w),N=(0,r.default)(O)?O:O.DEF,R=this.getLaFuncFromCache(S),k=R.call(this,N);if(k!==void 0){var z=N[k];return z.ALT.call(this)}this.raiseNoAltException(w,O.ERR_MSG)},A.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){var O=this.LA(1),w=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:O,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new h.NotAllInputParsedException(w,O))}},A.prototype.subruleInternal=function(O,w,S){var N;try{var R=S!==void 0?S.ARGS:void 0;return this.subruleIdx=w,N=O.apply(this,R),this.cstPostNonTerminal(N,S!==void 0&&S.LABEL!==void 0?S.LABEL:O.ruleName),N}catch(k){throw this.subruleInternalError(k,S,O.ruleName)}},A.prototype.subruleInternalError=function(O,w,S){throw(0,h.isRecognitionException)(O)&&O.partialCstResult!==void 0&&(this.cstPostNonTerminal(O.partialCstResult,w!==void 0&&w.LABEL!==void 0?w.LABEL:S),delete O.partialCstResult),O},A.prototype.consumeInternal=function(O,w,S){var N;try{var R=this.LA(1);this.tokenMatcher(R,O)===!0?(this.consumeToken(),N=R):this.consumeInternalError(O,R,S)}catch(k){N=this.consumeInternalRecovery(O,w,k)}return this.cstPostTerminal(S!==void 0&&S.LABEL!==void 0?S.LABEL:O.name,N),N},A.prototype.consumeInternalError=function(O,w,S){var N,R=this.LA(0);throw S!==void 0&&S.ERR_MSG?N=S.ERR_MSG:N=this.errorMessageProvider.buildMismatchTokenMessage({expected:O,actual:w,previous:R,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new h.MismatchedTokenException(N,w,R))},A.prototype.consumeInternalRecovery=function(O,w,S){if(this.recoveryEnabled&&S.name==="MismatchedTokenException"&&!this.isBackTracking()){var N=this.getFollowsForInRuleRecovery(O,w);try{return this.tryInRuleRecovery(O,N)}catch(R){throw R.name===m.IN_RULE_RECOVERY_EXCEPTION?S:R}}else throw S},A.prototype.saveRecogState=function(){var O=this.errors,w=(0,o.default)(this.RULE_STACK);return{errors:O,lexerState:this.exportLexerState(),RULE_STACK:w,CST_STACK:this.CST_STACK}},A.prototype.reloadRecogState=function(O){this.errors=O.errors,this.importLexerState(O.lexerState),this.RULE_STACK=O.RULE_STACK},A.prototype.ruleInvocationStateUpdate=function(O,w,S){this.RULE_OCCURRENCE_STACK.push(S),this.RULE_STACK.push(O),this.cstInvocationStateUpdate(w)},A.prototype.isBackTracking=function(){return this.isBackTrackingStack.length!==0},A.prototype.getCurrRuleFullName=function(){var O=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[O]},A.prototype.shortRuleNameToFullName=function(O){return this.shortRuleNameToFull[O]},A.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),v.EOF)},A.prototype.reset=function(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},A}();return Ma.RecognizerEngine=C,Ma}var _a={},Sp;function lU(){if(Sp)return _a;Sp=1;var t=Ce&&Ce.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(_a,"__esModule",{value:!0}),_a.ErrorHandler=void 0;var e=ir,r=t(Lr),n=t(Zn),i=ga,a=Rr(),s=function(){function l(){}return l.prototype.initErrorHandler=function(u){this._errors=[],this.errorMessageProvider=(0,r.default)(u,"errorMessageProvider")?u.errorMessageProvider:a.DEFAULT_PARSER_CONFIG.errorMessageProvider},l.prototype.SAVE_ERROR=function(u){if((0,e.isRecognitionException)(u))return u.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:(0,n.default)(this.RULE_OCCURRENCE_STACK)},this._errors.push(u),u;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(l.prototype,"errors",{get:function(){return(0,n.default)(this._errors)},set:function(u){this._errors=u},enumerable:!1,configurable:!0}),l.prototype.raiseEarlyExitException=function(u,c,o){for(var f=this.getCurrRuleFullName(),h=this.getGAstProductions()[f],d=(0,i.getLookaheadPathsForOptionalProd)(u,h,c,this.maxLookahead),p=d[0],g=[],m=1;m<=this.maxLookahead;m++)g.push(this.LA(m));var v=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:p,actual:g,previous:this.LA(0),customUserDescription:o,ruleName:f});throw this.SAVE_ERROR(new e.EarlyExitException(v,this.LA(1),this.LA(0)))},l.prototype.raiseNoAltException=function(u,c){for(var o=this.getCurrRuleFullName(),f=this.getGAstProductions()[o],h=(0,i.getLookaheadPathsForOr)(u,f,this.maxLookahead),d=[],p=1;p<=this.maxLookahead;p++)d.push(this.LA(p));var g=this.LA(0),m=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:h,actual:d,previous:g,customUserDescription:c,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new e.NoViableAltException(m,this.LA(1),g))},l}();return _a.ErrorHandler=s,_a}var Xl={},Iv=Ce&&Ce.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Xl,"__esModule",{value:!0});Xl.ContentAssist=void 0;var Tp=Mt,cU=Iv(Rs),uU=Iv(da),fU=function(){function t(){}return t.prototype.initContentAssist=function(){},t.prototype.computeContentAssist=function(e,r){var n=this.gastProductionsCache[e];if((0,uU.default)(n))throw Error("Rule ->".concat(e,"<- does not exist in this grammar."));return(0,Tp.nextPossibleTokensAfter)([n],r,this.tokenMatcher,this.maxLookahead)},t.prototype.getNextPossibleTokenTypes=function(e){var r=(0,cU.default)(e.ruleStack),n=this.getGAstProductions(),i=n[r],a=new Tp.NextAfterTokenWalker(i,e).startWalking();return a},t}();Xl.ContentAssist=fU;var ka={},Rp;function hU(){if(Rp)return ka;Rp=1;var t=Ce&&Ce.__importDefault||function(N){return N&&N.__esModule?N:{default:N}};Object.defineProperty(ka,"__esModule",{value:!0}),ka.GastRecorder=void 0;var e=t(dh),r=t(dt),n=t(th),i=t(lr),a=t(vs),s=t(Lr),l=Ut,u=Wl(),c=_i,o=xi,f=Rr(),h=ql,d={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(d);var p=!0,g=Math.pow(2,h.BITS_FOR_OCCURRENCE_IDX)-1,m=(0,o.createToken)({name:"RECORDING_PHASE_TOKEN",pattern:u.Lexer.NA});(0,c.augmentTokenTypes)([m]);var v=(0,o.createTokenInstance)(m,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(v);var b={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}},C=function(){function N(){}return N.prototype.initGastRecorder=function(R){this.recordingProdStack=[],this.RECORDING_PHASE=!1},N.prototype.enableRecording=function(){var R=this;this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",function(){for(var k=function(Y){var re=Y>0?Y:"";R["CONSUME".concat(re)]=function(Q,ae){return this.consumeInternalRecord(Q,Y,ae)},R["SUBRULE".concat(re)]=function(Q,ae){return this.subruleInternalRecord(Q,Y,ae)},R["OPTION".concat(re)]=function(Q){return this.optionInternalRecord(Q,Y)},R["OR".concat(re)]=function(Q){return this.orInternalRecord(Q,Y)},R["MANY".concat(re)]=function(Q){this.manyInternalRecord(Y,Q)},R["MANY_SEP".concat(re)]=function(Q){this.manySepFirstInternalRecord(Y,Q)},R["AT_LEAST_ONE".concat(re)]=function(Q){this.atLeastOneInternalRecord(Y,Q)},R["AT_LEAST_ONE_SEP".concat(re)]=function(Q){this.atLeastOneSepFirstInternalRecord(Y,Q)}},z=0;z<10;z++)k(z);R.consume=function(Y,re,Q){return this.consumeInternalRecord(re,Y,Q)},R.subrule=function(Y,re,Q){return this.subruleInternalRecord(re,Y,Q)},R.option=function(Y,re){return this.optionInternalRecord(re,Y)},R.or=function(Y,re){return this.orInternalRecord(re,Y)},R.many=function(Y,re){this.manyInternalRecord(Y,re)},R.atLeastOne=function(Y,re){this.atLeastOneInternalRecord(Y,re)},R.ACTION=R.ACTION_RECORD,R.BACKTRACK=R.BACKTRACK_RECORD,R.LA=R.LA_RECORD})},N.prototype.disableRecording=function(){var R=this;this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",function(){for(var k=R,z=0;z<10;z++){var Y=z>0?z:"";delete k["CONSUME".concat(Y)],delete k["SUBRULE".concat(Y)],delete k["OPTION".concat(Y)],delete k["OR".concat(Y)],delete k["MANY".concat(Y)],delete k["MANY_SEP".concat(Y)],delete k["AT_LEAST_ONE".concat(Y)],delete k["AT_LEAST_ONE_SEP".concat(Y)]}delete k.consume,delete k.subrule,delete k.option,delete k.or,delete k.many,delete k.atLeastOne,delete k.ACTION,delete k.BACKTRACK,delete k.LA})},N.prototype.ACTION_RECORD=function(R){},N.prototype.BACKTRACK_RECORD=function(R,k){return function(){return!0}},N.prototype.LA_RECORD=function(R){return f.END_OF_FILE},N.prototype.topLevelRuleRecord=function(R,k){try{var z=new l.Rule({definition:[],name:R});return z.name=R,this.recordingProdStack.push(z),k.call(this),this.recordingProdStack.pop(),z}catch(Y){if(Y.KNOWN_RECORDER_ERROR!==!0)try{Y.message=Y.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw Y}throw Y}},N.prototype.optionInternalRecord=function(R,k){return A.call(this,l.Option,R,k)},N.prototype.atLeastOneInternalRecord=function(R,k){A.call(this,l.RepetitionMandatory,k,R)},N.prototype.atLeastOneSepFirstInternalRecord=function(R,k){A.call(this,l.RepetitionMandatoryWithSeparator,k,R,p)},N.prototype.manyInternalRecord=function(R,k){A.call(this,l.Repetition,k,R)},N.prototype.manySepFirstInternalRecord=function(R,k){A.call(this,l.RepetitionWithSeparator,k,R,p)},N.prototype.orInternalRecord=function(R,k){return O.call(this,R,k)},N.prototype.subruleInternalRecord=function(R,k,z){if(S(k),!R||(0,s.default)(R,"ruleName")===!1){var Y=new Error("<SUBRULE".concat(w(k),"> argument is invalid")+" expecting a Parser method reference but got: <".concat(JSON.stringify(R),">")+`
 inside top level rule: <`.concat(this.recordingProdStack[0].name,">"));throw Y.KNOWN_RECORDER_ERROR=!0,Y}var re=(0,e.default)(this.recordingProdStack),Q=R.ruleName,ae=new l.NonTerminal({idx:k,nonTerminalName:Q,label:z==null?void 0:z.LABEL,referencedRule:void 0});return re.definition.push(ae),this.outputCst?b:d},N.prototype.consumeInternalRecord=function(R,k,z){if(S(k),!(0,c.hasShortKeyProperty)(R)){var Y=new Error("<CONSUME".concat(w(k),"> argument is invalid")+" expecting a TokenType reference but got: <".concat(JSON.stringify(R),">")+`
 inside top level rule: <`.concat(this.recordingProdStack[0].name,">"));throw Y.KNOWN_RECORDER_ERROR=!0,Y}var re=(0,e.default)(this.recordingProdStack),Q=new l.Terminal({idx:k,terminalType:R,label:z==null?void 0:z.LABEL});return re.definition.push(Q),v},N}();ka.GastRecorder=C;function A(N,R,k,z){z===void 0&&(z=!1),S(k);var Y=(0,e.default)(this.recordingProdStack),re=(0,a.default)(R)?R:R.DEF,Q=new N({definition:[],idx:k});return z&&(Q.separator=R.SEP),(0,s.default)(R,"MAX_LOOKAHEAD")&&(Q.maxLookahead=R.MAX_LOOKAHEAD),this.recordingProdStack.push(Q),re.call(this),Y.definition.push(Q),this.recordingProdStack.pop(),d}function O(N,R){var k=this;S(R);var z=(0,e.default)(this.recordingProdStack),Y=(0,r.default)(N)===!1,re=Y===!1?N:N.DEF,Q=new l.Alternation({definition:[],idx:R,ignoreAmbiguities:Y&&N.IGNORE_AMBIGUITIES===!0});(0,s.default)(N,"MAX_LOOKAHEAD")&&(Q.maxLookahead=N.MAX_LOOKAHEAD);var ae=(0,n.default)(re,function(ve){return(0,a.default)(ve.GATE)});return Q.hasPredicates=ae,z.definition.push(Q),(0,i.default)(re,function(ve){var J=new l.Alternative({definition:[]});Q.definition.push(J),(0,s.default)(ve,"IGNORE_AMBIGUITIES")?J.ignoreAmbiguities=ve.IGNORE_AMBIGUITIES:(0,s.default)(ve,"GATE")&&(J.ignoreAmbiguities=!0),k.recordingProdStack.push(J),ve.ALT.call(k),k.recordingProdStack.pop()}),d}function w(N){return N===0?"":"".concat(N)}function S(N){if(N<0||N>g){var R=new Error("Invalid DSL Method idx value: <".concat(N,`>
	`)+"Idx value must be a none negative value smaller than ".concat(g+1));throw R.KNOWN_RECORDER_ERROR=!0,R}}return ka}var Pa={},Np;function dU(){if(Np)return Pa;Np=1;var t=Ce&&Ce.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Pa,"__esModule",{value:!0}),Pa.PerformanceTracer=void 0;var e=t(Lr),r=ua,n=Rr(),i=function(){function a(){}return a.prototype.initPerformanceTracer=function(s){if((0,e.default)(s,"traceInitPerf")){var l=s.traceInitPerf,u=typeof l=="number";this.traceInitMaxIdent=u?l:1/0,this.traceInitPerf=u?l>0:l}else this.traceInitMaxIdent=0,this.traceInitPerf=n.DEFAULT_PARSER_CONFIG.traceInitPerf;this.traceInitIndent=-1},a.prototype.TRACE_INIT=function(s,l){if(this.traceInitPerf===!0){this.traceInitIndent++;var u=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log("".concat(u,"--> <").concat(s,">"));var c=(0,r.timer)(l),o=c.time,f=c.value,h=o>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&h("".concat(u,"<-- <").concat(s,"> time: ").concat(o,"ms")),this.traceInitIndent--,f}else return l()},a}();return Pa.PerformanceTracer=i,Pa}var Ql={};Object.defineProperty(Ql,"__esModule",{value:!0});Ql.applyMixins=void 0;function pU(t,e){e.forEach(function(r){var n=r.prototype;Object.getOwnPropertyNames(n).forEach(function(i){if(i!=="constructor"){var a=Object.getOwnPropertyDescriptor(n,i);a&&(a.get||a.set)?Object.defineProperty(t.prototype,i,a):t.prototype[i]=r.prototype[i]}})})}Ql.applyMixins=pU;var xp;function Rr(){return xp||(xp=1,function(t){var e=Ce&&Ce.__extends||function(){var Q=function(ae,ve){return Q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(J,ne){J.__proto__=ne}||function(J,ne){for(var se in ne)Object.prototype.hasOwnProperty.call(ne,se)&&(J[se]=ne[se])},Q(ae,ve)};return function(ae,ve){if(typeof ve!="function"&&ve!==null)throw new TypeError("Class extends value "+String(ve)+" is not a constructor or null");Q(ae,ve);function J(){this.constructor=ae}ae.prototype=ve===null?Object.create(ve):(J.prototype=ve.prototype,new J)}}(),r=Ce&&Ce.__importDefault||function(Q){return Q&&Q.__esModule?Q:{default:Q}};Object.defineProperty(t,"__esModule",{value:!0}),t.EmbeddedActionsParser=t.CstParser=t.Parser=t.EMPTY_ALT=t.ParserDefinitionErrorType=t.DEFAULT_RULE_CONFIG=t.DEFAULT_PARSER_CONFIG=t.END_OF_FILE=void 0;var n=r(zr),i=r(br),a=r(lr),s=r(Nn),l=r(Lr),u=r(Zn),c=ua,o=rn,f=xi,h=pa,d=HB(),p=_v(),g=jB(),m=iU(),v=aU(),b=sU(),C=oU(),A=lU(),O=Xl,w=hU(),S=dU(),N=Ql,R=Gl();t.END_OF_FILE=(0,f.createTokenInstance)(f.EOF,"",NaN,NaN,NaN,NaN,NaN,NaN),Object.freeze(t.END_OF_FILE),t.DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:h.defaultParserErrorProvider,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),t.DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),function(Q){Q[Q.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",Q[Q.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",Q[Q.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",Q[Q.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",Q[Q.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",Q[Q.LEFT_RECURSION=5]="LEFT_RECURSION",Q[Q.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",Q[Q.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",Q[Q.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",Q[Q.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",Q[Q.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",Q[Q.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",Q[Q.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",Q[Q.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"}(t.ParserDefinitionErrorType||(t.ParserDefinitionErrorType={}));function k(Q){return Q===void 0&&(Q=void 0),function(){return Q}}t.EMPTY_ALT=k;var z=function(){function Q(ae,ve){this.definitionErrors=[],this.selfAnalysisDone=!1;var J=this;if(J.initErrorHandler(ve),J.initLexerAdapter(),J.initLooksAhead(ve),J.initRecognizerEngine(ae,ve),J.initRecoverable(ve),J.initTreeBuilder(ve),J.initContentAssist(),J.initGastRecorder(ve),J.initPerformanceTracer(ve),(0,l.default)(ve,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=(0,l.default)(ve,"skipValidations")?ve.skipValidations:t.DEFAULT_PARSER_CONFIG.skipValidations}return Q.performSelfAnalysis=function(ae){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")},Q.prototype.performSelfAnalysis=function(){var ae=this;this.TRACE_INIT("performSelfAnalysis",function(){var ve;ae.selfAnalysisDone=!0;var J=ae.className;ae.TRACE_INIT("toFastProps",function(){(0,c.toFastProperties)(ae)}),ae.TRACE_INIT("Grammar Recording",function(){try{ae.enableRecording(),(0,a.default)(ae.definedRulesNames,function(se){var de=ae[se],be=de.originalGrammarAction,Ae;ae.TRACE_INIT("".concat(se," Rule"),function(){Ae=ae.topLevelRuleRecord(se,be)}),ae.gastProductionsCache[se]=Ae})}finally{ae.disableRecording()}});var ne=[];if(ae.TRACE_INIT("Grammar Resolving",function(){ne=(0,d.resolveGrammar)({rules:(0,s.default)(ae.gastProductionsCache)}),ae.definitionErrors=ae.definitionErrors.concat(ne)}),ae.TRACE_INIT("Grammar Validations",function(){if((0,n.default)(ne)&&ae.skipValidations===!1){var se=(0,d.validateGrammar)({rules:(0,s.default)(ae.gastProductionsCache),tokenTypes:(0,s.default)(ae.tokensMap),errMsgProvider:h.defaultGrammarValidatorErrorProvider,grammarName:J}),de=(0,R.validateLookahead)({lookaheadStrategy:ae.lookaheadStrategy,rules:(0,s.default)(ae.gastProductionsCache),tokenTypes:(0,s.default)(ae.tokensMap),grammarName:J});ae.definitionErrors=ae.definitionErrors.concat(se,de)}}),(0,n.default)(ae.definitionErrors)&&(ae.recoveryEnabled&&ae.TRACE_INIT("computeAllProdsFollows",function(){var se=(0,o.computeAllProdsFollows)((0,s.default)(ae.gastProductionsCache));ae.resyncFollows=se}),ae.TRACE_INIT("ComputeLookaheadFunctions",function(){var se,de;(de=(se=ae.lookaheadStrategy).initialize)===null||de===void 0||de.call(se,{rules:(0,s.default)(ae.gastProductionsCache)}),ae.preComputeLookaheadFunctions((0,s.default)(ae.gastProductionsCache))})),!Q.DEFER_DEFINITION_ERRORS_HANDLING&&!(0,n.default)(ae.definitionErrors))throw ve=(0,i.default)(ae.definitionErrors,function(se){return se.message}),new Error(`Parser Definition Errors detected:
 `.concat(ve.join(`
-------------------------------
`)))})},Q.DEFER_DEFINITION_ERRORS_HANDLING=!1,Q}();t.Parser=z,(0,N.applyMixins)(z,[p.Recoverable,g.LooksAhead,m.TreeBuilder,v.LexerAdapter,C.RecognizerEngine,b.RecognizerApi,A.ErrorHandler,O.ContentAssist,w.GastRecorder,S.PerformanceTracer]);var Y=function(Q){e(ae,Q);function ae(ve,J){J===void 0&&(J=t.DEFAULT_PARSER_CONFIG);var ne=(0,u.default)(J);return ne.outputCst=!0,Q.call(this,ve,ne)||this}return ae}(z);t.CstParser=Y;var re=function(Q){e(ae,Q);function ae(ve,J){J===void 0&&(J=t.DEFAULT_PARSER_CONFIG);var ne=(0,u.default)(J);return ne.outputCst=!1,Q.call(this,ve,ne)||this}return ae}(z);t.EmbeddedActionsParser=re}(xc)),xc}var Kl={},jl={},gU=Ce&&Ce.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),ma=Ce&&Ce.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(jl,"__esModule",{value:!0});jl.buildModel=void 0;var Dv=Ut,Va=ma(br),mU=ma(Mn),vU=ma(Nn),yU=ma(th),bU=ma(Ov),EU=ma(Bl);function OU(t){var e=new AU,r=(0,vU.default)(t);return(0,Va.default)(r,function(n){return e.visitRule(n)})}jl.buildModel=OU;var AU=function(t){gU(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.visitRule=function(r){var n=this.visitEach(r.definition),i=(0,bU.default)(n,function(s){return s.propertyName}),a=(0,Va.default)(i,function(s,l){var u=!(0,yU.default)(s,function(o){return!o.canBeNull}),c=s[0].type;return s.length>1&&(c=(0,Va.default)(s,function(o){return o.type})),{name:l,type:c,optional:u}});return{name:r.name,properties:a}},e.prototype.visitAlternative=function(r){return this.visitEachAndOverrideWith(r.definition,{canBeNull:!0})},e.prototype.visitOption=function(r){return this.visitEachAndOverrideWith(r.definition,{canBeNull:!0})},e.prototype.visitRepetition=function(r){return this.visitEachAndOverrideWith(r.definition,{canBeNull:!0})},e.prototype.visitRepetitionMandatory=function(r){return this.visitEach(r.definition)},e.prototype.visitRepetitionMandatoryWithSeparator=function(r){return this.visitEach(r.definition).concat({propertyName:r.separator.name,canBeNull:!0,type:Ys(r.separator)})},e.prototype.visitRepetitionWithSeparator=function(r){return this.visitEachAndOverrideWith(r.definition,{canBeNull:!0}).concat({propertyName:r.separator.name,canBeNull:!0,type:Ys(r.separator)})},e.prototype.visitAlternation=function(r){return this.visitEachAndOverrideWith(r.definition,{canBeNull:!0})},e.prototype.visitTerminal=function(r){return[{propertyName:r.label||r.terminalType.name,canBeNull:!1,type:Ys(r)}]},e.prototype.visitNonTerminal=function(r){return[{propertyName:r.label||r.nonTerminalName,canBeNull:!1,type:Ys(r)}]},e.prototype.visitEachAndOverrideWith=function(r,n){return(0,Va.default)(this.visitEach(r),function(i){return(0,EU.default)({},i,n)})},e.prototype.visitEach=function(r){var n=this;return(0,mU.default)((0,Va.default)(r,function(i){return n.visit(i)}))},e}(Dv.GAstVisitor);function Ys(t){return t instanceof Dv.NonTerminal?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}var Zl={},CU=Zf;function wU(t,e,r){var n=t.length;return r=r===void 0?n:r,!e&&r>=n?t:CU(t,e,r)}var SU=wU,TU="\\ud800-\\udfff",RU="\\u0300-\\u036f",NU="\\ufe20-\\ufe2f",xU="\\u20d0-\\u20ff",MU=RU+NU+xU,_U="\\ufe0e\\ufe0f",kU="\\u200d",PU=RegExp("["+kU+TU+MU+_U+"]");function IU(t){return PU.test(t)}var Lv=IU;function DU(t){return t.split("")}var LU=DU,Bv="\\ud800-\\udfff",BU="\\u0300-\\u036f",UU="\\ufe20-\\ufe2f",$U="\\u20d0-\\u20ff",FU=BU+UU+$U,VU="\\ufe0e\\ufe0f",WU="["+Bv+"]",xu="["+FU+"]",Mu="\\ud83c[\\udffb-\\udfff]",HU="(?:"+xu+"|"+Mu+")",Uv="[^"+Bv+"]",$v="(?:\\ud83c[\\udde6-\\uddff]){2}",Fv="[\\ud800-\\udbff][\\udc00-\\udfff]",GU="\\u200d",Vv=HU+"?",Wv="["+VU+"]?",zU="(?:"+GU+"(?:"+[Uv,$v,Fv].join("|")+")"+Wv+Vv+")*",qU=Wv+Vv+zU,YU="(?:"+[Uv+xu+"?",xu,$v,Fv,WU].join("|")+")",XU=RegExp(Mu+"(?="+Mu+")|"+YU+qU,"g");function QU(t){return t.match(XU)||[]}var KU=QU,jU=LU,ZU=Lv,JU=KU;function e$(t){return ZU(t)?JU(t):jU(t)}var t$=e$,r$=SU,n$=Lv,i$=t$,a$=D0;function s$(t){return function(e){e=a$(e);var r=n$(e)?i$(e):void 0,n=r?r[0]:e.charAt(0),i=r?r$(r,1).join(""):e.slice(1);return n[t]()+i}}var o$=s$,l$=o$,c$=l$("toUpperCase"),u$=c$,va=Ce&&Ce.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Zl,"__esModule",{value:!0});Zl.genDts=void 0;var f$=va(Mn),h$=va(dt),Jl=va(br),d$=va(Mi),p$=va(sh),Hv=va(u$);function g$(t,e){var r=[];return r=r.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),r=r.concat((0,f$.default)((0,Jl.default)(t,function(n){return m$(n)}))),e.includeVisitorInterface&&(r=r.concat(E$(e.visitorInterfaceName,t))),r.join(`

`)+`
`}Zl.genDts=g$;function m$(t){var e=v$(t),r=y$(t);return[e,r]}function v$(t){var e=Gv(t.name),r=gh(t.name);return"export interface ".concat(e,` extends CstNode {
  name: "`).concat(t.name,`";
  children: `).concat(r,`;
}`)}function y$(t){var e=gh(t.name);return"export type ".concat(e,` = {
  `).concat((0,Jl.default)(t.properties,function(r){return b$(r)}).join(`
  `),`
};`)}function b$(t){var e=A$(t.type);return"".concat(t.name).concat(t.optional?"?":"",": ").concat(e,"[];")}function E$(t,e){return"export interface ".concat(t,`<IN, OUT> extends ICstVisitor<IN, OUT> {
  `).concat((0,Jl.default)(e,function(r){return O$(r)}).join(`
  `),`
}`)}function O$(t){var e=gh(t.name);return"".concat(t.name,"(children: ").concat(e,", param?: IN): OUT;")}function A$(t){if((0,h$.default)(t)){var e=(0,p$.default)((0,Jl.default)(t,function(n){return Mp(n)})),r=(0,d$.default)(e,function(n,i){return n+" | "+i});return"("+r+")"}else return Mp(t)}function Mp(t){return t.kind==="token"?"IToken":Gv(t.name)}function Gv(t){return(0,Hv.default)(t)+"CstNode"}function gh(t){return(0,Hv.default)(t)+"CstChildren"}var Go=Ce&&Ce.__assign||function(){return Go=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Go.apply(this,arguments)};Object.defineProperty(Kl,"__esModule",{value:!0});Kl.generateCstDts=void 0;var C$=jl,w$=Zl,S$={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function T$(t,e){var r=Go(Go({},S$),e),n=(0,C$.buildModel)(t);return(0,w$.genDts)(n,r)}Kl.generateCstDts=T$;var ec={};Object.defineProperty(ec,"__esModule",{value:!0});ec.createSyntaxDiagramsCode=void 0;var _p=gs;function R$(t,e){var r=e===void 0?{}:e,n=r.resourceBase,i=n===void 0?"https://unpkg.com/chevrotain@".concat(_p.VERSION,"/diagrams/"):n,a=r.css,s=a===void 0?"https://unpkg.com/chevrotain@".concat(_p.VERSION,"/diagrams/diagrams.css"):a,l=`
<!-- This is a generated file -->
<!DOCTYPE html>
<meta charset="utf-8">
<style>
  body {
    background-color: hsl(30, 20%, 95%)
  }
</style>

`,u=`
<link rel='stylesheet' href='`.concat(s,`'>
`),c=`
<script src='`.concat(i,`vendor/railroad-diagrams.js'><\/script>
<script src='`).concat(i,`src/diagrams_builder.js'><\/script>
<script src='`).concat(i,`src/diagrams_behavior.js'><\/script>
<script src='`).concat(i,`src/main.js'><\/script>
`),o=`
<div id="diagrams" align="center"></div>    
`,f=`
<script>
    window.serializedGrammar = `.concat(JSON.stringify(t,null,"  "),`;
<\/script>
`),h=`
<script>
    var diagramsDiv = document.getElementById("diagrams");
    main.drawDiagramsFromSerializedGrammar(serializedGrammar, diagramsDiv);
<\/script>
`;return l+u+c+o+f+h}ec.createSyntaxDiagramsCode=R$;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=t.createSyntaxDiagramsCode=t.clearCache=t.generateCstDts=t.GAstVisitor=t.serializeProduction=t.serializeGrammar=t.Terminal=t.Rule=t.RepetitionWithSeparator=t.RepetitionMandatoryWithSeparator=t.RepetitionMandatory=t.Repetition=t.Option=t.NonTerminal=t.Alternative=t.Alternation=t.defaultLexerErrorProvider=t.NoViableAltException=t.NotAllInputParsedException=t.MismatchedTokenException=t.isRecognitionException=t.EarlyExitException=t.defaultParserErrorProvider=t.LLkLookaheadStrategy=t.getLookaheadPaths=t.tokenName=t.tokenMatcher=t.tokenLabel=t.EOF=t.createTokenInstance=t.createToken=t.LexerDefinitionErrorType=t.Lexer=t.EMPTY_ALT=t.ParserDefinitionErrorType=t.EmbeddedActionsParser=t.CstParser=t.VERSION=void 0;var e=gs;Object.defineProperty(t,"VERSION",{enumerable:!0,get:function(){return e.VERSION}});var r=Rr();Object.defineProperty(t,"CstParser",{enumerable:!0,get:function(){return r.CstParser}}),Object.defineProperty(t,"EmbeddedActionsParser",{enumerable:!0,get:function(){return r.EmbeddedActionsParser}}),Object.defineProperty(t,"ParserDefinitionErrorType",{enumerable:!0,get:function(){return r.ParserDefinitionErrorType}}),Object.defineProperty(t,"EMPTY_ALT",{enumerable:!0,get:function(){return r.EMPTY_ALT}});var n=Wl();Object.defineProperty(t,"Lexer",{enumerable:!0,get:function(){return n.Lexer}}),Object.defineProperty(t,"LexerDefinitionErrorType",{enumerable:!0,get:function(){return n.LexerDefinitionErrorType}});var i=xi;Object.defineProperty(t,"createToken",{enumerable:!0,get:function(){return i.createToken}}),Object.defineProperty(t,"createTokenInstance",{enumerable:!0,get:function(){return i.createTokenInstance}}),Object.defineProperty(t,"EOF",{enumerable:!0,get:function(){return i.EOF}}),Object.defineProperty(t,"tokenLabel",{enumerable:!0,get:function(){return i.tokenLabel}}),Object.defineProperty(t,"tokenMatcher",{enumerable:!0,get:function(){return i.tokenMatcher}}),Object.defineProperty(t,"tokenName",{enumerable:!0,get:function(){return i.tokenName}});var a=ga;Object.defineProperty(t,"getLookaheadPaths",{enumerable:!0,get:function(){return a.getLookaheadPaths}});var s=kv();Object.defineProperty(t,"LLkLookaheadStrategy",{enumerable:!0,get:function(){return s.LLkLookaheadStrategy}});var l=pa;Object.defineProperty(t,"defaultParserErrorProvider",{enumerable:!0,get:function(){return l.defaultParserErrorProvider}});var u=ir;Object.defineProperty(t,"EarlyExitException",{enumerable:!0,get:function(){return u.EarlyExitException}}),Object.defineProperty(t,"isRecognitionException",{enumerable:!0,get:function(){return u.isRecognitionException}}),Object.defineProperty(t,"MismatchedTokenException",{enumerable:!0,get:function(){return u.MismatchedTokenException}}),Object.defineProperty(t,"NotAllInputParsedException",{enumerable:!0,get:function(){return u.NotAllInputParsedException}}),Object.defineProperty(t,"NoViableAltException",{enumerable:!0,get:function(){return u.NoViableAltException}});var c=Ns;Object.defineProperty(t,"defaultLexerErrorProvider",{enumerable:!0,get:function(){return c.defaultLexerErrorProvider}});var o=Ut;Object.defineProperty(t,"Alternation",{enumerable:!0,get:function(){return o.Alternation}}),Object.defineProperty(t,"Alternative",{enumerable:!0,get:function(){return o.Alternative}}),Object.defineProperty(t,"NonTerminal",{enumerable:!0,get:function(){return o.NonTerminal}}),Object.defineProperty(t,"Option",{enumerable:!0,get:function(){return o.Option}}),Object.defineProperty(t,"Repetition",{enumerable:!0,get:function(){return o.Repetition}}),Object.defineProperty(t,"RepetitionMandatory",{enumerable:!0,get:function(){return o.RepetitionMandatory}}),Object.defineProperty(t,"RepetitionMandatoryWithSeparator",{enumerable:!0,get:function(){return o.RepetitionMandatoryWithSeparator}}),Object.defineProperty(t,"RepetitionWithSeparator",{enumerable:!0,get:function(){return o.RepetitionWithSeparator}}),Object.defineProperty(t,"Rule",{enumerable:!0,get:function(){return o.Rule}}),Object.defineProperty(t,"Terminal",{enumerable:!0,get:function(){return o.Terminal}});var f=Ut;Object.defineProperty(t,"serializeGrammar",{enumerable:!0,get:function(){return f.serializeGrammar}}),Object.defineProperty(t,"serializeProduction",{enumerable:!0,get:function(){return f.serializeProduction}}),Object.defineProperty(t,"GAstVisitor",{enumerable:!0,get:function(){return f.GAstVisitor}});var h=Kl;Object.defineProperty(t,"generateCstDts",{enumerable:!0,get:function(){return h.generateCstDts}});function d(){console.warn(`The clearCache function was 'soft' removed from the Chevrotain API.
	 It performs no action other than printing this message.
	 Please avoid using it as it will be completely removed in the future`)}t.clearCache=d;var p=ec;Object.defineProperty(t,"createSyntaxDiagramsCode",{enumerable:!0,get:function(){return p.createSyntaxDiagramsCode}});var g=function(){function m(){throw new Error(`The Parser class has been deprecated, use CstParser or EmbeddedActionsParser instead.	
See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_7-0-0`)}return m}();t.Parser=g})(d0);const Je=Df(d0);Je.Alternation;Je.Alternative;Je.CstParser;Je.EMPTY_ALT;Je.EOF;Je.EarlyExitException;const N$=Je.EmbeddedActionsParser;Je.GAstVisitor;Je.LLkLookaheadStrategy;const zv=Je.Lexer;Je.LexerDefinitionErrorType;Je.MismatchedTokenException;Je.NoViableAltException;Je.NonTerminal;const x$=Je.NotAllInputParsedException;Je.Option;Je.Parser;Je.ParserDefinitionErrorType;Je.Repetition;Je.RepetitionMandatory;Je.RepetitionMandatoryWithSeparator;Je.RepetitionWithSeparator;Je.Rule;Je.Terminal;Je.VERSION;Je.clearCache;Je.createSyntaxDiagramsCode;const et=Je.createToken;Je.createTokenInstance;Je.defaultLexerErrorProvider;Je.defaultParserErrorProvider;Je.generateCstDts;Je.getLookaheadPaths;Je.isRecognitionException;Je.serializeGrammar;Je.serializeProduction;Je.tokenLabel;Je.tokenMatcher;Je.tokenName;const mh={},M$=et({name:"WhiteSpace",pattern:/\s+/,group:zv.SKIPPED}),_$=et({name:"String",pattern:/"(""|[^"])*"/}),k$=et({name:"SingleQuotedString",pattern:/'(''|[^'])*'/}),P$=et({name:"SheetQuoted",pattern:/'((?![\\/[\]*?:]).)+?'!/}),I$=et({name:"Function",pattern:/[A-Za-z_]+[A-Za-z_0-9.]*\(/}),D$=et({name:"FormulaErrorT",pattern:/#NULL!|#DIV\/0!|#VALUE!|#NAME\?|#NUM!|#N\/A/}),L$=et({name:"RefError",pattern:/#REF!/}),vh=et({name:"Name",pattern:/[a-zA-Z_][a-zA-Z0-9_.?]*/}),B$=et({name:"Sheet",pattern:/[A-Za-z_.\d\u007F-\uFFFF]+!/}),U$=et({name:"Cell",pattern:/[$]?[A-Za-z]{1,3}[$]?[1-9][0-9]*/,longer_alt:vh}),$$=et({name:"Number",pattern:/[0-9]+[.]?[0-9]*([eE][+-][0-9]+)?/}),F$=et({name:"Boolean",pattern:/TRUE|FALSE/i}),V$=et({name:"Column",pattern:/[$]?[A-Za-z]{1,3}/,longer_alt:vh}),W$=et({name:"At",pattern:/@/}),H$=et({name:"Comma",pattern:/,/}),G$=et({name:"Colon",pattern:/:/}),z$=et({name:"Semicolon",pattern:/;/}),q$=et({name:"OpenParen",pattern:/\(/}),Y$=et({name:"CloseParen",pattern:/\)/}),X$=et({name:"OpenSquareParen",pattern:/\[/}),Q$=et({name:"CloseSquareParen",pattern:/]/}),K$=et({name:"exclamationMark",pattern:/!/}),j$=et({name:"OpenCurlyParen",pattern:/{/}),Z$=et({name:"CloseCurlyParen",pattern:/}/}),J$=et({name:"QuoteS",pattern:/'/}),kp=et({name:"MulOp",pattern:/\*/}),eF=et({name:"PlusOp",pattern:/\+/}),tF=et({name:"DivOp",pattern:/\//}),rF=et({name:"MinOp",pattern:/-/}),nF=et({name:"ConcatOp",pattern:/&/}),iF=et({name:"ExOp",pattern:/\^/}),aF=et({name:"PercentOp",pattern:/%/}),sF=et({name:"GtOp",pattern:/>/}),oF=et({name:"EqOp",pattern:/=/}),lF=et({name:"LtOp",pattern:/</}),cF=et({name:"NeqOp",pattern:/<>/}),uF=et({name:"GteOp",pattern:/>=/}),fF=et({name:"LteOp",pattern:/<=/}),yh=[M$,_$,P$,k$,I$,D$,L$,B$,U$,F$,V$,vh,$$,W$,H$,G$,z$,q$,Y$,X$,Q$,K$,j$,Z$,J$,kp,eF,tF,rF,nF,iF,kp,aF,cF,uF,fF,sF,oF,lF],hF=new zv(yh,{ensureOptimizations:!0});yh.forEach(t=>{mh[t.name]=t});const _u=t=>{const e=hF.tokenize(t);if(e.errors.length>0){const r=e.errors[0],n=r.line,i=r.column;let a=`
${t.split(`
`)[n-1]}
`;a+=`${Array(i-1).fill(" ").join("")}^
`;const s={message:`${a}Error at position ${n}:${i}
${r.message}`,errorLocation:{line:n,column:i}};throw B.ERROR(r.message,s)}return e},{String:Pp,SheetQuoted:dF,Function:pF,FormulaErrorT:Ip,RefError:Dp,Cell:gF,Sheet:mF,Name:vF,Number:Lp,Boolean:Bp,Column:yF,Comma:Xs,Colon:bF,Semicolon:EF,OpenParen:OF,CloseParen:Up,OpenCurlyParen:AF,CloseCurlyParen:CF,MulOp:wF,PlusOp:Uc,DivOp:SF,MinOp:$c,ConcatOp:TF,ExOp:RF,PercentOp:NF,NeqOp:xF,GteOp:MF,LteOp:_F,GtOp:kF,EqOp:PF,LtOp:IF}=mh;class qv extends N${constructor(r,n){super(mh,{maxLookahead:1,skipValidations:!0});fe(this,"utils");fe(this,"binaryOperatorsPrecedence");fe(this,"formulaWithPercentOp");fe(this,"formulaWithUnaryOp");fe(this,"formulaWithIntersect");fe(this,"formulaWithRange");fe(this,"formula");fe(this,"referenceWithoutInfix");fe(this,"paren");fe(this,"constant");fe(this,"functionCall");fe(this,"constantArray");fe(this,"formulaWithBinaryOp");fe(this,"constantForArray");fe(this,"plusMinusOp");fe(this,"arguments");fe(this,"referenceItem");fe(this,"prefixName");fe(this,"c1");this.utils=n,this.binaryOperatorsPrecedence=[["^"],["*","/"],["+","-"],["&"],["<",">","=","<>","<=",">="]];const i=this;i.RULE("formulaWithBinaryOp",()=>{const a=[],s=[i.SUBRULE(i.formulaWithPercentOp)];return i.MANY(()=>{a.push(i.OR(i.c1||(i.c1=[{ALT:()=>i.CONSUME(kF).image},{ALT:()=>i.CONSUME(PF).image},{ALT:()=>i.CONSUME(IF).image},{ALT:()=>i.CONSUME(xF).image},{ALT:()=>i.CONSUME(MF).image},{ALT:()=>i.CONSUME(_F).image},{ALT:()=>i.CONSUME(TF).image},{ALT:()=>i.CONSUME(Uc).image},{ALT:()=>i.CONSUME($c).image},{ALT:()=>i.CONSUME(wF).image},{ALT:()=>i.CONSUME(SF).image},{ALT:()=>i.CONSUME(RF).image}]))),s.push(i.SUBRULE2(i.formulaWithPercentOp))}),i.ACTION(()=>{for(const l of this.binaryOperatorsPrecedence)for(let u=0,c=a.length;u<c;u++){const o=a[u];l.includes(o)&&(a.splice(u,1),s.splice(u,2,this.utils.applyInfix(s[u],o,s[u+1])),u--,c--)}}),s[0]}),i.RULE("plusMinusOp",()=>i.OR([{ALT:()=>i.CONSUME(Uc).image},{ALT:()=>i.CONSUME($c).image}])),i.RULE("formulaWithPercentOp",()=>{let a=i.SUBRULE(i.formulaWithUnaryOp);return i.OPTION(()=>{const s=i.CONSUME(NF).image;a=i.ACTION(()=>this.utils.applyPostfix(a,s))}),a}),i.RULE("formulaWithUnaryOp",()=>{const a=[];i.MANY(()=>{const l=i.OR([{ALT:()=>i.CONSUME(Uc).image},{ALT:()=>i.CONSUME($c).image}]);a.push(l)});const s=i.SUBRULE(i.formulaWithIntersect);return a.length>0?i.ACTION(()=>this.utils.applyPrefix(a,s)):s}),i.RULE("formulaWithIntersect",()=>{const a=i.SUBRULE(i.formulaWithRange),s=[a];return i.MANY({GATE:()=>{const l=i.LA(0);return i.LA(1).startOffset>l.endOffset+1},DEF:()=>{s.push(i.SUBRULE3(i.formulaWithRange))}}),s.length>1?i.ACTION(()=>i.ACTION(()=>this.utils.applyIntersect(s))):a}),i.RULE("formulaWithRange",()=>{const a=i.SUBRULE(i.formula),s=[a];return i.MANY(()=>{i.CONSUME(bF),s.push(i.SUBRULE2(i.formula))}),s.length>1?i.ACTION(()=>i.ACTION(()=>this.utils.applyRange(s))):a}),i.RULE("formula",()=>i.OR9([{ALT:()=>i.SUBRULE(i.referenceWithoutInfix)},{ALT:()=>i.SUBRULE(i.paren)},{ALT:()=>i.SUBRULE(i.constant)},{ALT:()=>i.SUBRULE(i.functionCall)},{ALT:()=>i.SUBRULE(i.constantArray)}])),i.RULE("paren",()=>{i.CONSUME(OF);let a;const s=[];return s.push(i.SUBRULE(i.formulaWithBinaryOp)),i.MANY(()=>{i.CONSUME(Xs),s.push(i.SUBRULE2(i.formulaWithBinaryOp))}),s.length>1?a=i.ACTION(()=>this.utils.applyUnion(s)):a=s[0],i.CONSUME(Up),a}),i.RULE("constantArray",()=>{const a=[[]];let s=0;return i.CONSUME(AF),a[s].push(i.SUBRULE(i.constantForArray)),i.MANY(()=>{const l=i.OR([{ALT:()=>i.CONSUME(Xs).image},{ALT:()=>i.CONSUME(EF).image}]),u=i.SUBRULE2(i.constantForArray);l===","||(s++,a[s]=[]),a[s].push(u)}),i.CONSUME(CF),i.ACTION(()=>this.utils.toArray(a))}),i.RULE("constantForArray",()=>i.OR([{ALT:()=>{const a=i.OPTION(()=>i.SUBRULE(i.plusMinusOp)),s=i.CONSUME(Lp).image,l=i.ACTION(()=>this.utils.toNumber(s));return a?i.ACTION(()=>this.utils.applyPrefix([a],l)):l}},{ALT:()=>{const a=i.CONSUME(Pp).image;return i.ACTION(()=>this.utils.toString(a))}},{ALT:()=>{const a=i.CONSUME(Bp).image;return i.ACTION(()=>this.utils.toBoolean(a))}},{ALT:()=>{const a=i.CONSUME(Ip).image;return i.ACTION(()=>this.utils.toError(a))}},{ALT:()=>{const a=i.CONSUME(Dp).image;return i.ACTION(()=>this.utils.toError(a))}}])),i.RULE("constant",()=>i.OR([{ALT:()=>{const a=i.CONSUME(Lp).image;return i.ACTION(()=>this.utils.toNumber(a))}},{ALT:()=>{const a=i.CONSUME(Pp).image;return i.ACTION(()=>this.utils.toString(a))}},{ALT:()=>{const a=i.CONSUME(Bp).image;return i.ACTION(()=>this.utils.toBoolean(a))}},{ALT:()=>{const a=i.CONSUME(Ip).image;return i.ACTION(()=>this.utils.toError(a))}}])),i.RULE("functionCall",()=>{const a=i.CONSUME(pF).image.slice(0,-1),s=i.SUBRULE(i.arguments);return i.CONSUME(Up),i.ACTION(()=>r.callFunction(a,s))}),i.RULE("arguments",()=>{i.MANY2(()=>{i.CONSUME2(Xs)});const a=[];return i.OPTION(()=>{a.push(i.SUBRULE(i.formulaWithBinaryOp)),i.MANY(()=>{i.CONSUME1(Xs),a.push(null),i.OPTION3(()=>{a.pop(),a.push(i.SUBRULE2(i.formulaWithBinaryOp))})})}),a}),i.RULE("referenceWithoutInfix",()=>i.OR([{ALT:()=>i.SUBRULE(i.referenceItem)},{ALT:()=>{const a=i.SUBRULE(i.prefixName),s=i.SUBRULE2(i.formulaWithRange);return i.ACTION(()=>{if(this.utils.isFormulaError(s))return s;s.ref.sheet=a}),s}}])),i.RULE("referenceItem",()=>i.OR([{ALT:()=>{const a=i.CONSUME(gF).image;return i.ACTION(()=>this.utils.parseCellAddress(a))}},{ALT:()=>{const a=i.CONSUME(vF).image;return i.ACTION(()=>r.getVariable(a))}},{ALT:()=>{const a=i.CONSUME(yF).image;return i.ACTION(()=>this.utils.parseCol(a))}},{ALT:()=>{const a=i.CONSUME(Dp).image;return i.ACTION(()=>this.utils.toError(a))}}])),i.RULE("prefixName",()=>i.OR([{ALT:()=>i.CONSUME(mF).image.slice(0,-1)},{ALT:()=>i.CONSUME(dF).image.slice(1,-2).replace(/''/g,"'")}])),this.performSelfAnalysis()}}const $p=1048576,Fp=16384;let To=class{constructor(e){fe(this,"context");fe(this,"columnNameToNumber",e=>vi.columnNameToNumber(e));fe(this,"parseRow",e=>{const r=+e;if(!Number.isInteger(r))throw Error("Row number must be integer.");return{ref:{col:void 0,row:+e}}});fe(this,"parseRowRange",(e,r)=>({ref:{from:{col:null,row:Math.min(e,r)},to:{col:null,row:Math.max(e,r)}}}));fe(this,"toArray",e=>e);fe(this,"toNumber",e=>Number(e));fe(this,"toString",e=>e.substring(1,e.length-1).replace(/""/g,'"'));fe(this,"toBoolean",e=>e==="TRUE");fe(this,"toError",e=>new B(e.toUpperCase()));fe(this,"isFormulaError",e=>e instanceof B);this.context=e}parseCellAddress(e){const r=e.match(/([$]?)([A-Za-z]{1,3})([$]?)([1-9][0-9]*)/);return{ref:{address:r[0],col:this.columnNameToNumber(r[2]),row:+r[4]}}}parseCol(e){return{ref:{col:this.columnNameToNumber(e),row:void 0}}}parseColRange(e,r){return e=this.columnNameToNumber(e),r=this.columnNameToNumber(r),{ref:{from:{col:Math.min(e,r),row:null},to:{col:Math.max(e,r),row:null}}}}_applyPrefix(e,r,n){return this.isFormulaError(r)?r:zE.unaryOp(e,r,n)}async applyPrefixAsync(e,r){const{val:n,isArray:i}=this.extractRefValue(await r);return this._applyPrefix(e,n,i)}applyPrefix(e,r){if(this.context.async)return this.applyPrefixAsync(e,r);const{val:n,isArray:i}=this.extractRefValue(r);return this._applyPrefix(e,n,i)}_applyPostfix(e,r,n){return this.isFormulaError(e)?e:qE.percentOp(e,n,r)}async applyPostfixAsync(e,r){const{val:n,isArray:i}=this.extractRefValue(await e);return this._applyPostfix(n,i,r)}applyPostfix(e,r){if(this.context.async)return this.applyPostfixAsync(e,r);const{val:n,isArray:i}=this.extractRefValue(e);return this._applyPostfix(n,i,r)}_applyInfix(e,r,n){const i=e.val,a=e.isArray,s=n.val,l=n.isArray;if(this.isFormulaError(i))return i;if(this.isFormulaError(s))return s;if(wc.compareOp.includes(r))return Hi.compareOp(i,r,s,a,l);if(wc.concatOp.includes(r))return Hi.concatOp(i,r,s,a,l);if(wc.mathOp.includes(r))return Hi.mathOp(i,r,s,a,l);throw new Error(`Unrecognized infix: ${r}`)}async applyInfixAsync(e,r,n){const i=this.extractRefValue(await e),a=this.extractRefValue(await n);return this._applyInfix(i,r,a)}applyInfix(e,r,n){if(this.context.async)return this.applyInfixAsync(e,r,n);const i=this.extractRefValue(e),a=this.extractRefValue(n);return this._applyInfix(i,r,a)}applyIntersect(e){if(this.isFormulaError(e[0]))return e[0];if(!e[0].ref)throw Error(`Expecting a reference, but got ${e[0]}.`);let r,n,i,a,s;const l=e.shift().ref,u=l.sheet;if(l.from)r=Math.max(l.from.row,l.to.row),i=Math.min(l.from.row,l.to.row),n=Math.max(l.from.col,l.to.col),a=Math.min(l.from.col,l.to.col);else{if(l.row===void 0||l.col===void 0)throw Error("Cannot intersect the whole row or column.");r=i=l.row,n=a=l.col}let c;return e.forEach(o=>{if(this.isFormulaError(o))return o;if(o=o.ref,!o)throw Error(`Expecting a reference, but got ${o}.`);if(o.from){const f=Math.max(o.from.row,o.to.row),h=Math.min(o.from.row,o.to.row),d=Math.max(o.from.col,o.to.col),p=Math.min(o.from.col,o.to.col);(h>r||f<i||p>n||d<a||u!==o.sheet)&&(c=B.NULL),r=Math.min(r,f),i=Math.max(i,h),n=Math.min(n,d),a=Math.max(a,p)}else{if(o.row===void 0||o.col===void 0)throw Error("Cannot intersect the whole row or column.");(o.row>r||o.row<i||o.col>n||o.col<a||u!==o.sheet)&&(c=B.NULL),r=i=o.row,n=a=o.col}}),c||(r===i&&n===a?s={ref:{sheet:u,row:r,col:n}}:s={ref:{sheet:u,from:{row:i,col:a},to:{row:r,col:n}}},s.ref.sheet||delete s.ref.sheet,s)}applyUnion(e){const r=new mi;for(let n=0;n<e.length;n++){if(this.isFormulaError(e[n]))return e[n];r.add(this.extractRefValue(e[n]).val,e[n])}return r}applyRange(e){let r,n=-1,i=-1,a=$p+1,s=Fp+1;return e.forEach(l=>{if(this.isFormulaError(l))return l;typeof l=="number"&&(l=this.parseRow(l)),l=l.ref,l.row===void 0&&(a=1,n=$p),l.col===void 0&&(s=1,i=Fp),l.row>n&&(n=l.row),l.row<a&&(a=l.row),l.col>i&&(i=l.col),l.col<s&&(s=l.col)}),n===a&&i===s?r={ref:{row:n,col:i}}:r={ref:{from:{row:a,col:s},to:{row:n,col:i}}},r}extractRefValue(e){const r=e;let n=!1;return Array.isArray(r)&&(n=!0),e.ref?{val:this.context.retrieveRef(e),isArray:n}:{val:r,isArray:n}}static formatChevrotainError(e,r){let n,i,a="";return e instanceof x$?(n=e.token.startLine,i=e.token.startColumn):(n=e.previousToken.startLine,i=e.previousToken.startColumn+1),a+=`
${r.split(`
`)[n-1]}
`,a+=`${Array(i-1).fill(" ").join("")}^
`,a+=`Error at position ${n}:${i}
${e.message}`,e.errorLocation={line:n,column:i},B.ERROR(a,e)}};class DF{constructor(e,r=!1){fe(this,"logs");fe(this,"isTest");fe(this,"utils");fe(this,"onVariable");fe(this,"functions");fe(this,"onRange");fe(this,"onCell");fe(this,"funsNullAs0");fe(this,"funsNeedContextAndNoDataRetrieve");fe(this,"funsNeedContext");fe(this,"funsPreserveRef");fe(this,"parser");fe(this,"position");fe(this,"async");this.logs=[],this.isTest=r,this.utils=new To(this),e={functions:{},functionsNeedContext:{},onVariable:()=>null,onCell:()=>0,onRange:()=>[[0]],...e},this.onVariable=e.onVariable,this.functions={...In,...Eu,...fd,...ud,...je,...cd,...$t,...Wt,...ld,...rO,...e.functions,...e.functionsNeedContext},this.onRange=e.onRange,this.onCell=e.onCell,this.funsNullAs0=Object.keys(In).concat(Object.keys(je)).concat(Object.keys(Wt)).concat(Object.keys(cd)).concat(Object.keys(ud)).concat(Object.keys(Eu)).concat(Object.keys(ld)),this.funsNeedContextAndNoDataRetrieve=["ROW","ROWS","COLUMN","COLUMNS","SUMIF","INDEX","AVERAGEIF","IF"],this.funsNeedContext=[...Object.keys(e.functionsNeedContext),...this.funsNeedContextAndNoDataRetrieve,"INDEX","OFFSET","INDIRECT","IF","CHOOSE","WEBSERVICE"],this.funsPreserveRef=Object.keys(fd),this.parser=new qv(this,this.utils)}static get allTokens(){return yh}getCell(e){return e.sheet==null&&(e.sheet=this.position?this.position.sheet:void 0),this.onCell(e)}getRange(e){return e.sheet==null&&(e.sheet=this.position?this.position.sheet:void 0),this.onRange(e)}getVariable(e){const r={ref:this.onVariable(e,this.position.sheet,this.position)};return r.ref==null?B.NAME:r}retrieveRef(e){return St.isRangeRef(e)?this.getRange(e.ref):St.isCellRef(e)?this.getCell(e.ref):e}_callFunction(e,r){e.indexOf("_xlfn.")===0&&(e=e.slice(6)),e=e.toUpperCase();const n=this.funsNullAs0.includes(e)?0:"";if(this.funsNeedContextAndNoDataRetrieve.includes(e)||(r=r.map(i=>{if(i===null)return{value:n,isArray:!1,omitted:!0};const a=this.utils.extractRefValue(i);return this.funsPreserveRef.includes(e)?{value:a.val,isArray:a.isArray,ref:i.ref}:{value:a.val,isArray:a.isArray,isRangeRef:!!St.isRangeRef(i),isCellRef:!!St.isCellRef(i)}})),this.functions[e]){let i;try{!this.funsNeedContextAndNoDataRetrieve.includes(e)&&!this.funsNeedContext.includes(e)?i=this.functions[e](...r):i=this.functions[e](this,...r)}catch(a){if(a instanceof B)return a;throw a}if(i===void 0){if(this.isTest)return this.logs.includes(e)||this.logs.push(e),{value:0,ref:{}};throw B.NOT_IMPLEMENTED(e)}return i}if(this.isTest)return this.logs.includes(e)||this.logs.push(e),{value:0,ref:{}};throw B.NOT_IMPLEMENTED(e)}async callFunctionAsync(e,r){const n=[];for(const a of r)n.push(await a);const i=await this._callFunction(e,n);return St.checkFunctionResult(i)}callFunction(e,r){if(this.async)return this.callFunctionAsync(e,r);const n=this._callFunction(e,r);return St.checkFunctionResult(n)}supportedFunctions(){const e=[];return Object.keys(this.functions).forEach(n=>{try{if(this.functions[n](0,0,0,0,0,0,0,0,0,0,0)===void 0)return;e.push(n)}catch(i){i instanceof Error&&e.push(n)}}),e.sort()}checkFormulaResult(e,r=!1){const n=typeof e;if(n==="number"){if(isNaN(e))return B.VALUE;if(!isFinite(e))return B.NUM;e+=0}else if(n==="object"){if(e instanceof B)return e;if(r){if(e.ref&&(e=this.retrieveRef(e)),typeof e=="object"&&!Array.isArray(e)&&e!=null)return B.VALUE}else if(e.ref&&e.ref.row&&!e.ref.from)e=this.retrieveRef(e);else if(e.ref&&e.ref.from&&e.ref.from.col===e.ref.to.col)e=this.retrieveRef({ref:{row:e.ref.from.row,col:e.ref.from.col}});else if(Array.isArray(e))e=e[0][0];else return B.VALUE}return e}parse(e,r,n=!1){if(e.length===0)throw Error("Input must not be empty.");this.position=r,this.async=!1;const i=_u(e);this.parser.input=i.tokens;let a;try{if(a=this.parser.formulaWithBinaryOp(),a=this.checkFormulaResult(a,n),a instanceof B)return a}catch(s){throw B.ERROR(s.message,s)}if(this.parser.errors.length>0){const s=this.parser.errors[0];throw To.formatChevrotainError(s,e)}return a}async parseAsync(e,r,n=!1){if(e.length===0)throw Error("Input must not be empty.");this.position=r,this.async=!0;const i=_u(e);this.parser.input=i.tokens;let a;try{if(a=await this.parser.formulaWithBinaryOp(),a=this.checkFormulaResult(a,n),a instanceof B)return a}catch(s){throw B.ERROR(s.message,s)}if(this.parser.errors.length>0){const s=this.parser.errors[0];throw To.formatChevrotainError(s,e)}return a}}const Vp=1048576,Wp=16384;class Hp{constructor(e){fe(this,"context");fe(this,"columnNameToNumber",e=>vi.columnNameToNumber(e));fe(this,"parseRow",e=>{const r=+e;if(!Number.isInteger(r))throw Error("Row number must be integer.");return{ref:{col:void 0,row:+e}}});fe(this,"toArray",e=>e);fe(this,"toNumber",e=>Number(e));fe(this,"toString",e=>e.substring(1,e.length-1).replace(/""/g,'"'));fe(this,"toBoolean",e=>e==="TRUE");fe(this,"toError",e=>new B(e.toUpperCase()));fe(this,"isFormulaError",e=>e instanceof B);this.context=e}parseCellAddress(e){const r=e.match(/([$]?)([A-Za-z]{1,3})([$]?)([1-9][0-9]*)/);return{ref:{col:this.columnNameToNumber(r[2]),row:+r[4]}}}parseCol(e){return{ref:{col:this.columnNameToNumber(e),row:void 0}}}applyPrefix(e,r){return console.log(e),this.extractRefValue(r),0}applyPostfix(e,r){return console.log(r),this.extractRefValue(e),0}applyInfix(e,r,n){return console.log(r),this.extractRefValue(e),this.extractRefValue(n),0}applyIntersect(e){if(this.isFormulaError(e[0]))return e[0];if(!e[0].ref)throw Error(`Expecting a reference, but got ${e[0]}.`);let r,n,i,a,s;const l=e.shift().ref,u=l.sheet;if(l.from)r=Math.max(l.from.row,l.to.row),i=Math.min(l.from.row,l.to.row),n=Math.max(l.from.col,l.to.col),a=Math.min(l.from.col,l.to.col);else{if(l.row===void 0||l.col===void 0)throw Error("Cannot intersect the whole row or column.");r=i=l.row,n=a=l.col}let c;return e.forEach(o=>{if(this.isFormulaError(o))return o;if(o=o.ref,!o)throw Error(`Expecting a reference, but got ${o}.`);if(o.from){const f=Math.max(o.from.row,o.to.row),h=Math.min(o.from.row,o.to.row),d=Math.max(o.from.col,o.to.col),p=Math.min(o.from.col,o.to.col);(h>r||f<i||p>n||d<a||u!==o.sheet)&&(c=B.NULL),r=Math.min(r,f),i=Math.max(i,h),n=Math.min(n,d),a=Math.max(a,p)}else{if(o.row===void 0||o.col===void 0)throw Error("Cannot intersect the whole row or column.");(o.row>r||o.row<i||o.col>n||o.col<a||u!==o.sheet)&&(c=B.NULL),r=i=o.row,n=a=o.col}}),c||(r===i&&n===a?s={ref:{sheet:u,row:r,col:n}}:s={ref:{sheet:u,from:{row:i,col:a},to:{row:r,col:n}}},s.ref.sheet||delete s.ref.sheet,s)}applyUnion(e){const r=new mi;for(let n=0;n<e.length;n++){if(this.isFormulaError(e[n]))return e[n];r.add(this.extractRefValue(e[n]).val,e[n])}return r}applyRange(e){let r,n=-1,i=-1,a=Vp+1,s=Wp+1;return e.forEach(l=>{if(this.isFormulaError(l))return l;typeof l=="number"&&(l=this.parseRow(l)),l=l.ref,l.row===void 0&&(a=1,n=Vp),l.col===void 0&&(s=1,i=Wp),l.row>n&&(n=l.row),l.row<a&&(a=l.row),l.col>i&&(i=l.col),l.col<s&&(s=l.col)}),n===a&&i===s?r={ref:{row:n,col:i}}:r={ref:{from:{row:a,col:s},to:{row:n,col:i}}},r}extractRefValue(e){const r=Array.isArray(e);return e.ref?{val:this.context.retrieveRef(e),isArray:r}:{val:e,isArray:r}}}class LF{constructor(e){fe(this,"data");fe(this,"utils");fe(this,"onVariable");fe(this,"parser");fe(this,"position");this.data=[],this.utils=new Hp(this),e={onVariable:()=>null,...e},this.utils=new Hp(this),this.onVariable=e.onVariable,this.parser=new qv(this,this.utils)}getCell(e){return e.row!=null&&(e.sheet==null&&(e.sheet=this.position?this.position.sheet:void 0),this.data.findIndex(n=>n.from&&n.from.row<=e.row&&n.to.row>=e.row&&n.from.col<=e.col&&n.to.col>=e.col||n.row===e.row&&n.col===e.col&&n.sheet===e.sheet)===-1&&this.data.push(e)),0}getRange(e){return e.from.row!=null&&(e.sheet==null&&(e.sheet=this.position?this.position.sheet:void 0),this.data.findIndex(n=>n.from&&n.from.row===e.from.row&&n.from.col===e.from.col&&n.to.row===e.to.row&&n.to.col===e.to.col)===-1&&this.data.push(e)),[[0]]}getVariable(e){const r={ref:this.onVariable(e,this.position.sheet)};return r.ref==null?B.NAME:(St.isCellRef(r)?this.getCell(r.ref):this.getRange(r.ref),0)}retrieveRef(e){return St.isRangeRef(e)?this.getRange(e.ref):St.isCellRef(e)?this.getCell(e.ref):e}callFunction(e,r){return console.log(e),r.forEach(n=>{n!=null&&this.retrieveRef(n)}),{value:0,ref:{}}}checkFormulaResult(e){this.retrieveRef(e)}parse(e,r,n=!1){if(e.length===0)throw Error("Input must not be empty.");this.data=[],this.position=r;const i=_u(e);this.parser.input=i.tokens;try{const a=this.parser.formulaWithBinaryOp();this.checkFormulaResult(a)}catch(a){if(!n)throw B.ERROR(a.message,a)}if(this.parser.errors.length>0&&!n){const a=this.parser.errors[0];throw To.formatChevrotainError(a,e)}return this.data}}const BF=typeof window<"u",Qt=BF&&window.navigator.userAgent.toLowerCase(),UF=Qt&&/; msie|trident/i.test(Qt)&&!/ucbrowser/i.test(Qt),$F=Qt&&/edg/i.test(Qt),FF=Qt&&/chrome|crios/i.test(Qt)&&!/opr|opera|chromium|edg|ucbrowser|googlebot/i.test(Qt),VF=Qt&&/chromium/i.test(Qt),WF=Qt&&/safari/i.test(Qt)&&!/chromium|edg|ucbrowser|chrome|crios|opr|opera|fxios|firefox/i.test(Qt),HF=Qt&&/firefox|fxios/i.test(Qt)&&!/seamonkey/i.test(Qt),GF=Qt&&/opr|opera/i.test(Qt),zF=typeof document>"u"?0:document?document.querySelector("html"):0,qF=typeof document>"u"?0:document,YF=typeof window>"u"?0:window;function Yv(t,e,r){if(t){const n=t.parentNode;if(r.top+=t.offsetTop,r.left+=t.offsetLeft,n&&n!==zF&&n!==document.body&&(r.top-=n.scrollTop,r.left-=n.scrollLeft),!(e&&(t===e||t.offsetParent===e))&&t.offsetParent)return Yv(t.offsetParent,e,r)}return r}const Fc={};function XF(t){return Fc[t]||(Fc[t]=new RegExp(`(?:^|\\s)${t}(?!\\S)`,"g")),Fc[t]}function Gp(t,e){return t&&t.className&&t.className.match&&t.className.match(XF(e))}function ku(){const t=document.documentElement,e=document.body;return{scrollTop:t.scrollTop||e.scrollTop,scrollLeft:t.scrollLeft||e.scrollLeft,visibleHeight:t.clientHeight||e.clientHeight,visibleWidth:t.clientWidth||e.clientWidth}}const ht={isIE:UF,isEdge:$F,isChrome:FF,isChromium:VF,isSafari:WF,isFirefox:HF,isOpera:GF,getOffsetPos(t,e){return Yv(t,e,{left:0,top:0})},getDomNode:ku,hasClass:Gp,getAbsolutePos(t){const e=t.getBoundingClientRect(),r=e.top,n=e.left,{scrollTop:i,scrollLeft:a,visibleHeight:s,visibleWidth:l}=ku();return{boundingTop:r,top:i+r,boundingLeft:n,left:a+n,visibleHeight:s,visibleWidth:l}},getEventTargetNode(t,e,r,n){let i,a=t.target;for(;a&&a.nodeType&&a!==document;){if(r&&Gp(a,r)&&(!n||n(a)))return i=a,{flag:r?!!i:!0,container:e,targetElem:i};if(a===e)return{flag:r?!!i:!0,container:e,targetElem:i};a=a.parentNode}return{flag:!1}},isPx(t){return t&&/^\d+(px)?$/.test(t)},isScale(t){return t&&/^\d+%$/.test(t)}};function Ia(t){const e=t.getBoundingClientRect(),r=e.top,n=e.left,{scrollTop:i,scrollLeft:a,visibleHeight:s,visibleWidth:l}=ku();return{boundingTop:r,top:i+r,boundingLeft:n,left:a+n,visibleHeight:s,visibleWidth:l}}function Vc(t,e,r,n=!1){t&&e&&r&&t.addEventListener(e,r,n)}function zp(t,e,r,n=!1){t&&e&&r&&t.removeEventListener(e,r,n)}function bh(t,e){let r=!1;const n=function(a){var s;(s=e.drag)==null||s.call(e,a)},i=a=>{var s;zp(document,"mousemove",n),zp(document,"mouseup",i),document.onselectstart=null,document.ondragstart=null,r=!1,(s=e.end)==null||s.call(e,a)};Vc(t,"mousedown",a=>{var s;r||(document.onselectstart=()=>!1,document.ondragstart=()=>!1,Vc(document,"mousemove",n),Vc(document,"mouseup",i),r=!0,(s=e.start)==null||s.call(e,a))})}const QF=ht.isFirefox?"DOMMouseScroll":"mousewheel",Xv=[];function Gi(t){const e=t.type===QF;Xv.forEach(({type:r,cb:n})=>{(r===t.type||e&&r==="mousewheel")&&n(t)})}const xt={on(t,e,r){r&&Xv.push({comp:t,type:e,cb:r})},off(t,e){console.log(t,e)},trigger:Gi};qF&&(document.addEventListener("contextmenu",Gi,!1),document.addEventListener("keydown",Gi,!1));YF&&(window.addEventListener("mousedown",Gi,!1),window.addEventListener("mousewheel",Gi,!1),window.addEventListener("resize",Gi,!1));class KF{constructor(){fe(this,"skeleton",{})}add(e,r){return this.skeleton[e]=r,this}forEach(e){if(this.skeleton)for(const r in this.skeleton)this.skeleton&&this.skeleton.hasOwnProperty&&e.call(null,this.skeleton[r],r,this.skeleton)}}const Qv=new KF,jF={setupGrid(t){const{uId:e,reactiveData:r}=t,{refGridContextMenu:n,refGridColorPicker:i,refGridDiv:a}=t.getRefs();let s={},l={};s={closeMenu:()=>(Object.assign(r.ctxMenuStore,{visible:!1,selected:null,selectChild:null,showChild:!1,list:[]}),Object.assign(r.colorPickerStore,{selected:null,visible:!1,selectValue:null}),gt())},l={ctxMenuLinkEvent(c,o){if(o&&!o.disabled){if(o.code==="insertColumn"&&t.insertColumn(Number(o.param.col)),o.code==="insertRow"&&t.insertRow(Number(o.param.row)),o.code==="hideColumn"&&t.hideColumn(Number(o.param.col)),o.code==="hideRow"&&t.hideRow(Number(o.param.row)),o.code==="deleteColumn"&&t.deleteColumn(Number(o.param.col)),o.code==="deleteRow"&&t.deleteRow(Number(o.param.row)),o.code==="borderLeft"&&t.setCellBorder("cells","l"),o.code==="borderTop"&&t.setCellBorder("cells","t"),o.code==="borderRight"&&t.setCellBorder("cells","r"),o.code==="borderBottom"&&t.setCellBorder("cells","b"),o.code==="borderInner"&&t.setCellBorder("cells","inner"),o.code==="borderOuter"&&t.setCellBorder("cells","outer"),o.code==="borderFull"&&t.setCellBorder("cells","full"),o.code==="borderNone"&&t.setCellBorder("cells","none"),o.code==="mergeCells"&&t.mergeCells(),o.code==="unmergeCells"&&t.unmergeCells(),o.code==="fontBold"){let f=!1;for(let h=r.currentAreaSci;h<=r.currentAreaEci;h++)for(let d=r.currentAreaSri;d<=r.currentAreaEri;d++)if(r.currentSheetData[d][h+1].b&&!gi(h+1,d+1,r.merges)){f=!0;break}t.setFontStyle("cells","fontBold",f)}if(o.code==="fontItalic"){let f=!1;for(let h=r.currentAreaSci;h<=r.currentAreaEci;h++)for(let d=r.currentAreaSri;d<=r.currentAreaEri;d++)if(r.currentSheetData[d][h+1].i&&!gi(h+1,d+1,r.merges)){f=!0;break}t.setFontStyle("cells","fontItalic",f)}if(o.code==="fontUnderline"){let f=!1;for(let h=r.currentAreaSci;h<=r.currentAreaEci;h++)for(let d=r.currentAreaSri;d<=r.currentAreaEri;d++)if(r.currentSheetData[d][h+1].u&&!gi(h+1,d+1,r.merges)){f=!0;break}t.setFontStyle("cells","fontUnderline",f)}o.code==="formatGeneral"&&t.setCellFormat("cells","formatGeneral",null),o.code==="formatNumberGeneral"&&t.setCellFormat("cells","formatNumberGeneral",null),o.code==="formatNumberPercent"&&t.setCellFormat("cells","formatNumberPercent",null),o.code==="formatNumberScience"&&t.setCellFormat("cells","formatNumberScience",null),o.code==="formatNumberFraction"&&t.setCellFormat("cells","formatNumberFraction",null),o.code==="formatNumberThousands"&&t.setCellFormat("cells","formatNumberThousands",null),o.code==="formatTime"&&t.setCellFormat("cells","formatTime",null),o.code==="formatShortDate"&&t.setCellFormat("cells","formatShortDate",null),o.code==="formatLongDate"&&t.setCellFormat("cells","formatLongDate",null),o.code==="formatCurrencyCNY"&&t.setCellFormat("cells","formatCurrencyCNY",null),o.code==="formatCurrencyUSD"&&t.setCellFormat("cells","formatCurrencyUSD",null),o.code==="formatCurrencyEuro"&&t.setCellFormat("cells","formatCurrencyEuro",null)}s.closeMenu&&s.closeMenu()},ctxMenuMouseoutEvent(c,o){const{ctxMenuStore:f}=r;o.children||(f.selected=null),f.selectChild=null},ctxMenuMouseoverEvent(c,o,f){const h=c.currentTarget;if(o.type&&o.type==="colorPicker"){const{ctxMenuStore:d}=r;c.preventDefault(),c.stopPropagation(),d.selected=o,d.selectChild=null;const{scrollTop:p,scrollLeft:g}=ht.getDomNode(),{boundingTop:m,boundingLeft:v}=Ia(h),b=m,C=v+h.offsetWidth,A=b+p-4,O=C+g+4;Object.assign(r.colorPickerStore,{visible:!0,selected:o,selectValue:null,style:{top:`${A}px`,left:`${O}px`}}),gt(()=>{const{scrollTop:w,scrollLeft:S,visibleHeight:N,visibleWidth:R}=ht.getDomNode(),{boundingTop:k,boundingLeft:z}=Ia(h),Y=k+w,re=z+S,Q=i.value,ae=Q.clientHeight,ve=Q.clientWidth,{boundingTop:J,boundingLeft:ne}=Ia(Q),se=J+ae-N,de=ne+ve-R;se>-10&&(r.colorPickerStore.style.top=`${Math.max(w+2,Y-ae-2)}px`),de>-10&&(r.colorPickerStore.style.left=`${Math.max(S+2,re-ve-2)}px`)})}else{const{ctxMenuStore:d,colorPickerStore:p}=r;c.preventDefault(),c.stopPropagation(),d.selected=o,d.selectChild=f,p.visible=!1,f||(d.showChild=o&&o.children&&o.children.length>0,d.showChild&&gt(()=>{const g=h.nextElementSibling;if(g){const{boundingTop:m,boundingLeft:v,visibleHeight:b,visibleWidth:C}=Ia(h),A=m+h.offsetHeight,O=v+h.offsetWidth;let w="",S="";O+g.offsetWidth>C-10&&(w="auto",S=`${h.offsetWidth}px`);let N="",R="";A+g.offsetHeight>b-10&&(N="auto",R="0"),g.style.left=w,g.style.right=S,g.style.top=N,g.style.bottom=R}}))}},handleContextmenuEvent:c=>{const o=a.value,f=ht.getEventTargetNode(c,o,"column-indicator",p=>{const g=p.parentNode.parentNode.parentNode.parentNode;return g!==document&&g.getAttribute("data-uid")===e}),h=ht.getEventTargetNode(c,o,"row-indicator",p=>{const g=p.parentNode.parentNode.parentNode.parentNode.parentNode;return g!==document&&g.getAttribute("data-uid")===e}),d=ht.getEventTargetNode(c,o,"normal",p=>{const g=p.parentNode.parentNode.parentNode.parentNode;return g!==document&&g.getAttribute("data-uid")===e});f.flag&&u(c,"column-indicator",{row:f.targetElem.getAttribute("data-row"),col:f.targetElem.getAttribute("data-col")}),h.flag&&u(c,"row-indicator",{row:h.targetElem.getAttribute("data-row"),col:h.targetElem.getAttribute("data-col")}),d.flag&&u(c,"cell",null)}};const u=(c,o,f)=>{const h=[];if(o==="column-indicator"){let v=[];v.push({name:t.lang().insertColumn,code:"insertColumn",disabled:!1,visible:!0,param:f}),h.push(v),v=[],v.push({name:t.lang().hideColumn,code:"hideColumn",disabled:!1,visible:!0,param:f}),h.push(v),v=[],v.push({name:t.lang().deleteColumn,code:"deleteColumn",disabled:!1,visible:!0,param:f}),h.push(v)}if(o==="row-indicator"){let v=[];v.push({name:t.lang().insertRow,code:"insertRow",disabled:!1,visible:!0,param:f}),h.push(v),v=[],v.push({name:t.lang().hideRow,code:"hideRow",disabled:!1,visible:!0,param:f}),h.push(v),v=[],v.push({name:t.lang().deleteRow,code:"deleteRow",disabled:!1,visible:!0,param:f}),h.push(v)}if(o==="cell"){let v=[],b=[];b.push({name:t.lang().borderNone,code:"borderNone",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().borderFull,code:"borderFull",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().borderOuter,code:"borderOuter",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().borderInner,code:"borderInner",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().borderBottom,code:"borderBottom",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().borderTop,code:"borderTop",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().borderLeft,code:"borderLeft",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().borderRight,code:"borderRight",disabled:!1,visible:!0,param:f}),v.push({name:t.lang().cellBorder,prefixIcon:"info",code:"cellBorder",disabled:!1,visible:!0,children:b,param:f}),h.push(v),v=[],b=[],v.push({name:t.lang().fontColor,prefixIcon:"info",code:"fontColor",disabled:!1,visible:!0,children:b,param:f,type:"colorPicker"}),h.push(v),v=[],b=[],v.push({name:t.lang().backgroundColor,prefixIcon:"info",code:"backgroundColor",disabled:!1,visible:!0,children:b,param:f,type:"colorPicker"}),h.push(v),v=[],b=[],v.push({name:t.lang().mergeCells,prefixIcon:"info",code:"mergeCells",disabled:!1,visible:!0,children:b,param:f}),h.push(v),v=[],b=[],v.push({name:t.lang().unmergeCells,prefixIcon:"info",code:"unmergeCells",disabled:!1,visible:!0,children:b,param:f}),h.push(v),v=[],b=[],b.push({name:t.lang().fontBold,code:"fontBold",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().fontItalic,code:"fontItalic",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().fontUnderline,code:"fontUnderline",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().fontSelect,code:"fontSelect",disabled:!1,visible:!0,param:f,type:"fontSelect"}),b.push({name:t.lang().fontSizeSelect,code:"fontSizeSelect",disabled:!1,visible:!0,param:f,type:"fontSizeSelect"}),v.push({name:t.lang().fontStyle,prefixIcon:"info",code:"fontStyle",disabled:!1,visible:!0,children:b,param:f}),h.push(v),v=[],b=[],v.push({name:t.lang().formatGeneral,prefixIcon:"info",code:"formatGeneral",disabled:!1,visible:!0,children:b,param:f}),h.push(v),v=[],b=[],b.push({name:t.lang().formatNumberGeneral,code:"formatNumberGeneral",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().formatNumberPercent,code:"formatNumberPercent",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().formatNumberScience,code:"formatNumberScience",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().formatNumberFraction,code:"formatNumberFraction",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().formatNumberThousands,code:"formatNumberThousands",disabled:!1,visible:!0,param:f}),v.push({name:t.lang().formatNumber,prefixIcon:"info",code:"formatNumber",disabled:!1,visible:!0,children:b,param:f}),h.push(v),v=[],b=[],b.push({name:t.lang().formatTime,code:"formatTime",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().formatShortDate,code:"formatShortDate",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().formatLongDate,code:"formatLongDate",disabled:!1,visible:!0,param:f}),v.push({name:t.lang().formatNumberDateTime,prefixIcon:"info",code:"formatNumberDateTime",disabled:!1,visible:!0,children:b,param:f}),h.push(v),v=[],b=[],b.push({name:t.lang().formatCurrencyCNY,code:"formatCurrencyCNY",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().formatCurrencyUSD,code:"formatCurrencyUSD",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().formatCurrencyEuro,code:"formatCurrencyEuro",disabled:!1,visible:!0,param:f}),b.push({name:t.lang().formatNumberCurrencyOthers,code:"formatNumberCurrencyOthers",disabled:!1,visible:!0,param:f,type:"formatNumberCurrencyOthersSelect"}),v.push({name:t.lang().formatNumberCurrency,prefixIcon:"info",code:"formatNumberCurrency",disabled:!1,visible:!0,children:b,param:f}),h.push(v)}c.preventDefault();const{scrollTop:d,scrollLeft:p}=ht.getDomNode(),g=c.clientY+d,m=c.clientX+p;Object.assign(r.ctxMenuStore,{visible:!0,selected:null,list:h,selectChild:null,showChild:!1,style:{top:`${g}px`,left:`${m}px`}}),gt(()=>{const{scrollTop:v,scrollLeft:b,visibleHeight:C,visibleWidth:A}=ht.getDomNode(),O=c.clientY+v,w=c.clientX+b,S=n.value,N=S.clientHeight,R=S.clientWidth,{boundingTop:k,boundingLeft:z}=Ia(S),Y=k+N-C,re=z+R-A;Y>-10&&(r.ctxMenuStore.style.top=`${Math.max(v+2,O-N-2)}px`),re>-10&&(r.ctxMenuStore.style.left=`${Math.max(b+2,w-R-2)}px`)})};return{...s,...l}}},ZF="1.1.8",qp=[];function JF(t,e){return t&&t.install&&qp.indexOf(t)===-1&&(t.install(Pu,e),qp.push(t)),Pu}Qv.add("VmaFormulaGridCompContextMenu",jF);const Pu={version:ZF,hooks:Qv,use:JF},e3={hideRow:"Hide row",hideColumn:"Hide Column",insertRow:"Insert row",insertColumn:"Insert column",deleteRow:"Delete row",deleteColumn:"Delete column",borderNone:"No border",borderFull:"All border",borderOuter:"Outer border",borderInner:"Inner border",borderBottom:"Bottom border",borderTop:"Top border",borderLeft:"Left border",borderRight:"Right border",cellBorder:"Border",fontColor:"Font color",backgroundColor:"Background",mergeCells:"Merge",unmergeCells:"Unmerge",fontBold:"Bold",fontItalic:"Italic",fontUnderline:"Underline",fontSelect:"Select font",fontSizeSelect:"Select font size",fontStyle:"Font",formatGeneral:"General",formatNumberGeneral:"General number",formatNumberPercent:"Percent",formatNumberFraction:"Fraction",formatNumberScience:"Science",formatNumberThousands:"Thousands",formatNumber:"Number",formatTime:"Time",formatShortDate:"Short date",formatLongDate:"Long date",formatNumberDateTime:"Date & time",formatCurrencyCNY:"CNY",formatCurrencyUSD:"USD",formatCurrencyEuro:"Euro",formatNumberCurrencyOthers:"Others",formatNumberCurrency:"Currency"},t3={hideRow:"隐藏行",hideColumn:"隐藏列",insertRow:"插入行",insertColumn:"插入列",deleteRow:"删除行",deleteColumn:"删除列",borderNone:"无框线",borderFull:"所有框线",borderOuter:"外侧框线",borderInner:"内部框线",borderBottom:"下框线",borderTop:"上框线",borderLeft:"左框线",borderRight:"右框线",cellBorder:"边框",fontColor:"字体颜色",backgroundColor:"填充颜色",mergeCells:"合并",unmergeCells:"取消合并",fontBold:"粗体",fontItalic:"斜体",fontUnderline:"下划线",fontSelect:"选择字体",fontSizeSelect:"选择字体尺寸",fontStyle:"字体",formatGeneral:"常规文本",formatNumberGeneral:"常规",formatNumberPercent:"百分比",formatNumberFraction:"分数",formatNumberScience:"科学计数",formatNumberThousands:"千分计数",formatNumber:"数字",formatTime:"时间",formatShortDate:"短日期",formatLongDate:"长日期",formatNumberDateTime:"日期时间",formatCurrencyCNY:"人民币",formatCurrencyUSD:"美元",formatCurrencyEuro:"欧元",formatNumberCurrencyOthers:"其他货币",formatNumberCurrency:"货币"},r3={En:e3,"ZH-cn":t3},Yp=qt({name:"VmaFormulaGrid",props:{data:Object,type:{type:String,default:"primary"},size:{type:String,default:"normal"},functions:{type:Object,default:null},minDims:{type:Array,default:[10,10]},defaultRowHeight:{type:Number},defaultColumnWidth:{type:Number},columnResizable:{type:Boolean,default:!0},rowResizable:{type:Boolean,default:!0},virtualScrollX:{type:Boolean,default:!0},virtualScrollY:{type:Boolean,default:!0},lang:{type:String,default:"ZH-cn"}},emits:["update:data","change"],setup(t,e){let r;Si(()=>{F().then(()=>{y.recalculate(!0).then(()=>{const D=a.value,x=y.getParentElem();r=mu(()=>{y.recalculate(!0)}),D&&r.observe(D),x&&r.observe(x),xt.on(y,"mousewheel",pe),xt.on(y,"mousedown",ye),xt.on(y,"keydown",we),y.handleContextmenuEvent&&xt.on(y,"contextmenu",y.handleContextmenuEvent),xt.on(y,"resize",ie)}).then(()=>{y.calc()}).then(()=>{y.calcCurrentCellEditorStyle(),y.calcCurrentCellEditorDisplay(),y.reCalcCurrentAreaPos(),y.updateCurrentAreaStyle()})}).finally(()=>{E.supportedFonts=Qh(),E.supportedFontSizes=Kh()})}),El(()=>{r&&r.disconnect(),y.closeMenu&&y.closeMenu()}),jm(()=>{xt.off(y,"mousedown"),xt.off(y,"mousewheel"),xt.off(y,"keydown"),xt.off(y,"resize"),xt.off(y,"contextmenu")}),yt(()=>t.data,()=>{me().then(()=>{F().then(()=>{y.recalculate(!0).then(()=>{const D=a.value,x=y.getParentElem();r=mu(()=>{y.recalculate(!0)}),D&&r.observe(D),x&&r.observe(x),xt.on(y,"mousewheel",pe),xt.on(y,"mousedown",ye),xt.on(y,"keydown",we),y.handleContextmenuEvent&&xt.on(y,"contextmenu",y.handleContextmenuEvent),xt.on(y,"resize",ie)}).finally(()=>{y.calc()})}).finally(()=>{E.supportedFonts=Qh(),E.supportedFontSizes=Kh()})})},{deep:!0}),yt(()=>t.size,()=>{y.recalculate(!1).then(()=>{y.calcCurrentCellEditorStyle(),y.calcCurrentCellEditorDisplay(),y.reCalcCurrentAreaPos(),y.updateCurrentAreaStyle()})}),yt(()=>t.type,()=>{y.recalculate(!1)}),yt(()=>t.virtualScrollX,()=>{y.recalculate(!0)}),yt(()=>t.virtualScrollY,()=>{y.recalculate(!0)});const n=Ft("VmaFormulaGridHeader"),i=Ft("VmaFormulaGridBody"),a=He(),s=He(),l=He(),u=He(),c=He(),o=He(),f=He(),h=He(),d=He(),p=He(),g=He(),m=He(),v=He(),b=He(),C=He(),A=He(),O=He(),w=He(),S=He(),N=He(),R=He(),k=He(),z=He(),Y=He(),re=He(),Q=He(),ae=He(),ve=He(),J=He(),ne=He(),se=He(),de=He(),be=He(),Ae=He(),Te=it(()=>Jm(t.defaultColumnWidth,t.size)),_e=it(()=>e0(t.defaultRowHeight,t.size)),ke=it(()=>Math.max(Zh(t.size)+E.yEnd.toString().length*Zh(t.size),54)),E=Ir({global:{},xDim:0,yDim:0,xStart:-1,xEnd:0,yStart:0,yEnd:0,scrollbarWidth:0,scrollbarHeight:0,gridWidth:0,gridHeight:0,gridHeaderWidth:0,gridHeaderHeight:0,gridBodyWidth:0,gridBodyHeight:0,gridLeftFixedHeaderWidth:0,isOverflowX:!1,isOverflowY:!1,frozenColumnCount:0,frozenRowCount:0,colConfs:[],rowConfs:[],currentSheetData:[],currentSheetDataMap:{},rowHeightsChanged:{},columnWidthsChanged:{},rowHidesChanged:{},columnHidesChanged:{},columns:{firstList:[],leftList:[],otherList:[]},lastScrollLeft:0,lastScrollLeftTime:0,lastScrollXVisibleIndex:0,lastScrollTop:0,lastScrollTopTime:0,lastScrollYVisibleIndex:0,cells:{eMap:{},cMap:{},ncMap:{}},merges:{},ctxMenuStore:{selected:null,visible:!1,showChild:!1,selectChild:null,list:[],style:null},colorPickerStore:{selected:null,visible:!1,selectValue:null,style:null},currentCell:null,currentCellBorderStyle:{transform:"translateX(0) translateY(0)",left:0,top:0,width:0,height:0},currentCellEditorStyle:{transform:"translateX(0) translateY(0)",display:"none",left:0,top:0,width:0,height:0,minWidth:0,minHeight:0,resized:!1},currentCellEditorActive:!1,currentCellEditorContent:null,currentAreaStatus:!1,currentArea:{start:null,end:null},currentAreaBorderStyle:{transform:"translateX(0) translateY(0)",left:0,top:0,width:0,height:0},currentAreaSri:-1,currentAreaEri:-1,currentAreaSci:-1,currentAreaEci:-1,currentAreaH:-1,currentAreaW:-1,currentAreaStartColIndex:-1,currentAreaStartRowIndex:-1,styles:{bgc:[],fgc:[],b:[],i:[],u:[],ff:[],fs:[]},borders:[],formats:[],supportedFonts:[],supportedFontSizes:[]});yt(()=>E.currentCell,()=>{y.calcCurrentCellEditorStyle()},{deep:!0}),yt(()=>E.currentCellEditorActive,()=>{y.calcCurrentCellEditorDisplay()}),yt(()=>E.currentArea,()=>{y.reCalcCurrentAreaPos(),y.updateCurrentAreaStyle()},{deep:!0});const G=it(()=>r3[t.lang||"ZH-cn"]),U={refGridDiv:a,refColumnResizeBarDiv:s,refRowResizeBarDiv:l,refGridHeaderTableWrapperDiv:u,refGridBodyTableWrapperDiv:c,refGridHeaderLeftFixedTableWrapperDiv:o,refGridBodyLeftFixedTableWrapperDiv:f,refGridHeaderTable:h,refGridHeaderLeftFixedTable:d,refGridBodyTable:p,refGridBodyLeftFixedTable:g,refGridBodyLeftFixedScrollWrapperDiv:m,refGridBodyYLineDiv:v,refGridBodyXLineDiv:b,refGridBodyLeftFixedYLineDiv:C,refGridBodyLeftFixedXLineDiv:A,refGridHeaderLeftFixedXLineDiv:O,refGridHeaderTableColgroup:w,refGridHeaderLeftFixedTableColgroup:S,refGridBodyTableColgroup:N,refGridBodyLeftFixedTableColgroup:R,renderDefaultColWidth:Te,renderDefaultRowHeight:_e,rowIndicatorElWidth:ke,refGridContextMenu:k,refGridColorPicker:z,refCurrentCellEditor:Y,refCurrentCellBorderTop:re,refCurrentCellBorderRight:Q,refCurrentCellBorderBottom:ae,refCurrentCellBorderLeft:ve,refCurrentCellBorderCorner:J,refCurrentAreaBorderTop:ne,refCurrentAreaBorderRight:se,refCurrentAreaBorderBottom:de,refCurrentAreaBorderLeft:be,refCurrentAreaBorderCorner:Ae},ue={getCurrentGridData:()=>{const D={conf:{},type:t.data&&t.data.type?t.data.type:"Array",arrayData:[],mapData:{data:[]}};D.conf.global=Object.assign({},E.global);const x=[];Object.keys(E.rowHeightsChanged).map(P=>{x.push({row:Number(P),height:Number(E.rowHeightsChanged[P])})}),D.conf.rowHeight=x;const _=[];Object.keys(E.columnWidthsChanged).map(P=>{_.push({col:Re(Number(P)),width:Number(E.columnWidthsChanged[P])})}),D.conf.colWidth=_;const $=[];Object.keys(E.rowHidesChanged).map(P=>{E.rowHidesChanged[P]===0&&$.push(Number(P))}),D.conf.rowHide=$;const j=[];Object.keys(E.columnHidesChanged).map(P=>{E.columnHidesChanged[P]===0&&j.push(Re(Number(P)))}),D.conf.colHide=j;const ce=[];Object.keys(E.merges).map(P=>{const W=P.split(":"),oe=W[0].split("_"),te=W[1].split("_"),q=Re(Number(oe[0])),he=oe[1],Oe=Re(Number(te[0])),Ke=te[1];ce.push(q+he+":"+Oe+Ke)}),D.conf.merges=ce,D.conf.styles=Object.assign({},E.styles),D.conf.formats=Object.assign({},E.formats),D.conf.borders=Object.assign({},E.borders);const I=[],T=[];return E.currentSheetData.forEach((P,W)=>{const oe=[];P.forEach((te,q)=>{q>0&&(te.v!==null&&te.v!==void 0?(oe.push(te.v),T.push({p:Re(q)+(W+1),v:te.v})):oe.push(null))}),I.push(oe)}),D.arrayData=I,D.mapData.data=T,JSON.parse(JSON.stringify(D))}},V={lang:()=>G.value,calc:()=>{const D=[];E.cells={eMap:{},cMap:{},ncMap:{}};const x={row:1,col:1,sheet:"calc"},_=new LF({}),$=[];E.currentSheetData.forEach(q=>{q.forEach(he=>{let Oe=!1,Ke=!0,ze=null,Le=null;if(he&&he.v&&typeof he.v=="string"&&he.v.trim().startsWith("=")){Oe=!0,ze="#DEPPARSEERROR!";try{Le=_.parse(he.v.trim().substring(1),x),Ke=!1,ze=null}catch{console.error(`parse error: ${he.col}_${he.row}`)}Ke&&$.push(`${he.col}_${he.row}`),Le!==null&&Le.find(Er=>Er.row>E.rowConfs.length||Er.col>E.colConfs.length||gi(Er.col,Er.row,E.merges))&&(ze="#REFERROR!",$.push(`${he.col+1}_${he.row+1}`),Ke=!0,Le=null),he.mv=Oe?Ke?ze:null:he&&he.v?he.v:null,he.fd=Oe?Ke?null:Le:null,he.se=ze,D.push(he)}else he.mv=he.v})});const j={};D.forEach(q=>{$.indexOf(`${q.col+1}_${q.row+1}`)>=0?E.cells.eMap[`${q.col+1}_${q.row+1}`]={c:q.col+1,r:q.row+1,children:[],ref:q}:(j[`${q.col+1}_${q.row+1}`]={c:q.col+1,r:q.row+1,children:[],ref:q},q.fd&&q.fd.length>0&&q.fd.forEach(he=>{if(he.hasOwnProperty("from")||he.hasOwnProperty("to"))for(let Oe=he.from.row;Oe<=he.to.row;Oe++)for(let Ke=he.from.col;Ke<=he.to.col;Ke++)j.hasOwnProperty(`${Ke}_${Oe}`)||$.indexOf(`${Ke}_${Oe}`)<0&&(j[`${Ke}_${Oe}`]={c:Ke,r:Oe,children:[],ref:E.currentSheetData[Oe-1][Ke]}),j[`${q.col+1}_${q.row+1}`].children.indexOf(`${Ke}_${Oe}`)<0&&j[`${q.col+1}_${q.row+1}`].children.push(`${Ke}_${Oe}`);else j.hasOwnProperty(`${he.col}_${he.row}`)||$.indexOf(`${he.col}_${he.row}`)<0&&(j[`${he.col}_${he.row}`]={c:he.col,r:he.row,children:[],ref:E.currentSheetData[he.row-1][he.col]}),j[`${q.col+1}_${q.row+1}`].children.indexOf(`${he.col}_${he.row}`)<0&&j[`${q.col+1}_${q.row+1}`].children.push(`${he.col}_${he.row}`)}))});const{noErrorVertexes:ce}=t0(j,E.cells.eMap),I=Object.keys(E.cells.eMap);if(I.length>0)for(let q=0;q<I.length;q++)E.cells.eMap[I[q]].ref.se!==null?E.cells.eMap[I[q]].ref.mv=E.cells.eMap[I[q]].ref.se:(E.cells.eMap[I[q]].ref.mv="#REFERROR!",E.cells.eMap[I[q]].ref.se="#REFERROR!");const{topological:T,noCycleVertexes:P,cycleVertexes:W}=r0(ce,{});E.cells.cMap=W,E.cells.ncMap=P;const oe=Object.keys(W);for(let q=0;q<oe.length;q++)W[oe[q]].ref.mv="#CYCLEERROR!";const te=new DF({functions:t.functions,onCell:q=>gi(q.col,q.row,E.merges)?null:E.currentSheetData[q.row-1][q.col].mv,onRange:q=>{const he=[];for(let Oe=q.from.row;Oe<=q.to.row;Oe++){const Ke=[];for(let ze=q.from.col;ze<=q.to.col;ze++)Ke.push(gi(ze,Oe,E.merges)?null:E.currentSheetData[Oe-1][ze].mv);he.push(Ke)}return he}});for(let q=0;q<T.length;q++)if(P[T[q]]&&P[T[q]].ref&&P[T[q]].ref.v&&typeof P[T[q]].ref.v=="string"&&P[T[q]].ref.v.trim().startsWith("=")){let he=!0;try{let Oe=te.parse(P[T[q]].ref.v.trim().substring(1),{row:1,col:1});Oe&&Oe.result&&(Oe=Oe.result),typeof Oe=="number"||typeof Oe=="string"?P[T[q]].ref.mv=Oe:P[T[q]].ref.mv=`${Oe}`,he=!1}catch(Oe){try{te.parseAsync(P[T[q]].ref.v.trim().substring(1),{row:1,col:1}).then(ze=>{typeof ze=="number"||typeof ze=="string"?P[T[q]].ref.mv=ze:P[T[q]].ref.mv=`${ze}`,he=!1})}catch(Ke){console.error(T[q],Oe),console.error(T[q],Ke)}}he&&(P[T[q]].ref.mv="#ERROR!",P[T[q]].ref.se="#ERROR!")}},recalculate:D=>(Xe(),D?Ue().then(()=>(Xe(),Ue())):Ue()),getParentElem(){const D=a.value;if(y){const x=y.getRefs().refGridDiv.value;return x?x.parentNode:null}return D?D.parentNode:null},triggerScrollXEvent:D=>{const x=D.currentTarget||D.target;Z(x)},triggerScrollYEvent:D=>{const x=D.currentTarget||D.target;K(x)},updateCellStyle:()=>{},mergeCells:()=>{if(y.reactiveData.currentAreaSci===y.reactiveData.currentAreaEci&&y.reactiveData.currentAreaSri===y.reactiveData.currentAreaEri)return;const D=""+(y.reactiveData.currentAreaSci+1)+"_"+(y.reactiveData.currentAreaSri+1)+":"+(y.reactiveData.currentAreaEci+1)+"_"+(y.reactiveData.currentAreaEri+1),x={colStart:y.reactiveData.currentAreaSci+1,colEnd:y.reactiveData.currentAreaEci+1,colSpan:y.reactiveData.currentAreaEci+1-(y.reactiveData.currentAreaSci+1)+1,rowStart:y.reactiveData.currentAreaSri+1,rowEnd:y.reactiveData.currentAreaEri+1,rowSpan:y.reactiveData.currentAreaEri+1-(y.reactiveData.currentAreaSri+1)+1};Object.assign(y.reactiveData.merges,{[D]:x}),y.reactiveData.currentSheetData[y.reactiveData.currentAreaSri][y.reactiveData.currentAreaSci+1].colSpan=x.colSpan,y.reactiveData.currentSheetData[y.reactiveData.currentAreaSri][y.reactiveData.currentAreaSci+1].rowSpan=x.rowSpan,gt(()=>{y.calcCurrentCellEditorStyle(),y.calcCurrentCellEditorDisplay(),y.reCalcCurrentAreaPos(),y.updateCurrentAreaStyle(),y.calc()})},unmergeCells:()=>{const D={},x={};Object.keys(y.reactiveData.merges).map(_=>{let $=_.split(":"),j=$[0].split("_"),ce=$[1].split("_"),I=Number(j[0]),T=Number(j[1]),P=Number(ce[0]),W=Number(ce[1]);I-1>=y.reactiveData.currentAreaSci&&I-1<=y.reactiveData.currentAreaEci&&P-1>=y.reactiveData.currentAreaSci&&P-1<=y.reactiveData.currentAreaEci&&T-1>=y.reactiveData.currentAreaSri&&T-1<=y.reactiveData.currentAreaEri&&W-1>=y.reactiveData.currentAreaSri&&W-1<=y.reactiveData.currentAreaEri?x[_]=Object.assign({},y.reactiveData.merges[_]):D[_]=Object.assign({},y.reactiveData.merges[_])}),Object.keys(x).map(_=>{let j=_.split(":")[0].split("_"),ce=Number(j[0]),I=Number(j[1]);y.reactiveData.currentSheetData[I-1][ce-1+1].colSpan=1,y.reactiveData.currentSheetData[I-1][ce-1+1].rowSpan=1}),y.reactiveData.merges=D,gt(()=>{y.calcCurrentCellEditorStyle(),y.calcCurrentCellEditorDisplay(),y.reCalcCurrentAreaPos(),y.updateCurrentAreaStyle(),y.calc()})},reCalcCurrentAreaPos:()=>{if(y.reactiveData.currentArea&&y.reactiveData.currentArea.start!==null&&y.reactiveData.currentArea.end!=null){const{w:D,h:x,sci:_,eci:$,sri:j,eri:ce,startRowIndex:I,startColIndex:T}=n0(Te.value,y.reactiveData.columnWidthsChanged,y.reactiveData.columnHidesChanged,_e.value,y.reactiveData.rowHeightsChanged,y.reactiveData.rowHidesChanged,E.merges,y.reactiveData.currentArea);E.currentAreaSci=_,E.currentAreaEci=$,E.currentAreaSri=j,E.currentAreaEri=ce,E.currentAreaH=x,E.currentAreaW=D,E.currentAreaStartColIndex=T,E.currentAreaStartRowIndex=I}},updateCurrentAreaStyle:()=>{if(y.reactiveData.currentArea&&y.reactiveData.currentArea.start!==null&&y.reactiveData.currentArea.end!=null){const D=Eo(y.reactiveData.xStart,Te.value,y.reactiveData.columnWidthsChanged,y.reactiveData.columnHidesChanged),x=Oo(y.reactiveData.yStart,_e.value,y.reactiveData.rowHeightsChanged,y.reactiveData.rowHidesChanged);gt(()=>{const _=p.value.querySelectorAll(`td[data-row="${y.reactiveData.currentAreaStartRowIndex}"][data-col="${y.reactiveData.currentAreaStartColIndex}"]`);if(_.length>0){const $=D+_[0].offsetLeft-1,j=x+_[0].offsetTop-1;y.reactiveData.currentAreaBorderStyle.transform=`translateX(${$}px) translateY(${j}px)`,y.reactiveData.currentAreaBorderStyle.height=`${y.reactiveData.currentAreaH}px`,y.reactiveData.currentAreaBorderStyle.width=`${y.reactiveData.currentAreaW}px`}})}else y.reactiveData.currentAreaBorderStyle={transform:"translateX(0) translateY(0)",left:0,top:0,width:0,height:0}},calcCurrentCellEditorStyle:()=>{E.currentCell&&gt(()=>{const D=Eo(E.xStart,Te.value,E.columnWidthsChanged,E.columnHidesChanged),x=Oo(E.yStart,_e.value,E.rowHeightsChanged,E.rowHidesChanged),{row:_,col:$}=E.currentCell,j=p.value.querySelectorAll(`td[data-row="${_}"][data-col="${$}"]`);j.length>0?j.forEach(ce=>{const I=`${D+ce.offsetLeft}px`,T=`${x+ce.offsetTop}px`,P=`${D+ce.offsetLeft-1}px`,W=`${x+ce.offsetTop-1}px`;E.currentCellEditorStyle.transform=`translateX(${I}) translateY(${T})`,E.currentCellEditorStyle.resized||(E.currentCellEditorStyle.height=`${ce.offsetHeight-1}px`,E.currentCellEditorStyle.width=`${ce.offsetWidth-1}px`),E.currentCellEditorStyle.minHeight=`${ce.offsetHeight-1}px`,E.currentCellEditorStyle.minWidth=`${ce.offsetWidth-1}px`,E.currentCellBorderStyle.transform=`translateX(${P}) translateY(${W})`,E.currentCellBorderStyle.height=`${ce.offsetHeight}px`,E.currentCellBorderStyle.width=`${ce.offsetWidth}px`}):E.currentCell=null})},calcCurrentCellEditorDisplay:()=>{if(E.currentCell){const{row:D,col:x}=E.currentCell;D<=E.yEnd&&D>=E.yStart&&x<=E.xEnd&&x>=E.xStart&&E.currentCellEditorActive?E.currentCellEditorStyle.display="block":E.currentCellEditorStyle.display="none"}else E.currentCellEditorStyle.display="none"},insertColumn:D=>{L("insertColumn",D,null),E.colConfs.map(_=>(_.index>=D&&(_.index+=1),_));let x=!0;E.columnHidesChanged.hasOwnProperty((D+1).toString())&&(x=!1,E.columnHidesChanged[D.toString()]=0),E.colConfs.splice(D+1,0,new nd(Number(D),"default",x)),E.currentSheetData.map((_,$)=>(_.map(j=>(j.colSpan&&j.colSpan>1&&j.col<D&&j.col+j.colSpan>=D&&(j.colSpan+=1),j.col>=D&&(j.col+=1),null)),_.splice(D+1,0,new Ac($,D,1,1,null,null,null,null,!1,-1,"17","","",null,null,null,null,!1,!1,!1,null,null,"","")),null)),y.recalculate(!0).then(()=>{y.calcCurrentCellEditorStyle(),y.calcCurrentCellEditorDisplay(),y.reCalcCurrentAreaPos(),y.updateCurrentAreaStyle()}).then(()=>{y.calc()})},insertRow:D=>{L("insertRow",null,D),E.rowConfs.map($=>($.index>=D&&($.index+=1),$));let x=!0;E.rowHidesChanged.hasOwnProperty((D+1).toString())&&(x=!1,E.rowHidesChanged[D.toString()]=0),E.rowConfs.splice(D,0,new id(Number(D),"default",x)),E.currentSheetData.map(($,j)=>($.map(ce=>(ce.rowSpan&&ce.rowSpan>1&&ce.row<D&&ce.row+ce.rowSpan>=D&&(ce.rowSpan+=1),ce.row>=D&&(ce.row+=1),null)),null));const _=[];for(let $=-1;$<E.colConfs.length-1;$++)_.push(new Ac(Number(D),$,1,1,null,null,null,null,!1,-1,"17","","",null,null,null,null,!1,!1,!1,null,null,"",""));E.currentSheetData.splice(Number(D),0,_),y.recalculate(!0).then(()=>{y.calcCurrentCellEditorStyle(),y.calcCurrentCellEditorDisplay(),y.reCalcCurrentAreaPos(),y.updateCurrentAreaStyle()}).then(()=>{y.calc()})},hideColumn:D=>{L("hideColumn",D,null),E.colConfs[D+1].visible=!1,y.recalculate(!1).then(()=>{y.calcCurrentCellEditorStyle(),y.calcCurrentCellEditorDisplay(),y.reCalcCurrentAreaPos(),y.updateCurrentAreaStyle()})},hideRow:D=>{L("hideRow",null,D),E.rowConfs[D].visible=!1,y.recalculate(!1).then(()=>{y.calcCurrentCellEditorStyle(),y.calcCurrentCellEditorDisplay(),y.reCalcCurrentAreaPos(),y.updateCurrentAreaStyle()})},deleteColumn:D=>{L("deleteColumn",D,null),E.colConfs.map(x=>(x.index>=D&&(x.index-=1),x)),E.colConfs.splice(D+1,1),D+1<=E.colConfs.length-1&&E.currentSheetData.map((x,_)=>{x[D+1].colSpan&&x[D+1].colSpan>1&&(x[D+1+1].rowSpan=x[D+1].rowSpan,x[D+1+1].colSpan=x[D+1].colSpan-1)}),E.currentSheetData.map((x,_)=>(x.map($=>($.colSpan&&$.colSpan>1&&$.col<=D&&$.col+$.colSpan>D&&($.colSpan-=1),$.col>=D&&($.col-=1),null)),x.splice(D+1,1),null)),y.recalculate(!0).then(()=>{y.calcCurrentCellEditorStyle(),y.calcCurrentCellEditorDisplay(),y.reCalcCurrentAreaPos(),y.updateCurrentAreaStyle()}).then(()=>{y.calc()}),ee()},deleteRow:D=>{L("deleteRow",null,D),E.rowConfs.map(x=>(x.index>=D&&(x.index-=1),x)),E.rowConfs.splice(D,1),D+1<=E.currentSheetData.length&&E.currentSheetData[D].map(x=>{x.rowSpan&&x.rowSpan>1&&(E.currentSheetData[D+1][x.col+1].colSpan=x.colSpan,E.currentSheetData[D+1][x.col+1].rowSpan=x.rowSpan-1)}),E.currentSheetData.map((x,_)=>(x.map($=>($.rowSpan&&$.rowSpan>1&&$.row<=D&&$.row+$.rowSpan>D&&($.rowSpan-=1),$.row>=D&&($.row-=1),null)),null)),E.currentSheetData.splice(Number(D),1),y.recalculate(!0).then(()=>{y.calcCurrentCellEditorStyle(),y.calcCurrentCellEditorDisplay(),y.updateCurrentAreaStyle(),y.reCalcCurrentAreaPos(),y.updateCurrentAreaStyle()}).then(()=>{y.calc()}),ee()},setCellBorder:(D,x)=>{if(D==="cells"){const _={};x==="none"&&(_.none=!0),x==="full"&&(_.full=!0),x==="outer"&&(_.outer=!0),x==="inner"&&(_.inner=!0),x==="l"&&(_.left=!0),x==="t"&&(_.top=!0),x==="r"&&(_.right=!0),x==="b"&&(_.bottom=!0);const $=Re(y.reactiveData.currentAreaSci+1)+(y.reactiveData.currentAreaSri+1),j=Re(y.reactiveData.currentAreaEci+1)+(y.reactiveData.currentAreaEri+1),ce=$===j?$:$+":"+j;E.borders.push({p:ce,details:_,type:"cells"});for(let I=y.reactiveData.currentAreaSci;I<=y.reactiveData.currentAreaEci;I++)for(let T=y.reactiveData.currentAreaSri;T<=y.reactiveData.currentAreaEri;T++){const{bg:P}=ni(I,T,y.reactiveData.styles),{bdl:W,bdt:oe,bdr:te,bdb:q}=bc(I,T,E.borders,E.colConfs.length,E.rowConfs.length);y.reactiveData.currentSheetData[T][I+1].bgt=Ec(P.length>0,W,oe,te,q)}}},setBackgroundColor:(D,x,_)=>{if(D==="cells"){const $=Re(y.reactiveData.currentAreaSci+1)+(y.reactiveData.currentAreaSri+1),j=Re(y.reactiveData.currentAreaEci+1)+(y.reactiveData.currentAreaEri+1),ce=$===j?$:$+":"+j;E.styles.bgc.push({p:ce,color:x==="none"?"none":_,type:"cells"});for(let I=y.reactiveData.currentAreaSci;I<=y.reactiveData.currentAreaEci;I++)for(let T=y.reactiveData.currentAreaSri;T<=y.reactiveData.currentAreaEri;T++){const{bg:P}=ni(I,T,y.reactiveData.styles),{bdl:W,bdt:oe,bdr:te,bdb:q}=bc(I,T,E.borders,E.colConfs.length,E.rowConfs.length);y.reactiveData.currentSheetData[T][I+1].bg=P,y.reactiveData.currentSheetData[T][I+1].bgt=Ec(P.length>0,W,oe,te,q)}}},setFontColor:(D,x,_)=>{if(D==="cells"){const $=Re(y.reactiveData.currentAreaSci+1)+(y.reactiveData.currentAreaSri+1),j=Re(y.reactiveData.currentAreaEci+1)+(y.reactiveData.currentAreaEri+1),ce=$===j?$:$+":"+j;E.styles.fgc.push({p:ce,color:x==="none"?"none":_,type:"cells"});for(let I=y.reactiveData.currentAreaSci;I<=y.reactiveData.currentAreaEci;I++)for(let T=y.reactiveData.currentAreaSri;T<=y.reactiveData.currentAreaEri;T++){const{fg:P}=ni(I,T,y.reactiveData.styles);y.reactiveData.currentSheetData[T][I+1].fg=P}}},setFontStyle:(D,x,_)=>{if(D==="cells"){if(x==="fontBold"){const $=Re(y.reactiveData.currentAreaSci+1)+(y.reactiveData.currentAreaSri+1),j=Re(y.reactiveData.currentAreaEci+1)+(y.reactiveData.currentAreaEri+1),ce=$===j?$:$+":"+j;E.styles.b.push({p:ce,v:!_,type:"cells"});for(let I=y.reactiveData.currentAreaSci;I<=y.reactiveData.currentAreaEci;I++)for(let T=y.reactiveData.currentAreaSri;T<=y.reactiveData.currentAreaEri;T++){const{b:P}=ni(I,T,y.reactiveData.styles);y.reactiveData.currentSheetData[T][I+1].b=P}}if(x==="fontItalic"){const $=Re(y.reactiveData.currentAreaSci+1)+(y.reactiveData.currentAreaSri+1),j=Re(y.reactiveData.currentAreaEci+1)+(y.reactiveData.currentAreaEri+1),ce=$===j?$:$+":"+j;E.styles.i.push({p:ce,v:!_,type:"cells"});for(let I=y.reactiveData.currentAreaSci;I<=y.reactiveData.currentAreaEci;I++)for(let T=y.reactiveData.currentAreaSri;T<=y.reactiveData.currentAreaEri;T++){const{i:P}=ni(I,T,y.reactiveData.styles);y.reactiveData.currentSheetData[T][I+1].i=P}}if(x==="fontUnderline"){const $=Re(y.reactiveData.currentAreaSci+1)+(y.reactiveData.currentAreaSri+1),j=Re(y.reactiveData.currentAreaEci+1)+(y.reactiveData.currentAreaEri+1),ce=$===j?$:$+":"+j;E.styles.u.push({p:ce,v:!_,type:"cells"});for(let I=y.reactiveData.currentAreaSci;I<=y.reactiveData.currentAreaEci;I++)for(let T=y.reactiveData.currentAreaSri;T<=y.reactiveData.currentAreaEri;T++){const{u:P}=ni(I,T,y.reactiveData.styles);y.reactiveData.currentSheetData[T][I+1].u=P}}if(x==="fontSelect"){const $=Re(y.reactiveData.currentAreaSci+1)+(y.reactiveData.currentAreaSri+1),j=Re(y.reactiveData.currentAreaEci+1)+(y.reactiveData.currentAreaEri+1),ce=$===j?$:$+":"+j,I=lE(_);E.styles.ff.push({p:ce,v:I||"none",type:"cells"});for(let T=y.reactiveData.currentAreaSci;T<=y.reactiveData.currentAreaEci;T++)for(let P=y.reactiveData.currentAreaSri;P<=y.reactiveData.currentAreaEri;P++)y.reactiveData.currentSheetData[P][T+1].ff=_}if(x==="fontSizeSelect"){const $=Re(y.reactiveData.currentAreaSci+1)+(y.reactiveData.currentAreaSri+1),j=Re(y.reactiveData.currentAreaEci+1)+(y.reactiveData.currentAreaEri+1),ce=$===j?$:$+":"+j;E.styles.fs.push({p:ce,v:_||"none",type:"cells"});for(let I=y.reactiveData.currentAreaSci;I<=y.reactiveData.currentAreaEci;I++)for(let T=y.reactiveData.currentAreaSri;T<=y.reactiveData.currentAreaEri;T++)y.reactiveData.currentSheetData[T][I+1].fs=_}if(x==="fontSizeUp"){const $=Re(y.reactiveData.currentAreaSci+1)+(y.reactiveData.currentAreaSri+1),j=Re(y.reactiveData.currentAreaEci+1)+(y.reactiveData.currentAreaEri+1),ce=$===j?$:$+":"+j,I=Math.min(288,Number(_)+4);E.styles.fs.push({p:ce,v:I,type:"cells"});for(let T=y.reactiveData.currentAreaSci;T<=y.reactiveData.currentAreaEci;T++)for(let P=y.reactiveData.currentAreaSri;P<=y.reactiveData.currentAreaEri;P++)y.reactiveData.currentSheetData[P][T+1].fs=I}if(x==="fontSizeDown"){const $=Re(y.reactiveData.currentAreaSci+1)+(y.reactiveData.currentAreaSri+1),j=Re(y.reactiveData.currentAreaEci+1)+(y.reactiveData.currentAreaEri+1),ce=$===j?$:$+":"+j,I=Math.max(6,Number(_)-4);E.styles.fs.push({p:ce,v:I,type:"cells"});for(let T=y.reactiveData.currentAreaSci;T<=y.reactiveData.currentAreaEci;T++)for(let P=y.reactiveData.currentAreaSri;P<=y.reactiveData.currentAreaEri;P++)y.reactiveData.currentSheetData[P][T+1].fs=I}}},setCellFormat:(D,x,_)=>{if(D==="cells")if(x==="formatGeneral"){const $=Re(y.reactiveData.currentAreaSci+1)+(y.reactiveData.currentAreaSri+1),j=Re(y.reactiveData.currentAreaEci+1)+(y.reactiveData.currentAreaEri+1),ce=$===j?$:$+":"+j;E.formats.push({p:ce,details:{type:"g"},type:"cells"});for(let I=y.reactiveData.currentAreaSci;I<=y.reactiveData.currentAreaEci;I++)for(let T=y.reactiveData.currentAreaSri;T<=y.reactiveData.currentAreaEri;T++){const{g:P,gf:W}=yc(I,T,y.reactiveData.formats);y.reactiveData.currentSheetData[T][I+1].gf=W,y.reactiveData.currentSheetData[T][I+1].g=P}}else{const $={type:"unknown",v:""};if(x==="formatNumberGeneral"&&($.type="n",$.v=E.global.formats.n.general),x==="formatNumberPercent"&&($.type="n",$.v=E.global.formats.n.percent),x==="formatNumberScience"&&($.type="n",$.v=E.global.formats.n.science),x==="formatNumberFraction"&&($.type="n",$.v=E.global.formats.n.fraction),x==="formatNumberThousands"&&($.type="n",$.v=E.global.formats.n.thousands),x==="formatTime"&&($.type="d",$.v=E.global.formats.d.time),x==="formatShortDate"&&($.type="d",$.v=E.global.formats.d.shortDate),x==="formatLongDate"&&($.type="d",$.v=E.global.formats.d.longDate),x==="formatCurrencyCNY"&&($.type="c",$.v=E.global.formats.c.cny),x==="formatCurrencyUSD"&&($.type="c",$.v=E.global.formats.c.usd),x==="formatCurrencyEuro"&&($.type="c",$.v=E.global.formats.c.euro),x==="formatCurrencyOthers"&&($.type="c",$.v=_),console.log($),$.type!=="unknown"){const j=Re(y.reactiveData.currentAreaSci+1)+(y.reactiveData.currentAreaSri+1),ce=Re(y.reactiveData.currentAreaEci+1)+(y.reactiveData.currentAreaEri+1),I=j===ce?j:j+":"+ce;E.formats.push({p:I,details:$,type:"cells"});for(let T=y.reactiveData.currentAreaSci;T<=y.reactiveData.currentAreaEci;T++)for(let P=y.reactiveData.currentAreaSri;P<=y.reactiveData.currentAreaEri;P++){const{g:W,gf:oe}=yc(T,P,y.reactiveData.formats);y.reactiveData.currentSheetData[P][T+1].gf=oe,y.reactiveData.currentSheetData[P][T+1].g=W}}}},updateColVisible:(D,x,_)=>{if(D==="showForwardCols"&&Object.keys(E.columnHidesChanged).length){if(x===_){let $=0;const j=[];for(;E.columnHidesChanged.hasOwnProperty(`${Number(x)-$}`);)E.colConfs[Number(x)-$].visible=!0,j.push(`${Number(x)-$}`),$++;const ce={};Object.keys(E.columnHidesChanged).map(I=>(j.indexOf(I)<0&&(ce[I]=E.columnHidesChanged[I]),null)),E.columnHidesChanged=ce}y.recalculate(!1).then(()=>{y.calcCurrentCellEditorStyle(),y.calcCurrentCellEditorDisplay(),y.reCalcCurrentAreaPos(),y.updateCurrentAreaStyle()})}if(D==="showBackwardCols"&&Object.keys(E.columnHidesChanged).length){if(x===_){let $=2;const j=[];for(;E.columnHidesChanged.hasOwnProperty(`${Number(x)+$}`);)E.colConfs[Number(x)+$].visible=!0,j.push(`${Number(x)+$}`),$++;const ce={};Object.keys(E.columnHidesChanged).map(I=>(j.indexOf(I)<0&&(ce[I]=E.columnHidesChanged[I]),null)),E.columnHidesChanged=ce}y.recalculate(!1).then(()=>{y.calcCurrentCellEditorStyle(),y.calcCurrentCellEditorDisplay(),y.reCalcCurrentAreaPos(),y.updateCurrentAreaStyle()})}},updateRowVisible:(D,x,_)=>{if(D==="showUpRows"&&Object.keys(E.rowHidesChanged).length){if(x===_){let $=0;const j=[];for(;E.rowHidesChanged.hasOwnProperty(`${Number(x)-$}`);)E.rowConfs[Number(x)-$-1].visible=!0,j.push(`${Number(x)-$}`),$++;const ce={};Object.keys(E.rowHidesChanged).map(I=>(j.indexOf(I)<0&&(ce[I]=E.rowHidesChanged[I]),null)),E.rowHidesChanged=ce}y.recalculate(!1).then(()=>{y.calcCurrentCellEditorStyle(),y.calcCurrentCellEditorDisplay(),y.reCalcCurrentAreaPos(),y.updateCurrentAreaStyle()})}if(D==="showDownRows"&&Object.keys(E.rowHidesChanged).length){if(x===_){let $=2;const j=[];for(;E.rowHidesChanged.hasOwnProperty(`${Number(x)+$}`);)E.rowConfs[Number(x)+$-1].visible=!0,j.push(`${Number(x)+$}`),$++;const ce={};Object.keys(E.rowHidesChanged).map(I=>(j.indexOf(I)<0&&(ce[I]=E.rowHidesChanged[I]),null)),E.rowHidesChanged=ce}y.recalculate(!1).then(()=>{y.calcCurrentCellEditorStyle(),y.calcCurrentCellEditorDisplay(),y.reCalcCurrentAreaPos(),y.updateCurrentAreaStyle()})}}},ee=()=>{E.currentCell&&(E.currentCell.row<0||E.currentCell.col<0)&&(E.currentCell=null)},L=(D,x,_)=>{if(D==="hideColumn"&&(E.columnHidesChanged[x+1]=0),D==="hideRow"&&(E.rowHidesChanged[_+1]=0),D==="deleteColumn"){const $={};Object.keys(E.columnHidesChanged).map(I=>{if(Number(I)>x){const T=Number(I)-1;$[T]=E.columnHidesChanged[I]}else $[I]=E.columnHidesChanged[I];return null}),E.columnHidesChanged=$;const j={};Object.keys(E.columnWidthsChanged).map(I=>{if(Number(I)>x){const T=Number(I)-1;j[T]=E.columnWidthsChanged[I]}else j[I]=E.columnWidthsChanged[I];return null}),E.columnWidthsChanged=j;const ce={};if(Object.keys(E.merges).map(I=>{const T=I.split(":"),P=T[0].split("_"),W=T[1].split("_");Number(P[0])>x?(P[0]=(Number(P[0])-1).toString(),W[0]=(Number(W[0])-1).toString()):Number(P[0])<=x&&x<Number(W[0])&&(W[0]=(Number(W[0])-1).toString()),Number(P[0])===0&&Number(W[0])===0||(Number(P[0])===0&&Number(W[0])>0&&(P[0]="1"),ce[`${P.join("_")+":"+W.join("_")}`]={colStart:Number(P[0]),colEnd:Number(W[0]),colSpan:Number(W[0])-Number(P[0])+1,rowStart:Number(P[1]),rowEnd:Number(W[1]),rowSpan:Number(W[1])-Number(P[1])+1})}),E.merges=ce,y.reactiveData.styles){if(y.reactiveData.styles&&y.reactiveData.styles.bgc&&y.reactiveData.styles.bgc.length>0){const I=[];y.reactiveData.borders.forEach(T=>{if(T.hasOwnProperty("type")&&(T.type==="columns"||T.type==="cells")){if(T.type==="columns"&&T.hasOwnProperty("p")&&T.p.length>0){const P=[];T.p.forEach(W=>{if(W.indexOf(":")>=0){let oe=W.split(":");oe=oe.map(he=>le(he));let te=Math.min(...oe),q=Math.max(...oe);x+1<te?(te-=1,q-=1):x+1>=te&&x+1<=q&&(q-=1),q>=te&&P.push(Re(te)+":"+Re(q))}else x+1<le(W)?P.push(Re(le(W)-1)):x+1>le(W)&&P.push(W)}),P.length>0&&I.push(Object.assign({},T,{p:P}))}if(T.type==="cells"&&T.hasOwnProperty("p")&&T.p.length>0)if(T.p.indexOf(":")>=0){let P=T.p.split(":"),W=P[0],oe=P[1],te=W.replace(/[0-9]/g,""),q=parseInt(W.replace(/[^0-9]/gi,"")),he=oe.replace(/[0-9]/g,""),Oe=parseInt(oe.replace(/[^0-9]/gi,""));x+1<Math.min(le(te),le(he))?(te=Re(le(te)-1),he=Re(le(he)-1)):(x+1>=le(te)&&x+1<=le(he)||x+1>=le(he)&&x+1<=le(te))&&(le(he)>le(te)?he=Re(le(he)-1):te=Re(le(te)-1)),I.push(Object.assign({},T,{p:te+q+":"+he+Oe}))}else{let P=T.p.replace(/[0-9]/g,""),W=parseInt(T.p.replace(/[^0-9]/gi,""));x+1<le(P)?(P=Re(le(P)-1),I.push(Object.assign({},T,{p:P+W}))):x+1>le(P)&&I.push(Object.assign({},T,{p:P+W}))}}else T.hasOwnProperty("type")&&T.type==="rows"&&I.push(Object.assign({},T))}),y.reactiveData.styles.bgc=I}if(y.reactiveData.styles&&y.reactiveData.styles.fgc&&y.reactiveData.styles.fgc.length>0){const I=[];y.reactiveData.borders.forEach(T=>{if(T.hasOwnProperty("type")&&(T.type==="columns"||T.type==="cells")){if(T.type==="columns"&&T.hasOwnProperty("p")&&T.p.length>0){const P=[];T.p.forEach(W=>{if(W.indexOf(":")>=0){let oe=W.split(":");oe=oe.map(he=>le(he));let te=Math.min(...oe),q=Math.max(...oe);x+1<te?(te-=1,q-=1):x+1>=te&&x+1<=q&&(q-=1),q>=te&&P.push(Re(te)+":"+Re(q))}else x+1<le(W)?P.push(Re(le(W)-1)):x+1>le(W)&&P.push(W)}),P.length>0&&I.push(Object.assign({},T,{p:P}))}if(T.type==="cells"&&T.hasOwnProperty("p")&&T.p.length>0)if(T.p.indexOf(":")>=0){let P=T.p.split(":"),W=P[0],oe=P[1],te=W.replace(/[0-9]/g,""),q=parseInt(W.replace(/[^0-9]/gi,"")),he=oe.replace(/[0-9]/g,""),Oe=parseInt(oe.replace(/[^0-9]/gi,""));x+1<Math.min(le(te),le(he))?(te=Re(le(te)-1),he=Re(le(he)-1)):(x+1>=le(te)&&x+1<=le(he)||x+1>=le(he)&&x+1<=le(te))&&(le(he)>le(te)?he=Re(le(he)-1):te=Re(le(te)-1)),I.push(Object.assign({},T,{p:te+q+":"+he+Oe}))}else{let P=T.p.replace(/[0-9]/g,""),W=parseInt(T.p.replace(/[^0-9]/gi,""));x+1<le(P)?(P=Re(le(P)-1),I.push(Object.assign({},T,{p:P+W}))):x+1>le(P)&&I.push(Object.assign({},T,{p:P+W}))}}else T.hasOwnProperty("type")&&T.type==="rows"&&I.push(Object.assign({},T))}),y.reactiveData.styles.fgc=I}}if(y.reactiveData.borders&&y.reactiveData.borders.length>0){const I=[];y.reactiveData.borders.forEach(T=>{if(T.hasOwnProperty("type")&&(T.type==="columns"||T.type==="cells")){if(T.type==="columns"&&T.hasOwnProperty("p")&&T.p.length>0){const P=[];T.p.forEach(W=>{if(W.indexOf(":")>=0){let oe=W.split(":");oe=oe.map(he=>le(he));let te=Math.min(...oe),q=Math.max(...oe);x+1<te?(te-=1,q-=1):x+1>=te&&x+1<=q&&(q-=1),q>=te&&P.push(Re(te)+":"+Re(q))}else x+1<le(W)?P.push(Re(le(W)-1)):x+1>le(W)&&P.push(W)}),P.length>0&&I.push(Object.assign({},T,{p:P}))}if(T.type==="cells"&&T.hasOwnProperty("p")&&T.p.length>0)if(T.p.indexOf(":")>=0){let P=T.p.split(":"),W=P[0],oe=P[1],te=W.replace(/[0-9]/g,""),q=parseInt(W.replace(/[^0-9]/gi,"")),he=oe.replace(/[0-9]/g,""),Oe=parseInt(oe.replace(/[^0-9]/gi,""));x+1<Math.min(le(te),le(he))?(te=Re(le(te)-1),he=Re(le(he)-1)):(x+1>=le(te)&&x+1<=le(he)||x+1>=le(he)&&x+1<=le(te))&&(le(he)>le(te)?he=Re(le(he)-1):te=Re(le(te)-1)),I.push(Object.assign({},T,{p:te+q+":"+he+Oe}))}else{let P=T.p.replace(/[0-9]/g,""),W=parseInt(T.p.replace(/[^0-9]/gi,""));x+1<le(P)?(P=Re(le(P)-1),I.push(Object.assign({},T,{p:P+W}))):x+1>le(P)&&I.push(Object.assign({},T,{p:P+W}))}}else T.hasOwnProperty("type")&&T.type==="rows"&&I.push(Object.assign({},T))}),y.reactiveData.borders=I}if(y.reactiveData.currentArea&&y.reactiveData.currentArea.start!==null&&y.reactiveData.currentArea.end!=null){const{start:I,end:T}=y.reactiveData.currentArea;(I.col===x||T.col===x)&&(I.col===T.col?(y.reactiveData.currentArea={start:null,end:null},y.reactiveData.currentAreaStatus=!1):I.col<T.col?(I.col===x&&(y.reactiveData.currentArea.start=y.reactiveData.currentSheetData[I.row][I.col+1+1]),T.col===x&&(y.reactiveData.currentArea.end=y.reactiveData.currentSheetData[T.row][T.col+1-1])):I.col>T.col&&(T.col===x&&(y.reactiveData.currentArea.end=y.reactiveData.currentSheetData[T.row][T.col+1+1]),I.col===x&&(y.reactiveData.currentArea.start=y.reactiveData.currentSheetData[I.row][I.col+1-1])))}}if(D==="deleteRow"){const $={};Object.keys(E.rowHidesChanged).map(I=>{if(Number(I)>_){const T=Number(I)-1;$[T]=E.rowHidesChanged[I]}else $[I]=E.rowHidesChanged[I];return null}),E.rowHidesChanged=$;const j={};Object.keys(E.rowHeightsChanged).map(I=>{if(Number(I)>_){const T=Number(I)-1;j[T]=E.rowHeightsChanged[I]}else j[I]=E.rowHeightsChanged[I];return null}),E.rowHeightsChanged=j;const ce={};if(Object.keys(E.merges).map(I=>{const T=I.split(":"),P=T[0].split("_"),W=T[1].split("_");Number(P[1])>_+1?(P[1]=(Number(P[1])-1).toString(),W[1]=(Number(W[1])-1).toString()):Number(P[1])<=_+1&&_+1<=Number(W[1])&&(W[1]=(Number(W[1])-1).toString()),Number(P[1])===0&&Number(W[1])===0||(Number(P[1])===0&&Number(W[1])>0&&(P[1]="1"),ce[`${P.join("_")+":"+W.join("_")}`]={colStart:Number(P[0]),colEnd:Number(W[0]),colSpan:Number(W[0])-Number(P[0])+1,rowStart:Number(P[1]),rowEnd:Number(W[1]),rowSpan:Number(W[1])-Number(P[1])+1})}),E.merges=ce,y.reactiveData.styles){if(y.reactiveData.styles&&y.reactiveData.styles.bgc&&y.reactiveData.styles.bgc.length>0){const I=[];y.reactiveData.styles.bgc.forEach(T=>{if(T.hasOwnProperty("type")&&(T.type==="rows"||T.type==="cells")){if(T.type==="rows"&&T.hasOwnProperty("p")&&T.p.length>0){const P=[];T.p.forEach(W=>{if(typeof W=="string"&&W.indexOf(":")>=0){let oe=W.split(":");oe=oe.map(Number);let te=Math.min(...oe),q=Math.max(...oe);_+1<te?(te-=1,q-=1):_+1>=te&&_+1<=q&&(q-=1),q>=te&&P.push(""+te+":"+q)}else typeof W=="number"&&(_+1<W?P.push(W-1):_+1>W&&P.push(W))}),P.length>0&&I.push(Object.assign({},T,{p:P}))}if(T.type==="cells"&&T.hasOwnProperty("p")&&T.p.length>0)if(T.p.indexOf(":")>=0){let P=T.p.split(":"),W=P[0],oe=P[1],te=W.replace(/[0-9]/g,""),q=parseInt(W.replace(/[^0-9]/gi,"")),he=oe.replace(/[0-9]/g,""),Oe=parseInt(oe.replace(/[^0-9]/gi,""));_+1<Math.min(q,Oe)?(q-=1,Oe-=1):(_+1>=q&&_+1<=Oe||_+1>=Oe&&_+1<=q)&&(Oe>q?Oe-=1:q-=1),I.push(Object.assign({},T,{p:te+q+":"+he+Oe}))}else{let P=T.p.replace(/[0-9]/g,""),W=parseInt(T.p.replace(/[^0-9]/gi,""));_+1<W?(W-=1,I.push(Object.assign({},T,{p:P+W}))):_+1>W&&I.push(Object.assign({},T,{p:P+W}))}}else T.hasOwnProperty("type")&&T.type==="columns"&&I.push(Object.assign({},T))}),y.reactiveData.styles.bgc=I}if(y.reactiveData.styles&&y.reactiveData.styles.fgc&&y.reactiveData.styles.fgc.length>0){const I=[];y.reactiveData.styles.fgc.forEach(T=>{if(T.hasOwnProperty("type")&&(T.type==="rows"||T.type==="cells")){if(T.type==="rows"&&T.hasOwnProperty("p")&&T.p.length>0){const P=[];T.p.forEach(W=>{if(typeof W=="string"&&W.indexOf(":")>=0){let oe=W.split(":");oe=oe.map(Number);let te=Math.min(...oe),q=Math.max(...oe);_+1<te?(te-=1,q-=1):_+1>=te&&_+1<=q&&(q-=1),q>=te&&P.push(""+te+":"+q)}else typeof W=="number"&&(_+1<W?P.push(W-1):_+1>W&&P.push(W))}),P.length>0&&I.push(Object.assign({},T,{p:P}))}if(T.type==="cells"&&T.hasOwnProperty("p")&&T.p.length>0)if(T.p.indexOf(":")>=0){let P=T.p.split(":"),W=P[0],oe=P[1],te=W.replace(/[0-9]/g,""),q=parseInt(W.replace(/[^0-9]/gi,"")),he=oe.replace(/[0-9]/g,""),Oe=parseInt(oe.replace(/[^0-9]/gi,""));_+1<Math.min(q,Oe)?(q-=1,Oe-=1):(_+1>=q&&_+1<=Oe||_+1>=Oe&&_+1<=q)&&(Oe>q?Oe-=1:q-=1),I.push(Object.assign({},T,{p:te+q+":"+he+Oe}))}else{let P=T.p.replace(/[0-9]/g,""),W=parseInt(T.p.replace(/[^0-9]/gi,""));_+1<W?(W-=1,I.push(Object.assign({},T,{p:P+W}))):_+1>W&&I.push(Object.assign({},T,{p:P+W}))}}else T.hasOwnProperty("type")&&T.type==="columns"&&I.push(Object.assign({},T))}),y.reactiveData.styles.fgc=I}}if(y.reactiveData.borders&&y.reactiveData.borders.length>0){const I=[];y.reactiveData.borders.forEach(T=>{if(T.hasOwnProperty("type")&&(T.type==="rows"||T.type==="cells")){if(T.type==="rows"&&T.hasOwnProperty("p")&&T.p.length>0){const P=[];T.p.forEach(W=>{if(typeof W=="string"&&W.indexOf(":")>=0){let oe=W.split(":");oe=oe.map(Number);let te=Math.min(...oe),q=Math.max(...oe);_+1<te?(te-=1,q-=1):_+1>=te&&_+1<=q&&(q-=1),q>=te&&P.push(""+te+":"+q)}else typeof W=="number"&&(_+1<W?P.push(W-1):_+1>W&&P.push(W))}),P.length>0&&I.push(Object.assign({},T,{p:P}))}if(T.type==="cells"&&T.hasOwnProperty("p")&&T.p.length>0)if(T.p.indexOf(":")>=0){let P=T.p.split(":"),W=P[0],oe=P[1],te=W.replace(/[0-9]/g,""),q=parseInt(W.replace(/[^0-9]/gi,"")),he=oe.replace(/[0-9]/g,""),Oe=parseInt(oe.replace(/[^0-9]/gi,""));_+1<Math.min(q,Oe)?(q-=1,Oe-=1):(_+1>=q&&_+1<=Oe||_+1>=Oe&&_+1<=q)&&(Oe>q?Oe-=1:q-=1),I.push(Object.assign({},T,{p:te+q+":"+he+Oe}))}else{let P=T.p.replace(/[0-9]/g,""),W=parseInt(T.p.replace(/[^0-9]/gi,""));_+1<W?(W-=1,I.push(Object.assign({},T,{p:P+W}))):_+1>W&&I.push(Object.assign({},T,{p:P+W}))}}else T.hasOwnProperty("type")&&T.type==="columns"&&I.push(Object.assign({},T))}),y.reactiveData.borders=I}if(y.reactiveData.currentArea&&y.reactiveData.currentArea.start!==null&&y.reactiveData.currentArea.end!=null){const{start:I,end:T}=y.reactiveData.currentArea;(I.row===_||T.row===_)&&(I.row===T.row?(y.reactiveData.currentArea={start:null,end:null},y.reactiveData.currentAreaStatus=!1):I.row<T.row?(I.row===_&&(y.reactiveData.currentArea.start=y.reactiveData.currentSheetData[I.row+1][I.col+1]),T.row===_&&(y.reactiveData.currentArea.end=y.reactiveData.currentSheetData[T.row-1][T.col+1])):I.row>T.row&&(T.row===_&&(y.reactiveData.currentArea.end=y.reactiveData.currentSheetData[T.row+1][T.col+1]),I.row===_&&(y.reactiveData.currentArea.start=y.reactiveData.currentSheetData[I.row-1][I.col+1])))}}if(D==="insertColumn"){const $={};Object.keys(E.columnHidesChanged).map(I=>{if(Number(I)>x){const T=Number(I)+1;$[T]=E.columnHidesChanged[I]}else $[I]=E.columnHidesChanged[I];return null}),E.columnHidesChanged=$;const j={};if(Object.keys(E.columnWidthsChanged).map(I=>{if(Number(I)>x){const T=Number(I)+1;j[T]=E.columnWidthsChanged[I]}else j[I]=E.columnWidthsChanged[I];return null}),E.columnWidthsChanged=j,y.reactiveData.styles){if(y.reactiveData.styles&&y.reactiveData.styles.bgc&&y.reactiveData.styles.bgc.length>0){const I=[];y.reactiveData.styles.bgc.forEach(T=>{if(T.hasOwnProperty("type")&&(T.type==="columns"||T.type==="cells")){if(T.type==="columns"&&T.hasOwnProperty("p")&&T.p.length>0){const P=[];T.p.forEach(W=>{if(W.indexOf(":")>=0){let oe=W.split(":");oe=oe.map(he=>le(he));let te=Math.min(...oe),q=Math.max(...oe);x+1<=te?(te+=1,q+=1):x+1>te&&x+1<=q&&(q+=1),P.push(Re(te)+":"+Re(q))}else x+1<=le(W)?P.push(Re(le(W)+1)):P.push(W)}),P.length>0&&I.push(Object.assign({},T,{p:P}))}if(T.type==="cells"&&T.hasOwnProperty("p")&&T.p.length>0)if(T.p.indexOf(":")>=0){let P=T.p.split(":"),W=P[0],oe=P[1],te=W.replace(/[0-9]/g,""),q=parseInt(W.replace(/[^0-9]/gi,"")),he=oe.replace(/[0-9]/g,""),Oe=parseInt(oe.replace(/[^0-9]/gi,""));x+1<=Math.min(le(te),le(he))?(te=Re(le(te)+1),he=Re(le(he)+1)):(x+1>le(te)&&x+1<=le(he)||x+1>le(he)&&x+1<=le(te))&&(le(he)>le(te)?he=Re(le(he)+1):te=Re(le(te)+1)),I.push(Object.assign({},T,{p:te+q+":"+he+Oe}))}else{let P=T.p.replace(/[0-9]/g,""),W=parseInt(T.p.replace(/[^0-9]/gi,""));x+1<=le(P)?(P=Re(le(P)+1),I.push(Object.assign({},T,{p:P+W}))):I.push(Object.assign({},T,{p:P+W}))}}else T.hasOwnProperty("type")&&T.type==="rows"&&I.push(Object.assign({},T))}),y.reactiveData.styles.bgc=I}if(y.reactiveData.styles&&y.reactiveData.styles.fgc&&y.reactiveData.styles.fgc.length>0){const I=[];y.reactiveData.styles.fgc.forEach(T=>{if(T.hasOwnProperty("type")&&(T.type==="columns"||T.type==="cells")){if(T.type==="columns"&&T.hasOwnProperty("p")&&T.p.length>0){const P=[];T.p.forEach(W=>{if(W.indexOf(":")>=0){let oe=W.split(":");oe=oe.map(he=>le(he));let te=Math.min(...oe),q=Math.max(...oe);x+1<=te?(te+=1,q+=1):x+1>te&&x+1<=q&&(q+=1),P.push(Re(te)+":"+Re(q))}else x+1<=le(W)?P.push(Re(le(W)+1)):P.push(W)}),P.length>0&&I.push(Object.assign({},T,{p:P}))}if(T.type==="cells"&&T.hasOwnProperty("p")&&T.p.length>0)if(T.p.indexOf(":")>=0){let P=T.p.split(":"),W=P[0],oe=P[1],te=W.replace(/[0-9]/g,""),q=parseInt(W.replace(/[^0-9]/gi,"")),he=oe.replace(/[0-9]/g,""),Oe=parseInt(oe.replace(/[^0-9]/gi,""));x+1<=Math.min(le(te),le(he))?(te=Re(le(te)+1),he=Re(le(he)+1)):(x+1>le(te)&&x+1<=le(he)||x+1>le(he)&&x+1<=le(te))&&(le(he)>le(te)?he=Re(le(he)+1):te=Re(le(te)+1)),I.push(Object.assign({},T,{p:te+q+":"+he+Oe}))}else{let P=T.p.replace(/[0-9]/g,""),W=parseInt(T.p.replace(/[^0-9]/gi,""));x+1<=le(P)?(P=Re(le(P)+1),I.push(Object.assign({},T,{p:P+W}))):I.push(Object.assign({},T,{p:P+W}))}}else T.hasOwnProperty("type")&&T.type==="rows"&&I.push(Object.assign({},T))}),y.reactiveData.styles.fgc=I}}if(y.reactiveData.borders&&y.reactiveData.borders.length>0){const I=[];y.reactiveData.borders.forEach(T=>{if(T.hasOwnProperty("type")&&(T.type==="columns"||T.type==="cells")){if(T.type==="columns"&&T.hasOwnProperty("p")&&T.p.length>0){const P=[];T.p.forEach(W=>{if(W.indexOf(":")>=0){let oe=W.split(":");oe=oe.map(he=>le(he));let te=Math.min(...oe),q=Math.max(...oe);x+1<=te?(te+=1,q+=1):x+1>te&&x+1<=q&&(q+=1),P.push(Re(te)+":"+Re(q))}else x+1<=le(W)?P.push(Re(le(W)+1)):P.push(W)}),P.length>0&&I.push(Object.assign({},T,{p:P}))}if(T.type==="cells"&&T.hasOwnProperty("p")&&T.p.length>0)if(T.p.indexOf(":")>=0){let P=T.p.split(":"),W=P[0],oe=P[1],te=W.replace(/[0-9]/g,""),q=parseInt(W.replace(/[^0-9]/gi,"")),he=oe.replace(/[0-9]/g,""),Oe=parseInt(oe.replace(/[^0-9]/gi,""));x+1<=Math.min(le(te),le(he))?(te=Re(le(te)+1),he=Re(le(he)+1)):(x+1>le(te)&&x+1<=le(he)||x+1>le(he)&&x+1<=le(te))&&(le(he)>le(te)?he=Re(le(he)+1):te=Re(le(te)+1)),I.push(Object.assign({},T,{p:te+q+":"+he+Oe}))}else{let P=T.p.replace(/[0-9]/g,""),W=parseInt(T.p.replace(/[^0-9]/gi,""));x+1<=le(P)?(P=Re(le(P)+1),I.push(Object.assign({},T,{p:P+W}))):I.push(Object.assign({},T,{p:P+W}))}}else T.hasOwnProperty("type")&&T.type==="rows"&&I.push(Object.assign({},T))}),y.reactiveData.borders=I}const ce={};Object.keys(E.merges).map(I=>{const T=I.split(":"),P=T[0].split("_"),W=T[1].split("_");Number(P[0])>x?(P[0]=(Number(P[0])+1).toString(),W[0]=(Number(W[0])+1).toString()):Number(P[0])<=x&&x<Number(W[0])&&(W[0]=(Number(W[0])+1).toString()),ce[`${P.join("_")+":"+W.join("_")}`]={colStart:Number(P[0]),colEnd:Number(W[0]),colSpan:Number(W[0])-Number(P[0])+1,rowStart:Number(P[1]),rowEnd:Number(W[1]),rowSpan:Number(W[1])-Number(P[1])+1}}),E.merges=ce}if(D==="insertRow"){const $={};Object.keys(E.rowHidesChanged).map(I=>{if(Number(I)>_){const T=Number(I)+1;$[T]=E.rowHidesChanged[I]}else $[I]=E.rowHidesChanged[I];return null}),E.rowHidesChanged=$;const j={};if(Object.keys(E.rowHeightsChanged).map(I=>{if(Number(I)>_){const T=Number(I)+1;j[T]=E.rowHeightsChanged[I]}else j[I]=E.rowHeightsChanged[I];return null}),E.rowHeightsChanged=j,y.reactiveData.styles){if(y.reactiveData.styles&&y.reactiveData.styles.bgc&&y.reactiveData.styles.bgc.length>0){const I=[];y.reactiveData.styles.bgc.forEach(T=>{if(T.hasOwnProperty("type")&&(T.type==="rows"||T.type==="cells")){if(T.type==="rows"&&T.hasOwnProperty("p")&&T.p.length>0){const P=[];T.p.forEach(W=>{if(typeof W=="string"&&W.indexOf(":")>=0){let oe=W.split(":");oe=oe.map(Number);let te=Math.min(...oe),q=Math.max(...oe);_+1<=te?(te+=1,q+=1):_+1>te&&_+1<=q&&(q+=1),q>=te&&P.push(""+te+":"+q)}else typeof W=="number"&&(_+1<=W?P.push(W+1):_+1>W&&P.push(W))}),P.length>0&&I.push(Object.assign({},T,{p:P}))}if(T.type==="cells"&&T.hasOwnProperty("p")&&T.p.length>0)if(T.p.indexOf(":")>=0){let P=T.p.split(":"),W=P[0],oe=P[1],te=W.replace(/[0-9]/g,""),q=parseInt(W.replace(/[^0-9]/gi,"")),he=oe.replace(/[0-9]/g,""),Oe=parseInt(oe.replace(/[^0-9]/gi,""));_+1<=Math.min(q,Oe)?(q+=1,Oe+=1):(_+1>q&&_+1<=Oe||_+1>Oe&&_+1<=q)&&(Oe>q?Oe+=1:q+=1),I.push(Object.assign({},T,{p:te+q+":"+he+Oe}))}else{let P=T.p.replace(/[0-9]/g,""),W=parseInt(T.p.replace(/[^0-9]/gi,""));_+1<=W?(W+=1,I.push(Object.assign({},T,{p:P+W}))):_+1>W&&I.push(Object.assign({},T,{p:P+W}))}}else T.hasOwnProperty("type")&&T.type==="columns"&&I.push(Object.assign({},T))}),y.reactiveData.styles.bgc=I}if(y.reactiveData.styles&&y.reactiveData.styles.fgc&&y.reactiveData.styles.fgc.length>0){const I=[];y.reactiveData.styles.fgc.forEach(T=>{if(T.hasOwnProperty("type")&&(T.type==="rows"||T.type==="cells")){if(T.type==="rows"&&T.hasOwnProperty("p")&&T.p.length>0){const P=[];T.p.forEach(W=>{if(typeof W=="string"&&W.indexOf(":")>=0){let oe=W.split(":");oe=oe.map(Number);let te=Math.min(...oe),q=Math.max(...oe);_+1<=te?(te+=1,q+=1):_+1>te&&_+1<=q&&(q+=1),q>=te&&P.push(""+te+":"+q)}else typeof W=="number"&&(_+1<=W?P.push(W+1):_+1>W&&P.push(W))}),P.length>0&&I.push(Object.assign({},T,{p:P}))}if(T.type==="cells"&&T.hasOwnProperty("p")&&T.p.length>0)if(T.p.indexOf(":")>=0){let P=T.p.split(":"),W=P[0],oe=P[1],te=W.replace(/[0-9]/g,""),q=parseInt(W.replace(/[^0-9]/gi,"")),he=oe.replace(/[0-9]/g,""),Oe=parseInt(oe.replace(/[^0-9]/gi,""));_+1<=Math.min(q,Oe)?(q+=1,Oe+=1):(_+1>q&&_+1<=Oe||_+1>Oe&&_+1<=q)&&(Oe>q?Oe+=1:q+=1),I.push(Object.assign({},T,{p:te+q+":"+he+Oe}))}else{let P=T.p.replace(/[0-9]/g,""),W=parseInt(T.p.replace(/[^0-9]/gi,""));_+1<=W?(W+=1,I.push(Object.assign({},T,{p:P+W}))):_+1>W&&I.push(Object.assign({},T,{p:P+W}))}}else T.hasOwnProperty("type")&&T.type==="columns"&&I.push(Object.assign({},T))}),y.reactiveData.styles.fgc=I}}if(y.reactiveData.borders&&y.reactiveData.borders.length>0){const I=[];y.reactiveData.borders.forEach(T=>{if(T.hasOwnProperty("type")&&(T.type==="rows"||T.type==="cells")){if(T.type==="rows"&&T.hasOwnProperty("p")&&T.p.length>0){const P=[];T.p.forEach(W=>{if(typeof W=="string"&&W.indexOf(":")>=0){let oe=W.split(":");oe=oe.map(Number);let te=Math.min(...oe),q=Math.max(...oe);_+1<=te?(te+=1,q+=1):_+1>te&&_+1<=q&&(q+=1),q>=te&&P.push(""+te+":"+q)}else typeof W=="number"&&(_+1<=W?P.push(W+1):_+1>W&&P.push(W))}),P.length>0&&I.push(Object.assign({},T,{p:P}))}if(T.type==="cells"&&T.hasOwnProperty("p")&&T.p.length>0)if(T.p.indexOf(":")>=0){let P=T.p.split(":"),W=P[0],oe=P[1],te=W.replace(/[0-9]/g,""),q=parseInt(W.replace(/[^0-9]/gi,"")),he=oe.replace(/[0-9]/g,""),Oe=parseInt(oe.replace(/[^0-9]/gi,""));_+1<=Math.min(q,Oe)?(q+=1,Oe+=1):(_+1>q&&_+1<=Oe||_+1>Oe&&_+1<=q)&&(Oe>q?Oe+=1:q+=1),I.push(Object.assign({},T,{p:te+q+":"+he+Oe}))}else{let P=T.p.replace(/[0-9]/g,""),W=parseInt(T.p.replace(/[^0-9]/gi,""));_+1<=W?(W+=1,I.push(Object.assign({},T,{p:P+W}))):_+1>W&&I.push(Object.assign({},T,{p:P+W}))}}else T.hasOwnProperty("type")&&T.type==="columns"&&I.push(Object.assign({},T))}),y.reactiveData.borders=I}const ce={};Object.keys(E.merges).map(I=>{const T=I.split(":"),P=T[0].split("_"),W=T[1].split("_");Number(P[1])>_?(P[1]=(Number(P[1])+1).toString(),W[1]=(Number(W[1])+1).toString()):Number(P[1])<=_&&_<Number(W[1])&&(W[1]=(Number(W[1])+1).toString()),ce[`${P.join("_")+":"+W.join("_")}`]={colStart:Number(P[0]),colEnd:Number(W[0]),colSpan:Number(W[0])-Number(P[0])+1,rowStart:Number(P[1]),rowEnd:Number(W[1]),rowSpan:Number(W[1])-Number(P[1])+1}}),E.merges=ce}},Z=gu(D=>{De(D).then(()=>{Me()})},50),K=gu(D=>{Ie(D).then(()=>{Me()})},50),H=()=>X("div",{ref:a,class:["vma-formula-grid",`${t.size}`,`${t.type}`,{"overflow-x":E.isOverflowX,"overflow-y":E.isOverflowY}]},[t.columnResizable?X("div",{ref:s,class:["column-resize-bar",`${t.type}`],style:E.isOverflowX?{height:`calc(100% - ${E.scrollbarHeight}px)`}:{}}):st(),t.rowResizable?X("div",{ref:l,class:["row-resize-bar",`${t.type}`],style:E.isOverflowY?{width:`calc(100% - ${E.scrollbarWidth}px)`}:{}}):st(),X(Ft("VmaFormulaGridCompContextMenu"),{ref:k}),X(Ft("VmaFormulaGridCompColorPicker"),{ref:z,onChange:D=>{E.colorPickerStore.selected&&E.colorPickerStore.selected.code==="backgroundColor"&&(D.mode&&D.mode==="transparent"?y.setBackgroundColor("cells","none",null):y.setBackgroundColor("cells","normal",D.color.toHexString())),E.colorPickerStore.selected&&E.colorPickerStore.selected.code==="fontColor"&&(D.mode&&D.mode==="transparent"?y.setFontColor("cells","none",null):y.setFontColor("cells","normal",D.color.toHexString()))}}),X(n,{"data-uid":y.uId,fixed:"left",class:["left"],style:{height:`${E.gridHeaderHeight}px`,width:`${E.gridLeftFixedHeaderWidth}px`}}),X(n,{"data-uid":y.uId,fixed:"center",class:["center"],style:{height:`${E.gridHeaderHeight}px`,width:`${E.gridHeaderWidth}px`}}),X(i,{"data-uid":y.uId,fixed:"left",class:["left"]}),X(i,{"data-uid":y.uId,fixed:"center",class:["center"],style:{height:`${E.gridBodyHeight}px`}})]),ie=()=>{y.closeMenu&&y.closeMenu(),y.recalculate(!1)},pe=D=>{if(y.closeMenu){const{ctxMenuStore:x}=E,_=k.value,$=z.value;x.visible&&_&&!(ht.getEventTargetNode(D,_).flag||ht.getEventTargetNode(D,$).flag)&&y.closeMenu()}},ye=D=>{if(y.closeMenu){const{ctxMenuStore:x}=E,_=k.value,$=z.value;x.visible&&_&&!(ht.getEventTargetNode(D,_).flag||ht.getEventTargetNode(D,$).flag)&&y.closeMenu()}},we=D=>{if(y.closeMenu){const{ctxMenuStore:x}=E,_=k.value,$=z.value;x.visible&&_&&!(ht.getEventTargetNode(D,_).flag||ht.getEventTargetNode(D,$).flag)&&y.closeMenu()}},Ue=()=>gt().then(()=>{De(c.value).then(()=>{Ie(c.value).then(()=>{Xe()})})}),De=D=>new Promise(x=>{if(D||x(),t.virtualScrollX){const _=D.scrollLeft,$=uE(_,Te.value,E.columnWidthsChanged,E.columnHidesChanged),j=c.value.clientWidth,ce=Math.max(Math.ceil(j/Te.value),fE(j,$,Te.value,E.columnWidthsChanged,E.columnHidesChanged)),I={startColIndex:Math.max(0,$-20),endColIndex:Math.min($+ce+20,E.colConfs.length)};let{startColIndex:T,endColIndex:P}=I;T=Math.min(T,ed(T,y.reactiveData.merges,"min")),P=Math.max(P,ed(P,y.reactiveData.merges,"max")),E.lastScrollXVisibleIndex===0&&(E.xStart=T,E.xEnd=P),(Math.abs(P-$-ce)/2>5||Math.abs($-T)/2>5)&&(E.xStart=T,E.xEnd=P,E.lastScrollXVisibleIndex=$,We())}else E.xStart=0,E.xEnd=E.colConfs.length,E.lastScrollXVisibleIndex=0,We();x()}),Ie=D=>new Promise(x=>{if(D||x(),t.virtualScrollY){const _=D.scrollTop,$=hE(_,_e.value,E.rowHeightsChanged,E.rowHidesChanged),j=c.value.clientHeight,ce=Math.max(Math.ceil(j/_e.value),dE(j,$,_e.value,E.rowHeightsChanged,E.rowHidesChanged)),I={startIndex:Math.max(0,$-20),endIndex:Math.min($+ce+20,E.rowConfs.length-1)};let{startIndex:T,endIndex:P}=I;T=Math.min(T,td(T,y.reactiveData.merges,"min")),P=Math.max(P,td(P,y.reactiveData.merges,"max")),E.lastScrollYVisibleIndex===0&&(E.yStart=T,E.yEnd=P),(Math.abs(P-$-ce)/2>5||Math.abs($-T)/2>5)&&(E.yStart=T,E.yEnd=P,E.lastScrollYVisibleIndex=$,We())}else E.yStart=0,E.yEnd=E.rowConfs.length-1,E.lastScrollYVisibleIndex=0,We();x()}),We=()=>{const x=`${Eo(E.xStart,Te.value,E.columnWidthsChanged,E.columnHidesChanged)}px`,$=`${Oo(E.yStart,_e.value,E.rowHeightsChanged,E.rowHidesChanged)}px`;p.value&&(p.value.style.transform=`translateX(${x}) translateY(${$})`,p.value.style.width=`${E.gridWidth}px`,g.value.style.transform=`translateY(${$})`,g.value.style.width=`${E.gridWidth}px`),h.value&&(h.value.style.transform=`translateX(${x})`,h.value.style.width=`${E.gridWidth+E.scrollbarWidth}px`)},Xe=()=>{const D=[],x=[],_=[];E.xStart!==-1&&D.push(E.colConfs[0]);for(let $=E.xStart;$<=E.xEnd&&!($>=E.colConfs.length-1);$++){const j=E.colConfs[$+1];$===-1?D.push(j):j.visible&&(_.push(j),j.fixed==="left"&&x.push(j))}Object.assign(E.columns,{firstList:D,leftList:x,otherList:_}),gt(()=>{Qe()})},Qe=()=>{let D=0;const{firstList:x,otherList:_}=E.columns;x.forEach($=>{D+=ke.value,$.width=ke.value}),_.forEach($=>{D+=$.visible?typeof $.width=="string"?Te.value:$.width:0}),E.gridWidth=D,gt(()=>{Me()})},Me=()=>{if(a.value===null||a.value===void 0)return;const D=a.value.clientWidth,x=a.value.clientHeight,_=c.value.clientWidth,$=c.value.clientHeight,j=c.value.offsetWidth,ce=c.value.offsetHeight;E.gridWidth=Math.min(E.gridWidth,D),E.gridHeight=x,E.gridHeaderWidth=E.gridWidth,E.gridHeaderHeight=h.value.clientHeight;const{firstList:I,leftList:T}=E.columns;E.gridLeftFixedHeaderWidth=I.concat(T).reduce((oe,te)=>oe+(te.visible?typeof te.width=="string"?Te.value:te.width:0),0),E.gridBodyWidth=E.gridWidth,E.gridBodyHeight=E.gridHeight-E.gridHeaderHeight,E.isOverflowX=j>_,E.isOverflowY=ce>$,E.scrollbarWidth=Math.max(j-_,0),E.scrollbarHeight=Math.max(ce-$,0);const{colConfs:P,scrollbarWidth:W}=E;w.value.children&&w.value.children.length&&(Array.from(w.value.children).forEach((oe,te)=>{const q=parseInt(oe.attributes.idx.value);q===-1?oe.style.width=`${ke.value}px`:q+1<P.length?oe.style.width=`${P[q+1].visible?typeof P[q+1].width=="string"?Te.value:P[q+1].width:0}px`:oe.style.width=`${W}px`}),Array.from(N.value.children).forEach((oe,te)=>{const q=parseInt(oe.attributes.idx.value);q===-1?oe.style.width=`${ke.value}px`:q+1<P.length&&(oe.style.width=`${P[q+1].visible?typeof P[q+1].width=="string"?Te.value:P[q+1].width:0}px`)})),S.value.children&&S.value.children.length&&(Array.from(S.value.children).forEach((oe,te)=>{const q=parseInt(oe.attributes.idx.value);q===-1?oe.style.width=`${ke.value}px`:q+1<P.length?oe.style.width=`${P[q+1].visible?typeof P[q+1].width=="string"?Te.value:P[q+1].width:0}px`:oe.style.width=`${W}px`}),Array.from(R.value.children).forEach((oe,te)=>{const q=parseInt(oe.attributes.idx.value);q===-1?oe.style.width=`${ke.value}px`:q+1<P.length&&(oe.style.width=`${P[q+1].visible?typeof P[q+1].width=="string"?Te.value:P[q+1].width:0}px`)})),d.value.style.width=`${E.gridWidth+E.scrollbarWidth}px`,f.value.style.width=`${E.gridLeftFixedHeaderWidth}px`,f.value.style.height=`${E.gridBodyHeight-E.scrollbarHeight}px`,A.value.style.width=`${Jh(ke.value,E.colConfs.length,Te.value,E.columnWidthsChanged,E.columnHidesChanged)}px`,O.value.style.width=`${Jh(ke.value,E.colConfs.length,Te.value,E.columnWidthsChanged,E.columnHidesChanged)+E.scrollbarWidth}px`,C.value.style.height=`${pE(E.rowConfs.length,_e.value,E.rowHeightsChanged,E.rowHidesChanged)}px`,b.value.style.width=A.value.style.width,v.value.style.height=C.value.style.height,f.value.style.top=`${E.gridHeaderHeight}px`,p.value&&(p.value.style.width=`${E.gridWidth}px`,g.value.style.width=`${E.gridWidth}px`),h.value&&(h.value.style.width=`${E.gridWidth+E.scrollbarWidth}px`),y.calcCurrentCellEditorStyle(),y.calcCurrentCellEditorDisplay(),y.reCalcCurrentAreaPos(),y.updateCurrentAreaStyle()},me=()=>new Promise(D=>{E.xDim=0,E.yDim=0,E.xStart=-1,E.xEnd=0,E.yStart=0,E.yEnd=0,E.scrollbarWidth=0,E.scrollbarHeight=0,E.gridWidth=0,E.gridHeight=0,E.gridHeaderWidth=0,E.gridHeaderHeight=0,E.gridBodyWidth=0,E.gridBodyHeight=0,E.gridLeftFixedHeaderWidth=0,E.isOverflowX=!1,E.isOverflowY=!1,E.colConfs=[],E.rowConfs=[],E.currentSheetData=[],E.rowHeightsChanged={},E.columnWidthsChanged={},E.rowHidesChanged={},E.columnHidesChanged={},E.columns={firstList:[],leftList:[],otherList:[]},E.lastScrollLeft=0,E.lastScrollLeftTime=0,E.lastScrollXVisibleIndex=0,E.lastScrollTop=0,E.lastScrollTopTime=0,E.lastScrollYVisibleIndex=0,E.cells={eMap:{},cMap:{},ncMap:{}},E.merges={},E.currentCell=null,E.currentCellBorderStyle={transform:"translateX(0) translateY(0)",left:0,top:0,width:0,height:0},E.currentCellEditorStyle={transform:"translateX(0) translateY(0)",display:"none",left:0,top:0,width:0,height:0},E.currentCellEditorActive=!1,E.currentCellEditorContent=null,E.currentAreaStatus=!1,E.currentArea={start:null,end:null},E.currentAreaBorderStyle={transform:"translateX(0) translateY(0)",left:0,top:0,width:0,height:0},p.value.style.transform="translateX(0) translateY(0)",g.value.style.transform="translateY(0)",h.value.style.transform="translateX(0)",c.value.scrollLeft=0,c.value.scrollTop=0,D()}),F=()=>new Promise(D=>{if(E.xDim=t.minDims[0]+1,E.yDim=t.minDims[1],t.data){t.data.type==="map"?(t.data.mapData&&t.data.mapData.data&&t.data.mapData.data.length>0&&t.data.mapData.data.forEach($=>{if($.p){const j=le($.p.replace(/[0-9]/g,""))+1;j>E.xDim&&(E.xDim=j);const ce=parseInt($.p.replace(/[^0-9]/gi,""));ce>E.yDim&&(E.yDim=ce)}}),E.xStart=-1,E.xEnd=E.xDim-1,E.yStart=0,E.yEnd=E.yDim-1):(t.data.arrayData&&t.data.arrayData.length>0&&(t.data.arrayData.length+1>E.yDim&&(E.yDim=t.data.arrayData.length),t.data.arrayData.forEach($=>{$.length>E.xDim&&(E.xDim=$.length)})),E.xStart=-1,E.xEnd=E.xDim-1,E.yStart=0,E.yEnd=E.yDim-1),t.data.hasOwnProperty("conf")&&t.data.conf.hasOwnProperty("merges")&&t.data.conf.merges.length>0&&t.data.conf.merges.forEach($=>{const j=$.split(":");let ce=le(j[0].replace(/[0-9]/g,"")),I=le(j[1].replace(/[0-9]/g,"")),T=parseInt(j[0].replace(/[^0-9]/gi,"")),P=parseInt(j[1].replace(/[^0-9]/gi,""));if(ce!==I||T!==P){if(ce>I){const oe=I;I=ce,ce=oe}if(T>P){const oe=P;P=T,T=oe}let W=[];Object.keys(E.merges).forEach(oe=>{let te=!1,q=!1,he=[Math.min(ce,I),Math.min(E.merges[oe].colStart,E.merges[oe].colEnd)],Oe=[Math.max(ce,I),Math.max(E.merges[oe].colStart,E.merges[oe].colEnd)];Math.max(...he)<=Math.min(...Oe)&&(te=!0);let Ke=[Math.min(T,P),Math.min(E.merges[oe].rowStart,E.merges[oe].rowEnd)],ze=[Math.max(T,P),Math.max(E.merges[oe].rowStart,E.merges[oe].rowEnd)];Math.max(...Ke)<=Math.min(...ze)&&(q=!0),te&&q&&W.push(E.merges[oe])}),W.length===0&&(E.merges[`${ce}_${T}:${I}_${P}`]={colStart:ce,colEnd:I,colSpan:I-ce+1,rowStart:T,rowEnd:P,rowSpan:P-T+1})}}),t.data.hasOwnProperty("conf")&&t.data.conf.hasOwnProperty("global")&&(Object.keys(t.data.conf.global).length>0?E.global=pu({formats:jh()},t.data.conf.global):E.global=pu({formats:jh()})),t.data.hasOwnProperty("conf")&&t.data.conf.hasOwnProperty("styles")&&(t.data.conf.styles.hasOwnProperty("bgc")&&(E.styles.bgc=t.data.conf.styles.bgc.concat([])),t.data.conf.styles.hasOwnProperty("fgc")&&(E.styles.fgc=t.data.conf.styles.fgc.concat([])),t.data.conf.styles.hasOwnProperty("b")&&(E.styles.b=t.data.conf.styles.b.concat([])),t.data.conf.styles.hasOwnProperty("i")&&(E.styles.i=t.data.conf.styles.i.concat([])),t.data.conf.styles.hasOwnProperty("u")&&(E.styles.u=t.data.conf.styles.u.concat([])),t.data.conf.styles.hasOwnProperty("ff")&&(E.styles.ff=t.data.conf.styles.ff.concat([])),t.data.conf.styles.hasOwnProperty("fs")&&(E.styles.fs=t.data.conf.styles.fs.concat([]))),t.data.hasOwnProperty("conf")&&t.data.conf.hasOwnProperty("borders")&&t.data.conf.borders.length>0&&(E.borders=t.data.conf.borders.concat([])),t.data.hasOwnProperty("conf")&&t.data.conf.hasOwnProperty("formats")&&t.data.conf.formats.length>0&&(E.formats=t.data.conf.formats.concat([]));const x=[...Array(E.xDim.valueOf()+1)];x.forEach(($,j)=>{let ce=null,I=!0;if(t.data&&t.data.hasOwnProperty("conf")&&t.data.conf.hasOwnProperty("colWidth")&&t.data.conf.colWidth.length){for(let T=0;T<t.data.conf.colWidth.length;T++)if(le(t.data.conf.colWidth[T].col)===j&&Uo(t.data.conf.colWidth[T].width)){ce=t.data.conf.colWidth[T].width,E.columnWidthsChanged[`${j}`]=t.data.conf.colWidth[T].width;break}}if(t.data&&t.data.hasOwnProperty("conf")&&t.data.conf.hasOwnProperty("colHide")&&t.data.conf.colHide.length){for(let T=0;T<t.data.conf.colHide.length;T++)if(t.data.conf.colHide[T].indexOf(":")>=0){const P=t.data.conf.colHide[T].split(":"),W=Math.min(le(P[0]),le(P[1])),oe=Math.max(le(P[0]),le(P[1]));if(j>=W&&j<=oe){I=!1,E.columnHidesChanged[`${j}`]=0;break}}else if(le(t.data.conf.colHide[T])===j){I=!1,E.columnHidesChanged[`${j}`]=0;break}}E.colConfs.push(new nd(j-1,ce||"default",I))});const _=[...Array(E.yDim.valueOf())];_.forEach(($,j)=>{let ce=null,I=!0;if(t.data&&t.data.hasOwnProperty("conf")&&t.data.conf.hasOwnProperty("rowHeight")&&t.data.conf.rowHeight.length){for(let T=0;T<t.data.conf.rowHeight.length;T++)if(t.data.conf.rowHeight[T].row===j+1&&Uo(t.data.conf.rowHeight[T].height)){ce=t.data.conf.rowHeight[T].height,E.rowHeightsChanged[`${j+1}`]=t.data.conf.rowHeight[T].height;break}}if(t.data&&t.data.hasOwnProperty("conf")&&t.data.conf.hasOwnProperty("rowHide")&&t.data.conf.rowHide.length){for(let T=0;T<t.data.conf.rowHide.length;T++)if(typeof t.data.conf.rowHide[T]=="string"&&t.data.conf.rowHide[T].indexOf(":")>=0){const P=t.data.conf.rowHide[T].split(":"),W=Math.min(Number(P[0]),Number(P[1])),oe=Math.max(Number(P[0]),Number(P[1]));if(j+1>=W&&j+1<=oe){I=!1,E.rowHidesChanged[`${j+1}`]=0;break}}else if(t.data.conf.rowHide[T]===j+1){I=!1,E.rowHidesChanged[`${j+1}`]=0;break}}E.rowConfs.push(new id(j,ce||"default",I))}),E.currentSheetData=new Array(_.length).fill(null).map(()=>new Array(x.length).fill(null)),E.currentSheetData.forEach(($,j)=>{$.forEach((ce,I)=>{let T=null;t.data&&(t.data.type==="map"?t.data.mapData&&t.data.mapData.data&&t.data.mapData.data.length>0&&(T=t.data.mapData.data.find($s=>le($s.p.replace(/[0-9]/g,""))===I&&parseInt($s.p.replace(/[^0-9]/gi,""))===j+1)):t.data.arrayData&&t.data.arrayData.length>0&&j+1<=t.data.arrayData.length&&I<=t.data.arrayData[j].length&&(T=I-1<0?null:t.data.arrayData[j][I-1]));const{rowSpan:P,colSpan:W}=yE(I,j+1,E.merges),{fg:oe,bg:te,b:q,i:he,u:Oe,ff:Ke,fs:ze}=ni(I-1,j,y.reactiveData.styles),{g:Le,gf:bt}=yc(I-1,j,y.reactiveData.formats),{bdl:Er,bdt:ti,bdr:Aa,bdb:Ca}=bc(I-1,j,E.borders,E.colConfs.length,E.rowConfs.length),ri=Ec(te.length>0,Er,ti,Aa,Ca);E.currentSheetData[j][I]=new Ac(j,I-1,P,W,t.data&&t.data.type==="map"||cE(T)?T&&T.v?T.v:null:T,null,null,null,!1,-1,ri,te,oe,Er,ti,Aa,Ca,q,he,Oe,Ke,ze,Le,bt)})})}D()}),y={uId:Pt.create().toString(),props:t,context:e,reactiveData:E,getRefs:()=>U,renderVN:H};return Object.assign(y,ue),Object.assign(y,V),Pu.hooks.forEach(D=>{if(D.setupGrid){const x=D.setupGrid(y);x&&typeof x=="object"&&Object.assign(y,x)}}),or("$vmaFormulaGrid",y),or("$vmaFormulaGridLang",{lang:G.value}),y},render(){return this.renderVN()}}),n3=qt({name:"VmaFormulaGridHeader",props:{fixed:{type:String,default:"center"}},setup(t,e){const r=bi("$vmaFormulaGrid",{}),n=Ft("VmaFormulaGridCompIcon"),i=Ir({}),{refGridDiv:a,refGridHeaderTable:s,refGridHeaderTableWrapperDiv:l,refGridHeaderLeftFixedTable:u,refGridHeaderLeftFixedTableWrapperDiv:c,refGridHeaderTableColgroup:o,refGridHeaderLeftFixedTableColgroup:f,refGridHeaderLeftFixedXLineDiv:h,refColumnResizeBarDiv:d,renderDefaultRowHeight:p,renderDefaultColWidth:g}=r.getRefs(),m=w=>w>=r.reactiveData.currentAreaSci&&w<=r.reactiveData.currentAreaEci,v=()=>{const w=[];if(r.reactiveData.colConfs.length>0){r.reactiveData.xStart!==-1&&w.push(X("col",{idx:-1,style:{width:`${r.reactiveData.colConfs[0].width}px`}}));for(let S=r.reactiveData.xStart;S<=r.reactiveData.xEnd&&!(S>=r.reactiveData.colConfs.length-1);S++)w.push(X("col",{idx:S,style:{width:r.reactiveData.colConfs[S+1].visible?typeof r.reactiveData.colConfs[S+1].width=="string"?`${g.value}px`:`${r.reactiveData.colConfs[S+1].width}px`:"0px"}}))}return w},b=()=>{const w=[],S=[];r.reactiveData.xStart!==-1&&S.push(X("th",{"data-cat":"grid-corner","data-type":`${r.props.type}`,"data-row":0,"data-col":-1,class:["grid-corner",`${r.props.type}`]}));for(let N=r.reactiveData.xStart;N<=r.reactiveData.xEnd&&!(N>=r.reactiveData.colConfs.length-1);N++)if(N===-1)S.push(X("th",{"data-cat":"grid-corner","data-type":`${r.props.type}`,"data-row":0,"data-col":-1,class:["grid-corner",`${r.props.type}`]}));else if(t.fixed==="center"){const R=r.reactiveData.colConfs[N+1];S.push(X("th",{"data-cat":"column-indicator","data-type":`${r.props.type}`,"data-row":0,"data-col":R.index,class:["column-indicator",`${r.props.type}`,{"column-indicator-active":m(R.index)}]},[X("div",{class:["cell",`${r.props.type}`],style:{display:"flex",justifyContent:"center",alignItems:"center"}},X("div",{class:["cell-content"]},Re(R.index+1))),r.props.columnResizable?X("div",{class:["column-resize-handler",`${r.props.type}`],onMousedown:k=>{C(k),k.stopPropagation()}}):st(),r.reactiveData.columnHidesChanged&&Object.keys(r.reactiveData.columnHidesChanged).length>0&&r.reactiveData.columnHidesChanged.hasOwnProperty(`${R.index}`)?X("div",{class:["column-hide-info-frontward"],onClick:k=>{k.stopPropagation();const z=a.value,Y=ht.getEventTargetNode(k,z,"column-hide-info-frontward",re=>{const Q=re.parentNode.parentNode.parentNode.parentNode.parentNode;return Q!==document&&Q.getAttribute("data-uid")===r.uId});if(Y.flag){const Q=Y.targetElem.parentElement;r.updateColVisible("showForwardCols",Q.attributes["data-col"].value,Q.attributes["data-col"].value)}}},X(n,{name:"ellipsis-h",size:r.props.size,scaleX:.7,scaleY:.7})):st(),r.reactiveData.columnHidesChanged&&Object.keys(r.reactiveData.columnHidesChanged).length>0&&r.reactiveData.columnHidesChanged.hasOwnProperty(`${R.index+1+1}`)?X("div",{class:["column-hide-info-backward"],onClick:k=>{k.stopPropagation();const z=a.value,Y=ht.getEventTargetNode(k,z,"column-hide-info-backward",re=>{const Q=re.parentNode.parentNode.parentNode.parentNode.parentNode;return Q!==document&&Q.getAttribute("data-uid")===r.uId});if(Y.flag){const Q=Y.targetElem.parentElement;r.updateColVisible("showBackwardCols",Q.attributes["data-col"].value,Q.attributes["data-col"].value)}}},X(n,{name:"ellipsis-h",size:r.props.size,scaleX:.7,scaleY:.7})):st()]))}return S.concat(r.reactiveData.scrollbarWidth?[X("th",{"data-cat":"gutter-corner","data-type":`${r.props.type}`,"data-row":0,"data-col":r.reactiveData.colConfs.length,class:["gutter-corner",`${r.props.type}`]})]:st()),w.push(X("tr",{style:{height:`${p.value}px`}},S)),w},C=w=>{const{clientX:S}=w,N=document.onmousemove,R=document.onmouseup,k=w.target,z=l.value,Y=ht.getOffsetPos(k,z),re=k.clientWidth,Q=Jm(r.props.defaultColumnWidth,r.props.size),ae=Eo(r.reactiveData.xStart,g.value,r.reactiveData.columnWidthsChanged,r.reactiveData.columnHidesChanged),ve=re,J=Y.left+Math.floor(ve)+ae,ne=k.parentNode,se=Math.max(Y.left-ne.clientWidth+ve,0);let de=0;const be=d.value;be.style.left=`${Y.left+ve+ae}px`,be.style.display="block";const Ae=Te=>{Te.stopPropagation(),Te.preventDefault();const _e=Te.clientX-S,ke=J+_e;de=Math.max(ke,se),be.style.left=`${de}px`};document.onmousemove=Ae,document.onmouseup=()=>{if(document.onmousemove=N,document.onmouseup=R,be.style.display="none",k.parentElement.getAttribute("data-col")){const Te=r.reactiveData.colConfs.find(_e=>_e.index===parseInt(k.parentElement.getAttribute("data-col"),10));Te&&(Te.width=Math.max(k.parentElement.clientWidth+de-J,6),r.reactiveData.columnWidthsChanged[`${Te.index+1}`]=Te.width,r.reactiveData.gridWidth+=Te.width-Q)}k.parentElement.style.width=`${Math.max(k.parentElement.clientWidth+de-J,6)}px`,r.recalculate(!0).then(()=>{gt(()=>{r.calcCurrentCellEditorStyle(),r.calcCurrentCellEditorDisplay(),r.reCalcCurrentAreaPos(),r.updateCurrentAreaStyle()})})}},A=()=>X("div",{ref:t.fixed==="center"?l:c,class:["header-wrapper",`${r.props.type}`]},[X("div",{ref:h,style:{float:"left",height:"1px",marginTop:"-1px"}}),X("table",{ref:t.fixed==="center"?s:u,class:["header",`${r.props.type}`]},[X("colgroup",{ref:t.fixed==="center"?o:f},v().concat(r.reactiveData.scrollbarWidth?[X("col",{idx:r.reactiveData.colConfs.length-1,style:{width:`${r.reactiveData.scrollbarWidth}px`}})]:[st()])),X("thead",{class:[`${r.props.type}`]},b())])]);return{uId:Pt.create().toString(),props:t,context:e,reactiveData:i,renderVN:A}},render(){return this.renderVN()}}),i3=qt({name:"VmaFormulaGridBody",props:{fixed:{type:String,default:"center"}},setup(t,e){const r=bi("$vmaFormulaGrid",{}),n=Ft("VmaFormulaGridCompIcon"),i=Ft("VmaFormulaGridCompTextarea"),a=Ir({});Si(()=>{gt(()=>{t.fixed==="left"?(u.value.onscroll=null,g.value.onscroll=G):t.fixed==="center"&&(u.value.onscroll=G,g.value.onscroll=null)})}),El(()=>{u&&u.value&&(u.value.onscroll=null),g&&g.value&&(g.value.onscroll=null)});const{refGridDiv:s,refGridBodyTable:l,refGridBodyTableWrapperDiv:u,refGridBodyLeftFixedTable:c,refGridBodyLeftFixedTableWrapperDiv:o,refGridBodyXLineDiv:f,refGridBodyYLineDiv:h,refGridBodyLeftFixedXLineDiv:d,refGridBodyLeftFixedYLineDiv:p,refGridBodyLeftFixedScrollWrapperDiv:g,refGridBodyTableColgroup:m,refGridBodyLeftFixedTableColgroup:v,renderDefaultColWidth:b,renderDefaultRowHeight:C,refGridHeaderTableWrapperDiv:A,refCurrentCellEditor:O,refCurrentCellBorderTop:w,refCurrentCellBorderRight:S,refCurrentCellBorderBottom:N,refCurrentCellBorderLeft:R,refCurrentCellBorderCorner:k,refCurrentAreaBorderTop:z,refCurrentAreaBorderRight:Y,refCurrentAreaBorderBottom:re,refCurrentAreaBorderLeft:Q,refCurrentAreaBorderCorner:ae,refRowResizeBarDiv:ve}=r.getRefs(),J=()=>X("div",{ref:t.fixed==="center"?u:o,class:["body-wrapper"],onWheel:U},t.fixed==="center"?[X("div",{ref:f,style:{float:"left",height:"1px",marginTop:"-1px"}}),X("div",{ref:h,style:{float:"left",width:"1px",marginLeft:"-1px"}}),X("table",{ref:l,class:["body"]},[X("colgroup",{ref:m},E()),X("tbody",{},ke())]),X(i,{ref:O,class:["cell-editor"],size:r.props.size,type:r.props.type,modelValue:r.reactiveData.currentCellEditorContent,"onUpdate:modelValue":V=>{r.reactiveData.currentCellEditorContent=V},style:{display:r.reactiveData.currentCellEditorStyle.display,transform:r.reactiveData.currentCellEditorStyle.transform,height:r.reactiveData.currentCellEditorStyle.height,minHeight:r.reactiveData.currentCellEditorStyle.minHeight,width:r.reactiveData.currentCellEditorStyle.width,minWidth:r.reactiveData.currentCellEditorStyle.minWidth,left:r.reactiveData.currentCellEditorStyle.left,top:r.reactiveData.currentCellEditorStyle.top},onChange:()=>{r.reactiveData.currentCell.v=Uo(r.reactiveData.currentCellEditorContent)?Number(r.reactiveData.currentCellEditorContent):r.reactiveData.currentCellEditorContent},onBlur:()=>{gt(()=>{r.calc()})}}),X("div",{ref:R,class:["current-cell-border","left",`${r.props.type}`],style:{transform:r.reactiveData.currentCellBorderStyle.transform,left:r.reactiveData.currentCellBorderStyle.left,top:r.reactiveData.currentCellBorderStyle.top,height:r.reactiveData.currentCellBorderStyle.height,display:(r.reactiveData.currentCell&&Object.keys(r.reactiveData.currentCell).length>0,"none")}}),X("div",{ref:w,class:["current-cell-border","top",`${r.props.type}`],style:{transform:r.reactiveData.currentCellBorderStyle.transform,left:r.reactiveData.currentCellBorderStyle.left,top:r.reactiveData.currentCellBorderStyle.top,width:r.reactiveData.currentCellBorderStyle.width,display:(r.reactiveData.currentCell&&Object.keys(r.reactiveData.currentCell).length>0,"none")}}),X("div",{ref:S,class:["current-cell-border","right",`${r.props.type}`],style:{transform:r.reactiveData.currentCellBorderStyle.transform,left:r.reactiveData.currentCellBorderStyle.left+r.reactiveData.currentCellBorderStyle.width,top:r.reactiveData.currentCellBorderStyle.top,height:r.reactiveData.currentCellBorderStyle.height,display:(r.reactiveData.currentCell&&Object.keys(r.reactiveData.currentCell).length>0,"none")}}),X("div",{ref:N,class:["current-cell-border","bottom",`${r.props.type}`],style:{transform:r.reactiveData.currentCellBorderStyle.transform,left:r.reactiveData.currentCellBorderStyle.left,top:r.reactiveData.currentCellBorderStyle.top+r.reactiveData.currentCellBorderStyle.height,width:r.reactiveData.currentCellBorderStyle.width,display:(r.reactiveData.currentCell&&Object.keys(r.reactiveData.currentCell).length>0,"none")}}),X("div",{ref:k,class:["current-cell-border","corner",`${r.props.type}`],style:{transform:r.reactiveData.currentCellBorderStyle.transform,left:`calc(${r.reactiveData.currentCellBorderStyle.left+r.reactiveData.currentCellBorderStyle.width} - 3px)`,top:`calc(${r.reactiveData.currentCellBorderStyle.top+r.reactiveData.currentCellBorderStyle.height} - 3px)`,display:(r.reactiveData.currentCell&&Object.keys(r.reactiveData.currentCell).length>0,"none")}}),X("div",{ref:Q,class:["current-area-border","left",`${r.props.type}`],style:{transform:r.reactiveData.currentAreaBorderStyle.transform,left:r.reactiveData.currentAreaBorderStyle.left,top:r.reactiveData.currentAreaBorderStyle.top,height:r.reactiveData.currentAreaBorderStyle.height,display:r.reactiveData.currentArea&&r.reactiveData.currentArea.start!==null&&r.reactiveData.currentArea.end!==null?"block":"none"}}),X("div",{ref:z,class:["current-area-border","top",`${r.props.type}`],style:{transform:r.reactiveData.currentAreaBorderStyle.transform,left:r.reactiveData.currentAreaBorderStyle.left,top:r.reactiveData.currentAreaBorderStyle.top,width:r.reactiveData.currentAreaBorderStyle.width,display:r.reactiveData.currentArea&&r.reactiveData.currentArea.start!==null&&r.reactiveData.currentArea.end!==null?"block":"none"}}),X("div",{ref:Y,class:["current-area-border","right",`${r.props.type}`],style:{transform:r.reactiveData.currentAreaBorderStyle.transform,left:r.reactiveData.currentAreaBorderStyle.left+r.reactiveData.currentAreaBorderStyle.width,top:r.reactiveData.currentAreaBorderStyle.top,height:r.reactiveData.currentAreaBorderStyle.height,display:r.reactiveData.currentArea&&r.reactiveData.currentArea.start!==null&&r.reactiveData.currentArea.end!==null?"block":"none"}}),X("div",{ref:re,class:["current-area-border","bottom",`${r.props.type}`],style:{transform:r.reactiveData.currentAreaBorderStyle.transform,left:r.reactiveData.currentAreaBorderStyle.left,top:r.reactiveData.currentAreaBorderStyle.top+r.reactiveData.currentAreaBorderStyle.height,width:r.reactiveData.currentAreaBorderStyle.width,display:r.reactiveData.currentArea&&r.reactiveData.currentArea.start!==null&&r.reactiveData.currentArea.end!==null?"block":"none"}}),X("div",{ref:ae,class:["current-area-border","corner",`${r.props.type}`],style:{transform:r.reactiveData.currentAreaBorderStyle.transform,left:`calc(${r.reactiveData.currentAreaBorderStyle.left+r.reactiveData.currentAreaBorderStyle.width} - 3px)`,top:`calc(${r.reactiveData.currentAreaBorderStyle.top+r.reactiveData.currentAreaBorderStyle.height} - 3px)`,display:r.reactiveData.currentArea&&r.reactiveData.currentArea.start!==null&&r.reactiveData.currentArea.end!==null?"block":"none"}})]:t.fixed==="left"?X("div",{ref:g,class:["fixed-wrapper"],style:{height:`${r.reactiveData.gridBodyHeight-r.reactiveData.scrollbarHeight}px`}},[X("div",{ref:p,style:{float:"left",width:"1px",marginLeft:"-1px"}}),X("div",{ref:d,style:{float:"left",height:"1px",marginTop:"-1px"}}),X("table",{ref:c,class:["body"]},[X("colgroup",{ref:v},E()),X("tbody",{},ke())])]):st()),ne=V=>V.g===""?V.mv:Xa.format(V.gf,V.mv),se=V=>V&&V.v?ne(V):null,de=V=>{const{clientY:ee}=V,L=document.onmousemove,Z=document.onmouseup,K=V.target,H=o.value,ie=ht.getOffsetPos(K,H),pe=K.clientHeight,ye=e0(r.props.defaultRowHeight,r.props.size),we=Oo(r.reactiveData.yStart,C.value,r.reactiveData.rowHeightsChanged,r.reactiveData.rowHidesChanged),Ue=pe,De=ie.top+Math.floor(Ue)+we,Ie=K.parentNode,We=Math.max(ie.top-Ie.clientHeight+Ue,0);let Xe=0;const Qe=ve.value;Qe.style.top=`${ie.top+A.value.clientHeight+Ue+we}px`,Qe.style.display="block";const Me=me=>{me.stopPropagation(),me.preventDefault();const F=me.clientY-ee,y=De+F;Xe=Math.max(y,We),Qe.style.top=`${Xe+A.value.clientHeight}px`};document.onmousemove=Me,document.onmouseup=()=>{if(document.onmousemove=L,document.onmouseup=Z,Qe.style.display="none",K.parentElement.getAttribute("data-row")){const me=r.reactiveData.rowConfs.find(F=>F.index===parseInt(K.parentElement.getAttribute("data-row"),10));me&&(me.height=Math.max(K.parentElement.clientHeight+Xe-De,6),r.reactiveData.rowHeightsChanged[`${me.index+1}`]=me.height,r.reactiveData.gridHeight+=me.height-ye)}K.parentElement.parentElement.style.height=`${Math.max(K.parentElement.clientHeight+Xe-De,6)}px`,r.recalculate(!0).then(()=>{gt(()=>{r.calcCurrentCellEditorStyle(),r.calcCurrentCellEditorDisplay(),r.reCalcCurrentAreaPos(),r.updateCurrentAreaStyle()})})}},be=V=>{const ee=ht.getEventTargetNode(V,l,"normal",L=>L.attributes.hasOwnProperty("data-row")&&L.attributes.hasOwnProperty("data-col"));if(ee&&ee.flag){const L=ee.targetElem;(r.reactiveData.currentArea.end===null||!(r.reactiveData.currentArea.end.row===Number(L.attributes["data-row"].value)&&r.reactiveData.currentArea.end.col===Number(L.attributes["data-col"].value)))&&(r.reactiveData.currentArea.end=r.reactiveData.currentSheetData[Number(L.attributes["data-row"].value)][Number(L.attributes["data-col"].value)+1],r.reCalcCurrentAreaPos(),r.updateCurrentAreaStyle())}},Ae=V=>{const ee=document.onmousemove,L=document.onmouseup,Z=ht.getEventTargetNode(V,l,"normal",H=>H.attributes.hasOwnProperty("data-row")&&H.attributes.hasOwnProperty("data-col")),K=H=>{H.stopPropagation(),H.preventDefault(),be(H)};if(Z&&Z.flag){const H=Z.targetElem;r.reactiveData.currentArea.end=r.reactiveData.currentSheetData[Number(H.attributes["data-row"].value)][Number(H.attributes["data-col"].value)+1],r.reCalcCurrentAreaPos(),r.updateCurrentAreaStyle()}document.onmousemove=K,document.onmouseup=H=>{document.onmousemove=ee,document.onmouseup=L;const ie=ht.getEventTargetNode(H,l,"normal",pe=>pe.attributes.hasOwnProperty("data-row")&&pe.attributes.hasOwnProperty("data-col"));if(ie&&ie.flag){const pe=ie.targetElem;r.reactiveData.currentArea.end=r.reactiveData.currentSheetData[Number(pe.attributes["data-row"].value)][Number(pe.attributes["data-col"].value)+1],r.reCalcCurrentAreaPos(),r.updateCurrentAreaStyle()}}},Te=(V,ee)=>V>=r.reactiveData.currentAreaSci&&V<=r.reactiveData.currentAreaEci&&ee>=r.reactiveData.currentAreaSri&&ee<=r.reactiveData.currentAreaEri,_e=V=>V>=r.reactiveData.currentAreaSri&&V<=r.reactiveData.currentAreaEri,ke=()=>{const V=[];for(let ee=r.reactiveData.yStart;ee<=r.reactiveData.yEnd&&!(ee>r.reactiveData.rowConfs.length-1);ee++){const L=r.reactiveData.rowConfs[ee],Z=[];if(r.reactiveData.xStart!==-1&&Z.push(X("td",{"data-cat":"row-indicator","data-type":`${r.props.type}`,"data-row":L.index,"data-col":-1,class:["row-indicator",`${r.props.type}`,{"row-indicator-active":_e(L.index)}],style:{overflow:"hidden",height:"inherit",width:"inherit"}},[X("div",{class:["cell",`${r.props.type}`],style:{display:"flex",justifyContent:"center",alignItems:"center"}},X("div",{class:["cell-content"]},(L.index+1).toString())),r.props.rowResizable?X("div",{class:["row-resize-handler",`${r.props.type}`],onMousedown:K=>{de(K),K.stopPropagation()}}):st(),r.reactiveData.rowHidesChanged&&Object.keys(r.reactiveData.rowHidesChanged).length>0&&r.reactiveData.rowHidesChanged.hasOwnProperty(`${L.index}`)?X("div",{class:["row-hide-info-upward"],onClick:K=>{K.stopPropagation();const H=s.value,ie=ht.getEventTargetNode(K,H,"row-hide-info-upward",pe=>{const ye=pe.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;return ye!==document&&ye.getAttribute("data-uid")===r.uId});if(ie.flag){const ye=ie.targetElem.parentElement;r.updateRowVisible("showUpRows",ye.attributes["data-row"].value,ye.attributes["data-row"].value)}}},X(n,{name:"ellipsis-v",size:r.props.size,scaleX:.7,scaleY:.7})):st(),r.reactiveData.rowHidesChanged&&Object.keys(r.reactiveData.rowHidesChanged).length>0&&r.reactiveData.rowHidesChanged.hasOwnProperty(`${L.index+1+1}`)?X("div",{class:["row-hide-info-downward"],onClick:K=>{K.stopPropagation();const H=s.value,ie=ht.getEventTargetNode(K,H,"row-hide-info-downward",pe=>{const ye=pe.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;return ye!==document&&ye.getAttribute("data-uid")===r.uId});if(ie.flag){const ye=ie.targetElem.parentElement;r.updateRowVisible("showDownRows",ye.attributes["data-row"].value,ye.attributes["data-row"].value)}}},X(n,{name:"ellipsis-v",size:r.props.size,scaleX:.7,scaleY:.7})):st()])),t.fixed==="center")for(let K=r.reactiveData.xStart;K<=r.reactiveData.xEnd&&!(K>=r.reactiveData.colConfs.length-1);K++)if(K===-1)Z.push(X("td",{"data-cat":"row-indicator","data-type":`${r.props.type}`,"data-row":L.index,"data-col":-1,"data-id":`${L.index}_-1`,class:["row-indicator",`${r.props.type}`],style:{overflow:"hidden",height:"inherit",width:"inherit"}},X("div",{class:["cell",`${r.props.type}`],style:{display:"flex",justifyContent:"center",alignItems:"center"}},X("div",{class:["cell-content"]},(L.index+1).toString()))));else{const H=r.reactiveData.colConfs[K+1];if(!gi(H.index+1,L.index+1,r.reactiveData.merges)){const ie=r.reactiveData.currentSheetData[L.index][H.index+1];Z.push(X("td",{"data-cat":"normal","data-type":`${r.props.type}`,"data-row":L.index,"data-col":H.index,"data-id":`${L.index}_${H.index}`,rowspan:ie.rowSpan,colspan:ie.colSpan,class:["normal",`${r.props.type}`,`cell-bg-${ie.bgt}`,{"cell-active":Te(H.index,L.index)}],style:{height:ie.rowSpan>1?"100%":"inherit",width:ie.colSpan>1?"100%":"inherit","--cellBgCustom":ie.bg,color:ie.fg,fontWeight:ie.b?"bold":"normal",textDecoration:ie.u?"underline":"none",fontFamily:ie.ff,fontSize:ie.fs?ie.fs+"px":null},onMouseup:pe=>{r.reactiveData.currentAreaStatus=!1,r.reCalcCurrentAreaPos(),r.updateCurrentAreaStyle()},onMousedown:pe=>{if(r.reactiveData.currentCellEditorStyle.resized=!1,pe){if(pe.button===0)H.index>=0&&(r.reactiveData.currentCellEditorActive=!1,r.reactiveData.currentCell=r.reactiveData.currentSheetData[L.index][H.index+1],r.reactiveData.currentCellEditorContent=r.reactiveData.currentSheetData[L.index][H.index+1].v,r.reactiveData.currentAreaStatus=!0,r.reactiveData.currentArea={start:r.reactiveData.currentSheetData[L.index][H.index+1],end:null},gt(()=>{Ae(pe)}));else if(pe.button===2&&H.index>=0)if(r.reactiveData.currentArea&&r.reactiveData.currentArea.start!==null&&r.reactiveData.currentArea.end!=null){const{sci:ye,eci:we,sri:Ue,eri:De}=n0(b.value,r.reactiveData.columnWidthsChanged,r.reactiveData.columnHidesChanged,C.value,r.reactiveData.rowHeightsChanged,r.reactiveData.rowHidesChanged,r.reactiveData.merges,r.reactiveData.currentArea);L.index>=Ue&&L.index<=De&&H.index>=ye&&H.index<=we||(r.reactiveData.currentCellEditorActive=!1,r.reactiveData.currentCell=r.reactiveData.currentSheetData[L.index][H.index+1],r.reactiveData.currentCellEditorContent=r.reactiveData.currentSheetData[L.index][H.index+1].v,r.reactiveData.currentAreaStatus=!0,r.reactiveData.currentArea={start:r.reactiveData.currentSheetData[L.index][H.index+1],end:r.reactiveData.currentSheetData[L.index][H.index+1]})}else r.reactiveData.currentCellEditorActive=!1,r.reactiveData.currentCell=r.reactiveData.currentSheetData[L.index][H.index+1],r.reactiveData.currentCellEditorContent=r.reactiveData.currentSheetData[L.index][H.index+1].v,r.reactiveData.currentAreaStatus=!0,r.reactiveData.currentArea={start:r.reactiveData.currentSheetData[L.index][H.index+1],end:r.reactiveData.currentSheetData[L.index][H.index+1]}}},onDblclick:pe=>{H.index>=0&&(r.reactiveData.currentCellEditorActive=!0,gt(()=>{r.reactiveData.currentCellEditorStyle.resized=!1,O.value.focus()}))}},X("div",{class:["cell",`${r.props.type}`],style:{display:"flex",justifyContent:"center",alignItems:"center"}},X("span",{class:["cell-content",{italic:ie.i}]},se(ie)))))}}V.push(X("tr",{"data-row":ee,style:{height:L.visible?typeof L.height=="string"?`${C.value}px`:`${L.height}px`:0}},Z))}return V},E=()=>{const V=[];r.reactiveData.xStart!==-1&&V.push(X("col",{idx:-1}));for(let ee=r.reactiveData.xStart;ee<=r.reactiveData.xEnd&&!(ee>=r.reactiveData.colConfs.length-1);ee++)V.push(X("col",{idx:ee}));return V},G=V=>{t.fixed==="center"?(A.value.scrollLeft=u.value.scrollLeft,g.value.scrollTop=u.value.scrollTop):t.fixed==="left"&&(u.value.scrollTop=g.value.scrollTop),r.triggerScrollXEvent(V),r.triggerScrollYEvent(V)},U=V=>{t.fixed==="center"?(u.value.onscroll=G,g.value.onscroll=null):t.fixed==="left"&&(u.value.onscroll=null,g.value.onscroll=G)};return{uId:Pt.create().toString(),props:t,context:e,reactiveData:a,renderVN:J}},render(){return this.renderVN()}}),a3=qt({name:"VmaFormulaGridCompIcon",props:{type:{type:String,default:"default"},size:{type:String,default:"normal"},name:String,color:String,rotate:{type:Number,default:0},translateX:{type:Number,default:0},translateY:{type:Number,default:0},scaleX:{type:Number,default:1},scaleY:{type:Number,default:1}},setup(t,e){const r={uId:Pt.create().toString(),props:t,context:e},n=()=>{const{color:a,rotate:s,translateX:l,translateY:u,scaleX:c,scaleY:o}=t,f={};return a&&(f.color=a),f.transform=`rotate(${s}deg) translate(${l}px, ${u}px) scale(${c}, ${o})`,f},i=()=>X("i",{class:["vma-formula-grid-iconfont",`vma-formula-grid-icon-${t.name}`,"vma-formula-grid-icon",t.size,t.type],style:n()});return r.renderVN=i,or("$vmaFormulaGridCompIcon",r),r},render(){return this.renderVN()}}),s3=qt({name:"VmaFormulaGridCompContextMenu",props:{type:{type:String,default:"default"},size:{type:String,default:"normal"}},setup(t,e){const r=bi("$vmaFormulaGrid",{}),n=bi("$vmaFormulaGridLang"),i=Ft("VmaFormulaGridCompIcon"),a=Ft("VmaFormulaGridCompButton"),s=Ft("VmaFormulaGridCompSelect"),{refGridContextMenu:l}=r.getRefs(),{ctxMenuStore:u}=r.reactiveData,c={uId:Pt.create().toString(),props:t,context:e},o=(m,v)=>(console.log(m,v),st());let f=He(""),h=He(),d=He("");const p=it(()=>r.reactiveData.global&&r.reactiveData.global.formats&&r.reactiveData.global.formats.c&&r.reactiveData.global.formats.c.others&&r.reactiveData.global.formats.c.others.length>0?r.reactiveData.global.formats.c.others:[]),g=()=>X(_f,{to:"body",disabled:!1},[X("div",{ref:l,class:["vma-formula-grid-context-menu",{"is--visible":u.visible}],style:u.style},u.list.map((m,v)=>X("ul",{class:"group-wrapper",key:v},m.map((b,C)=>{const A=b.children&&b.children.length||b.type&&b.type==="colorPicker";return b.visible?X("li",{class:[{"link--disabled":b.disabled,"link--active":b===u.selected}],key:`${v}_${C}`},[X("a",{class:"link",href:"javascript:void(0)",onClick(O){r.ctxMenuLinkEvent&&r.ctxMenuLinkEvent(O,b)},onMouseover(O){r.ctxMenuMouseoverEvent&&r.ctxMenuMouseoverEvent(O,b)},onMouseout(O){r.ctxMenuMouseoutEvent&&r.ctxMenuMouseoutEvent(O,b)}},[X("i",{class:["link-prefix",b.prefixIcon]},b.prefixIcon?X(i,{name:b.prefixIcon,size:"mini",translateY:1}):st()),X("span",{class:"link-content"},b.name),X("i",{class:["link-suffix",A?b.suffixIcon||"angle-right":b.suffixIcon]},[b.suffixComp?o(b.suffixComp,b):st(),A?X(i,{name:b.suffixIcon||"angle-right",size:"mini",translateY:1}):b.suffixIcon?X(i,{name:b.suffixIcon,size:"mini",translateY:1}):st()])]),A&&!(b.type&&b.type==="colorPicker")?X("ul",{class:["sub-group-wrapper",{"is--show":b===u.selected}]},b.children.map((O,w)=>O.type==="fontSelect"?O.visible?X("li",{class:[{"link--disabled":O.disabled,"link--active":O===u.selectChild}],key:`${v}_${C}_${w}`},X("a",{class:"link",href:"javascript:void(0)"},[X("i",{class:["link-prefix",O.prefixIcon]},O.prefixIcon?X(i,{name:O.prefixIcon,size:"mini",translateY:1}):st()),X(s,{size:"mini",placeholder:n==null?void 0:n.lang.fontSelect,modelValue:f.value,"onUpdate:modelValue":S=>{f.value=S},options:r.reactiveData.supportedFonts.map(S=>({value:S.en,label:S.ch,disabled:!1})),onChange:S=>{r.setFontStyle("cells","fontSelect",S.value)}}),X("i",{class:["link-suffix",b.suffixIcon]})])):null:O.type==="fontSizeSelect"?O.visible?X("li",{class:[{"link--disabled":O.disabled,"link--active":O===u.selectChild}],key:`${v}_${C}_${w}`},X("a",{class:"link",href:"javascript:void(0)"},[X("i",{class:["link-prefix",O.prefixIcon]},O.prefixIcon?X(i,{name:O.prefixIcon,size:"mini",translateY:1}):st()),X("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexWrap:"nowrap"}},[X(s,{modelValue:h.value,placeholder:n==null?void 0:n.lang.fontSizeSelect,"onUpdate:modelValue":S=>{h.value=Number(S)},size:"mini",style:{width:"100px",flex:"0 1 auto"},options:r.reactiveData.supportedFontSizes.map(S=>({value:S,label:S,disabled:!1})),onChange:S=>{r.setFontStyle("cells","fontSizeSelect",S.value)}}),X(a,{icon:"font_size_up",type:"primary",size:"mini",style:{marginLeft:"4px"},onClick:S=>{let N=r.reactiveData.currentSheetData[r.reactiveData.currentAreaSri][r.reactiveData.currentAreaSci+1].fs;(N===null||N==="")&&(N=rd(r.props.size)),r.setFontStyle("cells","fontSizeUp",N)}}),X(a,{icon:"font_size_down",type:"primary",size:"mini",style:{marginLeft:"4px"},onClick:S=>{let N=r.reactiveData.currentSheetData[r.reactiveData.currentAreaSri][r.reactiveData.currentAreaSci+1].fs;(N===null||N==="")&&(N=rd(r.props.size)),r.setFontStyle("cells","fontSizeDown",N)}})]),X("i",{class:["link-suffix",b.suffixIcon]})])):null:O.type==="formatNumberCurrencyOthersSelect"?O.visible?X("li",{class:[{"link--disabled":O.disabled,"link--active":O===u.selectChild}],key:`${v}_${C}_${w}`},X("a",{class:"link",href:"javascript:void(0)"},[X("i",{class:["link-prefix",O.prefixIcon]},O.prefixIcon?X(i,{name:O.prefixIcon,size:"mini",translateY:1}):st()),X(s,{modelValue:d.value,placeholder:n==null?void 0:n.lang.formatNumberCurrencyOthers,"onUpdate:modelValue":S=>{d.value=S},size:"mini",style:{minWidth:"120px"},options:p.value.map(S=>({value:S.value,label:S.key,disabled:!1})),onChange:S=>{r.setCellFormat("cells","formatCurrencyOthers",S.value)}}),X("i",{class:["link-suffix",b.suffixIcon]})])):null:O.visible?X("li",{class:[{"link--disabled":O.disabled,"link--active":O===u.selectChild}],key:`${v}_${C}_${w}`},X("a",{class:"link",href:"javascript:void(0)",onClick(S){r.ctxMenuLinkEvent&&r.ctxMenuLinkEvent(S,O)},onMouseover(S){r.ctxMenuMouseoverEvent&&r.ctxMenuMouseoverEvent(S,b,O)},onMouseout(S){r.ctxMenuMouseoutEvent&&r.ctxMenuMouseoutEvent(S,b)}},[X("i",{class:["link-prefix",O.prefixIcon]},O.prefixIcon?X(i,{name:O.prefixIcon,size:"mini",translateY:1}):st()),X("span",{class:"link-content",style:{fontFamily:O.item}},O.name),X("i",{class:["link-suffix",b.suffixIcon]})])):null)):null]):null}))))]);return c.renderVN=g,or("$vmaFormulaGridCompContextMenu",c),c},render(){return this.renderVN()}}),Kv=1024;let o3=0,Wc=class{constructor(e,r){this.from=e,this.to=r}};class nt{constructor(e={}){this.id=o3++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=yr.match(e)),r=>{let n=e(r);return n===void 0?null:[this,n]}}}nt.closedBy=new nt({deserialize:t=>t.split(" ")});nt.openedBy=new nt({deserialize:t=>t.split(" ")});nt.group=new nt({deserialize:t=>t.split(" ")});nt.contextHash=new nt({perNode:!0});nt.lookAhead=new nt({perNode:!0});nt.mounted=new nt({perNode:!0});class zo{constructor(e,r,n){this.tree=e,this.overlay=r,this.parser=n}static get(e){return e&&e.props&&e.props[nt.mounted.id]}}const l3=Object.create(null);class yr{constructor(e,r,n,i=0){this.name=e,this.props=r,this.id=n,this.flags=i}static define(e){let r=e.props&&e.props.length?Object.create(null):l3,n=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),i=new yr(e.name||"",r,e.id,n);if(e.props){for(let a of e.props)if(Array.isArray(a)||(a=a(i)),a){if(a[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");r[a[0].id]=a[1]}}return i}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let r=this.prop(nt.group);return r?r.indexOf(e)>-1:!1}return this.id==e}static match(e){let r=Object.create(null);for(let n in e)for(let i of n.split(" "))r[i]=e[n];return n=>{for(let i=n.prop(nt.group),a=-1;a<(i?i.length:0);a++){let s=r[a<0?n.name:i[a]];if(s)return s}}}}yr.none=new yr("",Object.create(null),0,8);class Eh{constructor(e){this.types=e;for(let r=0;r<e.length;r++)if(e[r].id!=r)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let r=[];for(let n of this.types){let i=null;for(let a of e){let s=a(n);s&&(i||(i=Object.assign({},n.props)),i[s[0].id]=s[1])}r.push(i?new yr(n.name,i,n.id,n.flags):n)}return new Eh(r)}}const Qs=new WeakMap,Xp=new WeakMap;var Xt;(function(t){t[t.ExcludeBuffers=1]="ExcludeBuffers",t[t.IncludeAnonymous=2]="IncludeAnonymous",t[t.IgnoreMounts=4]="IgnoreMounts",t[t.IgnoreOverlays=8]="IgnoreOverlays"})(Xt||(Xt={}));class Vt{constructor(e,r,n,i,a){if(this.type=e,this.children=r,this.positions=n,this.length=i,this.props=null,a&&a.length){this.props=Object.create(null);for(let[s,l]of a)this.props[typeof s=="number"?s:s.id]=l}}toString(){let e=zo.get(this);if(e&&!e.overlay)return e.tree.toString();let r="";for(let n of this.children){let i=n.toString();i&&(r&&(r+=","),r+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(r.length?"("+r+")":""):r}cursor(e=0){return new Du(this.topNode,e)}cursorAt(e,r=0,n=0){let i=Qs.get(this)||this.topNode,a=new Du(i);return a.moveTo(e,r),Qs.set(this,a._tree),a}get topNode(){return new _r(this,0,0,null)}resolve(e,r=0){let n=es(Qs.get(this)||this.topNode,e,r,!1);return Qs.set(this,n),n}resolveInner(e,r=0){let n=es(Xp.get(this)||this.topNode,e,r,!0);return Xp.set(this,n),n}resolveStack(e,r=0){return f3(this,e,r)}iterate(e){let{enter:r,leave:n,from:i=0,to:a=this.length}=e,s=e.mode||0,l=(s&Xt.IncludeAnonymous)>0;for(let u=this.cursor(s|Xt.IncludeAnonymous);;){let c=!1;if(u.from<=a&&u.to>=i&&(!l&&u.type.isAnonymous||r(u)!==!1)){if(u.firstChild())continue;c=!0}for(;c&&n&&(l||!u.type.isAnonymous)&&n(u),!u.nextSibling();){if(!u.parent())return;c=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let r in this.props)e.push([+r,this.props[r]]);return e}balance(e={}){return this.children.length<=8?this:Ch(yr.none,this.children,this.positions,0,this.children.length,0,this.length,(r,n,i)=>new Vt(this.type,r,n,i,this.propValues),e.makeTree||((r,n,i)=>new Vt(yr.none,r,n,i)))}static build(e){return h3(e)}}Vt.empty=new Vt(yr.none,[],[],0);class Oh{constructor(e,r){this.buffer=e,this.index=r}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Oh(this.buffer,this.index)}}class qn{constructor(e,r,n){this.buffer=e,this.length=r,this.set=n}get type(){return yr.none}toString(){let e=[];for(let r=0;r<this.buffer.length;)e.push(this.childString(r)),r=this.buffer[r+3];return e.join(",")}childString(e){let r=this.buffer[e],n=this.buffer[e+3],i=this.set.types[r],a=i.name;if(/\W/.test(a)&&!i.isError&&(a=JSON.stringify(a)),e+=4,n==e)return a;let s=[];for(;e<n;)s.push(this.childString(e)),e=this.buffer[e+3];return a+"("+s.join(",")+")"}findChild(e,r,n,i,a){let{buffer:s}=this,l=-1;for(let u=e;u!=r&&!(jv(a,i,s[u+1],s[u+2])&&(l=u,n>0));u=s[u+3]);return l}slice(e,r,n){let i=this.buffer,a=new Uint16Array(r-e),s=0;for(let l=e,u=0;l<r;){a[u++]=i[l++],a[u++]=i[l++]-n;let c=a[u++]=i[l++]-n;a[u++]=i[l++]-e,s=Math.max(s,c)}return new qn(a,s,this.set)}}function jv(t,e,r,n){switch(t){case-2:return r<e;case-1:return n>=e&&r<e;case 0:return r<e&&n>e;case 1:return r<=e&&n>e;case 2:return n>e;case 4:return!0}}function es(t,e,r,n){for(var i;t.from==t.to||(r<1?t.from>=e:t.from>e)||(r>-1?t.to<=e:t.to<e);){let s=!n&&t instanceof _r&&t.index<0?null:t.parent;if(!s)return t;t=s}let a=n?0:Xt.IgnoreOverlays;if(n)for(let s=t,l=s.parent;l;s=l,l=s.parent)s instanceof _r&&s.index<0&&((i=l.enter(e,r,a))===null||i===void 0?void 0:i.from)!=s.from&&(t=l);for(;;){let s=t.enter(e,r,a);if(!s)return t;t=s}}class Zv{cursor(e=0){return new Du(this,e)}getChild(e,r=null,n=null){let i=Qp(this,e,r,n);return i.length?i[0]:null}getChildren(e,r=null,n=null){return Qp(this,e,r,n)}resolve(e,r=0){return es(this,e,r,!1)}resolveInner(e,r=0){return es(this,e,r,!0)}matchContext(e){return Iu(this,e)}enterUnfinishedNodesBefore(e){let r=this.childBefore(e),n=this;for(;r;){let i=r.lastChild;if(!i||i.to!=r.to)break;i.type.isError&&i.from==i.to?(n=r,r=i.prevSibling):r=i}return n}get node(){return this}get next(){return this.parent}}class _r extends Zv{constructor(e,r,n,i){super(),this._tree=e,this.from=r,this.index=n,this._parent=i}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,r,n,i,a=0){for(let s=this;;){for(let{children:l,positions:u}=s._tree,c=r>0?l.length:-1;e!=c;e+=r){let o=l[e],f=u[e]+s.from;if(jv(i,n,f,f+o.length)){if(o instanceof qn){if(a&Xt.ExcludeBuffers)continue;let h=o.findChild(0,o.buffer.length,r,n-f,i);if(h>-1)return new Un(new c3(s,o,e,f),null,h)}else if(a&Xt.IncludeAnonymous||!o.type.isAnonymous||Ah(o)){let h;if(!(a&Xt.IgnoreMounts)&&(h=zo.get(o))&&!h.overlay)return new _r(h.tree,f,e,s);let d=new _r(o,f,e,s);return a&Xt.IncludeAnonymous||!d.type.isAnonymous?d:d.nextChild(r<0?o.children.length-1:0,r,n,i)}}}if(a&Xt.IncludeAnonymous||!s.type.isAnonymous||(s.index>=0?e=s.index+r:e=r<0?-1:s._parent._tree.children.length,s=s._parent,!s))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,r,n=0){let i;if(!(n&Xt.IgnoreOverlays)&&(i=zo.get(this._tree))&&i.overlay){let a=e-this.from;for(let{from:s,to:l}of i.overlay)if((r>0?s<=a:s<a)&&(r<0?l>=a:l>a))return new _r(i.tree,i.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,r,n)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function Qp(t,e,r,n){let i=t.cursor(),a=[];if(!i.firstChild())return a;if(r!=null){for(;!i.type.is(r);)if(!i.nextSibling())return a}for(;;){if(n!=null&&i.type.is(n))return a;if(i.type.is(e)&&a.push(i.node),!i.nextSibling())return n==null?a:[]}}function Iu(t,e,r=e.length-1){for(let n=t.parent;r>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(e[r]&&e[r]!=n.name)return!1;r--}}return!0}class c3{constructor(e,r,n,i){this.parent=e,this.buffer=r,this.index=n,this.start=i}}class Un extends Zv{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,r,n){super(),this.context=e,this._parent=r,this.index=n,this.type=e.buffer.set.types[e.buffer.buffer[n]]}child(e,r,n){let{buffer:i}=this.context,a=i.findChild(this.index+4,i.buffer[this.index+3],e,r-this.context.start,n);return a<0?null:new Un(this.context,this,a)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,r,n=0){if(n&Xt.ExcludeBuffers)return null;let{buffer:i}=this.context,a=i.findChild(this.index+4,i.buffer[this.index+3],r>0?1:-1,e-this.context.start,r);return a<0?null:new Un(this.context,this,a)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,r=e.buffer[this.index+3];return r<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new Un(this.context,this._parent,r):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,r=this._parent?this._parent.index+4:0;return this.index==r?this.externalSibling(-1):new Un(this.context,this._parent,e.findChild(r,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],r=[],{buffer:n}=this.context,i=this.index+4,a=n.buffer[this.index+3];if(a>i){let s=n.buffer[this.index+1];e.push(n.slice(i,a,s)),r.push(0)}return new Vt(this.type,e,r,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function Jv(t){if(!t.length)return null;let e=0,r=t[0];for(let a=1;a<t.length;a++){let s=t[a];(s.from>r.from||s.to<r.to)&&(r=s,e=a)}let n=r instanceof _r&&r.index<0?null:r.parent,i=t.slice();return n?i[e]=n:i.splice(e,1),new u3(i,r)}class u3{constructor(e,r){this.heads=e,this.node=r}get next(){return Jv(this.heads)}}function f3(t,e,r){let n=t.resolveInner(e,r),i=null;for(let a=n instanceof _r?n:n.context.parent;a;a=a.parent)if(a.index<0){let s=a.parent;(i||(i=[n])).push(s.resolve(e,r)),a=s}else{let s=zo.get(a.tree);if(s&&s.overlay&&s.overlay[0].from<=e&&s.overlay[s.overlay.length-1].to>=e){let l=new _r(s.tree,s.overlay[0].from+a.from,-1,a);(i||(i=[n])).push(es(l,e,r,!1))}}return i?Jv(i):n}class Du{get name(){return this.type.name}constructor(e,r=0){if(this.mode=r,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof _r)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let n=e._parent;n;n=n._parent)this.stack.unshift(n.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,r){this.index=e;let{start:n,buffer:i}=this.buffer;return this.type=r||i.set.types[i.buffer[e]],this.from=n+i.buffer[e+1],this.to=n+i.buffer[e+2],!0}yield(e){return e?e instanceof _r?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,r,n){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,r,n,this.mode));let{buffer:i}=this.buffer,a=i.findChild(this.index+4,i.buffer[this.index+3],e,r-this.buffer.start,n);return a<0?!1:(this.stack.push(this.index),this.yieldBuf(a))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,r,n=this.mode){return this.buffer?n&Xt.ExcludeBuffers?!1:this.enterChild(1,e,r):this.yield(this._tree.enter(e,r,n))}parent(){if(!this.buffer)return this.yieldNode(this.mode&Xt.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&Xt.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:r}=this.buffer,n=this.stack.length-1;if(e<0){let i=n<0?0:this.stack[n]+4;if(this.index!=i)return this.yieldBuf(r.findChild(i,this.index,-1,0,4))}else{let i=r.buffer[this.index+3];if(i<(n<0?r.buffer.length:r.buffer[this.stack[n]+3]))return this.yieldBuf(i)}return n<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let r,n,{buffer:i}=this;if(i){if(e>0){if(this.index<i.buffer.buffer.length)return!1}else for(let a=0;a<this.index;a++)if(i.buffer.buffer[a+3]<this.index)return!1;({index:r,parent:n}=i)}else({index:r,_parent:n}=this._tree);for(;n;{index:r,_parent:n}=n)if(r>-1)for(let a=r+e,s=e<0?-1:n._tree.children.length;a!=s;a+=e){let l=n._tree.children[a];if(this.mode&Xt.IncludeAnonymous||l instanceof qn||!l.type.isAnonymous||Ah(l))return!1}return!0}move(e,r){if(r&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,r=0){for(;(this.from==this.to||(r<1?this.from>=e:this.from>e)||(r>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,r););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,r=null,n=0;if(e&&e.context==this.buffer)e:for(let i=this.index,a=this.stack.length;a>=0;){for(let s=e;s;s=s._parent)if(s.index==i){if(i==this.index)return s;r=s,n=a+1;break e}i=this.stack[--a]}for(let i=n;i<this.stack.length;i++)r=new Un(this.buffer,r,this.stack[i]);return this.bufferNode=new Un(this.buffer,r,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,r){for(let n=0;;){let i=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){n++;continue}this.type.isAnonymous||(i=!0)}for(;i&&r&&r(this),i=this.type.isAnonymous,!this.nextSibling();){if(!n)return;this.parent(),n--,i=!0}}}matchContext(e){if(!this.buffer)return Iu(this.node,e);let{buffer:r}=this.buffer,{types:n}=r.set;for(let i=e.length-1,a=this.stack.length-1;i>=0;a--){if(a<0)return Iu(this.node,e,i);let s=n[r.buffer[this.stack[a]]];if(!s.isAnonymous){if(e[i]&&e[i]!=s.name)return!1;i--}}return!0}}function Ah(t){return t.children.some(e=>e instanceof qn||!e.type.isAnonymous||Ah(e))}function h3(t){var e;let{buffer:r,nodeSet:n,maxBufferLength:i=Kv,reused:a=[],minRepeatType:s=n.types.length}=t,l=Array.isArray(r)?new Oh(r,r.length):r,u=n.types,c=0,o=0;function f(O,w,S,N,R,k){let{id:z,start:Y,end:re,size:Q}=l,ae=o;for(;Q<0;)if(l.next(),Q==-1){let de=a[z];S.push(de),N.push(Y-O);return}else if(Q==-3){c=z;return}else if(Q==-4){o=z;return}else throw new RangeError(`Unrecognized record size: ${Q}`);let ve=u[z],J,ne,se=Y-O;if(re-Y<=i&&(ne=m(l.pos-w,R))){let de=new Uint16Array(ne.size-ne.skip),be=l.pos-ne.size,Ae=de.length;for(;l.pos>be;)Ae=v(ne.start,de,Ae);J=new qn(de,re-ne.start,n),se=ne.start-O}else{let de=l.pos-Q;l.next();let be=[],Ae=[],Te=z>=s?z:-1,_e=0,ke=re;for(;l.pos>de;)Te>=0&&l.id==Te&&l.size>=0?(l.end<=ke-i&&(p(be,Ae,Y,_e,l.end,ke,Te,ae),_e=be.length,ke=l.end),l.next()):k>2500?h(Y,de,be,Ae):f(Y,de,be,Ae,Te,k+1);if(Te>=0&&_e>0&&_e<be.length&&p(be,Ae,Y,_e,Y,ke,Te,ae),be.reverse(),Ae.reverse(),Te>-1&&_e>0){let E=d(ve);J=Ch(ve,be,Ae,0,be.length,0,re-Y,E,E)}else J=g(ve,be,Ae,re-Y,ae-re)}S.push(J),N.push(se)}function h(O,w,S,N){let R=[],k=0,z=-1;for(;l.pos>w;){let{id:Y,start:re,end:Q,size:ae}=l;if(ae>4)l.next();else{if(z>-1&&re<z)break;z<0&&(z=Q-i),R.push(Y,re,Q),k++,l.next()}}if(k){let Y=new Uint16Array(k*4),re=R[R.length-2];for(let Q=R.length-3,ae=0;Q>=0;Q-=3)Y[ae++]=R[Q],Y[ae++]=R[Q+1]-re,Y[ae++]=R[Q+2]-re,Y[ae++]=ae;S.push(new qn(Y,R[2]-re,n)),N.push(re-O)}}function d(O){return(w,S,N)=>{let R=0,k=w.length-1,z,Y;if(k>=0&&(z=w[k])instanceof Vt){if(!k&&z.type==O&&z.length==N)return z;(Y=z.prop(nt.lookAhead))&&(R=S[k]+z.length+Y)}return g(O,w,S,N,R)}}function p(O,w,S,N,R,k,z,Y){let re=[],Q=[];for(;O.length>N;)re.push(O.pop()),Q.push(w.pop()+S-R);O.push(g(n.types[z],re,Q,k-R,Y-k)),w.push(R-S)}function g(O,w,S,N,R=0,k){if(c){let z=[nt.contextHash,c];k=k?[z].concat(k):[z]}if(R>25){let z=[nt.lookAhead,R];k=k?[z].concat(k):[z]}return new Vt(O,w,S,N,k)}function m(O,w){let S=l.fork(),N=0,R=0,k=0,z=S.end-i,Y={size:0,start:0,skip:0};e:for(let re=S.pos-O;S.pos>re;){let Q=S.size;if(S.id==w&&Q>=0){Y.size=N,Y.start=R,Y.skip=k,k+=4,N+=4,S.next();continue}let ae=S.pos-Q;if(Q<0||ae<re||S.start<z)break;let ve=S.id>=s?4:0,J=S.start;for(S.next();S.pos>ae;){if(S.size<0)if(S.size==-3)ve+=4;else break e;else S.id>=s&&(ve+=4);S.next()}R=J,N+=Q,k+=ve}return(w<0||N==O)&&(Y.size=N,Y.start=R,Y.skip=k),Y.size>4?Y:void 0}function v(O,w,S){let{id:N,start:R,end:k,size:z}=l;if(l.next(),z>=0&&N<s){let Y=S;if(z>4){let re=l.pos-(z-4);for(;l.pos>re;)S=v(O,w,S)}w[--S]=Y,w[--S]=k-O,w[--S]=R-O,w[--S]=N}else z==-3?c=N:z==-4&&(o=N);return S}let b=[],C=[];for(;l.pos>0;)f(t.start||0,t.bufferStart||0,b,C,-1,0);let A=(e=t.length)!==null&&e!==void 0?e:b.length?C[0]+b[0].length:0;return new Vt(u[t.topID],b.reverse(),C.reverse(),A)}const Kp=new WeakMap;function Ro(t,e){if(!t.isAnonymous||e instanceof qn||e.type!=t)return 1;let r=Kp.get(e);if(r==null){r=1;for(let n of e.children){if(n.type!=t||!(n instanceof Vt)){r=1;break}r+=Ro(t,n)}Kp.set(e,r)}return r}function Ch(t,e,r,n,i,a,s,l,u){let c=0;for(let p=n;p<i;p++)c+=Ro(t,e[p]);let o=Math.ceil(c*1.5/8),f=[],h=[];function d(p,g,m,v,b){for(let C=m;C<v;){let A=C,O=g[C],w=Ro(t,p[C]);for(C++;C<v;C++){let S=Ro(t,p[C]);if(w+S>=o)break;w+=S}if(C==A+1){if(w>o){let S=p[A];d(S.children,S.positions,0,S.children.length,g[A]+b);continue}f.push(p[A])}else{let S=g[C-1]+p[C-1].length-O;f.push(Ch(t,p,g,A,C,O,S,null,u))}h.push(O+b-a)}}return d(e,r,n,i,0),(l||u)(f,h,s)}class yi{constructor(e,r,n,i,a=!1,s=!1){this.from=e,this.to=r,this.tree=n,this.offset=i,this.open=(a?1:0)|(s?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,r=[],n=!1){let i=[new yi(0,e.length,e,0,!1,n)];for(let a of r)a.to>e.length&&i.push(a);return i}static applyChanges(e,r,n=128){if(!r.length)return e;let i=[],a=1,s=e.length?e[0]:null;for(let l=0,u=0,c=0;;l++){let o=l<r.length?r[l]:null,f=o?o.fromA:1e9;if(f-u>=n)for(;s&&s.from<f;){let h=s;if(u>=h.from||f<=h.to||c){let d=Math.max(h.from,u)-c,p=Math.min(h.to,f)-c;h=d>=p?null:new yi(d,p,h.tree,h.offset+c,l>0,!!o)}if(h&&i.push(h),s.to>f)break;s=a<e.length?e[a++]:null}if(!o)break;u=o.toA,c=o.toA-o.toB}return i}}class e1{startParse(e,r,n){return typeof e=="string"&&(e=new d3(e)),n=n?n.length?n.map(i=>new Wc(i.from,i.to)):[new Wc(0,0)]:[new Wc(0,e.length)],this.createParse(e,r||[],n)}parse(e,r,n){let i=this.startParse(e,r,n);for(;;){let a=i.advance();if(a)return a}}}class d3{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,r){return this.string.slice(e,r)}}new nt({perNode:!0});class ot{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,r,n){let i=[];return this.decompose(0,e,i,2),n.length&&n.decompose(0,n.length,i,3),this.decompose(r,this.length,i,1),Jr.from(i,this.length-(r-e)+n.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,r=this.length){let n=[];return this.decompose(e,r,n,0),Jr.from(n,r-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let r=this.scanIdentical(e,1),n=this.length-this.scanIdentical(e,-1),i=new Ka(this),a=new Ka(e);for(let s=r,l=r;;){if(i.next(s),a.next(s),s=0,i.lineBreak!=a.lineBreak||i.done!=a.done||i.value!=a.value)return!1;if(l+=i.value.length,i.done||l>=n)return!0}}iter(e=1){return new Ka(this,e)}iterRange(e,r=this.length){return new t1(this,e,r)}iterLines(e,r){let n;if(e==null)n=this.iter();else{r==null&&(r=this.lines+1);let i=this.line(e).from;n=this.iterRange(i,Math.max(i,r==this.lines+1?this.length:r<=1?0:this.line(r-1).to))}return new r1(n)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?ot.empty:e.length<=32?new Bt(e):Jr.from(Bt.split(e,[]))}}class Bt extends ot{constructor(e,r=p3(e)){super(),this.text=e,this.length=r}get lines(){return this.text.length}get children(){return null}lineInner(e,r,n,i){for(let a=0;;a++){let s=this.text[a],l=i+s.length;if((r?n:l)>=e)return new g3(i,l,n,s);i=l+1,n++}}decompose(e,r,n,i){let a=e<=0&&r>=this.length?this:new Bt(jp(this.text,e,r),Math.min(r,this.length)-Math.max(0,e));if(i&1){let s=n.pop(),l=No(a.text,s.text.slice(),0,a.length);if(l.length<=32)n.push(new Bt(l,s.length+a.length));else{let u=l.length>>1;n.push(new Bt(l.slice(0,u)),new Bt(l.slice(u)))}}else n.push(a)}replace(e,r,n){if(!(n instanceof Bt))return super.replace(e,r,n);let i=No(this.text,No(n.text,jp(this.text,0,e)),r),a=this.length+n.length-(r-e);return i.length<=32?new Bt(i,a):Jr.from(Bt.split(i,[]),a)}sliceString(e,r=this.length,n=`
`){let i="";for(let a=0,s=0;a<=r&&s<this.text.length;s++){let l=this.text[s],u=a+l.length;a>e&&s&&(i+=n),e<u&&r>a&&(i+=l.slice(Math.max(0,e-a),r-a)),a=u+1}return i}flatten(e){for(let r of this.text)e.push(r)}scanIdentical(){return 0}static split(e,r){let n=[],i=-1;for(let a of e)n.push(a),i+=a.length+1,n.length==32&&(r.push(new Bt(n,i)),n=[],i=-1);return i>-1&&r.push(new Bt(n,i)),r}}class Jr extends ot{constructor(e,r){super(),this.children=e,this.length=r,this.lines=0;for(let n of e)this.lines+=n.lines}lineInner(e,r,n,i){for(let a=0;;a++){let s=this.children[a],l=i+s.length,u=n+s.lines-1;if((r?u:l)>=e)return s.lineInner(e,r,n,i);i=l+1,n=u+1}}decompose(e,r,n,i){for(let a=0,s=0;s<=r&&a<this.children.length;a++){let l=this.children[a],u=s+l.length;if(e<=u&&r>=s){let c=i&((s<=e?1:0)|(u>=r?2:0));s>=e&&u<=r&&!c?n.push(l):l.decompose(e-s,r-s,n,c)}s=u+1}}replace(e,r,n){if(n.lines<this.lines)for(let i=0,a=0;i<this.children.length;i++){let s=this.children[i],l=a+s.length;if(e>=a&&r<=l){let u=s.replace(e-a,r-a,n),c=this.lines-s.lines+u.lines;if(u.lines<c>>4&&u.lines>c>>6){let o=this.children.slice();return o[i]=u,new Jr(o,this.length-(r-e)+n.length)}return super.replace(a,l,u)}a=l+1}return super.replace(e,r,n)}sliceString(e,r=this.length,n=`
`){let i="";for(let a=0,s=0;a<this.children.length&&s<=r;a++){let l=this.children[a],u=s+l.length;s>e&&a&&(i+=n),e<u&&r>s&&(i+=l.sliceString(e-s,r-s,n)),s=u+1}return i}flatten(e){for(let r of this.children)r.flatten(e)}scanIdentical(e,r){if(!(e instanceof Jr))return 0;let n=0,[i,a,s,l]=r>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;i+=r,a+=r){if(i==s||a==l)return n;let u=this.children[i],c=e.children[a];if(u!=c)return n+u.scanIdentical(c,r);n+=u.length+1}}static from(e,r=e.reduce((n,i)=>n+i.length+1,-1)){let n=0;for(let d of e)n+=d.lines;if(n<32){let d=[];for(let p of e)p.flatten(d);return new Bt(d,r)}let i=Math.max(32,n>>5),a=i<<1,s=i>>1,l=[],u=0,c=-1,o=[];function f(d){let p;if(d.lines>a&&d instanceof Jr)for(let g of d.children)f(g);else d.lines>s&&(u>s||!u)?(h(),l.push(d)):d instanceof Bt&&u&&(p=o[o.length-1])instanceof Bt&&d.lines+p.lines<=32?(u+=d.lines,c+=d.length+1,o[o.length-1]=new Bt(p.text.concat(d.text),p.length+1+d.length)):(u+d.lines>i&&h(),u+=d.lines,c+=d.length+1,o.push(d))}function h(){u!=0&&(l.push(o.length==1?o[0]:Jr.from(o,c)),c=-1,u=o.length=0)}for(let d of e)f(d);return h(),l.length==1?l[0]:new Jr(l,r)}}ot.empty=new Bt([""],0);function p3(t){let e=-1;for(let r of t)e+=r.length+1;return e}function No(t,e,r=0,n=1e9){for(let i=0,a=0,s=!0;a<t.length&&i<=n;a++){let l=t[a],u=i+l.length;u>=r&&(u>n&&(l=l.slice(0,n-i)),i<r&&(l=l.slice(r-i)),s?(e[e.length-1]+=l,s=!1):e.push(l)),i=u+1}return e}function jp(t,e,r){return No(t,[""],e,r)}class Ka{constructor(e,r=1){this.dir=r,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[r>0?1:(e instanceof Bt?e.text.length:e.children.length)<<1]}nextInner(e,r){for(this.done=this.lineBreak=!1;;){let n=this.nodes.length-1,i=this.nodes[n],a=this.offsets[n],s=a>>1,l=i instanceof Bt?i.text.length:i.children.length;if(s==(r>0?l:0)){if(n==0)return this.done=!0,this.value="",this;r>0&&this.offsets[n-1]++,this.nodes.pop(),this.offsets.pop()}else if((a&1)==(r>0?0:1)){if(this.offsets[n]+=r,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(i instanceof Bt){let u=i.text[s+(r<0?-1:0)];if(this.offsets[n]+=r,u.length>Math.max(0,e))return this.value=e==0?u:r>0?u.slice(e):u.slice(0,u.length-e),this;e-=u.length}else{let u=i.children[s+(r<0?-1:0)];e>u.length?(e-=u.length,this.offsets[n]+=r):(r<0&&this.offsets[n]--,this.nodes.push(u),this.offsets.push(r>0?1:(u instanceof Bt?u.text.length:u.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class t1{constructor(e,r,n){this.value="",this.done=!1,this.cursor=new Ka(e,r>n?-1:1),this.pos=r>n?e.length:0,this.from=Math.min(r,n),this.to=Math.max(r,n)}nextInner(e,r){if(r<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,r<0?this.pos-this.to:this.from-this.pos);let n=r<0?this.pos-this.from:this.to-this.pos;e>n&&(e=n),n-=e;let{value:i}=this.cursor.next(e);return this.pos+=(i.length+e)*r,this.value=i.length<=n?i:r<0?i.slice(i.length-n):i.slice(0,n),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class r1{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:r,lineBreak:n,value:i}=this.inner.next(e);return r&&this.afterBreak?(this.value="",this.afterBreak=!1):r?(this.done=!0,this.value=""):n?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=i,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(ot.prototype[Symbol.iterator]=function(){return this.iter()},Ka.prototype[Symbol.iterator]=t1.prototype[Symbol.iterator]=r1.prototype[Symbol.iterator]=function(){return this});class g3{constructor(e,r,n,i){this.from=e,this.to=r,this.number=n,this.text=i}get length(){return this.to-this.from}}let zi="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(t=>t?parseInt(t,36):1);for(let t=1;t<zi.length;t++)zi[t]+=zi[t-1];function m3(t){for(let e=1;e<zi.length;e+=2)if(zi[e]>t)return zi[e-1]<=t;return!1}function Zp(t){return t>=127462&&t<=127487}const Jp=8205;function er(t,e,r=!0,n=!0){return(r?n1:v3)(t,e,n)}function n1(t,e,r){if(e==t.length)return e;e&&i1(t.charCodeAt(e))&&a1(t.charCodeAt(e-1))&&e--;let n=Zt(t,e);for(e+=Nr(n);e<t.length;){let i=Zt(t,e);if(n==Jp||i==Jp||r&&m3(i))e+=Nr(i),n=i;else if(Zp(i)){let a=0,s=e-2;for(;s>=0&&Zp(Zt(t,s));)a++,s-=2;if(a%2==0)break;e+=2}else break}return e}function v3(t,e,r){for(;e>0;){let n=n1(t,e-2,r);if(n<e)return n;e--}return 0}function i1(t){return t>=56320&&t<57344}function a1(t){return t>=55296&&t<56320}function Zt(t,e){let r=t.charCodeAt(e);if(!a1(r)||e+1==t.length)return r;let n=t.charCodeAt(e+1);return i1(n)?(r-55296<<10)+(n-56320)+65536:r}function wh(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode((t>>10)+55296,(t&1023)+56320))}function Nr(t){return t<65536?1:2}const Lu=/\r\n?|\n/;var fr=function(t){return t[t.Simple=0]="Simple",t[t.TrackDel=1]="TrackDel",t[t.TrackBefore=2]="TrackBefore",t[t.TrackAfter=3]="TrackAfter",t}(fr||(fr={}));class ln{constructor(e){this.sections=e}get length(){let e=0;for(let r=0;r<this.sections.length;r+=2)e+=this.sections[r];return e}get newLength(){let e=0;for(let r=0;r<this.sections.length;r+=2){let n=this.sections[r+1];e+=n<0?this.sections[r]:n}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let r=0,n=0,i=0;r<this.sections.length;){let a=this.sections[r++],s=this.sections[r++];s<0?(e(n,i,a),i+=a):i+=s,n+=a}}iterChangedRanges(e,r=!1){Bu(this,e,r)}get invertedDesc(){let e=[];for(let r=0;r<this.sections.length;){let n=this.sections[r++],i=this.sections[r++];i<0?e.push(n,i):e.push(i,n)}return new ln(e)}composeDesc(e){return this.empty?e:e.empty?this:s1(this,e)}mapDesc(e,r=!1){return e.empty?this:Uu(this,e,r)}mapPos(e,r=-1,n=fr.Simple){let i=0,a=0;for(let s=0;s<this.sections.length;){let l=this.sections[s++],u=this.sections[s++],c=i+l;if(u<0){if(c>e)return a+(e-i);a+=l}else{if(n!=fr.Simple&&c>=e&&(n==fr.TrackDel&&i<e&&c>e||n==fr.TrackBefore&&i<e||n==fr.TrackAfter&&c>e))return null;if(c>e||c==e&&r<0&&!l)return e==i||r<0?a:a+u;a+=u}i=c}if(e>i)throw new RangeError(`Position ${e} is out of range for changeset of length ${i}`);return a}touchesRange(e,r=e){for(let n=0,i=0;n<this.sections.length&&i<=r;){let a=this.sections[n++],s=this.sections[n++],l=i+a;if(s>=0&&i<=r&&l>=e)return i<e&&l>r?"cover":!0;i=l}return!1}toString(){let e="";for(let r=0;r<this.sections.length;){let n=this.sections[r++],i=this.sections[r++];e+=(e?" ":"")+n+(i>=0?":"+i:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(r=>typeof r!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new ln(e)}static create(e){return new ln(e)}}class Gt extends ln{constructor(e,r){super(e),this.inserted=r}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return Bu(this,(r,n,i,a,s)=>e=e.replace(i,i+(n-r),s),!1),e}mapDesc(e,r=!1){return Uu(this,e,r,!0)}invert(e){let r=this.sections.slice(),n=[];for(let i=0,a=0;i<r.length;i+=2){let s=r[i],l=r[i+1];if(l>=0){r[i]=l,r[i+1]=s;let u=i>>1;for(;n.length<u;)n.push(ot.empty);n.push(s?e.slice(a,a+s):ot.empty)}a+=s}return new Gt(r,n)}compose(e){return this.empty?e:e.empty?this:s1(this,e,!0)}map(e,r=!1){return e.empty?this:Uu(this,e,r,!0)}iterChanges(e,r=!1){Bu(this,e,r)}get desc(){return ln.create(this.sections)}filter(e){let r=[],n=[],i=[],a=new ts(this);e:for(let s=0,l=0;;){let u=s==e.length?1e9:e[s++];for(;l<u||l==u&&a.len==0;){if(a.done)break e;let o=Math.min(a.len,u-l);nr(i,o,-1);let f=a.ins==-1?-1:a.off==0?a.ins:0;nr(r,o,f),f>0&&$n(n,r,a.text),a.forward(o),l+=o}let c=e[s++];for(;l<c;){if(a.done)break e;let o=Math.min(a.len,c-l);nr(r,o,-1),nr(i,o,a.ins==-1?-1:a.off==0?a.ins:0),a.forward(o),l+=o}}return{changes:new Gt(r,n),filtered:ln.create(i)}}toJSON(){let e=[];for(let r=0;r<this.sections.length;r+=2){let n=this.sections[r],i=this.sections[r+1];i<0?e.push(n):i==0?e.push([n]):e.push([n].concat(this.inserted[r>>1].toJSON()))}return e}static of(e,r,n){let i=[],a=[],s=0,l=null;function u(o=!1){if(!o&&!i.length)return;s<r&&nr(i,r-s,-1);let f=new Gt(i,a);l=l?l.compose(f.map(l)):f,i=[],a=[],s=0}function c(o){if(Array.isArray(o))for(let f of o)c(f);else if(o instanceof Gt){if(o.length!=r)throw new RangeError(`Mismatched change set length (got ${o.length}, expected ${r})`);u(),l=l?l.compose(o.map(l)):o}else{let{from:f,to:h=f,insert:d}=o;if(f>h||f<0||h>r)throw new RangeError(`Invalid change range ${f} to ${h} (in doc of length ${r})`);let p=d?typeof d=="string"?ot.of(d.split(n||Lu)):d:ot.empty,g=p.length;if(f==h&&g==0)return;f<s&&u(),f>s&&nr(i,f-s,-1),nr(i,h-f,g),$n(a,i,p),s=h}}return c(e),u(!l),l}static empty(e){return new Gt(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let r=[],n=[];for(let i=0;i<e.length;i++){let a=e[i];if(typeof a=="number")r.push(a,-1);else{if(!Array.isArray(a)||typeof a[0]!="number"||a.some((s,l)=>l&&typeof s!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(a.length==1)r.push(a[0],0);else{for(;n.length<i;)n.push(ot.empty);n[i]=ot.of(a.slice(1)),r.push(a[0],n[i].length)}}}return new Gt(r,n)}static createSet(e,r){return new Gt(e,r)}}function nr(t,e,r,n=!1){if(e==0&&r<=0)return;let i=t.length-2;i>=0&&r<=0&&r==t[i+1]?t[i]+=e:e==0&&t[i]==0?t[i+1]+=r:n?(t[i]+=e,t[i+1]+=r):t.push(e,r)}function $n(t,e,r){if(r.length==0)return;let n=e.length-2>>1;if(n<t.length)t[t.length-1]=t[t.length-1].append(r);else{for(;t.length<n;)t.push(ot.empty);t.push(r)}}function Bu(t,e,r){let n=t.inserted;for(let i=0,a=0,s=0;s<t.sections.length;){let l=t.sections[s++],u=t.sections[s++];if(u<0)i+=l,a+=l;else{let c=i,o=a,f=ot.empty;for(;c+=l,o+=u,u&&n&&(f=f.append(n[s-2>>1])),!(r||s==t.sections.length||t.sections[s+1]<0);)l=t.sections[s++],u=t.sections[s++];e(i,c,a,o,f),i=c,a=o}}}function Uu(t,e,r,n=!1){let i=[],a=n?[]:null,s=new ts(t),l=new ts(e);for(let u=-1;;)if(s.ins==-1&&l.ins==-1){let c=Math.min(s.len,l.len);nr(i,c,-1),s.forward(c),l.forward(c)}else if(l.ins>=0&&(s.ins<0||u==s.i||s.off==0&&(l.len<s.len||l.len==s.len&&!r))){let c=l.len;for(nr(i,l.ins,-1);c;){let o=Math.min(s.len,c);s.ins>=0&&u<s.i&&s.len<=o&&(nr(i,0,s.ins),a&&$n(a,i,s.text),u=s.i),s.forward(o),c-=o}l.next()}else if(s.ins>=0){let c=0,o=s.len;for(;o;)if(l.ins==-1){let f=Math.min(o,l.len);c+=f,o-=f,l.forward(f)}else if(l.ins==0&&l.len<o)o-=l.len,l.next();else break;nr(i,c,u<s.i?s.ins:0),a&&u<s.i&&$n(a,i,s.text),u=s.i,s.forward(s.len-o)}else{if(s.done&&l.done)return a?Gt.createSet(i,a):ln.create(i);throw new Error("Mismatched change set lengths")}}function s1(t,e,r=!1){let n=[],i=r?[]:null,a=new ts(t),s=new ts(e);for(let l=!1;;){if(a.done&&s.done)return i?Gt.createSet(n,i):ln.create(n);if(a.ins==0)nr(n,a.len,0,l),a.next();else if(s.len==0&&!s.done)nr(n,0,s.ins,l),i&&$n(i,n,s.text),s.next();else{if(a.done||s.done)throw new Error("Mismatched change set lengths");{let u=Math.min(a.len2,s.len),c=n.length;if(a.ins==-1){let o=s.ins==-1?-1:s.off?0:s.ins;nr(n,u,o,l),i&&o&&$n(i,n,s.text)}else s.ins==-1?(nr(n,a.off?0:a.len,u,l),i&&$n(i,n,a.textBit(u))):(nr(n,a.off?0:a.len,s.off?0:s.ins,l),i&&!s.off&&$n(i,n,s.text));l=(a.ins>u||s.ins>=0&&s.len>u)&&(l||n.length>c),a.forward2(u),s.forward(u)}}}}class ts{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,r=this.i-2>>1;return r>=e.length?ot.empty:e[r]}textBit(e){let{inserted:r}=this.set,n=this.i-2>>1;return n>=r.length&&!e?ot.empty:r[n].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class di{constructor(e,r,n){this.from=e,this.to=r,this.flags=n}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,r=-1){let n,i;return this.empty?n=i=e.mapPos(this.from,r):(n=e.mapPos(this.from,1),i=e.mapPos(this.to,-1)),n==this.from&&i==this.to?this:new di(n,i,this.flags)}extend(e,r=e){if(e<=this.anchor&&r>=this.anchor)return Ee.range(e,r);let n=Math.abs(e-this.anchor)>Math.abs(r-this.anchor)?e:r;return Ee.range(this.anchor,n)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return Ee.range(e.anchor,e.head)}static create(e,r,n){return new di(e,r,n)}}class Ee{constructor(e,r){this.ranges=e,this.mainIndex=r}map(e,r=-1){return e.empty?this:Ee.create(this.ranges.map(n=>n.map(e,r)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let r=0;r<this.ranges.length;r++)if(!this.ranges[r].eq(e.ranges[r]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new Ee([this.main],0)}addRange(e,r=!0){return Ee.create([e].concat(this.ranges),r?0:this.mainIndex+1)}replaceRange(e,r=this.mainIndex){let n=this.ranges.slice();return n[r]=e,Ee.create(n,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new Ee(e.ranges.map(r=>di.fromJSON(r)),e.main)}static single(e,r=e){return new Ee([Ee.range(e,r)],0)}static create(e,r=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let n=0,i=0;i<e.length;i++){let a=e[i];if(a.empty?a.from<=n:a.from<n)return Ee.normalized(e.slice(),r);n=a.to}return new Ee(e,r)}static cursor(e,r=0,n,i){return di.create(e,e,(r==0?0:r<0?8:16)|(n==null?7:Math.min(6,n))|(i??16777215)<<6)}static range(e,r,n,i){let a=(n??16777215)<<6|(i==null?7:Math.min(6,i));return r<e?di.create(r,e,48|a):di.create(e,r,(r>e?8:0)|a)}static normalized(e,r=0){let n=e[r];e.sort((i,a)=>i.from-a.from),r=e.indexOf(n);for(let i=1;i<e.length;i++){let a=e[i],s=e[i-1];if(a.empty?a.from<=s.to:a.from<s.to){let l=s.from,u=Math.max(a.to,s.to);i<=r&&r--,e.splice(--i,2,a.anchor>a.head?Ee.range(u,l):Ee.range(l,u))}}return new Ee(e,r)}}function o1(t,e){for(let r of t.ranges)if(r.to>e)throw new RangeError("Selection points outside of document")}let Sh=0;class $e{constructor(e,r,n,i,a){this.combine=e,this.compareInput=r,this.compare=n,this.isStatic=i,this.id=Sh++,this.default=e([]),this.extensions=typeof a=="function"?a(this):a}get reader(){return this}static define(e={}){return new $e(e.combine||(r=>r),e.compareInput||((r,n)=>r===n),e.compare||(e.combine?(r,n)=>r===n:Th),!!e.static,e.enables)}of(e){return new xo([],this,0,e)}compute(e,r){if(this.isStatic)throw new Error("Can't compute a static facet");return new xo(e,this,1,r)}computeN(e,r){if(this.isStatic)throw new Error("Can't compute a static facet");return new xo(e,this,2,r)}from(e,r){return r||(r=n=>n),this.compute([e],n=>r(n.field(e)))}}function Th(t,e){return t==e||t.length==e.length&&t.every((r,n)=>r===e[n])}class xo{constructor(e,r,n,i){this.dependencies=e,this.facet=r,this.type=n,this.value=i,this.id=Sh++}dynamicSlot(e){var r;let n=this.value,i=this.facet.compareInput,a=this.id,s=e[a]>>1,l=this.type==2,u=!1,c=!1,o=[];for(let f of this.dependencies)f=="doc"?u=!0:f=="selection"?c=!0:((r=e[f.id])!==null&&r!==void 0?r:1)&1||o.push(e[f.id]);return{create(f){return f.values[s]=n(f),1},update(f,h){if(u&&h.docChanged||c&&(h.docChanged||h.selection)||$u(f,o)){let d=n(f);if(l?!eg(d,f.values[s],i):!i(d,f.values[s]))return f.values[s]=d,1}return 0},reconfigure:(f,h)=>{let d,p=h.config.address[a];if(p!=null){let g=Yo(h,p);if(this.dependencies.every(m=>m instanceof $e?h.facet(m)===f.facet(m):m instanceof rr?h.field(m,!1)==f.field(m,!1):!0)||(l?eg(d=n(f),g,i):i(d=n(f),g)))return f.values[s]=g,0}else d=n(f);return f.values[s]=d,1}}}}function eg(t,e,r){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!r(t[n],e[n]))return!1;return!0}function $u(t,e){let r=!1;for(let n of e)ja(t,n)&1&&(r=!0);return r}function y3(t,e,r){let n=r.map(u=>t[u.id]),i=r.map(u=>u.type),a=n.filter(u=>!(u&1)),s=t[e.id]>>1;function l(u){let c=[];for(let o=0;o<n.length;o++){let f=Yo(u,n[o]);if(i[o]==2)for(let h of f)c.push(h);else c.push(f)}return e.combine(c)}return{create(u){for(let c of n)ja(u,c);return u.values[s]=l(u),1},update(u,c){if(!$u(u,a))return 0;let o=l(u);return e.compare(o,u.values[s])?0:(u.values[s]=o,1)},reconfigure(u,c){let o=$u(u,n),f=c.config.facets[e.id],h=c.facet(e);if(f&&!o&&Th(r,f))return u.values[s]=h,0;let d=l(u);return e.compare(d,h)?(u.values[s]=h,0):(u.values[s]=d,1)}}}const tg=$e.define({static:!0});class rr{constructor(e,r,n,i,a){this.id=e,this.createF=r,this.updateF=n,this.compareF=i,this.spec=a,this.provides=void 0}static define(e){let r=new rr(Sh++,e.create,e.update,e.compare||((n,i)=>n===i),e);return e.provide&&(r.provides=e.provide(r)),r}create(e){let r=e.facet(tg).find(n=>n.field==this);return((r==null?void 0:r.create)||this.createF)(e)}slot(e){let r=e[this.id]>>1;return{create:n=>(n.values[r]=this.create(n),1),update:(n,i)=>{let a=n.values[r],s=this.updateF(a,i);return this.compareF(a,s)?0:(n.values[r]=s,1)},reconfigure:(n,i)=>i.config.address[this.id]!=null?(n.values[r]=i.field(this),0):(n.values[r]=this.create(n),1)}}init(e){return[this,tg.of({field:this,create:e})]}get extension(){return this}}const fi={lowest:4,low:3,default:2,high:1,highest:0};function Da(t){return e=>new l1(e,t)}const ya={highest:Da(fi.highest),high:Da(fi.high),default:Da(fi.default),low:Da(fi.low),lowest:Da(fi.lowest)};class l1{constructor(e,r){this.inner=e,this.prec=r}}class Oi{of(e){return new Fu(this,e)}reconfigure(e){return Oi.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class Fu{constructor(e,r){this.compartment=e,this.inner=r}}class qo{constructor(e,r,n,i,a,s){for(this.base=e,this.compartments=r,this.dynamicSlots=n,this.address=i,this.staticValues=a,this.facets=s,this.statusTemplate=[];this.statusTemplate.length<n.length;)this.statusTemplate.push(0)}staticFacet(e){let r=this.address[e.id];return r==null?e.default:this.staticValues[r>>1]}static resolve(e,r,n){let i=[],a=Object.create(null),s=new Map;for(let h of b3(e,r,s))h instanceof rr?i.push(h):(a[h.facet.id]||(a[h.facet.id]=[])).push(h);let l=Object.create(null),u=[],c=[];for(let h of i)l[h.id]=c.length<<1,c.push(d=>h.slot(d));let o=n==null?void 0:n.config.facets;for(let h in a){let d=a[h],p=d[0].facet,g=o&&o[h]||[];if(d.every(m=>m.type==0))if(l[p.id]=u.length<<1|1,Th(g,d))u.push(n.facet(p));else{let m=p.combine(d.map(v=>v.value));u.push(n&&p.compare(m,n.facet(p))?n.facet(p):m)}else{for(let m of d)m.type==0?(l[m.id]=u.length<<1|1,u.push(m.value)):(l[m.id]=c.length<<1,c.push(v=>m.dynamicSlot(v)));l[p.id]=c.length<<1,c.push(m=>y3(m,p,d))}}let f=c.map(h=>h(l));return new qo(e,s,f,l,u,a)}}function b3(t,e,r){let n=[[],[],[],[],[]],i=new Map;function a(s,l){let u=i.get(s);if(u!=null){if(u<=l)return;let c=n[u].indexOf(s);c>-1&&n[u].splice(c,1),s instanceof Fu&&r.delete(s.compartment)}if(i.set(s,l),Array.isArray(s))for(let c of s)a(c,l);else if(s instanceof Fu){if(r.has(s.compartment))throw new RangeError("Duplicate use of compartment in extensions");let c=e.get(s.compartment)||s.inner;r.set(s.compartment,c),a(c,l)}else if(s instanceof l1)a(s.inner,s.prec);else if(s instanceof rr)n[l].push(s),s.provides&&a(s.provides,l);else if(s instanceof xo)n[l].push(s),s.facet.extensions&&a(s.facet.extensions,fi.default);else{let c=s.extension;if(!c)throw new Error(`Unrecognized extension value in extension set (${s}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);a(c,l)}}return a(t,fi.default),n.reduce((s,l)=>s.concat(l))}function ja(t,e){if(e&1)return 2;let r=e>>1,n=t.status[r];if(n==4)throw new Error("Cyclic dependency between fields and/or facets");if(n&2)return n;t.status[r]=4;let i=t.computeSlot(t,t.config.dynamicSlots[r]);return t.status[r]=2|i}function Yo(t,e){return e&1?t.config.staticValues[e>>1]:t.values[e>>1]}const c1=$e.define(),Vu=$e.define({combine:t=>t.some(e=>e),static:!0}),u1=$e.define({combine:t=>t.length?t[0]:void 0,static:!0}),f1=$e.define(),h1=$e.define(),d1=$e.define(),p1=$e.define({combine:t=>t.length?t[0]:!1});class _n{constructor(e,r){this.type=e,this.value=r}static define(){return new E3}}class E3{of(e){return new _n(this,e)}}class O3{constructor(e){this.map=e}of(e){return new Ze(this,e)}}class Ze{constructor(e,r){this.type=e,this.value=r}map(e){let r=this.type.map(this.value,e);return r===void 0?void 0:r==this.value?this:new Ze(this.type,r)}is(e){return this.type==e}static define(e={}){return new O3(e.map||(r=>r))}static mapEffects(e,r){if(!e.length)return e;let n=[];for(let i of e){let a=i.map(r);a&&n.push(a)}return n}}Ze.reconfigure=Ze.define();Ze.appendConfig=Ze.define();class zt{constructor(e,r,n,i,a,s){this.startState=e,this.changes=r,this.selection=n,this.effects=i,this.annotations=a,this.scrollIntoView=s,this._doc=null,this._state=null,n&&o1(n,r.newLength),a.some(l=>l.type==zt.time)||(this.annotations=a.concat(zt.time.of(Date.now())))}static create(e,r,n,i,a,s){return new zt(e,r,n,i,a,s)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let r of this.annotations)if(r.type==e)return r.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let r=this.annotation(zt.userEvent);return!!(r&&(r==e||r.length>e.length&&r.slice(0,e.length)==e&&r[e.length]=="."))}}zt.time=_n.define();zt.userEvent=_n.define();zt.addToHistory=_n.define();zt.remote=_n.define();function A3(t,e){let r=[];for(let n=0,i=0;;){let a,s;if(n<t.length&&(i==e.length||e[i]>=t[n]))a=t[n++],s=t[n++];else if(i<e.length)a=e[i++],s=e[i++];else return r;!r.length||r[r.length-1]<a?r.push(a,s):r[r.length-1]<s&&(r[r.length-1]=s)}}function g1(t,e,r){var n;let i,a,s;return r?(i=e.changes,a=Gt.empty(e.changes.length),s=t.changes.compose(e.changes)):(i=e.changes.map(t.changes),a=t.changes.mapDesc(e.changes,!0),s=t.changes.compose(i)),{changes:s,selection:e.selection?e.selection.map(a):(n=t.selection)===null||n===void 0?void 0:n.map(i),effects:Ze.mapEffects(t.effects,i).concat(Ze.mapEffects(e.effects,a)),annotations:t.annotations.length?t.annotations.concat(e.annotations):e.annotations,scrollIntoView:t.scrollIntoView||e.scrollIntoView}}function Wu(t,e,r){let n=e.selection,i=qi(e.annotations);return e.userEvent&&(i=i.concat(zt.userEvent.of(e.userEvent))),{changes:e.changes instanceof Gt?e.changes:Gt.of(e.changes||[],r,t.facet(u1)),selection:n&&(n instanceof Ee?n:Ee.single(n.anchor,n.head)),effects:qi(e.effects),annotations:i,scrollIntoView:!!e.scrollIntoView}}function m1(t,e,r){let n=Wu(t,e.length?e[0]:{},t.doc.length);e.length&&e[0].filter===!1&&(r=!1);for(let a=1;a<e.length;a++){e[a].filter===!1&&(r=!1);let s=!!e[a].sequential;n=g1(n,Wu(t,e[a],s?n.changes.newLength:t.doc.length),s)}let i=zt.create(t,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return w3(r?C3(i):i)}function C3(t){let e=t.startState,r=!0;for(let i of e.facet(f1)){let a=i(t);if(a===!1){r=!1;break}Array.isArray(a)&&(r=r===!0?a:A3(r,a))}if(r!==!0){let i,a;if(r===!1)a=t.changes.invertedDesc,i=Gt.empty(e.doc.length);else{let s=t.changes.filter(r);i=s.changes,a=s.filtered.mapDesc(s.changes).invertedDesc}t=zt.create(e,i,t.selection&&t.selection.map(a),Ze.mapEffects(t.effects,a),t.annotations,t.scrollIntoView)}let n=e.facet(h1);for(let i=n.length-1;i>=0;i--){let a=n[i](t);a instanceof zt?t=a:Array.isArray(a)&&a.length==1&&a[0]instanceof zt?t=a[0]:t=m1(e,qi(a),!1)}return t}function w3(t){let e=t.startState,r=e.facet(d1),n=t;for(let i=r.length-1;i>=0;i--){let a=r[i](t);a&&Object.keys(a).length&&(n=g1(n,Wu(e,a,t.changes.newLength),!0))}return n==t?t:zt.create(e,t.changes,t.selection,n.effects,n.annotations,n.scrollIntoView)}const S3=[];function qi(t){return t==null?S3:Array.isArray(t)?t:[t]}var Tt=function(t){return t[t.Word=0]="Word",t[t.Space=1]="Space",t[t.Other=2]="Other",t}(Tt||(Tt={}));const T3=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Hu;try{Hu=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function R3(t){if(Hu)return Hu.test(t);for(let e=0;e<t.length;e++){let r=t[e];if(/\w/.test(r)||r>""&&(r.toUpperCase()!=r.toLowerCase()||T3.test(r)))return!0}return!1}function N3(t){return e=>{if(!/\S/.test(e))return Tt.Space;if(R3(e))return Tt.Word;for(let r=0;r<t.length;r++)if(e.indexOf(t[r])>-1)return Tt.Word;return Tt.Other}}class rt{constructor(e,r,n,i,a,s){this.config=e,this.doc=r,this.selection=n,this.values=i,this.status=e.statusTemplate.slice(),this.computeSlot=a,s&&(s._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)ja(this,l<<1);this.computeSlot=null}field(e,r=!0){let n=this.config.address[e.id];if(n==null){if(r)throw new RangeError("Field is not present in this state");return}return ja(this,n),Yo(this,n)}update(...e){return m1(this,e,!0)}applyTransaction(e){let r=this.config,{base:n,compartments:i}=r;for(let l of e.effects)l.is(Oi.reconfigure)?(r&&(i=new Map,r.compartments.forEach((u,c)=>i.set(c,u)),r=null),i.set(l.value.compartment,l.value.extension)):l.is(Ze.reconfigure)?(r=null,n=l.value):l.is(Ze.appendConfig)&&(r=null,n=qi(n).concat(l.value));let a;r?a=e.startState.values.slice():(r=qo.resolve(n,i,this),a=new rt(r,this.doc,this.selection,r.dynamicSlots.map(()=>null),(u,c)=>c.reconfigure(u,this),null).values);let s=e.startState.facet(Vu)?e.newSelection:e.newSelection.asSingle();new rt(r,e.newDoc,s,a,(l,u)=>u.update(l,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(r=>({changes:{from:r.from,to:r.to,insert:e},range:Ee.cursor(r.from+e.length)}))}changeByRange(e){let r=this.selection,n=e(r.ranges[0]),i=this.changes(n.changes),a=[n.range],s=qi(n.effects);for(let l=1;l<r.ranges.length;l++){let u=e(r.ranges[l]),c=this.changes(u.changes),o=c.map(i);for(let h=0;h<l;h++)a[h]=a[h].map(o);let f=i.mapDesc(c,!0);a.push(u.range.map(f)),i=i.compose(o),s=Ze.mapEffects(s,o).concat(Ze.mapEffects(qi(u.effects),f))}return{changes:i,selection:Ee.create(a,r.mainIndex),effects:s}}changes(e=[]){return e instanceof Gt?e:Gt.of(e,this.doc.length,this.facet(rt.lineSeparator))}toText(e){return ot.of(e.split(this.facet(rt.lineSeparator)||Lu))}sliceDoc(e=0,r=this.doc.length){return this.doc.sliceString(e,r,this.lineBreak)}facet(e){let r=this.config.address[e.id];return r==null?e.default:(ja(this,r),Yo(this,r))}toJSON(e){let r={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let n in e){let i=e[n];i instanceof rr&&this.config.address[i.id]!=null&&(r[n]=i.spec.toJSON(this.field(e[n]),this))}return r}static fromJSON(e,r={},n){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let i=[];if(n){for(let a in n)if(Object.prototype.hasOwnProperty.call(e,a)){let s=n[a],l=e[a];i.push(s.init(u=>s.spec.fromJSON(l,u)))}}return rt.create({doc:e.doc,selection:Ee.fromJSON(e.selection),extensions:r.extensions?i.concat([r.extensions]):i})}static create(e={}){let r=qo.resolve(e.extensions||[],new Map),n=e.doc instanceof ot?e.doc:ot.of((e.doc||"").split(r.staticFacet(rt.lineSeparator)||Lu)),i=e.selection?e.selection instanceof Ee?e.selection:Ee.single(e.selection.anchor,e.selection.head):Ee.single(0);return o1(i,n.length),r.staticFacet(Vu)||(i=i.asSingle()),new rt(r,n,i,r.dynamicSlots.map(()=>null),(a,s)=>s.create(a),null)}get tabSize(){return this.facet(rt.tabSize)}get lineBreak(){return this.facet(rt.lineSeparator)||`
`}get readOnly(){return this.facet(p1)}phrase(e,...r){for(let n of this.facet(rt.phrases))if(Object.prototype.hasOwnProperty.call(n,e)){e=n[e];break}return r.length&&(e=e.replace(/\$(\$|\d*)/g,(n,i)=>{if(i=="$")return"$";let a=+(i||1);return!a||a>r.length?n:r[a-1]})),e}languageDataAt(e,r,n=-1){let i=[];for(let a of this.facet(c1))for(let s of a(this,r,n))Object.prototype.hasOwnProperty.call(s,e)&&i.push(s[e]);return i}charCategorizer(e){return N3(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:r,from:n,length:i}=this.doc.lineAt(e),a=this.charCategorizer(e),s=e-n,l=e-n;for(;s>0;){let u=er(r,s,!1);if(a(r.slice(u,s))!=Tt.Word)break;s=u}for(;l<i;){let u=er(r,l);if(a(r.slice(l,u))!=Tt.Word)break;l=u}return s==l?null:Ee.range(s+n,l+n)}}rt.allowMultipleSelections=Vu;rt.tabSize=$e.define({combine:t=>t.length?t[0]:4});rt.lineSeparator=u1;rt.readOnly=p1;rt.phrases=$e.define({compare(t,e){let r=Object.keys(t),n=Object.keys(e);return r.length==n.length&&r.every(i=>t[i]==e[i])}});rt.languageData=c1;rt.changeFilter=f1;rt.transactionFilter=h1;rt.transactionExtender=d1;Oi.reconfigure=Ze.define();function yn(t,e,r={}){let n={};for(let i of t)for(let a of Object.keys(i)){let s=i[a],l=n[a];if(l===void 0)n[a]=s;else if(!(l===s||s===void 0))if(Object.hasOwnProperty.call(r,a))n[a]=r[a](l,s);else throw new Error("Config merge conflict for field "+a)}for(let i in e)n[i]===void 0&&(n[i]=e[i]);return n}class Ai{eq(e){return this==e}range(e,r=e){return rs.create(e,r,this)}}Ai.prototype.startSide=Ai.prototype.endSide=0;Ai.prototype.point=!1;Ai.prototype.mapMode=fr.TrackDel;class rs{constructor(e,r,n){this.from=e,this.to=r,this.value=n}static create(e,r,n){return new rs(e,r,n)}}function Gu(t,e){return t.from-e.from||t.value.startSide-e.value.startSide}class Rh{constructor(e,r,n,i){this.from=e,this.to=r,this.value=n,this.maxPoint=i}get length(){return this.to[this.to.length-1]}findIndex(e,r,n,i=0){let a=n?this.to:this.from;for(let s=i,l=a.length;;){if(s==l)return s;let u=s+l>>1,c=a[u]-e||(n?this.value[u].endSide:this.value[u].startSide)-r;if(u==s)return c>=0?s:l;c>=0?l=u:s=u+1}}between(e,r,n,i){for(let a=this.findIndex(r,-1e9,!0),s=this.findIndex(n,1e9,!1,a);a<s;a++)if(i(this.from[a]+e,this.to[a]+e,this.value[a])===!1)return!1}map(e,r){let n=[],i=[],a=[],s=-1,l=-1;for(let u=0;u<this.value.length;u++){let c=this.value[u],o=this.from[u]+e,f=this.to[u]+e,h,d;if(o==f){let p=r.mapPos(o,c.startSide,c.mapMode);if(p==null||(h=d=p,c.startSide!=c.endSide&&(d=r.mapPos(o,c.endSide),d<h)))continue}else if(h=r.mapPos(o,c.startSide),d=r.mapPos(f,c.endSide),h>d||h==d&&c.startSide>0&&c.endSide<=0)continue;(d-h||c.endSide-c.startSide)<0||(s<0&&(s=h),c.point&&(l=Math.max(l,d-h)),n.push(c),i.push(h-s),a.push(d-s))}return{mapped:n.length?new Rh(i,a,n,l):null,pos:s}}}class ut{constructor(e,r,n,i){this.chunkPos=e,this.chunk=r,this.nextLayer=n,this.maxPoint=i}static create(e,r,n,i){return new ut(e,r,n,i)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let r of this.chunk)e+=r.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:r=[],sort:n=!1,filterFrom:i=0,filterTo:a=this.length}=e,s=e.filter;if(r.length==0&&!s)return this;if(n&&(r=r.slice().sort(Gu)),this.isEmpty)return r.length?ut.of(r):this;let l=new v1(this,null,-1).goto(0),u=0,c=[],o=new Yn;for(;l.value||u<r.length;)if(u<r.length&&(l.from-r[u].from||l.startSide-r[u].value.startSide)>=0){let f=r[u++];o.addInner(f.from,f.to,f.value)||c.push(f)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(u==r.length||this.chunkEnd(l.chunkIndex)<r[u].from)&&(!s||i>this.chunkEnd(l.chunkIndex)||a<this.chunkPos[l.chunkIndex])&&o.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!s||i>l.to||a<l.from||s(l.from,l.to,l.value))&&(o.addInner(l.from,l.to,l.value)||c.push(rs.create(l.from,l.to,l.value))),l.next());return o.finishInner(this.nextLayer.isEmpty&&!c.length?ut.empty:this.nextLayer.update({add:c,filter:s,filterFrom:i,filterTo:a}))}map(e){if(e.empty||this.isEmpty)return this;let r=[],n=[],i=-1;for(let s=0;s<this.chunk.length;s++){let l=this.chunkPos[s],u=this.chunk[s],c=e.touchesRange(l,l+u.length);if(c===!1)i=Math.max(i,u.maxPoint),r.push(u),n.push(e.mapPos(l));else if(c===!0){let{mapped:o,pos:f}=u.map(l,e);o&&(i=Math.max(i,o.maxPoint),r.push(o),n.push(f))}}let a=this.nextLayer.map(e);return r.length==0?a:new ut(n,r,a||ut.empty,i)}between(e,r,n){if(!this.isEmpty){for(let i=0;i<this.chunk.length;i++){let a=this.chunkPos[i],s=this.chunk[i];if(r>=a&&e<=a+s.length&&s.between(a,e-a,r-a,n)===!1)return}this.nextLayer.between(e,r,n)}}iter(e=0){return ns.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,r=0){return ns.from(e).goto(r)}static compare(e,r,n,i,a=-1){let s=e.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=a),l=r.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=a),u=rg(s,l,n),c=new La(s,u,a),o=new La(l,u,a);n.iterGaps((f,h,d)=>ng(c,f,o,h,d,i)),n.empty&&n.length==0&&ng(c,0,o,0,0,i)}static eq(e,r,n=0,i){i==null&&(i=999999999);let a=e.filter(o=>!o.isEmpty&&r.indexOf(o)<0),s=r.filter(o=>!o.isEmpty&&e.indexOf(o)<0);if(a.length!=s.length)return!1;if(!a.length)return!0;let l=rg(a,s),u=new La(a,l,0).goto(n),c=new La(s,l,0).goto(n);for(;;){if(u.to!=c.to||!zu(u.active,c.active)||u.point&&(!c.point||!u.point.eq(c.point)))return!1;if(u.to>i)return!0;u.next(),c.next()}}static spans(e,r,n,i,a=-1){let s=new La(e,null,a).goto(r),l=r,u=s.openStart;for(;;){let c=Math.min(s.to,n);if(s.point){let o=s.activeForPoint(s.to),f=s.pointFrom<r?o.length+1:Math.min(o.length,u);i.point(l,c,s.point,o,f,s.pointRank),u=Math.min(s.openEnd(c),o.length)}else c>l&&(i.span(l,c,s.active,u),u=s.openEnd(c));if(s.to>n)return u+(s.point&&s.to>n?1:0);l=s.to,s.next()}}static of(e,r=!1){let n=new Yn;for(let i of e instanceof rs?[e]:r?x3(e):e)n.add(i.from,i.to,i.value);return n.finish()}}ut.empty=new ut([],[],null,-1);function x3(t){if(t.length>1)for(let e=t[0],r=1;r<t.length;r++){let n=t[r];if(Gu(e,n)>0)return t.slice().sort(Gu);e=n}return t}ut.empty.nextLayer=ut.empty;class Yn{finishChunk(e){this.chunks.push(new Rh(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,r,n){this.addInner(e,r,n)||(this.nextLayer||(this.nextLayer=new Yn)).add(e,r,n)}addInner(e,r,n){let i=e-this.lastTo||n.startSide-this.last.endSide;if(i<=0&&(e-this.lastFrom||n.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return i<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(r-this.chunkStart),this.last=n,this.lastFrom=e,this.lastTo=r,this.value.push(n),n.point&&(this.maxPoint=Math.max(this.maxPoint,r-e)),!0)}addChunk(e,r){if((e-this.lastTo||r.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,r.maxPoint),this.chunks.push(r),this.chunkPos.push(e);let n=r.value.length-1;return this.last=r.value[n],this.lastFrom=r.from[n]+e,this.lastTo=r.to[n]+e,!0}finish(){return this.finishInner(ut.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let r=ut.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,r}}function rg(t,e,r){let n=new Map;for(let a of t)for(let s=0;s<a.chunk.length;s++)a.chunk[s].maxPoint<=0&&n.set(a.chunk[s],a.chunkPos[s]);let i=new Set;for(let a of e)for(let s=0;s<a.chunk.length;s++){let l=n.get(a.chunk[s]);l!=null&&(r?r.mapPos(l):l)==a.chunkPos[s]&&!(r!=null&&r.touchesRange(l,l+a.chunk[s].length))&&i.add(a.chunk[s])}return i}class v1{constructor(e,r,n,i=0){this.layer=e,this.skip=r,this.minPoint=n,this.rank=i}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,r=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,r,!1),this}gotoInner(e,r,n){for(;this.chunkIndex<this.layer.chunk.length;){let i=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(i)||this.layer.chunkEnd(this.chunkIndex)<e||i.maxPoint<this.minPoint))break;this.chunkIndex++,n=!1}if(this.chunkIndex<this.layer.chunk.length){let i=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],r,!0);(!n||this.rangeIndex<i)&&this.setRangeIndex(i)}this.next()}forward(e,r){(this.to-e||this.endSide-r)<0&&this.gotoInner(e,r,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],r=this.layer.chunk[this.chunkIndex],n=e+r.from[this.rangeIndex];if(this.from=n,this.to=e+r.to[this.rangeIndex],this.value=r.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class ns{constructor(e){this.heap=e}static from(e,r=null,n=-1){let i=[];for(let a=0;a<e.length;a++)for(let s=e[a];!s.isEmpty;s=s.nextLayer)s.maxPoint>=n&&i.push(new v1(s,r,n,a));return i.length==1?i[0]:new ns(i)}get startSide(){return this.value?this.value.startSide:0}goto(e,r=-1e9){for(let n of this.heap)n.goto(e,r);for(let n=this.heap.length>>1;n>=0;n--)Hc(this.heap,n);return this.next(),this}forward(e,r){for(let n of this.heap)n.forward(e,r);for(let n=this.heap.length>>1;n>=0;n--)Hc(this.heap,n);(this.to-e||this.value.endSide-r)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Hc(this.heap,0)}}}function Hc(t,e){for(let r=t[e];;){let n=(e<<1)+1;if(n>=t.length)break;let i=t[n];if(n+1<t.length&&i.compare(t[n+1])>=0&&(i=t[n+1],n++),r.compare(i)<0)break;t[n]=r,t[e]=i,e=n}}class La{constructor(e,r,n){this.minPoint=n,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=ns.from(e,r,n)}goto(e,r=-1e9){return this.cursor.goto(e,r),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=r,this.openStart=-1,this.next(),this}forward(e,r){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-r)<0;)this.removeActive(this.minActive);this.cursor.forward(e,r)}removeActive(e){Ks(this.active,e),Ks(this.activeTo,e),Ks(this.activeRank,e),this.minActive=ig(this.active,this.activeTo)}addActive(e){let r=0,{value:n,to:i,rank:a}=this.cursor;for(;r<this.activeRank.length&&this.activeRank[r]<=a;)r++;js(this.active,r,n),js(this.activeTo,r,i),js(this.activeRank,r,a),e&&js(e,r,this.cursor.from),this.minActive=ig(this.active,this.activeTo)}next(){let e=this.to,r=this.point;this.point=null;let n=this.openStart<0?[]:null;for(;;){let i=this.minActive;if(i>-1&&(this.activeTo[i]-this.cursor.from||this.active[i].endSide-this.cursor.startSide)<0){if(this.activeTo[i]>e){this.to=this.activeTo[i],this.endSide=this.active[i].endSide;break}this.removeActive(i),n&&Ks(n,i)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let a=this.cursor.value;if(!a.point)this.addActive(n),this.cursor.next();else if(r&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=a,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=a.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(n){this.openStart=0;for(let i=n.length-1;i>=0&&n[i]<e;i--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let r=[];for(let n=this.active.length-1;n>=0&&!(this.activeRank[n]<this.pointRank);n--)(this.activeTo[n]>e||this.activeTo[n]==e&&this.active[n].endSide>=this.point.endSide)&&r.push(this.active[n]);return r.reverse()}openEnd(e){let r=0;for(let n=this.activeTo.length-1;n>=0&&this.activeTo[n]>e;n--)r++;return r}}function ng(t,e,r,n,i,a){t.goto(e),r.goto(n);let s=n+i,l=n,u=n-e;for(;;){let c=t.to+u-r.to||t.endSide-r.endSide,o=c<0?t.to+u:r.to,f=Math.min(o,s);if(t.point||r.point?t.point&&r.point&&(t.point==r.point||t.point.eq(r.point))&&zu(t.activeForPoint(t.to),r.activeForPoint(r.to))||a.comparePoint(l,f,t.point,r.point):f>l&&!zu(t.active,r.active)&&a.compareRange(l,f,t.active,r.active),o>s)break;l=o,c<=0&&t.next(),c>=0&&r.next()}}function zu(t,e){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!=e[r]&&!t[r].eq(e[r]))return!1;return!0}function Ks(t,e){for(let r=e,n=t.length-1;r<n;r++)t[r]=t[r+1];t.pop()}function js(t,e,r){for(let n=t.length-1;n>=e;n--)t[n+1]=t[n];t[e]=r}function ig(t,e){let r=-1,n=1e9;for(let i=0;i<e.length;i++)(e[i]-n||t[i].endSide-t[r].endSide)<0&&(r=i,n=e[i]);return r}function ba(t,e,r=t.length){let n=0;for(let i=0;i<r;)t.charCodeAt(i)==9?(n+=e-n%e,i++):(n++,i=er(t,i));return n}function qu(t,e,r,n){for(let i=0,a=0;;){if(a>=e)return i;if(i==t.length)break;a+=t.charCodeAt(i)==9?r-a%r:1,i=er(t,i)}return n===!0?-1:t.length}const Yu="ͼ",ag=typeof Symbol>"u"?"__"+Yu:Symbol.for(Yu),Xu=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),sg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class Xn{constructor(e,r){this.rules=[];let{finish:n}=r||{};function i(s){return/^@/.test(s)?[s]:s.split(/,\s*/)}function a(s,l,u,c){let o=[],f=/^@(\w+)\b/.exec(s[0]),h=f&&f[1]=="keyframes";if(f&&l==null)return u.push(s[0]+";");for(let d in l){let p=l[d];if(/&/.test(d))a(d.split(/,\s*/).map(g=>s.map(m=>g.replace(/&/,m))).reduce((g,m)=>g.concat(m)),p,u);else if(p&&typeof p=="object"){if(!f)throw new RangeError("The value of a property ("+d+") should be a primitive value.");a(i(d),p,o,h)}else p!=null&&o.push(d.replace(/_.*/,"").replace(/[A-Z]/g,g=>"-"+g.toLowerCase())+": "+p+";")}(o.length||h)&&u.push((n&&!f&&!c?s.map(n):s).join(", ")+" {"+o.join(" ")+"}")}for(let s in e)a(i(s),e[s],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=sg[ag]||1;return sg[ag]=e+1,Yu+e.toString(36)}static mount(e,r,n){let i=e[Xu],a=n&&n.nonce;i?a&&i.setNonce(a):i=new M3(e,a),i.mount(Array.isArray(r)?r:[r])}}let og=new Map;class M3{constructor(e,r){let n=e.ownerDocument||e,i=n.defaultView;if(!e.head&&e.adoptedStyleSheets&&i.CSSStyleSheet){let a=og.get(n);if(a)return e.adoptedStyleSheets=[a.sheet,...e.adoptedStyleSheets],e[Xu]=a;this.sheet=new i.CSSStyleSheet,e.adoptedStyleSheets=[this.sheet,...e.adoptedStyleSheets],og.set(n,this)}else{this.styleTag=n.createElement("style"),r&&this.styleTag.setAttribute("nonce",r);let a=e.head||e;a.insertBefore(this.styleTag,a.firstChild)}this.modules=[],e[Xu]=this}mount(e){let r=this.sheet,n=0,i=0;for(let a=0;a<e.length;a++){let s=e[a],l=this.modules.indexOf(s);if(l<i&&l>-1&&(this.modules.splice(l,1),i--,l=-1),l==-1){if(this.modules.splice(i++,0,s),r)for(let u=0;u<s.rules.length;u++)r.insertRule(s.rules[u],n++)}else{for(;i<l;)n+=this.modules[i++].rules.length;n+=s.rules.length,i++}}if(!r){let a="";for(let s=0;s<this.modules.length;s++)a+=this.modules[s].getRules()+`
`;this.styleTag.textContent=a}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}var Qn={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},is={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},_3=typeof navigator<"u"&&/Mac/.test(navigator.platform),k3=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Jt=0;Jt<10;Jt++)Qn[48+Jt]=Qn[96+Jt]=String(Jt);for(var Jt=1;Jt<=24;Jt++)Qn[Jt+111]="F"+Jt;for(var Jt=65;Jt<=90;Jt++)Qn[Jt]=String.fromCharCode(Jt+32),is[Jt]=String.fromCharCode(Jt);for(var Gc in Qn)is.hasOwnProperty(Gc)||(is[Gc]=Qn[Gc]);function P3(t){var e=_3&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||k3&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",r=!e&&t.key||(t.shiftKey?is:Qn)[t.keyCode]||t.key||"Unidentified";return r=="Esc"&&(r="Escape"),r=="Del"&&(r="Delete"),r=="Left"&&(r="ArrowLeft"),r=="Up"&&(r="ArrowUp"),r=="Right"&&(r="ArrowRight"),r=="Down"&&(r="ArrowDown"),r}function Xo(t){let e;return t.nodeType==11?e=t.getSelection?t:t.ownerDocument:e=t,e.getSelection()}function Qu(t,e){return e?t==e||t.contains(e.nodeType!=1?e.parentNode:e):!1}function I3(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function Mo(t,e){if(!e.anchorNode)return!1;try{return Qu(t,e.anchorNode)}catch{return!1}}function Ji(t){return t.nodeType==3?Ci(t,0,t.nodeValue.length).getClientRects():t.nodeType==1?t.getClientRects():[]}function Qo(t,e,r,n){return r?lg(t,e,r,n,-1)||lg(t,e,r,n,1):!1}function as(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e}function lg(t,e,r,n,i){for(;;){if(t==r&&e==n)return!0;if(e==(i<0?0:wn(t))){if(t.nodeName=="DIV")return!1;let a=t.parentNode;if(!a||a.nodeType!=1)return!1;e=as(t)+(i<0?0:1),t=a}else if(t.nodeType==1){if(t=t.childNodes[e+(i<0?-1:0)],t.nodeType==1&&t.contentEditable=="false")return!1;e=i<0?wn(t):0}else return!1}}function wn(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function tc(t,e){let r=e?t.left:t.right;return{left:r,right:r,top:t.top,bottom:t.bottom}}function D3(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}function L3(t,e,r,n,i,a,s,l){let u=t.ownerDocument,c=u.defaultView||window;for(let o=t,f=!1;o&&!f;)if(o.nodeType==1){let h,d=o==u.body,p=1,g=1;if(d)h=D3(c);else{if(/^(fixed|sticky)$/.test(getComputedStyle(o).position)&&(f=!0),o.scrollHeight<=o.clientHeight&&o.scrollWidth<=o.clientWidth){o=o.assignedSlot||o.parentNode;continue}let b=o.getBoundingClientRect();p=b.width/o.offsetWidth,g=b.height/o.offsetHeight,h={left:b.left,right:b.left+o.clientWidth*p,top:b.top,bottom:b.top+o.clientHeight*g}}let m=0,v=0;if(i=="nearest")e.top<h.top?(v=-(h.top-e.top+s),r>0&&e.bottom>h.bottom+v&&(v=e.bottom-h.bottom+v+s)):e.bottom>h.bottom&&(v=e.bottom-h.bottom+s,r<0&&e.top-v<h.top&&(v=-(h.top+v-e.top+s)));else{let b=e.bottom-e.top,C=h.bottom-h.top;v=(i=="center"&&b<=C?e.top+b/2-C/2:i=="start"||i=="center"&&r<0?e.top-s:e.bottom-C+s)-h.top}if(n=="nearest"?e.left<h.left?(m=-(h.left-e.left+a),r>0&&e.right>h.right+m&&(m=e.right-h.right+m+a)):e.right>h.right&&(m=e.right-h.right+a,r<0&&e.left<h.left+m&&(m=-(h.left+m-e.left+a))):m=(n=="center"?e.left+(e.right-e.left)/2-(h.right-h.left)/2:n=="start"==l?e.left-a:e.right-(h.right-h.left)+a)-h.left,m||v)if(d)c.scrollBy(m,v);else{let b=0,C=0;if(v){let A=o.scrollTop;o.scrollTop+=v/g,C=(o.scrollTop-A)*g}if(m){let A=o.scrollLeft;o.scrollLeft+=m/p,b=(o.scrollLeft-A)*p}e={left:e.left-b,top:e.top-C,right:e.right-b,bottom:e.bottom-C},b&&Math.abs(b-m)<1&&(n="nearest"),C&&Math.abs(C-v)<1&&(i="nearest")}if(d)break;o=o.assignedSlot||o.parentNode}else if(o.nodeType==11)o=o.host;else break}function B3(t){let e=t.ownerDocument;for(let r=t.parentNode;r&&r!=e.body;)if(r.nodeType==1){if(r.scrollHeight>r.clientHeight||r.scrollWidth>r.clientWidth)return r;r=r.assignedSlot||r.parentNode}else if(r.nodeType==11)r=r.host;else break;return null}class U3{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:r,focusNode:n}=e;this.set(r,Math.min(e.anchorOffset,r?wn(r):0),n,Math.min(e.focusOffset,n?wn(n):0))}set(e,r,n,i){this.anchorNode=e,this.anchorOffset=r,this.focusNode=n,this.focusOffset=i}}let Di=null;function y1(t){if(t.setActive)return t.setActive();if(Di)return t.focus(Di);let e=[];for(let r=t;r&&(e.push(r,r.scrollTop,r.scrollLeft),r!=r.ownerDocument);r=r.parentNode);if(t.focus(Di==null?{get preventScroll(){return Di={preventScroll:!0},!0}}:void 0),!Di){Di=!1;for(let r=0;r<e.length;){let n=e[r++],i=e[r++],a=e[r++];n.scrollTop!=i&&(n.scrollTop=i),n.scrollLeft!=a&&(n.scrollLeft=a)}}}let cg;function Ci(t,e,r=e){let n=cg||(cg=document.createRange());return n.setEnd(t,r),n.setStart(t,e),n}function Yi(t,e,r){let n={key:e,code:e,keyCode:r,which:r,cancelable:!0},i=new KeyboardEvent("keydown",n);i.synthetic=!0,t.dispatchEvent(i);let a=new KeyboardEvent("keyup",n);return a.synthetic=!0,t.dispatchEvent(a),i.defaultPrevented||a.defaultPrevented}function $3(t){for(;t;){if(t&&(t.nodeType==9||t.nodeType==11&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}function b1(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}function F3(t,e){let r=e.focusNode,n=e.focusOffset;if(!r||e.anchorNode!=r||e.anchorOffset!=n)return!1;for(n=Math.min(n,wn(r));;)if(n){if(r.nodeType!=1)return!1;let i=r.childNodes[n-1];i.contentEditable=="false"?n--:(r=i,n=wn(r))}else{if(r==t)return!0;n=as(r),r=r.parentNode}}function E1(t){return t.scrollTop>Math.max(1,t.scrollHeight-t.clientHeight-4)}class ar{constructor(e,r,n=!0){this.node=e,this.offset=r,this.precise=n}static before(e,r){return new ar(e.parentNode,as(e),r)}static after(e,r){return new ar(e.parentNode,as(e)+1,r)}}const Nh=[];class At{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let r=this.posAtStart;for(let n of this.children){if(n==e)return r;r+=n.length+n.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,r){if(this.flags&2){let n=this.dom,i=null,a;for(let s of this.children){if(s.flags&7){if(!s.dom&&(a=i?i.nextSibling:n.firstChild)){let l=At.get(a);(!l||!l.parent&&l.canReuseDOM(s))&&s.reuseDOM(a)}s.sync(e,r),s.flags&=-8}if(a=i?i.nextSibling:n.firstChild,r&&!r.written&&r.node==n&&a!=s.dom&&(r.written=!0),s.dom.parentNode==n)for(;a&&a!=s.dom;)a=ug(a);else n.insertBefore(s.dom,a);i=s.dom}for(a=i?i.nextSibling:n.firstChild,a&&r&&r.node==n&&(r.written=!0);a;)a=ug(a)}else if(this.flags&1)for(let n of this.children)n.flags&7&&(n.sync(e,r),n.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,r){let n;if(e==this.dom)n=this.dom.childNodes[r];else{let i=wn(e)==0?0:r==0?-1:1;for(;;){let a=e.parentNode;if(a==this.dom)break;i==0&&a.firstChild!=a.lastChild&&(e==a.firstChild?i=-1:i=1),e=a}i<0?n=e:n=e.nextSibling}if(n==this.dom.firstChild)return 0;for(;n&&!At.get(n);)n=n.nextSibling;if(!n)return this.length;for(let i=0,a=0;;i++){let s=this.children[i];if(s.dom==n)return a;a+=s.length+s.breakAfter}}domBoundsAround(e,r,n=0){let i=-1,a=-1,s=-1,l=-1;for(let u=0,c=n,o=n;u<this.children.length;u++){let f=this.children[u],h=c+f.length;if(c<e&&h>r)return f.domBoundsAround(e,r,c);if(h>=e&&i==-1&&(i=u,a=c),c>r&&f.dom.parentNode==this.dom){s=u,l=o;break}o=h,c=h+f.breakAfter}return{from:a,to:l<0?n+this.length:l,startDOM:(i?this.children[i-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:s<this.children.length&&s>=0?this.children[s].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let r=this.parent;r;r=r.parent){if(e&&(r.flags|=2),r.flags&1)return;r.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.flags&7&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let r=e.parent;if(!r)return e;e=r}}replaceChildren(e,r,n=Nh){this.markDirty();for(let i=e;i<r;i++){let a=this.children[i];a.parent==this&&n.indexOf(a)<0&&a.destroy()}this.children.splice(e,r-e,...n);for(let i=0;i<n.length;i++)n[i].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new O1(this.children,e,this.children.length)}childPos(e,r=1){return this.childCursor().findPos(e,r)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,r,n,i,a,s){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!((this.flags|e.flags)&8)}getSide(){return 0}destroy(){for(let e of this.children)e.destroy();this.parent=null}}At.prototype.breakAfter=0;function ug(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class O1{constructor(e,r,n){this.children=e,this.pos=r,this.i=n,this.off=0}findPos(e,r=1){for(;;){if(e>this.pos||e==this.pos&&(r>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let n=this.children[--this.i];this.pos-=n.length+n.breakAfter}}}function A1(t,e,r,n,i,a,s,l,u){let{children:c}=t,o=c.length?c[e]:null,f=a.length?a[a.length-1]:null,h=f?f.breakAfter:s;if(!(e==n&&o&&!s&&!h&&a.length<2&&o.merge(r,i,a.length?f:null,r==0,l,u))){if(n<c.length){let d=c[n];d&&(i<d.length||d.breakAfter&&(f!=null&&f.breakAfter))?(e==n&&(d=d.split(i),i=0),!h&&f&&d.merge(0,i,f,!0,0,u)?a[a.length-1]=d:((i||d.children.length&&!d.children[0].length)&&d.merge(0,i,null,!1,0,u),a.push(d))):d!=null&&d.breakAfter&&(f?f.breakAfter=1:s=1),n++}for(o&&(o.breakAfter=s,r>0&&(!s&&a.length&&o.merge(r,o.length,a[0],!1,l,0)?o.breakAfter=a.shift().breakAfter:(r<o.length||o.children.length&&o.children[o.children.length-1].length==0)&&o.merge(r,o.length,null,!1,l,0),e++));e<n&&a.length;)if(c[n-1].become(a[a.length-1]))n--,a.pop(),u=a.length?0:l;else if(c[e].become(a[0]))e++,a.shift(),l=a.length?0:u;else break;!a.length&&e&&n<c.length&&!c[e-1].breakAfter&&c[n].merge(0,0,c[e-1],!1,l,u)&&e--,(e<n||a.length)&&t.replaceChildren(e,n,a)}}function C1(t,e,r,n,i,a){let s=t.childCursor(),{i:l,off:u}=s.findPos(r,1),{i:c,off:o}=s.findPos(e,-1),f=e-r;for(let h of n)f+=h.length;t.length+=f,A1(t,c,o,l,u,n,0,i,a)}let Sr=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},Ku=typeof document<"u"?document:{documentElement:{style:{}}};const ju=/Edge\/(\d+)/.exec(Sr.userAgent),w1=/MSIE \d/.test(Sr.userAgent),Zu=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Sr.userAgent),rc=!!(w1||Zu||ju),fg=!rc&&/gecko\/(\d+)/i.test(Sr.userAgent),zc=!rc&&/Chrome\/(\d+)/.exec(Sr.userAgent),hg="webkitFontSmoothing"in Ku.documentElement.style,S1=!rc&&/Apple Computer/.test(Sr.vendor),dg=S1&&(/Mobile\/\w+/.test(Sr.userAgent)||Sr.maxTouchPoints>2);var Fe={mac:dg||/Mac/.test(Sr.platform),windows:/Win/.test(Sr.platform),linux:/Linux|X11/.test(Sr.platform),ie:rc,ie_version:w1?Ku.documentMode||6:Zu?+Zu[1]:ju?+ju[1]:0,gecko:fg,gecko_version:fg?+(/Firefox\/(\d+)/.exec(Sr.userAgent)||[0,0])[1]:0,chrome:!!zc,chrome_version:zc?+zc[1]:0,ios:dg,android:/Android\b/.test(Sr.userAgent),webkit:hg,safari:S1,webkit_version:hg?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:Ku.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const V3=256;class Sn extends At{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,r){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(r&&r.node==this.dom&&(r.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,r,n){return this.flags&8||n&&(!(n instanceof Sn)||this.length-(r-e)+n.length>V3||n.flags&8)?!1:(this.text=this.text.slice(0,e)+(n?n.text:"")+this.text.slice(r),this.markDirty(),!0)}split(e){let r=new Sn(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),r.flags|=this.flags&8,r}localPosFromDOM(e,r){return e==this.dom?r:r?this.text.length:0}domAtPos(e){return new ar(this.dom,e)}domBoundsAround(e,r,n){return{from:n,to:n+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,r){return W3(this.dom,e,r)}}class Tn extends At{constructor(e,r=[],n=0){super(),this.mark=e,this.children=r,this.length=n;for(let i of r)i.setParent(this)}setAttrs(e){if(b1(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let r in this.mark.attrs)e.setAttribute(r,this.mark.attrs[r]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!((this.flags|e.flags)&8)}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,r){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,r)}merge(e,r,n,i,a,s){return n&&(!(n instanceof Tn&&n.mark.eq(this.mark))||e&&a<=0||r<this.length&&s<=0)?!1:(C1(this,e,r,n?n.children:[],a-1,s-1),this.markDirty(),!0)}split(e){let r=[],n=0,i=-1,a=0;for(let l of this.children){let u=n+l.length;u>e&&r.push(n<e?l.split(e-n):l),i<0&&n>=e&&(i=a),n=u,a++}let s=this.length-e;return this.length=e,i>-1&&(this.children.length=i,this.markDirty()),new Tn(this.mark,r,s)}domAtPos(e){return T1(this,e)}coordsAt(e,r){return N1(this,e,r)}}function W3(t,e,r){let n=t.nodeValue.length;e>n&&(e=n);let i=e,a=e,s=0;e==0&&r<0||e==n&&r>=0?Fe.chrome||Fe.gecko||(e?(i--,s=1):a<n&&(a++,s=-1)):r<0?i--:a<n&&a++;let l=Ci(t,i,a).getClientRects();if(!l.length)return null;let u=l[(s?s<0:r>=0)?0:l.length-1];return Fe.safari&&!s&&u.width==0&&(u=Array.prototype.find.call(l,c=>c.width)||u),s?tc(u,s<0):u||null}class Fn extends At{static create(e,r,n){return new Fn(e,r,n)}constructor(e,r,n){super(),this.widget=e,this.length=r,this.side=n,this.prevWidget=null}split(e){let r=Fn.create(this.widget,this.length-e,this.side);return this.length-=e,r}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,r,n,i,a,s){return n&&(!(n instanceof Fn)||!this.widget.compare(n.widget)||e>0&&a<=0||r<this.length&&s<=0)?!1:(this.length=e+(n?n.length:0)+(this.length-r),!0)}become(e){return e instanceof Fn&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return ot.empty;let e=this;for(;e.parent;)e=e.parent;let{view:r}=e,n=r&&r.state.doc,i=this.posAtStart;return n?n.slice(i,i+this.length):ot.empty}domAtPos(e){return(this.length?e==0:this.side>0)?ar.before(this.dom):ar.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,r){let n=this.widget.coordsAt(this.dom,e,r);if(n)return n;let i=this.dom.getClientRects(),a=null;if(!i.length)return null;let s=this.side?this.side<0:e>0;for(let l=s?i.length-1:0;a=i[l],!(e>0?l==0:l==i.length-1||a.top<a.bottom);l+=s?-1:1);return tc(a,!s)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class ea extends At{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof ea&&e.side==this.side}split(){return new ea(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?ar.before(this.dom):ar.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return ot.empty}get isHidden(){return!0}}Sn.prototype.children=Fn.prototype.children=ea.prototype.children=Nh;function T1(t,e){let r=t.dom,{children:n}=t,i=0;for(let a=0;i<n.length;i++){let s=n[i],l=a+s.length;if(!(l==a&&s.getSide()<=0)){if(e>a&&e<l&&s.dom.parentNode==r)return s.domAtPos(e-a);if(e<=a)break;a=l}}for(let a=i;a>0;a--){let s=n[a-1];if(s.dom.parentNode==r)return s.domAtPos(s.length)}for(let a=i;a<n.length;a++){let s=n[a];if(s.dom.parentNode==r)return s.domAtPos(0)}return new ar(r,0)}function R1(t,e,r){let n,{children:i}=t;r>0&&e instanceof Tn&&i.length&&(n=i[i.length-1])instanceof Tn&&n.mark.eq(e.mark)?R1(n,e.children[0],r-1):(i.push(e),e.setParent(t)),t.length+=e.length}function N1(t,e,r){let n=null,i=-1,a=null,s=-1;function l(c,o){for(let f=0,h=0;f<c.children.length&&h<=o;f++){let d=c.children[f],p=h+d.length;p>=o&&(d.children.length?l(d,o-h):(!a||a.isHidden&&r>0)&&(p>o||h==p&&d.getSide()>0)?(a=d,s=o-h):(h<o||h==p&&d.getSide()<0&&!d.isHidden)&&(n=d,i=o-h)),h=p}}l(t,e);let u=(r<0?n:a)||n||a;return u?u.coordsAt(Math.max(0,u==n?i:s),r):H3(t)}function H3(t){let e=t.dom.lastChild;if(!e)return t.dom.getBoundingClientRect();let r=Ji(e);return r[r.length-1]||null}function Ju(t,e){for(let r in t)r=="class"&&e.class?e.class+=" "+t.class:r=="style"&&e.style?e.style+=";"+t.style:e[r]=t[r];return e}const pg=Object.create(null);function xh(t,e,r){if(t==e)return!0;t||(t=pg),e||(e=pg);let n=Object.keys(t),i=Object.keys(e);if(n.length-(r&&n.indexOf(r)>-1?1:0)!=i.length-(r&&i.indexOf(r)>-1?1:0))return!1;for(let a of n)if(a!=r&&(i.indexOf(a)==-1||t[a]!==e[a]))return!1;return!0}function ef(t,e,r){let n=!1;if(e)for(let i in e)r&&i in r||(n=!0,i=="style"?t.style.cssText="":t.removeAttribute(i));if(r)for(let i in r)e&&e[i]==r[i]||(n=!0,i=="style"?t.style.cssText=r[i]:t.setAttribute(i,r[i]));return n}function G3(t){let e=Object.create(null);for(let r=0;r<t.attributes.length;r++){let n=t.attributes[r];e[n.name]=n.value}return e}class Ht extends At{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,r,n,i,a,s){if(n){if(!(n instanceof Ht))return!1;this.dom||n.transferDOM(this)}return i&&this.setDeco(n?n.attrs:null),C1(this,e,r,n?n.children:[],a,s),!0}split(e){let r=new Ht;if(r.breakAfter=this.breakAfter,this.length==0)return r;let{i:n,off:i}=this.childPos(e);i&&(r.append(this.children[n].split(i),0),this.children[n].merge(i,this.children[n].length,null,!1,0,0),n++);for(let a=n;a<this.children.length;a++)r.append(this.children[a],0);for(;n>0&&this.children[n-1].length==0;)this.children[--n].destroy();return this.children.length=n,this.markDirty(),this.length=e,r}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){xh(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,r){R1(this,e,r)}addLineDeco(e){let r=e.spec.attributes,n=e.spec.class;r&&(this.attrs=Ju(r,this.attrs||{})),n&&(this.attrs=Ju({class:n},this.attrs||{}))}domAtPos(e){return T1(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.flags|=6)}sync(e,r){var n;this.dom?this.flags&4&&(b1(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(ef(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,r);let i=this.dom.lastChild;for(;i&&At.get(i)instanceof Tn;)i=i.lastChild;if(!i||!this.length||i.nodeName!="BR"&&((n=At.get(i))===null||n===void 0?void 0:n.isEditable)==!1&&(!Fe.ios||!this.children.some(a=>a instanceof Sn))){let a=document.createElement("BR");a.cmIgnore=!0,this.dom.appendChild(a)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,r;for(let n of this.children){if(!(n instanceof Sn)||/[^ -~]/.test(n.text))return null;let i=Ji(n.dom);if(i.length!=1)return null;e+=i[0].width,r=i[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:r}:null}coordsAt(e,r){let n=N1(this,e,r);if(!this.children.length&&n&&this.parent){let{heightOracle:i}=this.parent.view.viewState,a=n.bottom-n.top;if(Math.abs(a-i.lineHeight)<2&&i.textHeight<a){let s=(a-i.textHeight)/2;return{top:n.top+s,bottom:n.bottom-s,left:n.left,right:n.left}}}return n}become(e){return!1}covers(){return!0}static find(e,r){for(let n=0,i=0;n<e.children.length;n++){let a=e.children[n],s=i+a.length;if(s>=r){if(a instanceof Ht)return a;if(s>r)break}i=s+a.breakAfter}return null}}class Wn extends At{constructor(e,r,n){super(),this.widget=e,this.length=r,this.deco=n,this.breakAfter=0,this.prevWidget=null}merge(e,r,n,i,a,s){return n&&(!(n instanceof Wn)||!this.widget.compare(n.widget)||e>0&&a<=0||r<this.length&&s<=0)?!1:(this.length=e+(n?n.length:0)+(this.length-r),!0)}domAtPos(e){return e==0?ar.before(this.dom):ar.after(this.dom,e==this.length)}split(e){let r=this.length-e;this.length=e;let n=new Wn(this.widget,r,this.deco);return n.breakAfter=this.breakAfter,n}get children(){return Nh}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):ot.empty}domBoundsAround(){return null}become(e){return e instanceof Wn&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,r){return this.widget.coordsAt(this.dom,e,r)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:r,endSide:n}=this.deco;return r==n?!1:e<0?r<0:n>0}}class kn{eq(e){return!1}updateDOM(e,r){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,r,n){return null}get isHidden(){return!1}destroy(e){}}var hr=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(hr||(hr={}));class qe extends Ai{constructor(e,r,n,i){super(),this.startSide=e,this.endSide=r,this.widget=n,this.spec=i}get heightRelevant(){return!1}static mark(e){return new _s(e)}static widget(e){let r=Math.max(-1e4,Math.min(1e4,e.side||0)),n=!!e.block;return r+=n&&!e.inlineOrder?r>0?3e8:-4e8:r>0?1e8:-1e8,new Kn(e,r,r,n,e.widget||null,!1)}static replace(e){let r=!!e.block,n,i;if(e.isBlockGap)n=-5e8,i=4e8;else{let{start:a,end:s}=x1(e,r);n=(a?r?-3e8:-1:5e8)-1,i=(s?r?2e8:1:-6e8)+1}return new Kn(e,n,i,r,e.widget||null,!0)}static line(e){return new ks(e)}static set(e,r=!1){return ut.of(e,r)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}qe.none=ut.empty;class _s extends qe{constructor(e){let{start:r,end:n}=x1(e);super(r?-1:5e8,n?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var r,n;return this==e||e instanceof _s&&this.tagName==e.tagName&&(this.class||((r=this.attrs)===null||r===void 0?void 0:r.class))==(e.class||((n=e.attrs)===null||n===void 0?void 0:n.class))&&xh(this.attrs,e.attrs,"class")}range(e,r=e){if(e>=r)throw new RangeError("Mark decorations may not be empty");return super.range(e,r)}}_s.prototype.point=!1;class ks extends qe{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof ks&&this.spec.class==e.spec.class&&xh(this.spec.attributes,e.spec.attributes)}range(e,r=e){if(r!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,r)}}ks.prototype.mapMode=fr.TrackBefore;ks.prototype.point=!0;class Kn extends qe{constructor(e,r,n,i,a,s){super(r,n,a,e),this.block=i,this.isReplace=s,this.mapMode=i?r<=0?fr.TrackBefore:fr.TrackAfter:fr.TrackDel}get type(){return this.startSide!=this.endSide?hr.WidgetRange:this.startSide<=0?hr.WidgetBefore:hr.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof Kn&&z3(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,r=e){if(this.isReplace&&(e>r||e==r&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&r!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,r)}}Kn.prototype.point=!0;function x1(t,e=!1){let{inclusiveStart:r,inclusiveEnd:n}=t;return r==null&&(r=t.inclusive),n==null&&(n=t.inclusive),{start:r??e,end:n??e}}function z3(t,e){return t==e||!!(t&&e&&t.compare(e))}function tf(t,e,r,n=0){let i=r.length-1;i>=0&&r[i]+n>=t?r[i]=Math.max(r[i],e):r.push(t,e)}class Za{constructor(e,r,n,i){this.doc=e,this.pos=r,this.end=n,this.disallowBlockEffectsFor=i,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=r}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof Wn&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new Ht),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(Zs(new ea(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(e&&this.content.length&&this.content[this.content.length-1]instanceof Wn)&&this.getLine()}buildText(e,r,n){for(;e>0;){if(this.textOff==this.text.length){let{value:a,lineBreak:s,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(s){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=a,this.textOff=0}let i=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(r.slice(r.length-n)),this.getLine().append(Zs(new Sn(this.text.slice(this.textOff,this.textOff+i)),r),n),this.atCursorPos=!0,this.textOff+=i,e-=i,n=0}}span(e,r,n,i){this.buildText(r-e,n,i),this.pos=r,this.openStart<0&&(this.openStart=i)}point(e,r,n,i,a,s){if(this.disallowBlockEffectsFor[s]&&n instanceof Kn){if(n.block)throw new RangeError("Block decorations may not be specified via plugins");if(r>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=r-e;if(n instanceof Kn)if(n.block)n.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new Wn(n.widget||new gg("div"),l,n));else{let u=Fn.create(n.widget||new gg("span"),l,l?0:n.startSide),c=this.atCursorPos&&!u.isEditable&&a<=i.length&&(e<r||n.startSide>0),o=!u.isEditable&&(e<r||a>i.length||n.startSide<=0),f=this.getLine();this.pendingBuffer==2&&!c&&!u.isEditable&&(this.pendingBuffer=0),this.flushBuffer(i),c&&(f.append(Zs(new ea(1),i),a),a=i.length+Math.max(0,a-i.length)),f.append(Zs(u,i),a),this.atCursorPos=o,this.pendingBuffer=o?e<r||a>i.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=i.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(n);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=r),this.openStart<0&&(this.openStart=a)}static build(e,r,n,i,a){let s=new Za(e,r,n,a);return s.openEnd=ut.spans(i,r,n,s),s.openStart<0&&(s.openStart=s.openEnd),s.finish(s.openEnd),s}}function Zs(t,e){for(let r of e)t=new Tn(r,[t],t.length);return t}class gg extends kn{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}const M1=$e.define(),_1=$e.define(),k1=$e.define(),P1=$e.define(),rf=$e.define(),I1=$e.define(),D1=$e.define(),L1=$e.define({combine:t=>t.some(e=>e)}),B1=$e.define({combine:t=>t.some(e=>e)});class Xi{constructor(e,r="nearest",n="nearest",i=5,a=5,s=!1){this.range=e,this.y=r,this.x=n,this.yMargin=i,this.xMargin=a,this.isSnapshot=s}map(e){return e.empty?this:new Xi(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new Xi(Ee.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const Js=Ze.define({map:(t,e)=>t.map(e)});function kr(t,e,r){let n=t.facet(P1);n.length?n[0](e):window.onerror?window.onerror(String(e),r,void 0,void 0,e):r?console.error(r+":",e):console.error(e)}const nc=$e.define({combine:t=>t.length?t[0]:!0});let q3=0;const Wa=$e.define();class It{constructor(e,r,n,i,a){this.id=e,this.create=r,this.domEventHandlers=n,this.domEventObservers=i,this.extension=a(this)}static define(e,r){const{eventHandlers:n,eventObservers:i,provide:a,decorations:s}=r||{};return new It(q3++,e,n,i,l=>{let u=[Wa.of(l)];return s&&u.push(ss.of(c=>{let o=c.plugin(l);return o?s(o):qe.none})),a&&u.push(a(l)),u})}static fromClass(e,r){return It.define(n=>new e(n),r)}}class qc{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let r=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(r)}catch(n){if(kr(r.state,n,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(r){kr(e.state,r,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var r;if(!((r=this.value)===null||r===void 0)&&r.destroy)try{this.value.destroy()}catch(n){kr(e.state,n,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const U1=$e.define(),Mh=$e.define(),ss=$e.define(),_h=$e.define(),$1=$e.define();function mg(t,e,r){let n=t.state.facet($1);if(!n.length)return n;let i=n.map(s=>s instanceof Function?s(t):s),a=[];return ut.spans(i,e,r,{point(){},span(s,l,u,c){let o=a;for(let f=u.length-1;f>=0;f--,c--){let h=u[f].spec.bidiIsolate,d;if(h!=null)if(c>0&&o.length&&(d=o[o.length-1]).to==s&&d.direction==h)d.to=l,o=d.inner;else{let p={from:s,to:l,direction:h,inner:[]};o.push(p),o=p.inner}}}}),a}const F1=$e.define();function V1(t){let e=0,r=0,n=0,i=0;for(let a of t.state.facet(F1)){let s=a(t);s&&(s.left!=null&&(e=Math.max(e,s.left)),s.right!=null&&(r=Math.max(r,s.right)),s.top!=null&&(n=Math.max(n,s.top)),s.bottom!=null&&(i=Math.max(i,s.bottom)))}return{left:e,right:r,top:n,bottom:i}}const Ha=$e.define();class Pr{constructor(e,r,n,i){this.fromA=e,this.toA=r,this.fromB=n,this.toB=i}join(e){return new Pr(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let r=e.length,n=this;for(;r>0;r--){let i=e[r-1];if(!(i.fromA>n.toA)){if(i.toA<n.fromA)break;n=n.join(i),e.splice(r-1,1)}}return e.splice(r,0,n),e}static extendWithRanges(e,r){if(r.length==0)return e;let n=[];for(let i=0,a=0,s=0,l=0;;i++){let u=i==e.length?null:e[i],c=s-l,o=u?u.fromB:1e9;for(;a<r.length&&r[a]<o;){let f=r[a],h=r[a+1],d=Math.max(l,f),p=Math.min(o,h);if(d<=p&&new Pr(d+c,p+c,d,p).addToSet(n),h>o)break;a+=2}if(!u)return n;new Pr(u.fromA,u.toA,u.fromB,u.toB).addToSet(n),s=u.toA,l=u.toB}}}class Ko{constructor(e,r,n){this.view=e,this.state=r,this.transactions=n,this.flags=0,this.startState=e.state,this.changes=Gt.empty(this.startState.doc.length);for(let a of n)this.changes=this.changes.compose(a.changes);let i=[];this.changes.iterChangedRanges((a,s,l,u)=>i.push(new Pr(a,s,l,u))),this.changedRanges=i}static create(e,r,n){return new Ko(e,r,n)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}var _t=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(_t||(_t={}));const os=_t.LTR,W1=_t.RTL;function H1(t){let e=[];for(let r=0;r<t.length;r++)e.push(1<<+t[r]);return e}const Y3=H1("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),X3=H1("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),nf=Object.create(null),Xr=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),r=t.charCodeAt(1);nf[e]=r,nf[r]=-e}function Q3(t){return t<=247?Y3[t]:1424<=t&&t<=1524?2:1536<=t&&t<=1785?X3[t-1536]:1774<=t&&t<=2220?4:8192<=t&&t<=8203?256:64336<=t&&t<=65023?4:t==8204?256:1}const K3=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class Vn{get dir(){return this.level%2?W1:os}constructor(e,r,n){this.from=e,this.to=r,this.level=n}side(e,r){return this.dir==r==e?this.to:this.from}static find(e,r,n,i){let a=-1;for(let s=0;s<e.length;s++){let l=e[s];if(l.from<=r&&l.to>=r){if(l.level==n)return s;(a<0||(i!=0?i<0?l.from<r:l.to>r:e[a].level>l.level))&&(a=s)}}if(a<0)throw new RangeError("Index out of range");return a}}function G1(t,e){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++){let n=t[r],i=e[r];if(n.from!=i.from||n.to!=i.to||n.direction!=i.direction||!G1(n.inner,i.inner))return!1}return!0}const pt=[];function j3(t,e,r,n,i){for(let a=0;a<=n.length;a++){let s=a?n[a-1].to:e,l=a<n.length?n[a].from:r,u=a?256:i;for(let c=s,o=u,f=u;c<l;c++){let h=Q3(t.charCodeAt(c));h==512?h=o:h==8&&f==4&&(h=16),pt[c]=h==4?2:h,h&7&&(f=h),o=h}for(let c=s,o=u,f=u;c<l;c++){let h=pt[c];if(h==128)c<l-1&&o==pt[c+1]&&o&24?h=pt[c]=o:pt[c]=256;else if(h==64){let d=c+1;for(;d<l&&pt[d]==64;)d++;let p=c&&o==8||d<r&&pt[d]==8?f==1?1:8:256;for(let g=c;g<d;g++)pt[g]=p;c=d-1}else h==8&&f==1&&(pt[c]=1);o=h,h&7&&(f=h)}}}function Z3(t,e,r,n,i){let a=i==1?2:1;for(let s=0,l=0,u=0;s<=n.length;s++){let c=s?n[s-1].to:e,o=s<n.length?n[s].from:r;for(let f=c,h,d,p;f<o;f++)if(d=nf[h=t.charCodeAt(f)])if(d<0){for(let g=l-3;g>=0;g-=3)if(Xr[g+1]==-d){let m=Xr[g+2],v=m&2?i:m&4?m&1?a:i:0;v&&(pt[f]=pt[Xr[g]]=v),l=g;break}}else{if(Xr.length==189)break;Xr[l++]=f,Xr[l++]=h,Xr[l++]=u}else if((p=pt[f])==2||p==1){let g=p==i;u=g?0:1;for(let m=l-3;m>=0;m-=3){let v=Xr[m+2];if(v&2)break;if(g)Xr[m+2]|=2;else{if(v&4)break;Xr[m+2]|=4}}}}}function J3(t,e,r,n){for(let i=0,a=n;i<=r.length;i++){let s=i?r[i-1].to:t,l=i<r.length?r[i].from:e;for(let u=s;u<l;){let c=pt[u];if(c==256){let o=u+1;for(;;)if(o==l){if(i==r.length)break;o=r[i++].to,l=i<r.length?r[i].from:e}else if(pt[o]==256)o++;else break;let f=a==1,h=(o<e?pt[o]:n)==1,d=f==h?f?1:2:n;for(let p=o,g=i,m=g?r[g-1].to:t;p>u;)p==m&&(p=r[--g].from,m=g?r[g-1].to:t),pt[--p]=d;u=o}else a=c,u++}}}function af(t,e,r,n,i,a,s){let l=n%2?2:1;if(n%2==i%2)for(let u=e,c=0;u<r;){let o=!0,f=!1;if(c==a.length||u<a[c].from){let g=pt[u];g!=l&&(o=!1,f=g==16)}let h=!o&&l==1?[]:null,d=o?n:n+1,p=u;e:for(;;)if(c<a.length&&p==a[c].from){if(f)break e;let g=a[c];if(!o)for(let m=g.to,v=c+1;;){if(m==r)break e;if(v<a.length&&a[v].from==m)m=a[v++].to;else{if(pt[m]==l)break e;break}}if(c++,h)h.push(g);else{g.from>u&&s.push(new Vn(u,g.from,d));let m=g.direction==os!=!(d%2);sf(t,m?n+1:n,i,g.inner,g.from,g.to,s),u=g.to}p=g.to}else{if(p==r||(o?pt[p]!=l:pt[p]==l))break;p++}h?af(t,u,p,n+1,i,h,s):u<p&&s.push(new Vn(u,p,d)),u=p}else for(let u=r,c=a.length;u>e;){let o=!0,f=!1;if(!c||u>a[c-1].to){let g=pt[u-1];g!=l&&(o=!1,f=g==16)}let h=!o&&l==1?[]:null,d=o?n:n+1,p=u;e:for(;;)if(c&&p==a[c-1].to){if(f)break e;let g=a[--c];if(!o)for(let m=g.from,v=c;;){if(m==e)break e;if(v&&a[v-1].to==m)m=a[--v].from;else{if(pt[m-1]==l)break e;break}}if(h)h.push(g);else{g.to<u&&s.push(new Vn(g.to,u,d));let m=g.direction==os!=!(d%2);sf(t,m?n+1:n,i,g.inner,g.from,g.to,s),u=g.from}p=g.from}else{if(p==e||(o?pt[p-1]!=l:pt[p-1]==l))break;p--}h?af(t,p,u,n+1,i,h,s):p<u&&s.push(new Vn(p,u,d)),u=p}}function sf(t,e,r,n,i,a,s){let l=e%2?2:1;j3(t,i,a,n,l),Z3(t,i,a,n,l),J3(i,a,n,l),af(t,i,a,e,r,n,s)}function e5(t,e,r){if(!t)return[new Vn(0,0,e==W1?1:0)];if(e==os&&!r.length&&!K3.test(t))return z1(t.length);if(r.length)for(;t.length>pt.length;)pt[pt.length]=256;let n=[],i=e==os?0:1;return sf(t,i,i,r,0,t.length,n),n}function z1(t){return[new Vn(0,t,0)]}let q1="";function t5(t,e,r,n,i){var a;let s=n.head-t.from,l=-1;if(s==0){if(!i||!t.length)return null;e[0].level!=r&&(s=e[0].side(!1,r),l=0)}else if(s==t.length){if(i)return null;let h=e[e.length-1];h.level!=r&&(s=h.side(!0,r),l=e.length-1)}l<0&&(l=Vn.find(e,s,(a=n.bidiLevel)!==null&&a!==void 0?a:-1,n.assoc));let u=e[l];s==u.side(i,r)&&(u=e[l+=i?1:-1],s=u.side(!i,r));let c=i==(u.dir==r),o=er(t.text,s,c);if(q1=t.text.slice(Math.min(s,o),Math.max(s,o)),o!=u.side(i,r))return Ee.cursor(o+t.from,c?-1:1,u.level);let f=l==(i?e.length-1:0)?null:e[l+(i?1:-1)];return!f&&u.level!=r?Ee.cursor(i?t.to:t.from,i?-1:1,r):f&&f.level<u.level?Ee.cursor(f.side(!i,r)+t.from,i?1:-1,f.level):Ee.cursor(o+t.from,i?-1:1,u.level)}class vg extends At{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new Ht],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Pr(0,0,0,e.state.doc.length)],0,null)}update(e){var r;let n=e.changedRanges;this.minWidth>0&&n.length&&(n.every(({fromA:c,toA:o})=>o<this.minWidthFrom||c>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0);let i=-1;this.view.inputState.composing>=0&&(!((r=this.domChanged)===null||r===void 0)&&r.newSel?i=this.domChanged.newSel.head:!l5(e.changes,this.hasComposition)&&!e.selectionSet&&(i=e.state.selection.main.head));let a=i>-1?n5(this.view,e.changes,i):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:c,to:o}=this.hasComposition;n=new Pr(c,o,e.changes.mapPos(c,-1),e.changes.mapPos(o,1)).addToSet(n.slice())}this.hasComposition=a?{from:a.range.fromB,to:a.range.toB}:null,(Fe.ie||Fe.chrome)&&!a&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let s=this.decorations,l=this.updateDeco(),u=s5(s,l,e.changes);return n=Pr.extendWithRanges(n,u),!(this.flags&7)&&n.length==0?!1:(this.updateInner(n,e.startState.doc.length,a),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,r,n){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,r,n);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let s=Fe.chrome||Fe.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,s),this.flags&=-8,s&&(s.written||i.selectionRange.focusNode!=s.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(s=>s.flags&=-9);let a=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let s of this.children)s instanceof Wn&&s.widget instanceof yg&&a.push(s.dom);i.updateGaps(a)}updateChildren(e,r,n){let i=n?n.range.addToSet(e.slice()):e,a=this.childCursor(r);for(let s=i.length-1;;s--){let l=s>=0?i[s]:null;if(!l)break;let{fromA:u,toA:c,fromB:o,toB:f}=l,h,d,p,g;if(n&&n.range.fromB<f&&n.range.toB>o){let A=Za.build(this.view.state.doc,o,n.range.fromB,this.decorations,this.dynamicDecorationMap),O=Za.build(this.view.state.doc,n.range.toB,f,this.decorations,this.dynamicDecorationMap);d=A.breakAtStart,p=A.openStart,g=O.openEnd;let w=this.compositionView(n);O.breakAtStart?w.breakAfter=1:O.content.length&&w.merge(w.length,w.length,O.content[0],!1,O.openStart,0)&&(w.breakAfter=O.content[0].breakAfter,O.content.shift()),A.content.length&&w.merge(0,0,A.content[A.content.length-1],!0,0,A.openEnd)&&A.content.pop(),h=A.content.concat(w).concat(O.content)}else({content:h,breakAtStart:d,openStart:p,openEnd:g}=Za.build(this.view.state.doc,o,f,this.decorations,this.dynamicDecorationMap));let{i:m,off:v}=a.findPos(c,1),{i:b,off:C}=a.findPos(u,-1);A1(this,b,C,m,v,h,d,p,g)}n&&this.fixCompositionDOM(n)}compositionView(e){let r=new Sn(e.text.nodeValue);r.flags|=8;for(let{deco:i}of e.marks)r=new Tn(i,[r],r.length);let n=new Ht;return n.append(r,0),n}fixCompositionDOM(e){let r=(a,s)=>{s.flags|=8|(s.children.some(u=>u.flags&7)?1:0),this.markedForComposition.add(s);let l=At.get(a);l&&l!=s&&(l.dom=null),s.setDOM(a)},n=this.childPos(e.range.fromB,1),i=this.children[n.i];r(e.line,i);for(let a=e.marks.length-1;a>=-1;a--)n=i.childPos(n.off,1),i=i.children[n.i],r(a>=0?e.marks[a].node:e.text,i)}updateSelection(e=!1,r=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let n=this.view.root.activeElement,i=n==this.dom,a=!i&&Mo(this.dom,this.view.observer.selectionRange)&&!(n&&this.dom.contains(n));if(!(i||r||a))return;let s=this.forceSelection;this.forceSelection=!1;let l=this.view.state.selection.main,u=this.moveToLine(this.domAtPos(l.anchor)),c=l.empty?u:this.moveToLine(this.domAtPos(l.head));if(Fe.gecko&&l.empty&&!this.hasComposition&&r5(u)){let f=document.createTextNode("");this.view.observer.ignore(()=>u.node.insertBefore(f,u.node.childNodes[u.offset]||null)),u=c=new ar(f,0),s=!0}let o=this.view.observer.selectionRange;(s||!o.focusNode||!Qo(u.node,u.offset,o.anchorNode,o.anchorOffset)||!Qo(c.node,c.offset,o.focusNode,o.focusOffset))&&(this.view.observer.ignore(()=>{Fe.android&&Fe.chrome&&this.dom.contains(o.focusNode)&&o5(o.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let f=Xo(this.view.root);if(f)if(l.empty){if(Fe.gecko){let h=i5(u.node,u.offset);if(h&&h!=3){let d=X1(u.node,u.offset,h==1?1:-1);d&&(u=new ar(d.node,d.offset))}}f.collapse(u.node,u.offset),l.bidiLevel!=null&&f.caretBidiLevel!==void 0&&(f.caretBidiLevel=l.bidiLevel)}else if(f.extend){f.collapse(u.node,u.offset);try{f.extend(c.node,c.offset)}catch{}}else{let h=document.createRange();l.anchor>l.head&&([u,c]=[c,u]),h.setEnd(c.node,c.offset),h.setStart(u.node,u.offset),f.removeAllRanges(),f.addRange(h)}a&&this.view.root.activeElement==this.dom&&(this.dom.blur(),n&&n.focus())}),this.view.observer.setSelectionRange(u,c)),this.impreciseAnchor=u.precise?null:new ar(o.anchorNode,o.anchorOffset),this.impreciseHead=c.precise?null:new ar(o.focusNode,o.focusOffset)}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,r=e.state.selection.main,n=Xo(e.root),{anchorNode:i,anchorOffset:a}=e.observer.selectionRange;if(!n||!r.empty||!r.assoc||!n.modify)return;let s=Ht.find(this,r.head);if(!s)return;let l=s.posAtStart;if(r.head==l||r.head==l+s.length)return;let u=this.coordsAt(r.head,-1),c=this.coordsAt(r.head,1);if(!u||!c||u.bottom>c.top)return;let o=this.domAtPos(r.head+r.assoc);n.collapse(o.node,o.offset),n.modify("move",r.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let f=e.observer.selectionRange;e.docView.posFromDOM(f.anchorNode,f.anchorOffset)!=r.from&&n.collapse(i,a)}moveToLine(e){let r=this.dom,n;if(e.node!=r)return e;for(let i=e.offset;!n&&i<r.childNodes.length;i++){let a=At.get(r.childNodes[i]);a instanceof Ht&&(n=a.domAtPos(0))}for(let i=e.offset-1;!n&&i>=0;i--){let a=At.get(r.childNodes[i]);a instanceof Ht&&(n=a.domAtPos(a.length))}return n?new ar(n.node,n.offset,!0):e}nearest(e){for(let r=e;r;){let n=At.get(r);if(n&&n.rootView==this)return n;r=r.parentNode}return null}posFromDOM(e,r){let n=this.nearest(e);if(!n)throw new RangeError("Trying to find position for a DOM position outside of the document");return n.localPosFromDOM(e,r)+n.posAtStart}domAtPos(e){let{i:r,off:n}=this.childCursor().findPos(e,-1);for(;r<this.children.length-1;){let i=this.children[r];if(n<i.length||i instanceof Ht)break;r++,n=0}return this.children[r].domAtPos(n)}coordsAt(e,r){let n=null,i=0;for(let a=this.length,s=this.children.length-1;s>=0;s--){let l=this.children[s],u=a-l.breakAfter,c=u-l.length;if(u<e)break;c<=e&&(c<e||l.covers(-1))&&(u>e||l.covers(1))&&(!n||l instanceof Ht&&!(n instanceof Ht&&r>=0))&&(n=l,i=c),a=c}return n?n.coordsAt(e-i,r):null}coordsForChar(e){let{i:r,off:n}=this.childPos(e,1),i=this.children[r];if(!(i instanceof Ht))return null;for(;i.children.length;){let{i:l,off:u}=i.childPos(n,1);for(;;l++){if(l==i.children.length)return null;if((i=i.children[l]).length)break}n=u}if(!(i instanceof Sn))return null;let a=er(i.text,n);if(a==n)return null;let s=Ci(i.dom,n,a).getClientRects();for(let l=0;l<s.length;l++){let u=s[l];if(l==s.length-1||u.top<u.bottom&&u.left<u.right)return u}return null}measureVisibleLineHeights(e){let r=[],{from:n,to:i}=e,a=this.view.contentDOM.clientWidth,s=a>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,u=this.view.textDirection==_t.LTR;for(let c=0,o=0;o<this.children.length;o++){let f=this.children[o],h=c+f.length;if(h>i)break;if(c>=n){let d=f.dom.getBoundingClientRect();if(r.push(d.height),s){let p=f.dom.lastChild,g=p?Ji(p):[];if(g.length){let m=g[g.length-1],v=u?m.right-d.left:d.right-m.left;v>l&&(l=v,this.minWidth=a,this.minWidthFrom=c,this.minWidthTo=h)}}}c=h+f.breakAfter}return r}textDirectionAt(e){let{i:r}=this.childPos(e,1);return getComputedStyle(this.children[r].dom).direction=="rtl"?_t.RTL:_t.LTR}measureTextSize(){for(let a of this.children)if(a instanceof Ht){let s=a.measureTextSize();if(s)return s}let e=document.createElement("div"),r,n,i;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let a=Ji(e.firstChild)[0];r=e.getBoundingClientRect().height,n=a?a.width/27:7,i=a?a.height:r,e.remove()}),{lineHeight:r,charWidth:n,textHeight:i}}childCursor(e=this.length){let r=this.children.length;return r&&(e-=this.children[--r].length),new O1(this.children,e,r)}computeBlockGapDeco(){let e=[],r=this.view.viewState;for(let n=0,i=0;;i++){let a=i==r.viewports.length?null:r.viewports[i],s=a?a.from-1:this.length;if(s>n){let l=(r.lineBlockAt(s).bottom-r.lineBlockAt(n).top)/this.view.scaleY;e.push(qe.replace({widget:new yg(l),block:!0,inclusive:!0,isBlockGap:!0}).range(n,s))}if(!a)break;n=a.to+1}return qe.set(e)}updateDeco(){let e=this.view.state.facet(ss).map((r,n)=>(this.dynamicDecorationMap[n]=typeof r=="function")?r(this.view):r);for(let r=e.length;r<e.length+3;r++)this.dynamicDecorationMap[r]=!1;return this.decorations=[...e,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){if(e.isSnapshot){let c=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=c.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}let{range:r}=e,n=this.coordsAt(r.head,r.empty?r.assoc:r.head>r.anchor?-1:1),i;if(!n)return;!r.empty&&(i=this.coordsAt(r.anchor,r.anchor>r.head?-1:1))&&(n={left:Math.min(n.left,i.left),top:Math.min(n.top,i.top),right:Math.max(n.right,i.right),bottom:Math.max(n.bottom,i.bottom)});let a=V1(this.view),s={left:n.left-a.left,top:n.top-a.top,right:n.right+a.right,bottom:n.bottom+a.bottom},{offsetWidth:l,offsetHeight:u}=this.view.scrollDOM;L3(this.view.scrollDOM,s,r.head<r.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,l),-l),Math.max(Math.min(e.yMargin,u),-u),this.view.textDirection==_t.LTR)}}function r5(t){return t.node.nodeType==1&&t.node.firstChild&&(t.offset==0||t.node.childNodes[t.offset-1].contentEditable=="false")&&(t.offset==t.node.childNodes.length||t.node.childNodes[t.offset].contentEditable=="false")}class yg extends kn{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function Y1(t,e){let r=t.observer.selectionRange,n=r.focusNode&&X1(r.focusNode,r.focusOffset,0);if(!n)return null;let i=e-n.offset;return{from:i,to:i+n.node.nodeValue.length,node:n.node}}function n5(t,e,r){let n=Y1(t,r);if(!n)return null;let{node:i,from:a,to:s}=n,l=i.nodeValue;if(/[\n\r]/.test(l)||t.state.doc.sliceString(n.from,n.to)!=l)return null;let u=e.invertedDesc,c=new Pr(u.mapPos(a),u.mapPos(s),a,s),o=[];for(let f=i.parentNode;;f=f.parentNode){let h=At.get(f);if(h instanceof Tn)o.push({node:f,deco:h.mark});else{if(h instanceof Ht||f.nodeName=="DIV"&&f.parentNode==t.contentDOM)return{range:c,text:i,marks:o,line:f};if(f!=t.contentDOM)o.push({node:f,deco:new _s({inclusive:!0,attributes:G3(f),tagName:f.tagName.toLowerCase()})});else return null}}}function X1(t,e,r){if(r<=0)for(let n=t,i=e;;){if(n.nodeType==3)return{node:n,offset:i};if(n.nodeType==1&&i>0)n=n.childNodes[i-1],i=wn(n);else break}if(r>=0)for(let n=t,i=e;;){if(n.nodeType==3)return{node:n,offset:i};if(n.nodeType==1&&i<n.childNodes.length&&r>=0)n=n.childNodes[i],i=0;else break}return null}function i5(t,e){return t.nodeType!=1?0:(e&&t.childNodes[e-1].contentEditable=="false"?1:0)|(e<t.childNodes.length&&t.childNodes[e].contentEditable=="false"?2:0)}let a5=class{constructor(){this.changes=[]}compareRange(e,r){tf(e,r,this.changes)}comparePoint(e,r){tf(e,r,this.changes)}};function s5(t,e,r){let n=new a5;return ut.compare(t,e,r,n),n.changes}function o5(t,e){for(let r=t;r&&r!=e;r=r.assignedSlot||r.parentNode)if(r.nodeType==1&&r.contentEditable=="false")return!0;return!1}function l5(t,e){let r=!1;return e&&t.iterChangedRanges((n,i)=>{n<e.to&&i>e.from&&(r=!0)}),r}function c5(t,e,r=1){let n=t.charCategorizer(e),i=t.doc.lineAt(e),a=e-i.from;if(i.length==0)return Ee.cursor(e);a==0?r=1:a==i.length&&(r=-1);let s=a,l=a;r<0?s=er(i.text,a,!1):l=er(i.text,a);let u=n(i.text.slice(s,l));for(;s>0;){let c=er(i.text,s,!1);if(n(i.text.slice(c,s))!=u)break;s=c}for(;l<i.length;){let c=er(i.text,l);if(n(i.text.slice(l,c))!=u)break;l=c}return Ee.range(s+i.from,l+i.from)}function u5(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function f5(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function Yc(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function bg(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function Eg(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function of(t,e,r){let n,i,a,s,l=!1,u,c,o,f;for(let p=t.firstChild;p;p=p.nextSibling){let g=Ji(p);for(let m=0;m<g.length;m++){let v=g[m];i&&Yc(i,v)&&(v=bg(Eg(v,i.bottom),i.top));let b=u5(e,v),C=f5(r,v);if(b==0&&C==0)return p.nodeType==3?Og(p,e,r):of(p,e,r);if(!n||s>C||s==C&&a>b){n=p,i=v,a=b,s=C;let A=C?r<v.top?-1:1:b?e<v.left?-1:1:0;l=!A||(A>0?m<g.length-1:m>0)}b==0?r>v.bottom&&(!o||o.bottom<v.bottom)?(u=p,o=v):r<v.top&&(!f||f.top>v.top)&&(c=p,f=v):o&&Yc(o,v)?o=Eg(o,v.bottom):f&&Yc(f,v)&&(f=bg(f,v.top))}}if(o&&o.bottom>=r?(n=u,i=o):f&&f.top<=r&&(n=c,i=f),!n)return{node:t,offset:0};let h=Math.max(i.left,Math.min(i.right,e));if(n.nodeType==3)return Og(n,h,r);if(l&&n.contentEditable!="false")return of(n,h,r);let d=Array.prototype.indexOf.call(t.childNodes,n)+(e>=(i.left+i.right)/2?1:0);return{node:t,offset:d}}function Og(t,e,r){let n=t.nodeValue.length,i=-1,a=1e9,s=0;for(let l=0;l<n;l++){let u=Ci(t,l,l+1).getClientRects();for(let c=0;c<u.length;c++){let o=u[c];if(o.top==o.bottom)continue;s||(s=e-o.left);let f=(o.top>r?o.top-r:r-o.bottom)-1;if(o.left-1<=e&&o.right+1>=e&&f<a){let h=e>=(o.left+o.right)/2,d=h;if((Fe.chrome||Fe.gecko)&&Ci(t,l).getBoundingClientRect().left==o.right&&(d=!h),f<=0)return{node:t,offset:l+(d?1:0)};i=l+(d?1:0),a=f}}}return{node:t,offset:i>-1?i:s>0?t.nodeValue.length:0}}function Q1(t,e,r,n=-1){var i,a;let s=t.contentDOM.getBoundingClientRect(),l=s.top+t.viewState.paddingTop,u,{docHeight:c}=t.viewState,{x:o,y:f}=e,h=f-l;if(h<0)return 0;if(h>c)return t.state.doc.length;for(let A=t.viewState.heightOracle.textHeight/2,O=!1;u=t.elementAtHeight(h),u.type!=hr.Text;)for(;h=n>0?u.bottom+A:u.top-A,!(h>=0&&h<=c);){if(O)return r?null:0;O=!0,n=-n}f=l+h;let d=u.from;if(d<t.viewport.from)return t.viewport.from==0?0:r?null:Ag(t,s,u,o,f);if(d>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:r?null:Ag(t,s,u,o,f);let p=t.dom.ownerDocument,g=t.root.elementFromPoint?t.root:p,m=g.elementFromPoint(o,f);m&&!t.contentDOM.contains(m)&&(m=null),m||(o=Math.max(s.left+1,Math.min(s.right-1,o)),m=g.elementFromPoint(o,f),m&&!t.contentDOM.contains(m)&&(m=null));let v,b=-1;if(m&&((i=t.docView.nearest(m))===null||i===void 0?void 0:i.isEditable)!=!1){if(p.caretPositionFromPoint){let A=p.caretPositionFromPoint(o,f);A&&({offsetNode:v,offset:b}=A)}else if(p.caretRangeFromPoint){let A=p.caretRangeFromPoint(o,f);A&&({startContainer:v,startOffset:b}=A,(!t.contentDOM.contains(v)||Fe.safari&&h5(v,b,o)||Fe.chrome&&d5(v,b,o))&&(v=void 0))}}if(!v||!t.docView.dom.contains(v)){let A=Ht.find(t.docView,d);if(!A)return h>u.top+u.height/2?u.to:u.from;({node:v,offset:b}=of(A.dom,o,f))}let C=t.docView.nearest(v);if(!C)return null;if(C.isWidget&&((a=C.dom)===null||a===void 0?void 0:a.nodeType)==1){let A=C.dom.getBoundingClientRect();return e.y<A.top||e.y<=A.bottom&&e.x<=(A.left+A.right)/2?C.posAtStart:C.posAtEnd}else return C.localPosFromDOM(v,b)+C.posAtStart}function Ag(t,e,r,n,i){let a=Math.round((n-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&r.height>t.defaultLineHeight*1.5){let l=t.viewState.heightOracle.textHeight,u=Math.floor((i-r.top-(t.defaultLineHeight-l)*.5)/l);a+=u*t.viewState.heightOracle.lineLength}let s=t.state.sliceDoc(r.from,r.to);return r.from+qu(s,a,t.state.tabSize)}function h5(t,e,r){let n;if(t.nodeType!=3||e!=(n=t.nodeValue.length))return!1;for(let i=t.nextSibling;i;i=i.nextSibling)if(i.nodeType!=1||i.nodeName!="BR")return!1;return Ci(t,n-1,n).getBoundingClientRect().left>r}function d5(t,e,r){if(e!=0)return!1;for(let i=t;;){let a=i.parentNode;if(!a||a.nodeType!=1||a.firstChild!=i)return!1;if(a.classList.contains("cm-line"))break;i=a}let n=t.nodeType==1?t.getBoundingClientRect():Ci(t,0,Math.max(t.nodeValue.length,1)).getBoundingClientRect();return r-n.left>5}function lf(t,e){let r=t.lineBlockAt(e);if(Array.isArray(r.type)){for(let n of r.type)if(n.to>e||n.to==e&&(n.to==r.to||n.type==hr.Text))return n}return r}function p5(t,e,r,n){let i=lf(t,e.head),a=!n||i.type!=hr.Text||!(t.lineWrapping||i.widgetLineBreaks)?null:t.coordsAtPos(e.assoc<0&&e.head>i.from?e.head-1:e.head);if(a){let s=t.dom.getBoundingClientRect(),l=t.textDirectionAt(i.from),u=t.posAtCoords({x:r==(l==_t.LTR)?s.right-1:s.left+1,y:(a.top+a.bottom)/2});if(u!=null)return Ee.cursor(u,r?-1:1)}return Ee.cursor(r?i.to:i.from,r?-1:1)}function Cg(t,e,r,n){let i=t.state.doc.lineAt(e.head),a=t.bidiSpans(i),s=t.textDirectionAt(i.from);for(let l=e,u=null;;){let c=t5(i,a,s,l,r),o=q1;if(!c){if(i.number==(r?t.state.doc.lines:1))return l;o=`
`,i=t.state.doc.line(i.number+(r?1:-1)),a=t.bidiSpans(i),c=Ee.cursor(r?i.from:i.to)}if(u){if(!u(o))return l}else{if(!n)return c;u=n(o)}l=c}}function g5(t,e,r){let n=t.state.charCategorizer(e),i=n(r);return a=>{let s=n(a);return i==Tt.Space&&(i=s),i==s}}function m5(t,e,r,n){let i=e.head,a=r?1:-1;if(i==(r?t.state.doc.length:0))return Ee.cursor(i,e.assoc);let s=e.goalColumn,l,u=t.contentDOM.getBoundingClientRect(),c=t.coordsAtPos(i,e.assoc||-1),o=t.documentTop;if(c)s==null&&(s=c.left-u.left),l=a<0?c.top:c.bottom;else{let d=t.viewState.lineBlockAt(i);s==null&&(s=Math.min(u.right-u.left,t.defaultCharacterWidth*(i-d.from))),l=(a<0?d.top:d.bottom)+o}let f=u.left+s,h=n??t.viewState.heightOracle.textHeight>>1;for(let d=0;;d+=10){let p=l+(h+d)*a,g=Q1(t,{x:f,y:p},!1,a);if(p<u.top||p>u.bottom||(a<0?g<i:g>i)){let m=t.docView.coordsForChar(g),v=!m||p<m.top?-1:1;return Ee.cursor(g,v,void 0,s)}}}function _o(t,e,r){for(;;){let n=0;for(let i of t)i.between(e-1,e+1,(a,s,l)=>{if(e>a&&e<s){let u=n||r||(e-a<s-e?-1:1);e=u<0?a:s,n=u}});if(!n)return e}}function Xc(t,e,r){let n=_o(t.state.facet(_h).map(i=>i(t)),r.from,e.head>r.from?-1:1);return n==r.from?r:Ee.cursor(n,n<r.from?1:-1)}class v5{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,Fe.safari&&e.contentDOM.addEventListener("input",()=>null),Fe.gecko&&P5(e.contentDOM.ownerDocument)}handleEvent(e){!S5(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||this.runHandlers(e.type,e)}runHandlers(e,r){let n=this.handlers[e];if(n){for(let i of n.observers)i(this.view,r);for(let i of n.handlers){if(r.defaultPrevented)break;if(i(this.view,r)){r.preventDefault();break}}}}ensureHandlers(e){let r=y5(e),n=this.handlers,i=this.view.contentDOM;for(let a in r)if(a!="scroll"){let s=!r[a].handlers.length,l=n[a];l&&s!=!l.handlers.length&&(i.removeEventListener(a,this.handleEvent),l=null),l||i.addEventListener(a,this.handleEvent,{passive:s})}for(let a in n)a!="scroll"&&!r[a]&&i.removeEventListener(a,this.handleEvent);this.handlers=r}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(e.keyCode!=27&&j1.indexOf(e.keyCode)<0&&(this.view.inputState.lastEscPress=0),Fe.android&&Fe.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let r;return Fe.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((r=K1.find(n=>n.keyCode==e.keyCode))&&!e.ctrlKey||b5.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=r||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(){let e=this.pendingIOSKey;return e?(this.pendingIOSKey=void 0,Yi(this.view.contentDOM,e.key,e.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:Fe.safari&&!Fe.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function wg(t,e){return(r,n)=>{try{return e.call(t,n,r)}catch(i){kr(r.state,i)}}}function y5(t){let e=Object.create(null);function r(n){return e[n]||(e[n]={observers:[],handlers:[]})}for(let n of t){let i=n.spec;if(i&&i.domEventHandlers)for(let a in i.domEventHandlers){let s=i.domEventHandlers[a];s&&r(a).handlers.push(wg(n.value,s))}if(i&&i.domEventObservers)for(let a in i.domEventObservers){let s=i.domEventObservers[a];s&&r(a).observers.push(wg(n.value,s))}}for(let n in Hr)r(n).handlers.push(Hr[n]);for(let n in Gr)r(n).observers.push(Gr[n]);return e}const K1=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],b5="dthko",j1=[16,17,18,20,91,92,224,225],eo=6;function to(t){return Math.max(0,t)*.7+8}function E5(t,e){return Math.max(Math.abs(t.clientX-e.clientX),Math.abs(t.clientY-e.clientY))}class O5{constructor(e,r,n,i){this.view=e,this.startEvent=r,this.style=n,this.mustSelect=i,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=r,this.scrollParent=B3(e.contentDOM),this.atoms=e.state.facet(_h).map(s=>s(e));let a=e.contentDOM.ownerDocument;a.addEventListener("mousemove",this.move=this.move.bind(this)),a.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=r.shiftKey,this.multiple=e.state.facet(rt.allowMultipleSelections)&&A5(e,r),this.dragging=w5(e,r)&&ty(r)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){var r;if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&E5(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let n=0,i=0,a=((r=this.scrollParent)===null||r===void 0?void 0:r.getBoundingClientRect())||{left:0,top:0,right:this.view.win.innerWidth,bottom:this.view.win.innerHeight},s=V1(this.view);e.clientX-s.left<=a.left+eo?n=-to(a.left-e.clientX):e.clientX+s.right>=a.right-eo&&(n=to(e.clientX-a.right)),e.clientY-s.top<=a.top+eo?i=-to(a.top-e.clientY):e.clientY+s.bottom>=a.bottom-eo&&(i=to(e.clientY-a.bottom)),this.setScrollSpeed(n,i)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,r){this.scrollSpeed={x:e,y:r},e||r?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){this.scrollParent?(this.scrollParent.scrollLeft+=this.scrollSpeed.x,this.scrollParent.scrollTop+=this.scrollSpeed.y):this.view.win.scrollBy(this.scrollSpeed.x,this.scrollSpeed.y),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(e){let r=null;for(let n=0;n<e.ranges.length;n++){let i=e.ranges[n],a=null;if(i.empty){let s=_o(this.atoms,i.from,0);s!=i.from&&(a=Ee.cursor(s,-1))}else{let s=_o(this.atoms,i.from,-1),l=_o(this.atoms,i.to,1);(s!=i.from||l!=i.to)&&(a=Ee.range(i.from==i.anchor?s:l,i.from==i.head?s:l))}a&&(r||(r=e.ranges.slice()),r[n]=a)}return r?Ee.create(r,e.mainIndex):e}select(e){let{view:r}=this,n=this.skipAtoms(this.style.get(e,this.extend,this.multiple));(this.mustSelect||!n.eq(r.state.selection)||n.main.assoc!=r.state.selection.main.assoc&&this.dragging===!1)&&this.view.dispatch({selection:n,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function A5(t,e){let r=t.state.facet(M1);return r.length?r[0](e):Fe.mac?e.metaKey:e.ctrlKey}function C5(t,e){let r=t.state.facet(_1);return r.length?r[0](e):Fe.mac?!e.altKey:!e.ctrlKey}function w5(t,e){let{main:r}=t.state.selection;if(r.empty)return!1;let n=Xo(t.root);if(!n||n.rangeCount==0)return!0;let i=n.getRangeAt(0).getClientRects();for(let a=0;a<i.length;a++){let s=i[a];if(s.left<=e.clientX&&s.right>=e.clientX&&s.top<=e.clientY&&s.bottom>=e.clientY)return!0}return!1}function S5(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let r=e.target,n;r!=t.contentDOM;r=r.parentNode)if(!r||r.nodeType==11||(n=At.get(r))&&n.ignoreEvent(e))return!1;return!0}const Hr=Object.create(null),Gr=Object.create(null),Z1=Fe.ie&&Fe.ie_version<15||Fe.ios&&Fe.webkit_version<604;function T5(t){let e=t.dom.parentNode;if(!e)return;let r=e.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout(()=>{t.focus(),r.remove(),J1(t,r.value)},50)}function J1(t,e){let{state:r}=t,n,i=1,a=r.toText(e),s=a.lines==r.selection.ranges.length;if(cf!=null&&r.selection.ranges.every(u=>u.empty)&&cf==a.toString()){let u=-1;n=r.changeByRange(c=>{let o=r.doc.lineAt(c.from);if(o.from==u)return{range:c};u=o.from;let f=r.toText((s?a.line(i++).text:e)+r.lineBreak);return{changes:{from:o.from,insert:f},range:Ee.cursor(c.from+f.length)}})}else s?n=r.changeByRange(u=>{let c=a.line(i++);return{changes:{from:u.from,to:u.to,insert:c.text},range:Ee.cursor(u.from+c.length)}}):n=r.replaceSelection(a);t.dispatch(n,{userEvent:"input.paste",scrollIntoView:!0})}Gr.scroll=t=>{t.inputState.lastScrollTop=t.scrollDOM.scrollTop,t.inputState.lastScrollLeft=t.scrollDOM.scrollLeft};Hr.keydown=(t,e)=>(t.inputState.setSelectionOrigin("select"),e.keyCode==27&&(t.inputState.lastEscPress=Date.now()),!1);Gr.touchstart=(t,e)=>{t.inputState.lastTouchTime=Date.now(),t.inputState.setSelectionOrigin("select.pointer")};Gr.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")};Hr.mousedown=(t,e)=>{if(t.observer.flush(),t.inputState.lastTouchTime>Date.now()-2e3)return!1;let r=null;for(let n of t.state.facet(k1))if(r=n(t,e),r)break;if(!r&&e.button==0&&(r=x5(t,e)),r){let n=!t.hasFocus;t.inputState.startMouseSelection(new O5(t,e,r,n)),n&&t.observer.ignore(()=>y1(t.contentDOM));let i=t.inputState.mouseSelection;if(i)return i.start(e),i.dragging===!1}return!1};function Sg(t,e,r,n){if(n==1)return Ee.cursor(e,r);if(n==2)return c5(t.state,e,r);{let i=Ht.find(t.docView,e),a=t.state.doc.lineAt(i?i.posAtEnd:e),s=i?i.posAtStart:a.from,l=i?i.posAtEnd:a.to;return l<t.state.doc.length&&l==a.to&&l++,Ee.range(s,l)}}let ey=(t,e)=>t>=e.top&&t<=e.bottom,Tg=(t,e,r)=>ey(e,r)&&t>=r.left&&t<=r.right;function R5(t,e,r,n){let i=Ht.find(t.docView,e);if(!i)return 1;let a=e-i.posAtStart;if(a==0)return 1;if(a==i.length)return-1;let s=i.coordsAt(a,-1);if(s&&Tg(r,n,s))return-1;let l=i.coordsAt(a,1);return l&&Tg(r,n,l)?1:s&&ey(n,s)?-1:1}function Rg(t,e){let r=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:r,bias:R5(t,r,e.clientX,e.clientY)}}const N5=Fe.ie&&Fe.ie_version<=11;let Ng=null,xg=0,Mg=0;function ty(t){if(!N5)return t.detail;let e=Ng,r=Mg;return Ng=t,Mg=Date.now(),xg=!e||r>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(xg+1)%3:1}function x5(t,e){let r=Rg(t,e),n=ty(e),i=t.state.selection;return{update(a){a.docChanged&&(r.pos=a.changes.mapPos(r.pos),i=i.map(a.changes))},get(a,s,l){let u=Rg(t,a),c,o=Sg(t,u.pos,u.bias,n);if(r.pos!=u.pos&&!s){let f=Sg(t,r.pos,r.bias,n),h=Math.min(f.from,o.from),d=Math.max(f.to,o.to);o=h<o.from?Ee.range(h,d):Ee.range(d,h)}return s?i.replaceRange(i.main.extend(o.from,o.to)):l&&n==1&&i.ranges.length>1&&(c=M5(i,u.pos))?c:l?i.addRange(o):Ee.create([o])}}}function M5(t,e){for(let r=0;r<t.ranges.length;r++){let{from:n,to:i}=t.ranges[r];if(n<=e&&i>=e)return Ee.create(t.ranges.slice(0,r).concat(t.ranges.slice(r+1)),t.mainIndex==r?0:t.mainIndex-(t.mainIndex>r?1:0))}return null}Hr.dragstart=(t,e)=>{let{selection:{main:r}}=t.state;if(e.target.draggable){let i=t.docView.nearest(e.target);if(i&&i.isWidget){let a=i.posAtStart,s=a+i.length;(a>=r.to||s<=r.from)&&(r=Ee.range(a,s))}}let{inputState:n}=t;return n.mouseSelection&&(n.mouseSelection.dragging=!0),n.draggedContent=r,e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(r.from,r.to)),e.dataTransfer.effectAllowed="copyMove"),!1};Hr.dragend=t=>(t.inputState.draggedContent=null,!1);function _g(t,e,r,n){if(!r)return;let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:a}=t.inputState,s=n&&a&&C5(t,e)?{from:a.from,to:a.to}:null,l={from:i,insert:r},u=t.state.changes(s?[s,l]:l);t.focus(),t.dispatch({changes:u,selection:{anchor:u.mapPos(i,-1),head:u.mapPos(i,1)},userEvent:s?"move.drop":"input.drop"}),t.inputState.draggedContent=null}Hr.drop=(t,e)=>{if(!e.dataTransfer)return!1;if(t.state.readOnly)return!0;let r=e.dataTransfer.files;if(r&&r.length){let n=Array(r.length),i=0,a=()=>{++i==r.length&&_g(t,e,n.filter(s=>s!=null).join(t.state.lineBreak),!1)};for(let s=0;s<r.length;s++){let l=new FileReader;l.onerror=a,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(n[s]=l.result),a()},l.readAsText(r[s])}return!0}else{let n=e.dataTransfer.getData("Text");if(n)return _g(t,e,n,!0),!0}return!1};Hr.paste=(t,e)=>{if(t.state.readOnly)return!0;t.observer.flush();let r=Z1?null:e.clipboardData;return r?(J1(t,r.getData("text/plain")||r.getData("text/uri-text")),!0):(T5(t),!1)};function _5(t,e){let r=t.dom.parentNode;if(!r)return;let n=r.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=e,n.focus(),n.selectionEnd=e.length,n.selectionStart=0,setTimeout(()=>{n.remove(),t.focus()},50)}function k5(t){let e=[],r=[],n=!1;for(let i of t.selection.ranges)i.empty||(e.push(t.sliceDoc(i.from,i.to)),r.push(i));if(!e.length){let i=-1;for(let{from:a}of t.selection.ranges){let s=t.doc.lineAt(a);s.number>i&&(e.push(s.text),r.push({from:s.from,to:Math.min(t.doc.length,s.to+1)})),i=s.number}n=!0}return{text:e.join(t.lineBreak),ranges:r,linewise:n}}let cf=null;Hr.copy=Hr.cut=(t,e)=>{let{text:r,ranges:n,linewise:i}=k5(t.state);if(!r&&!i)return!1;cf=i?r:null,e.type=="cut"&&!t.state.readOnly&&t.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"});let a=Z1?null:e.clipboardData;return a?(a.clearData(),a.setData("text/plain",r),!0):(_5(t,r),!1)};const ry=_n.define();function ny(t,e){let r=[];for(let n of t.facet(D1)){let i=n(t,e);i&&r.push(i)}return r?t.update({effects:r,annotations:ry.of(!0)}):null}function iy(t){setTimeout(()=>{let e=t.hasFocus;if(e!=t.inputState.notifiedFocused){let r=ny(t.state,e);r?t.dispatch(r):t.update([])}},10)}Gr.focus=t=>{t.inputState.lastFocusTime=Date.now(),!t.scrollDOM.scrollTop&&(t.inputState.lastScrollTop||t.inputState.lastScrollLeft)&&(t.scrollDOM.scrollTop=t.inputState.lastScrollTop,t.scrollDOM.scrollLeft=t.inputState.lastScrollLeft),iy(t)};Gr.blur=t=>{t.observer.clearSelectionRange(),iy(t)};Gr.compositionstart=Gr.compositionupdate=t=>{t.inputState.compositionFirstChange==null&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0)};Gr.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionPendingKey=!0,t.inputState.compositionPendingChange=t.observer.pendingRecords().length>0,t.inputState.compositionFirstChange=null,Fe.chrome&&Fe.android?t.observer.flushSoon():t.inputState.compositionPendingChange?Promise.resolve().then(()=>t.observer.flush()):setTimeout(()=>{t.inputState.composing<0&&t.docView.hasComposition&&t.update([])},50)};Gr.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()};Hr.beforeinput=(t,e)=>{var r;let n;if(Fe.chrome&&Fe.android&&(n=K1.find(i=>i.inputType==e.inputType))&&(t.observer.delayAndroidKey(n.key,n.keyCode),n.key=="Backspace"||n.key=="Delete")){let i=((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0;setTimeout(()=>{var a;(((a=window.visualViewport)===null||a===void 0?void 0:a.height)||0)>i+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())},100)}return!1};const kg=new Set;function P5(t){kg.has(t)||(kg.add(t),t.addEventListener("copy",()=>{}),t.addEventListener("cut",()=>{}))}const Pg=["pre-wrap","normal","pre-line","break-spaces"];class I5{constructor(e){this.lineWrapping=e,this.doc=ot.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30,this.heightChanged=!1}heightForGap(e,r){let n=this.doc.lineAt(r).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(n+=Math.max(0,Math.ceil((r-e-n*this.lineLength*.5)/this.lineLength))),this.lineHeight*n}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return Pg.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let r=!1;for(let n=0;n<e.length;n++){let i=e[n];i<0?n++:this.heightSamples[Math.floor(i*10)]||(r=!0,this.heightSamples[Math.floor(i*10)]=!0)}return r}refresh(e,r,n,i,a,s){let l=Pg.indexOf(e)>-1,u=Math.round(r)!=Math.round(this.lineHeight)||this.lineWrapping!=l;if(this.lineWrapping=l,this.lineHeight=r,this.charWidth=n,this.textHeight=i,this.lineLength=a,u){this.heightSamples={};for(let c=0;c<s.length;c++){let o=s[c];o<0?c++:this.heightSamples[Math.floor(o*10)]=!0}}return u}}class D5{constructor(e,r){this.from=e,this.heights=r,this.index=0}get more(){return this.index<this.heights.length}}class en{constructor(e,r,n,i,a){this.from=e,this.length=r,this.top=n,this.height=i,this._content=a}get type(){return typeof this._content=="number"?hr.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof Kn?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let r=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new en(this.from,this.length+e.length,this.top,this.height+e.height,r)}}var Ot=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(Ot||(Ot={}));const ko=.001;class dr{constructor(e,r,n=2){this.length=e,this.height=r,this.flags=n}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,r){this.height!=r&&(Math.abs(this.height-r)>ko&&(e.heightChanged=!0),this.height=r)}replace(e,r,n){return dr.of(n)}decomposeLeft(e,r){r.push(this)}decomposeRight(e,r){r.push(this)}applyChanges(e,r,n,i){let a=this,s=n.doc;for(let l=i.length-1;l>=0;l--){let{fromA:u,toA:c,fromB:o,toB:f}=i[l],h=a.lineAt(u,Ot.ByPosNoHeight,n.setDoc(r),0,0),d=h.to>=c?h:a.lineAt(c,Ot.ByPosNoHeight,n,0,0);for(f+=d.to-c,c=d.to;l>0&&h.from<=i[l-1].toA;)u=i[l-1].fromA,o=i[l-1].fromB,l--,u<h.from&&(h=a.lineAt(u,Ot.ByPosNoHeight,n,0,0));o+=h.from-u,u=h.from;let p=kh.build(n.setDoc(s),e,o,f);a=a.replace(u,c,p)}return a.updateHeight(n,0)}static empty(){return new wr(0,0)}static of(e){if(e.length==1)return e[0];let r=0,n=e.length,i=0,a=0;for(;;)if(r==n)if(i>a*2){let l=e[r-1];l.break?e.splice(--r,1,l.left,null,l.right):e.splice(--r,1,l.left,l.right),n+=1+l.break,i-=l.size}else if(a>i*2){let l=e[n];l.break?e.splice(n,1,l.left,null,l.right):e.splice(n,1,l.left,l.right),n+=2+l.break,a-=l.size}else break;else if(i<a){let l=e[r++];l&&(i+=l.size)}else{let l=e[--n];l&&(a+=l.size)}let s=0;return e[r-1]==null?(s=1,r--):e[r]==null&&(s=1,n++),new L5(dr.of(e.slice(0,r)),s,dr.of(e.slice(n)))}}dr.prototype.size=1;class ay extends dr{constructor(e,r,n){super(e,r),this.deco=n}blockAt(e,r,n,i){return new en(i,this.length,n,this.height,this.deco||0)}lineAt(e,r,n,i,a){return this.blockAt(0,n,i,a)}forEachLine(e,r,n,i,a,s){e<=a+this.length&&r>=a&&s(this.blockAt(0,n,i,a))}updateHeight(e,r=0,n=!1,i){return i&&i.from<=r&&i.more&&this.setHeight(e,i.heights[i.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class wr extends ay{constructor(e,r){super(e,r,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,r,n,i){return new en(i,this.length,n,this.height,this.breaks)}replace(e,r,n){let i=n[0];return n.length==1&&(i instanceof wr||i instanceof jt&&i.flags&4)&&Math.abs(this.length-i.length)<10?(i instanceof jt?i=new wr(i.length,this.height):i.height=this.height,this.outdated||(i.outdated=!1),i):dr.of(n)}updateHeight(e,r=0,n=!1,i){return i&&i.from<=r&&i.more?this.setHeight(e,i.heights[i.index++]):(n||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class jt extends dr{constructor(e){super(e,0)}heightMetrics(e,r){let n=e.doc.lineAt(r).number,i=e.doc.lineAt(r+this.length).number,a=i-n+1,s,l=0;if(e.lineWrapping){let u=Math.min(this.height,e.lineHeight*a);s=u/a,this.length>a+1&&(l=(this.height-u)/(this.length-a-1))}else s=this.height/a;return{firstLine:n,lastLine:i,perLine:s,perChar:l}}blockAt(e,r,n,i){let{firstLine:a,lastLine:s,perLine:l,perChar:u}=this.heightMetrics(r,i);if(r.lineWrapping){let c=i+Math.round(Math.max(0,Math.min(1,(e-n)/this.height))*this.length),o=r.doc.lineAt(c),f=l+o.length*u,h=Math.max(n,e-f/2);return new en(o.from,o.length,h,f,0)}else{let c=Math.max(0,Math.min(s-a,Math.floor((e-n)/l))),{from:o,length:f}=r.doc.line(a+c);return new en(o,f,n+l*c,l,0)}}lineAt(e,r,n,i,a){if(r==Ot.ByHeight)return this.blockAt(e,n,i,a);if(r==Ot.ByPosNoHeight){let{from:d,to:p}=n.doc.lineAt(e);return new en(d,p-d,0,0,0)}let{firstLine:s,perLine:l,perChar:u}=this.heightMetrics(n,a),c=n.doc.lineAt(e),o=l+c.length*u,f=c.number-s,h=i+l*f+u*(c.from-a-f);return new en(c.from,c.length,Math.max(i,Math.min(h,i+this.height-o)),o,0)}forEachLine(e,r,n,i,a,s){e=Math.max(e,a),r=Math.min(r,a+this.length);let{firstLine:l,perLine:u,perChar:c}=this.heightMetrics(n,a);for(let o=e,f=i;o<=r;){let h=n.doc.lineAt(o);if(o==e){let p=h.number-l;f+=u*p+c*(e-a-p)}let d=u+c*h.length;s(new en(h.from,h.length,f,d,0)),f+=d,o=h.to+1}}replace(e,r,n){let i=this.length-r;if(i>0){let a=n[n.length-1];a instanceof jt?n[n.length-1]=new jt(a.length+i):n.push(null,new jt(i-1))}if(e>0){let a=n[0];a instanceof jt?n[0]=new jt(e+a.length):n.unshift(new jt(e-1),null)}return dr.of(n)}decomposeLeft(e,r){r.push(new jt(e-1),null)}decomposeRight(e,r){r.push(null,new jt(this.length-e-1))}updateHeight(e,r=0,n=!1,i){let a=r+this.length;if(i&&i.from<=r+this.length&&i.more){let s=[],l=Math.max(r,i.from),u=-1;for(i.from>r&&s.push(new jt(i.from-r-1).updateHeight(e,r));l<=a&&i.more;){let o=e.doc.lineAt(l).length;s.length&&s.push(null);let f=i.heights[i.index++];u==-1?u=f:Math.abs(f-u)>=ko&&(u=-2);let h=new wr(o,f);h.outdated=!1,s.push(h),l+=o+1}l<=a&&s.push(null,new jt(a-l).updateHeight(e,l));let c=dr.of(s);return(u<0||Math.abs(c.height-this.height)>=ko||Math.abs(u-this.heightMetrics(e,r).perLine)>=ko)&&(e.heightChanged=!0),c}else(n||this.outdated)&&(this.setHeight(e,e.heightForGap(r,r+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class L5 extends dr{constructor(e,r,n){super(e.length+r+n.length,e.height+n.height,r|(e.outdated||n.outdated?2:0)),this.left=e,this.right=n,this.size=e.size+n.size}get break(){return this.flags&1}blockAt(e,r,n,i){let a=n+this.left.height;return e<a?this.left.blockAt(e,r,n,i):this.right.blockAt(e,r,a,i+this.left.length+this.break)}lineAt(e,r,n,i,a){let s=i+this.left.height,l=a+this.left.length+this.break,u=r==Ot.ByHeight?e<s:e<l,c=u?this.left.lineAt(e,r,n,i,a):this.right.lineAt(e,r,n,s,l);if(this.break||(u?c.to<l:c.from>l))return c;let o=r==Ot.ByPosNoHeight?Ot.ByPosNoHeight:Ot.ByPos;return u?c.join(this.right.lineAt(l,o,n,s,l)):this.left.lineAt(l,o,n,i,a).join(c)}forEachLine(e,r,n,i,a,s){let l=i+this.left.height,u=a+this.left.length+this.break;if(this.break)e<u&&this.left.forEachLine(e,r,n,i,a,s),r>=u&&this.right.forEachLine(e,r,n,l,u,s);else{let c=this.lineAt(u,Ot.ByPos,n,i,a);e<c.from&&this.left.forEachLine(e,c.from-1,n,i,a,s),c.to>=e&&c.from<=r&&s(c),r>c.to&&this.right.forEachLine(c.to+1,r,n,l,u,s)}}replace(e,r,n){let i=this.left.length+this.break;if(r<i)return this.balanced(this.left.replace(e,r,n),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-i,r-i,n));let a=[];e>0&&this.decomposeLeft(e,a);let s=a.length;for(let l of n)a.push(l);if(e>0&&Ig(a,s-1),r<this.length){let l=a.length;this.decomposeRight(r,a),Ig(a,l)}return dr.of(a)}decomposeLeft(e,r){let n=this.left.length;if(e<=n)return this.left.decomposeLeft(e,r);r.push(this.left),this.break&&(n++,e>=n&&r.push(null)),e>n&&this.right.decomposeLeft(e-n,r)}decomposeRight(e,r){let n=this.left.length,i=n+this.break;if(e>=i)return this.right.decomposeRight(e-i,r);e<n&&this.left.decomposeRight(e,r),this.break&&e<i&&r.push(null),r.push(this.right)}balanced(e,r){return e.size>2*r.size||r.size>2*e.size?dr.of(this.break?[e,null,r]:[e,r]):(this.left=e,this.right=r,this.height=e.height+r.height,this.outdated=e.outdated||r.outdated,this.size=e.size+r.size,this.length=e.length+this.break+r.length,this)}updateHeight(e,r=0,n=!1,i){let{left:a,right:s}=this,l=r+a.length+this.break,u=null;return i&&i.from<=r+a.length&&i.more?u=a=a.updateHeight(e,r,n,i):a.updateHeight(e,r,n),i&&i.from<=l+s.length&&i.more?u=s=s.updateHeight(e,l,n,i):s.updateHeight(e,l,n),u?this.balanced(a,s):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function Ig(t,e){let r,n;t[e]==null&&(r=t[e-1])instanceof jt&&(n=t[e+1])instanceof jt&&t.splice(e-1,3,new jt(r.length+1+n.length))}const B5=5;class kh{constructor(e,r){this.pos=e,this.oracle=r,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,r){if(this.lineStart>-1){let n=Math.min(r,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof wr?i.length+=n-this.pos:(n>this.pos||!this.isCovered)&&this.nodes.push(new wr(n-this.pos,-1)),this.writtenTo=n,r>n&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=r}point(e,r,n){if(e<r||n.heightRelevant){let i=n.widget?n.widget.estimatedHeight:0,a=n.widget?n.widget.lineBreaks:0;i<0&&(i=this.oracle.lineHeight);let s=r-e;n.block?this.addBlock(new ay(s,i,n)):(s||a||i>=B5)&&this.addLineDeco(i,a,s)}else r>e&&this.span(e,r);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:r}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=r,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new wr(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,r){let n=new jt(r-e);return this.oracle.doc.lineAt(e).to==r&&(n.flags|=4),n}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof wr)return e;let r=new wr(0,-1);return this.nodes.push(r),r}addBlock(e){this.enterLine();let r=e.deco;r&&r.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,r&&r.endSide>0&&(this.covering=e)}addLineDeco(e,r,n){let i=this.ensureLine();i.length+=n,i.collapsed+=n,i.widgetHeight=Math.max(i.widgetHeight,e),i.breaks+=r,this.writtenTo=this.pos=this.pos+n}finish(e){let r=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(r instanceof wr)&&!this.isCovered?this.nodes.push(new wr(0,-1)):(this.writtenTo<this.pos||r==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let n=e;for(let i of this.nodes)i instanceof wr&&i.updateHeight(this.oracle,n),n+=i?i.length:1;return this.nodes}static build(e,r,n,i){let a=new kh(n,e);return ut.spans(r,n,i,a,0),a.finish(n)}}function U5(t,e,r){let n=new $5;return ut.compare(t,e,r,n,0),n.changes}class $5{constructor(){this.changes=[]}compareRange(){}comparePoint(e,r,n,i){(e<r||n&&n.heightRelevant||i&&i.heightRelevant)&&tf(e,r,this.changes,5)}}function F5(t,e){let r=t.getBoundingClientRect(),n=t.ownerDocument,i=n.defaultView||window,a=Math.max(0,r.left),s=Math.min(i.innerWidth,r.right),l=Math.max(0,r.top),u=Math.min(i.innerHeight,r.bottom);for(let c=t.parentNode;c&&c!=n.body;)if(c.nodeType==1){let o=c,f=window.getComputedStyle(o);if((o.scrollHeight>o.clientHeight||o.scrollWidth>o.clientWidth)&&f.overflow!="visible"){let h=o.getBoundingClientRect();a=Math.max(a,h.left),s=Math.min(s,h.right),l=Math.max(l,h.top),u=c==t.parentNode?h.bottom:Math.min(u,h.bottom)}c=f.position=="absolute"||f.position=="fixed"?o.offsetParent:o.parentNode}else if(c.nodeType==11)c=c.host;else break;return{left:a-r.left,right:Math.max(a,s)-r.left,top:l-(r.top+e),bottom:Math.max(l,u)-(r.top+e)}}function V5(t,e){let r=t.getBoundingClientRect();return{left:0,right:r.right-r.left,top:e,bottom:r.bottom-(r.top+e)}}class Qc{constructor(e,r,n){this.from=e,this.to=r,this.size=n}static same(e,r){if(e.length!=r.length)return!1;for(let n=0;n<e.length;n++){let i=e[n],a=r[n];if(i.from!=a.from||i.to!=a.to||i.size!=a.size)return!1}return!0}draw(e,r){return qe.replace({widget:new W5(this.size*(r?e.scaleY:e.scaleX),r)}).range(this.from,this.to)}}class W5 extends kn{constructor(e,r){super(),this.size=e,this.vertical=r}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class Dg{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!0,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=Lg,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=_t.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let r=e.facet(Mh).some(n=>typeof n!="function"&&n.class=="cm-lineWrapping");this.heightOracle=new I5(r),this.stateDeco=e.facet(ss).filter(n=>typeof n!="function"),this.heightMap=dr.empty().applyChanges(this.stateDeco,ot.empty,this.heightOracle.setDoc(e.doc),[new Pr(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=qe.set(this.lineGaps.map(n=>n.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:r}=this.state.selection;for(let n=0;n<=1;n++){let i=n?r.head:r.anchor;if(!e.some(({from:a,to:s})=>i>=a&&i<=s)){let{from:a,to:s}=this.lineBlockAt(i);e.push(new ro(a,s))}}this.viewports=e.sort((n,i)=>n.from-i.from),this.scaler=this.heightMap.height<=7e6?Lg:new z5(this.heightOracle,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:Ga(e,this.scaler))})}update(e,r=null){this.state=e.state;let n=this.stateDeco;this.stateDeco=this.state.facet(ss).filter(o=>typeof o!="function");let i=e.changedRanges,a=Pr.extendWithRanges(i,U5(n,this.stateDeco,e?e.changes:Gt.empty(this.state.doc.length))),s=this.heightMap.height,l=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),a),this.heightMap.height!=s&&(e.flags|=2),l?(this.scrollAnchorPos=e.changes.mapPos(l.from,-1),this.scrollAnchorHeight=l.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let u=a.length?this.mapViewport(this.viewport,e.changes):this.viewport;(r&&(r.range.head<u.from||r.range.head>u.to)||!this.viewportIsAppropriate(u))&&(u=this.getViewport(0,r));let c=!e.changes.empty||e.flags&2||u.from!=this.viewport.from||u.to!=this.viewport.to;this.viewport=u,this.updateForViewport(),c&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),r&&(this.scrollTarget=r),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(B1)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let r=e.contentDOM,n=window.getComputedStyle(r),i=this.heightOracle,a=n.whiteSpace;this.defaultTextDirection=n.direction=="rtl"?_t.RTL:_t.LTR;let s=this.heightOracle.mustRefreshForWrapping(a),l=r.getBoundingClientRect(),u=s||this.mustMeasureContent||this.contentDOMHeight!=l.height;this.contentDOMHeight=l.height,this.mustMeasureContent=!1;let c=0,o=0;if(l.width&&l.height){let A=l.width/r.offsetWidth,O=l.height/r.offsetHeight;(A>.995&&A<1.005||!isFinite(A)||Math.abs(l.width-r.offsetWidth)<1)&&(A=1),(O>.995&&O<1.005||!isFinite(O)||Math.abs(l.height-r.offsetHeight)<1)&&(O=1),(this.scaleX!=A||this.scaleY!=O)&&(this.scaleX=A,this.scaleY=O,c|=8,s=u=!0)}let f=(parseInt(n.paddingTop)||0)*this.scaleY,h=(parseInt(n.paddingBottom)||0)*this.scaleY;(this.paddingTop!=f||this.paddingBottom!=h)&&(this.paddingTop=f,this.paddingBottom=h,c|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(i.lineWrapping&&(u=!0),this.editorWidth=e.scrollDOM.clientWidth,c|=8);let d=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=d&&(this.scrollAnchorHeight=-1,this.scrollTop=d),this.scrolledToBottom=E1(e.scrollDOM);let p=(this.printing?V5:F5)(r,this.paddingTop),g=p.top-this.pixelViewport.top,m=p.bottom-this.pixelViewport.bottom;this.pixelViewport=p;let v=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(v!=this.inView&&(this.inView=v,v&&(u=!0)),!this.inView&&!this.scrollTarget)return 0;let b=l.width;if((this.contentDOMWidth!=b||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=l.width,this.editorHeight=e.scrollDOM.clientHeight,c|=8),u){let A=e.docView.measureVisibleLineHeights(this.viewport);if(i.mustRefreshForHeights(A)&&(s=!0),s||i.lineWrapping&&Math.abs(b-this.contentDOMWidth)>i.charWidth){let{lineHeight:O,charWidth:w,textHeight:S}=e.docView.measureTextSize();s=O>0&&i.refresh(a,O,w,S,b/w,A),s&&(e.docView.minWidth=0,c|=8)}g>0&&m>0?o=Math.max(g,m):g<0&&m<0&&(o=Math.min(g,m)),i.heightChanged=!1;for(let O of this.viewports){let w=O.from==this.viewport.from?A:e.docView.measureVisibleLineHeights(O);this.heightMap=(s?dr.empty().applyChanges(this.stateDeco,ot.empty,this.heightOracle,[new Pr(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(i,0,s,new D5(O.from,w))}i.heightChanged&&(c|=2)}let C=!this.viewportIsAppropriate(this.viewport,o)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return C&&(this.viewport=this.getViewport(o,this.scrollTarget)),this.updateForViewport(),(c&2||C)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(s?[]:this.lineGaps,e)),c|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),c}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,r){let n=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),i=this.heightMap,a=this.heightOracle,{visibleTop:s,visibleBottom:l}=this,u=new ro(i.lineAt(s-n*1e3,Ot.ByHeight,a,0,0).from,i.lineAt(l+(1-n)*1e3,Ot.ByHeight,a,0,0).to);if(r){let{head:c}=r.range;if(c<u.from||c>u.to){let o=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),f=i.lineAt(c,Ot.ByPos,a,0,0),h;r.y=="center"?h=(f.top+f.bottom)/2-o/2:r.y=="start"||r.y=="nearest"&&c<u.from?h=f.top:h=f.bottom-o,u=new ro(i.lineAt(h-1e3/2,Ot.ByHeight,a,0,0).from,i.lineAt(h+o+1e3/2,Ot.ByHeight,a,0,0).to)}}return u}mapViewport(e,r){let n=r.mapPos(e.from,-1),i=r.mapPos(e.to,1);return new ro(this.heightMap.lineAt(n,Ot.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(i,Ot.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:r},n=0){if(!this.inView)return!0;let{top:i}=this.heightMap.lineAt(e,Ot.ByPos,this.heightOracle,0,0),{bottom:a}=this.heightMap.lineAt(r,Ot.ByPos,this.heightOracle,0,0),{visibleTop:s,visibleBottom:l}=this;return(e==0||i<=s-Math.max(10,Math.min(-n,250)))&&(r==this.state.doc.length||a>=l+Math.max(10,Math.min(n,250)))&&i>s-2*1e3&&a<l+2*1e3}mapLineGaps(e,r){if(!e.length||r.empty)return e;let n=[];for(let i of e)r.touchesRange(i.from,i.to)||n.push(new Qc(r.mapPos(i.from),r.mapPos(i.to),i.size));return n}ensureLineGaps(e,r){let n=this.heightOracle.lineWrapping,i=n?1e4:2e3,a=i>>1,s=i<<1;if(this.defaultTextDirection!=_t.LTR&&!n)return[];let l=[],u=(c,o,f,h)=>{if(o-c<a)return;let d=this.state.selection.main,p=[d.from];d.empty||p.push(d.to);for(let m of p)if(m>c&&m<o){u(c,m-10,f,h),u(m+10,o,f,h);return}let g=G5(e,m=>m.from>=f.from&&m.to<=f.to&&Math.abs(m.from-c)<a&&Math.abs(m.to-o)<a&&!p.some(v=>m.from<v&&m.to>v));if(!g){if(o<f.to&&r&&n&&r.visibleRanges.some(m=>m.from<=o&&m.to>=o)){let m=r.moveToLineBoundary(Ee.cursor(o),!1,!0).head;m>c&&(o=m)}g=new Qc(c,o,this.gapSize(f,c,o,h))}l.push(g)};for(let c of this.viewportLines){if(c.length<s)continue;let o=H5(c.from,c.to,this.stateDeco);if(o.total<s)continue;let f=this.scrollTarget?this.scrollTarget.range.head:null,h,d;if(n){let p=i/this.heightOracle.lineLength*this.heightOracle.lineHeight,g,m;if(f!=null){let v=io(o,f),b=((this.visibleBottom-this.visibleTop)/2+p)/c.height;g=v-b,m=v+b}else g=(this.visibleTop-c.top-p)/c.height,m=(this.visibleBottom-c.top+p)/c.height;h=no(o,g),d=no(o,m)}else{let p=o.total*this.heightOracle.charWidth,g=i*this.heightOracle.charWidth,m,v;if(f!=null){let b=io(o,f),C=((this.pixelViewport.right-this.pixelViewport.left)/2+g)/p;m=b-C,v=b+C}else m=(this.pixelViewport.left-g)/p,v=(this.pixelViewport.right+g)/p;h=no(o,m),d=no(o,v)}h>c.from&&u(c.from,h,c,o),d<c.to&&u(d,c.to,c,o)}return l}gapSize(e,r,n,i){let a=io(i,n)-io(i,r);return this.heightOracle.lineWrapping?e.height*a:i.total*this.heightOracle.charWidth*a}updateLineGaps(e){Qc.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=qe.set(e.map(r=>r.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let r=[];ut.spans(e,this.viewport.from,this.viewport.to,{span(i,a){r.push({from:i,to:a})},point(){}},20);let n=r.length!=this.visibleRanges.length||this.visibleRanges.some((i,a)=>i.from!=r[a].from||i.to!=r[a].to);return this.visibleRanges=r,n?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(r=>r.from<=e&&r.to>=e)||Ga(this.heightMap.lineAt(e,Ot.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return Ga(this.heightMap.lineAt(this.scaler.fromDOM(e),Ot.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let r=this.lineBlockAtHeight(e+8);return r.from>=this.viewport.from||this.viewportLines[0].top-e>200?r:this.viewportLines[0]}elementAtHeight(e){return Ga(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class ro{constructor(e,r){this.from=e,this.to=r}}function H5(t,e,r){let n=[],i=t,a=0;return ut.spans(r,t,e,{span(){},point(s,l){s>i&&(n.push({from:i,to:s}),a+=s-i),i=l}},20),i<e&&(n.push({from:i,to:e}),a+=e-i),{total:a,ranges:n}}function no({total:t,ranges:e},r){if(r<=0)return e[0].from;if(r>=1)return e[e.length-1].to;let n=Math.floor(t*r);for(let i=0;;i++){let{from:a,to:s}=e[i],l=s-a;if(n<=l)return a+n;n-=l}}function io(t,e){let r=0;for(let{from:n,to:i}of t.ranges){if(e<=i){r+=e-n;break}r+=i-n}return r/t.total}function G5(t,e){for(let r of t)if(e(r))return r}const Lg={toDOM(t){return t},fromDOM(t){return t},scale:1};class z5{constructor(e,r,n){let i=0,a=0,s=0;this.viewports=n.map(({from:l,to:u})=>{let c=r.lineAt(l,Ot.ByPos,e,0,0).top,o=r.lineAt(u,Ot.ByPos,e,0,0).bottom;return i+=o-c,{from:l,to:u,top:c,bottom:o,domTop:0,domBottom:0}}),this.scale=(7e6-i)/(r.height-i);for(let l of this.viewports)l.domTop=s+(l.top-a)*this.scale,s=l.domBottom=l.domTop+(l.bottom-l.top),a=l.bottom}toDOM(e){for(let r=0,n=0,i=0;;r++){let a=r<this.viewports.length?this.viewports[r]:null;if(!a||e<a.top)return i+(e-n)*this.scale;if(e<=a.bottom)return a.domTop+(e-a.top);n=a.bottom,i=a.domBottom}}fromDOM(e){for(let r=0,n=0,i=0;;r++){let a=r<this.viewports.length?this.viewports[r]:null;if(!a||e<a.domTop)return n+(e-i)/this.scale;if(e<=a.domBottom)return a.top+(e-a.domTop);n=a.bottom,i=a.domBottom}}}function Ga(t,e){if(e.scale==1)return t;let r=e.toDOM(t.top),n=e.toDOM(t.bottom);return new en(t.from,t.length,r,n-r,Array.isArray(t._content)?t._content.map(i=>Ga(i,e)):t._content)}const ao=$e.define({combine:t=>t.join(" ")}),uf=$e.define({combine:t=>t.indexOf(!0)>-1}),ff=Xn.newName(),sy=Xn.newName(),oy=Xn.newName(),ly={"&light":"."+sy,"&dark":"."+oy};function hf(t,e,r){return new Xn(e,{finish(n){return/&/.test(n)?n.replace(/&\w*/,i=>{if(i=="&")return t;if(!r||!r[i])throw new RangeError(`Unsupported selector: ${i}`);return r[i]}):t+" "+n}})}const q5=hf("."+ff,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace:before":{content:"attr(data-display)",position:"absolute",pointerEvents:"none",color:"#888"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},ly),za="￿";class Y5{constructor(e,r){this.points=e,this.text="",this.lineSeparator=r.facet(rt.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=za}readRange(e,r){if(!e)return this;let n=e.parentNode;for(let i=e;;){this.findPointBefore(n,i);let a=this.text.length;this.readNode(i);let s=i.nextSibling;if(s==r)break;let l=At.get(i),u=At.get(s);(l&&u?l.breakAfter:(l?l.breakAfter:Bg(i))||Bg(s)&&(i.nodeName!="BR"||i.cmIgnore)&&this.text.length>a)&&this.lineBreak(),i=s}return this.findPointBefore(n,r),this}readTextNode(e){let r=e.nodeValue;for(let n of this.points)n.node==e&&(n.pos=this.text.length+Math.min(n.offset,r.length));for(let n=0,i=this.lineSeparator?null:/\r\n?|\n/g;;){let a=-1,s=1,l;if(this.lineSeparator?(a=r.indexOf(this.lineSeparator,n),s=this.lineSeparator.length):(l=i.exec(r))&&(a=l.index,s=l[0].length),this.append(r.slice(n,a<0?r.length:a)),a<0)break;if(this.lineBreak(),s>1)for(let u of this.points)u.node==e&&u.pos>this.text.length&&(u.pos-=s-1);n=a+s}}readNode(e){if(e.cmIgnore)return;let r=At.get(e),n=r&&r.overrideDOMText;if(n!=null){this.findPointInside(e,n.length);for(let i=n.iter();!i.next().done;)i.lineBreak?this.lineBreak():this.append(i.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,r){for(let n of this.points)n.node==e&&e.childNodes[n.offset]==r&&(n.pos=this.text.length)}findPointInside(e,r){for(let n of this.points)(e.nodeType==3?n.node==e:e.contains(n.node))&&(n.pos=this.text.length+(X5(e,n.node,n.offset)?r:0))}}function X5(t,e,r){for(;;){if(!e||r<wn(e))return!1;if(e==t)return!0;r=as(e)+1,e=e.parentNode}}function Bg(t){return t.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}class Ug{constructor(e,r){this.node=e,this.offset=r,this.pos=-1}}class Q5{constructor(e,r,n,i){this.typeOver=i,this.bounds=null,this.text="";let{impreciseHead:a,impreciseAnchor:s}=e.docView;if(e.state.readOnly&&r>-1)this.newSel=null;else if(r>-1&&(this.bounds=e.docView.domBoundsAround(r,n,0))){let l=a||s?[]:Z5(e),u=new Y5(l,e.state);u.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=u.text,this.newSel=J5(l,this.bounds.from)}else{let l=e.observer.selectionRange,u=a&&a.node==l.focusNode&&a.offset==l.focusOffset||!Qu(e.contentDOM,l.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(l.focusNode,l.focusOffset),c=s&&s.node==l.anchorNode&&s.offset==l.anchorOffset||!Qu(e.contentDOM,l.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(l.anchorNode,l.anchorOffset);this.newSel=Ee.single(c,u)}}}function cy(t,e){let r,{newSel:n}=e,i=t.state.selection.main,a=t.inputState.lastKeyTime>Date.now()-100?t.inputState.lastKeyCode:-1;if(e.bounds){let{from:s,to:l}=e.bounds,u=i.from,c=null;(a===8||Fe.android&&e.text.length<l-s)&&(u=i.to,c="end");let o=j5(t.state.doc.sliceString(s,l,za),e.text,u-s,c);o&&(Fe.chrome&&a==13&&o.toB==o.from+2&&e.text.slice(o.from,o.toB)==za+za&&o.toB--,r={from:s+o.from,to:s+o.toA,insert:ot.of(e.text.slice(o.from,o.toB).split(za))})}else n&&(!t.hasFocus&&t.state.facet(nc)||n.main.eq(i))&&(n=null);if(!r&&!n)return!1;if(!r&&e.typeOver&&!i.empty&&n&&n.main.empty?r={from:i.from,to:i.to,insert:t.state.doc.slice(i.from,i.to)}:r&&r.from>=i.from&&r.to<=i.to&&(r.from!=i.from||r.to!=i.to)&&i.to-i.from-(r.to-r.from)<=4?r={from:i.from,to:i.to,insert:t.state.doc.slice(i.from,r.from).append(r.insert).append(t.state.doc.slice(r.to,i.to))}:(Fe.mac||Fe.android)&&r&&r.from==r.to&&r.from==i.head-1&&/^\. ?$/.test(r.insert.toString())&&t.contentDOM.getAttribute("autocorrect")=="off"?(n&&r.insert.length==2&&(n=Ee.single(n.main.anchor-1,n.main.head-1)),r={from:i.from,to:i.to,insert:ot.of([" "])}):Fe.chrome&&r&&r.from==r.to&&r.from==i.head&&r.insert.toString()==`
 `&&t.lineWrapping&&(n&&(n=Ee.single(n.main.anchor-1,n.main.head-1)),r={from:i.from,to:i.to,insert:ot.of([" "])}),r){if(Fe.ios&&t.inputState.flushIOSKey()||Fe.android&&(r.from==i.from&&r.to==i.to&&r.insert.length==1&&r.insert.lines==2&&Yi(t.contentDOM,"Enter",13)||(r.from==i.from-1&&r.to==i.to&&r.insert.length==0||a==8&&r.insert.length<r.to-r.from&&r.to>i.head)&&Yi(t.contentDOM,"Backspace",8)||r.from==i.from&&r.to==i.to+1&&r.insert.length==0&&Yi(t.contentDOM,"Delete",46)))return!0;let s=r.insert.toString();t.inputState.composing>=0&&t.inputState.composing++;let l,u=()=>l||(l=K5(t,r,n));return t.state.facet(I1).some(c=>c(t,r.from,r.to,s,u))||t.dispatch(u()),!0}else if(n&&!n.main.eq(i)){let s=!1,l="select";return t.inputState.lastSelectionTime>Date.now()-50&&(t.inputState.lastSelectionOrigin=="select"&&(s=!0),l=t.inputState.lastSelectionOrigin),t.dispatch({selection:n,scrollIntoView:s,userEvent:l}),!0}else return!1}function K5(t,e,r){let n,i=t.state,a=i.selection.main;if(e.from>=a.from&&e.to<=a.to&&e.to-e.from>=(a.to-a.from)/3&&(!r||r.main.empty&&r.main.from==e.from+e.insert.length)&&t.inputState.composing<0){let l=a.from<e.from?i.sliceDoc(a.from,e.from):"",u=a.to>e.to?i.sliceDoc(e.to,a.to):"";n=i.replaceSelection(t.state.toText(l+e.insert.sliceString(0,void 0,t.state.lineBreak)+u))}else{let l=i.changes(e),u=r&&r.main.to<=l.newLength?r.main:void 0;if(i.selection.ranges.length>1&&t.inputState.composing>=0&&e.to<=a.to&&e.to>=a.to-10){let c=t.state.sliceDoc(e.from,e.to),o,f=r&&Y1(t,r.main.head);if(f){let p=e.insert.length-(e.to-e.from);o={from:f.from,to:f.to-p}}else o=t.state.doc.lineAt(a.head);let h=a.to-e.to,d=a.to-a.from;n=i.changeByRange(p=>{if(p.from==a.from&&p.to==a.to)return{changes:l,range:u||p.map(l)};let g=p.to-h,m=g-c.length;if(p.to-p.from!=d||t.state.sliceDoc(m,g)!=c||p.to>=o.from&&p.from<=o.to)return{range:p};let v=i.changes({from:m,to:g,insert:e.insert}),b=p.to-a.to;return{changes:v,range:u?Ee.range(Math.max(0,u.anchor+b),Math.max(0,u.head+b)):p.map(v)}})}else n={changes:l,selection:u&&i.selection.replaceRange(u)}}let s="input.type";return(t.composing||t.inputState.compositionPendingChange&&t.inputState.compositionEndedAt>Date.now()-50)&&(t.inputState.compositionPendingChange=!1,s+=".compose",t.inputState.compositionFirstChange&&(s+=".start",t.inputState.compositionFirstChange=!1)),i.update(n,{userEvent:s,scrollIntoView:!0})}function j5(t,e,r,n){let i=Math.min(t.length,e.length),a=0;for(;a<i&&t.charCodeAt(a)==e.charCodeAt(a);)a++;if(a==i&&t.length==e.length)return null;let s=t.length,l=e.length;for(;s>0&&l>0&&t.charCodeAt(s-1)==e.charCodeAt(l-1);)s--,l--;if(n=="end"){let u=Math.max(0,a-Math.min(s,l));r-=s+u-a}if(s<a&&t.length<e.length){let u=r<=a&&r>=s?a-r:0;a-=u,l=a+(l-s),s=a}else if(l<a){let u=r<=a&&r>=l?a-r:0;a-=u,s=a+(s-l),l=a}return{from:a,toA:s,toB:l}}function Z5(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:r,anchorOffset:n,focusNode:i,focusOffset:a}=t.observer.selectionRange;return r&&(e.push(new Ug(r,n)),(i!=r||a!=n)&&e.push(new Ug(i,a))),e}function J5(t,e){if(t.length==0)return null;let r=t[0].pos,n=t.length==2?t[1].pos:r;return r>-1&&n>-1?Ee.single(r+e,n+e):null}const e4={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Kc=Fe.ie&&Fe.ie_version<=11;class t4{constructor(e){this.view=e,this.active=!1,this.selectionRange=new U3,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(r=>{for(let n of r)this.queue.push(n);(Fe.ie&&Fe.ie_version<=11||Fe.ios&&e.composing)&&r.some(n=>n.type=="childList"&&n.removedNodes.length||n.type=="characterData"&&n.oldValue.length>n.target.nodeValue.length)?this.flushSoon():this.flush()}),Kc&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var r;((r=this.view.docView)===null||r===void 0?void 0:r.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(r=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),r.length>0&&r[r.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(r=>{r.length>0&&r[r.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((r,n)=>r!=e[n]))){this.gapIntersection.disconnect();for(let r of e)this.gapIntersection.observe(r);this.gaps=e}}onSelectionChange(e){let r=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:n}=this,i=this.selectionRange;if(n.state.facet(nc)?n.root.activeElement!=this.dom:!Mo(n.dom,i))return;let a=i.anchorNode&&n.docView.nearest(i.anchorNode);if(a&&a.ignoreEvent(e)){r||(this.selectionChanged=!1);return}(Fe.ie&&Fe.ie_version<=11||Fe.android&&Fe.chrome)&&!n.state.selection.main.empty&&i.focusNode&&Qo(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,r=Fe.safari&&e.root.nodeType==11&&I3(this.dom.ownerDocument)==this.dom&&r4(this.view)||Xo(e.root);if(!r||this.selectionRange.eq(r))return!1;let n=Mo(this.dom,r);return n&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&F3(this.dom,r)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(r),n&&(this.selectionChanged=!0),!0)}setSelectionRange(e,r){this.selectionRange.set(e.node,e.offset,r.node,r.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,r=null;for(let n=this.dom;n;)if(n.nodeType==1)!r&&e<this.scrollTargets.length&&this.scrollTargets[e]==n?e++:r||(r=this.scrollTargets.slice(0,e)),r&&r.push(n),n=n.assignedSlot||n.parentNode;else if(n.nodeType==11)n=n.host;else break;if(e<this.scrollTargets.length&&!r&&(r=this.scrollTargets.slice(0,e)),r){for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);for(let n of this.scrollTargets=r)n.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,e4),Kc&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Kc&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,r){var n;if(!this.delayedAndroidKey){let i=()=>{let a=this.delayedAndroidKey;a&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=a.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&a.force&&Yi(this.dom,a.key,a.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(i)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:r,force:this.lastChange<Date.now()-50||!!(!((n=this.delayedAndroidKey)===null||n===void 0)&&n.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let r=-1,n=-1,i=!1;for(let a of e){let s=this.readMutation(a);s&&(s.typeOver&&(i=!0),r==-1?{from:r,to:n}=s:(r=Math.min(s.from,r),n=Math.max(s.to,n)))}return{from:r,to:n,typeOver:i}}readChange(){let{from:e,to:r,typeOver:n}=this.processRecords(),i=this.selectionChanged&&Mo(this.dom,this.selectionRange);if(e<0&&!i)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let a=new Q5(this.view,e,r,n);return this.view.docView.domChanged={newSel:a.newSel?a.newSel.main:null},a}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let r=this.readChange();if(!r)return this.view.requestMeasure(),!1;let n=this.view.state,i=cy(this.view,r);return this.view.state==n&&this.view.update([]),i}readMutation(e){let r=this.view.docView.nearest(e.target);if(!r||r.ignoreMutation(e))return null;if(r.markDirty(e.type=="attributes"),e.type=="attributes"&&(r.flags|=4),e.type=="childList"){let n=$g(r,e.previousSibling||e.target.previousSibling,-1),i=$g(r,e.nextSibling||e.target.nextSibling,1);return{from:n?r.posAfter(n):r.posAtStart,to:i?r.posBefore(i):r.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}destroy(){var e,r,n;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(r=this.gapIntersection)===null||r===void 0||r.disconnect(),(n=this.resizeScroll)===null||n===void 0||n.disconnect();for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey)}}function $g(t,e,r){for(;e;){let n=At.get(e);if(n&&n.parent==t)return n;let i=e.parentNode;e=i!=t.dom?i:r>0?e.nextSibling:e.previousSibling}return null}function r4(t){let e=null;function r(u){u.preventDefault(),u.stopImmediatePropagation(),e=u.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",r,!0),t.dom.ownerDocument.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",r,!0),!e)return null;let n=e.startContainer,i=e.startOffset,a=e.endContainer,s=e.endOffset,l=t.docView.domAtPos(t.state.selection.main.anchor);return Qo(l.node,l.offset,a,s)&&([n,i,a,s]=[a,s,n,i]),{anchorNode:n,anchorOffset:i,focusNode:a,focusOffset:s}}class Be{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM);let{dispatch:r}=e;this.dispatchTransactions=e.dispatchTransactions||r&&(n=>n.forEach(i=>r(i,this)))||(n=>this.update(n)),this.dispatch=this.dispatch.bind(this),this._root=e.root||$3(e.parent)||document,this.viewState=new Dg(e.state||rt.create(e)),e.scrollTo&&e.scrollTo.is(Js)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(Wa).map(n=>new qc(n));for(let n of this.plugins)n.update(this);this.observer=new t4(this),this.inputState=new v5(this),this.inputState.ensureHandlers(this.plugins),this.docView=new vg(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}dispatch(...e){let r=e.length==1&&e[0]instanceof zt?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(r,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let r=!1,n=!1,i,a=this.state;for(let h of e){if(h.startState!=a)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");a=h.state}if(this.destroyed){this.viewState.state=a;return}let s=this.hasFocus,l=0,u=null;e.some(h=>h.annotation(ry))?(this.inputState.notifiedFocused=s,l=1):s!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=s,u=ny(a,s),u||(l=1));let c=this.observer.delayedAndroidKey,o=null;if(c?(this.observer.clearDelayedAndroidKey(),o=this.observer.readChange(),(o&&!this.state.doc.eq(a.doc)||!this.state.selection.eq(a.selection))&&(o=null)):this.observer.clear(),a.facet(rt.phrases)!=this.state.facet(rt.phrases))return this.setState(a);i=Ko.create(this,a,e),i.flags|=l;let f=this.viewState.scrollTarget;try{this.updateState=2;for(let h of e){if(f&&(f=f.map(h.changes)),h.scrollIntoView){let{main:d}=h.state.selection;f=new Xi(d.empty?d:Ee.cursor(d.head,d.head>d.anchor?-1:1))}for(let d of h.effects)d.is(Js)&&(f=d.value.clip(this.state))}this.viewState.update(i,f),this.bidiCache=jo.update(this.bidiCache,i.changes),i.empty||(this.updatePlugins(i),this.inputState.update(i)),r=this.docView.update(i),this.state.facet(Ha)!=this.styleModules&&this.mountStyles(),n=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(r,e.some(h=>h.isUserEvent("select.pointer")))}finally{this.updateState=0}if(i.startState.facet(ao)!=i.state.facet(ao)&&(this.viewState.mustMeasureContent=!0),(r||n||f||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!i.empty)for(let h of this.state.facet(rf))try{h(i)}catch(d){kr(this.state,d,"update listener")}(u||o)&&Promise.resolve().then(()=>{u&&this.state==u.startState&&this.dispatch(u),o&&!cy(this,o)&&c.force&&Yi(this.contentDOM,c.key,c.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let r=this.hasFocus;try{for(let n of this.plugins)n.destroy(this);this.viewState=new Dg(e),this.plugins=e.facet(Wa).map(n=>new qc(n)),this.pluginMap.clear();for(let n of this.plugins)n.update(this);this.docView.destroy(),this.docView=new vg(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}r&&this.focus(),this.requestMeasure()}updatePlugins(e){let r=e.startState.facet(Wa),n=e.state.facet(Wa);if(r!=n){let i=[];for(let a of n){let s=r.indexOf(a);if(s<0)i.push(new qc(a));else{let l=this.plugins[s];l.mustUpdate=e,i.push(l)}}for(let a of this.plugins)a.mustUpdate!=e&&a.destroy(this);this.plugins=i,this.pluginMap.clear()}else for(let i of this.plugins)i.mustUpdate=e;for(let i=0;i<this.plugins.length;i++)this.plugins[i].update(this);r!=n&&this.inputState.ensureHandlers(this.plugins)}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let r=null,n=this.scrollDOM,i=n.scrollTop*this.scaleY,{scrollAnchorPos:a,scrollAnchorHeight:s}=this.viewState;Math.abs(i-this.viewState.scrollTop)>1&&(s=-1),this.viewState.scrollAnchorHeight=-1;try{for(let l=0;;l++){if(s<0)if(E1(n))a=-1,s=this.viewState.heightMap.height;else{let d=this.viewState.scrollAnchorAt(i);a=d.from,s=d.top}this.updateState=1;let u=this.viewState.measure(this);if(!u&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(l>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let c=[];u&4||([this.measureRequests,c]=[c,this.measureRequests]);let o=c.map(d=>{try{return d.read(this)}catch(p){return kr(this.state,p),Fg}}),f=Ko.create(this,this.state,[]),h=!1;f.flags|=u,r?r.flags|=u:r=f,this.updateState=2,f.empty||(this.updatePlugins(f),this.inputState.update(f),this.updateAttrs(),h=this.docView.update(f));for(let d=0;d<c.length;d++)if(o[d]!=Fg)try{let p=c[d];p.write&&p.write(o[d],this)}catch(p){kr(this.state,p)}if(h&&this.docView.updateSelection(!0),!f.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null;continue}else{let p=(a<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(a).top)-s;if(p>1||p<-1){i=i+p,n.scrollTop=i/this.scaleY,s=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(r&&!r.empty)for(let l of this.state.facet(rf))l(r)}get themeClasses(){return ff+" "+(this.state.facet(uf)?oy:sy)+" "+this.state.facet(ao)}updateAttrs(){let e=Vg(this,U1,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),r={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(nc)?"true":"false",class:"cm-content",style:`${Fe.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(r["aria-readonly"]="true"),Vg(this,Mh,r);let n=this.observer.ignore(()=>{let i=ef(this.contentDOM,this.contentAttrs,r),a=ef(this.dom,this.editorAttrs,e);return i||a});return this.editorAttrs=e,this.contentAttrs=r,n}showAnnouncements(e){let r=!0;for(let n of e)for(let i of n.effects)if(i.is(Be.announce)){r&&(this.announceDOM.textContent=""),r=!1;let a=this.announceDOM.appendChild(document.createElement("div"));a.textContent=i.value}}mountStyles(){this.styleModules=this.state.facet(Ha);let e=this.state.facet(Be.cspNonce);Xn.mount(this.root,this.styleModules.concat(q5).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let r=0;r<this.measureRequests.length;r++)if(this.measureRequests[r].key===e.key){this.measureRequests[r]=e;return}}this.measureRequests.push(e)}}plugin(e){let r=this.pluginMap.get(e);return(r===void 0||r&&r.spec!=e)&&this.pluginMap.set(e,r=this.plugins.find(n=>n.spec==e)||null),r&&r.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,r,n){return Xc(this,e,Cg(this,e,r,n))}moveByGroup(e,r){return Xc(this,e,Cg(this,e,r,n=>g5(this,e.head,n)))}moveToLineBoundary(e,r,n=!0){return p5(this,e,r,n)}moveVertically(e,r,n){return Xc(this,e,m5(this,e,r,n))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,r=0){return this.docView.posFromDOM(e,r)}posAtCoords(e,r=!0){return this.readMeasured(),Q1(this,e,r)}coordsAtPos(e,r=1){this.readMeasured();let n=this.docView.coordsAt(e,r);if(!n||n.left==n.right)return n;let i=this.state.doc.lineAt(e),a=this.bidiSpans(i),s=a[Vn.find(a,e-i.from,-1,r)];return tc(n,s.dir==_t.LTR==r>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(L1)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>n4)return z1(e.length);let r=this.textDirectionAt(e.from),n;for(let a of this.bidiCache)if(a.from==e.from&&a.dir==r&&(a.fresh||G1(a.isolates,n=mg(this,e.from,e.to))))return a.order;n||(n=mg(this,e.from,e.to));let i=e5(e.text,r,n);return this.bidiCache.push(new jo(e.from,e.to,r,n,!0,i)),i}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||Fe.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{y1(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,r={}){return Js.of(new Xi(typeof e=="number"?Ee.cursor(e):e,r.y,r.x,r.yMargin,r.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:r}=this.scrollDOM,n=this.viewState.scrollAnchorAt(e);return Js.of(new Xi(Ee.cursor(n.from),"start","start",n.top-e,r,!0))}static domEventHandlers(e){return It.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return It.define(()=>({}),{eventObservers:e})}static theme(e,r){let n=Xn.newName(),i=[ao.of(n),Ha.of(hf(`.${n}`,e))];return r&&r.dark&&i.push(uf.of(!0)),i}static baseTheme(e){return ya.lowest(Ha.of(hf("."+ff,e,ly)))}static findFromDOM(e){var r;let n=e.querySelector(".cm-content"),i=n&&At.get(n)||At.get(e);return((r=i==null?void 0:i.rootView)===null||r===void 0?void 0:r.view)||null}}Be.styleModule=Ha;Be.inputHandler=I1;Be.focusChangeEffect=D1;Be.perLineTextDirection=L1;Be.exceptionSink=P1;Be.updateListener=rf;Be.editable=nc;Be.mouseSelectionStyle=k1;Be.dragMovesSelection=_1;Be.clickAddsSelectionRange=M1;Be.decorations=ss;Be.atomicRanges=_h;Be.bidiIsolatedRanges=$1;Be.scrollMargins=F1;Be.darkTheme=uf;Be.cspNonce=$e.define({combine:t=>t.length?t[0]:""});Be.contentAttributes=Mh;Be.editorAttributes=U1;Be.lineWrapping=Be.contentAttributes.of({class:"cm-lineWrapping"});Be.announce=Ze.define();const n4=4096,Fg={};class jo{constructor(e,r,n,i,a,s){this.from=e,this.to=r,this.dir=n,this.isolates=i,this.fresh=a,this.order=s}static update(e,r){if(r.empty&&!e.some(a=>a.fresh))return e;let n=[],i=e.length?e[e.length-1].dir:_t.LTR;for(let a=Math.max(0,e.length-10);a<e.length;a++){let s=e[a];s.dir==i&&!r.touchesRange(s.from,s.to)&&n.push(new jo(r.mapPos(s.from,1),r.mapPos(s.to,-1),s.dir,s.isolates,!1,s.order))}return n}}function Vg(t,e,r){for(let n=t.state.facet(e),i=n.length-1;i>=0;i--){let a=n[i],s=typeof a=="function"?a(t):a;s&&Ju(s,r)}return r}const i4=Fe.mac?"mac":Fe.windows?"win":Fe.linux?"linux":"key";function a4(t,e){const r=t.split(/-(?!$)/);let n=r[r.length-1];n=="Space"&&(n=" ");let i,a,s,l;for(let u=0;u<r.length-1;++u){const c=r[u];if(/^(cmd|meta|m)$/i.test(c))l=!0;else if(/^a(lt)?$/i.test(c))i=!0;else if(/^(c|ctrl|control)$/i.test(c))a=!0;else if(/^s(hift)?$/i.test(c))s=!0;else if(/^mod$/i.test(c))e=="mac"?l=!0:a=!0;else throw new Error("Unrecognized modifier name: "+c)}return i&&(n="Alt-"+n),a&&(n="Ctrl-"+n),l&&(n="Meta-"+n),s&&(n="Shift-"+n),n}function so(t,e,r){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),r!==!1&&e.shiftKey&&(t="Shift-"+t),t}const s4=ya.default(Be.domEventHandlers({keydown(t,e){return fy(uy(e.state),t,e,"editor")}})),Ps=$e.define({enables:s4}),Wg=new WeakMap;function uy(t){let e=t.facet(Ps),r=Wg.get(e);return r||Wg.set(e,r=c4(e.reduce((n,i)=>n.concat(i),[]))),r}function o4(t,e,r){return fy(uy(t.state),e,t,r)}let Bn=null;const l4=4e3;function c4(t,e=i4){let r=Object.create(null),n=Object.create(null),i=(s,l)=>{let u=n[s];if(u==null)n[s]=l;else if(u!=l)throw new Error("Key binding "+s+" is used both as a regular binding and as a multi-stroke prefix")},a=(s,l,u,c,o)=>{var f,h;let d=r[s]||(r[s]=Object.create(null)),p=l.split(/ (?!$)/).map(v=>a4(v,e));for(let v=1;v<p.length;v++){let b=p.slice(0,v).join(" ");i(b,!0),d[b]||(d[b]={preventDefault:!0,stopPropagation:!1,run:[C=>{let A=Bn={view:C,prefix:b,scope:s};return setTimeout(()=>{Bn==A&&(Bn=null)},l4),!0}]})}let g=p.join(" ");i(g,!1);let m=d[g]||(d[g]={preventDefault:!1,stopPropagation:!1,run:((h=(f=d._any)===null||f===void 0?void 0:f.run)===null||h===void 0?void 0:h.slice())||[]});u&&m.run.push(u),c&&(m.preventDefault=!0),o&&(m.stopPropagation=!0)};for(let s of t){let l=s.scope?s.scope.split(" "):["editor"];if(s.any)for(let c of l){let o=r[c]||(r[c]=Object.create(null));o._any||(o._any={preventDefault:!1,stopPropagation:!1,run:[]});for(let f in o)o[f].run.push(s.any)}let u=s[e]||s.key;if(u)for(let c of l)a(c,u,s.run,s.preventDefault,s.stopPropagation),s.shift&&a(c,"Shift-"+u,s.shift,s.preventDefault,s.stopPropagation)}return r}function fy(t,e,r,n){let i=P3(e),a=Zt(i,0),s=Nr(a)==i.length&&i!=" ",l="",u=!1,c=!1,o=!1;Bn&&Bn.view==r&&Bn.scope==n&&(l=Bn.prefix+" ",j1.indexOf(e.keyCode)<0&&(c=!0,Bn=null));let f=new Set,h=m=>{if(m){for(let v of m.run)if(!f.has(v)&&(f.add(v),v(r,e)))return m.stopPropagation&&(o=!0),!0;m.preventDefault&&(m.stopPropagation&&(o=!0),c=!0)}return!1},d=t[n],p,g;return d&&(h(d[l+so(i,e,!s)])?u=!0:s&&(e.altKey||e.metaKey||e.ctrlKey)&&!(Fe.windows&&e.ctrlKey&&e.altKey)&&(p=Qn[e.keyCode])&&p!=i?(h(d[l+so(p,e,!0)])||e.shiftKey&&(g=is[e.keyCode])!=i&&g!=p&&h(d[l+so(g,e,!1)]))&&(u=!0):s&&e.shiftKey&&h(d[l+so(i,e,!0)])&&(u=!0),!u&&h(d._any)&&(u=!0)),c&&(u=!0),u&&o&&e.stopPropagation(),u}class Is{constructor(e,r,n,i,a){this.className=e,this.left=r,this.top=n,this.width=i,this.height=a}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,r){return r.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,r,n){if(n.empty){let i=e.coordsAtPos(n.head,n.assoc||1);if(!i)return[];let a=hy(e);return[new Is(r,i.left-a.left,i.top-a.top,null,i.bottom-i.top)]}else return u4(e,r,n)}}function hy(t){let e=t.scrollDOM.getBoundingClientRect();return{left:(t.textDirection==_t.LTR?e.left:e.right-t.scrollDOM.clientWidth*t.scaleX)-t.scrollDOM.scrollLeft*t.scaleX,top:e.top-t.scrollDOM.scrollTop*t.scaleY}}function Hg(t,e,r){let n=Ee.cursor(e);return{from:Math.max(r.from,t.moveToLineBoundary(n,!1,!0).from),to:Math.min(r.to,t.moveToLineBoundary(n,!0,!0).from),type:hr.Text}}function u4(t,e,r){if(r.to<=t.viewport.from||r.from>=t.viewport.to)return[];let n=Math.max(r.from,t.viewport.from),i=Math.min(r.to,t.viewport.to),a=t.textDirection==_t.LTR,s=t.contentDOM,l=s.getBoundingClientRect(),u=hy(t),c=s.querySelector(".cm-line"),o=c&&window.getComputedStyle(c),f=l.left+(o?parseInt(o.paddingLeft)+Math.min(0,parseInt(o.textIndent)):0),h=l.right-(o?parseInt(o.paddingRight):0),d=lf(t,n),p=lf(t,i),g=d.type==hr.Text?d:null,m=p.type==hr.Text?p:null;if(g&&(t.lineWrapping||d.widgetLineBreaks)&&(g=Hg(t,n,g)),m&&(t.lineWrapping||p.widgetLineBreaks)&&(m=Hg(t,i,m)),g&&m&&g.from==m.from)return b(C(r.from,r.to,g));{let O=g?C(r.from,null,g):A(d,!1),w=m?C(null,r.to,m):A(p,!0),S=[];return(g||d).to<(m||p).from-(g&&m?1:0)||d.widgetLineBreaks>1&&O.bottom+t.defaultLineHeight/2<w.top?S.push(v(f,O.bottom,h,w.top)):O.bottom<w.top&&t.elementAtHeight((O.bottom+w.top)/2).type==hr.Text&&(O.bottom=w.top=(O.bottom+w.top)/2),b(O).concat(S).concat(b(w))}function v(O,w,S,N){return new Is(e,O-u.left,w-u.top-.01,S-O,N-w+.01)}function b({top:O,bottom:w,horizontal:S}){let N=[];for(let R=0;R<S.length;R+=2)N.push(v(S[R],O,S[R+1],w));return N}function C(O,w,S){let N=1e9,R=-1e9,k=[];function z(Q,ae,ve,J,ne){let se=t.coordsAtPos(Q,Q==S.to?-2:2),de=t.coordsAtPos(ve,ve==S.from?2:-2);!se||!de||(N=Math.min(se.top,de.top,N),R=Math.max(se.bottom,de.bottom,R),ne==_t.LTR?k.push(a&&ae?f:se.left,a&&J?h:de.right):k.push(!a&&J?f:de.left,!a&&ae?h:se.right))}let Y=O??S.from,re=w??S.to;for(let Q of t.visibleRanges)if(Q.to>Y&&Q.from<re)for(let ae=Math.max(Q.from,Y),ve=Math.min(Q.to,re);;){let J=t.state.doc.lineAt(ae);for(let ne of t.bidiSpans(J)){let se=ne.from+J.from,de=ne.to+J.from;if(se>=ve)break;de>ae&&z(Math.max(se,ae),O==null&&se<=Y,Math.min(de,ve),w==null&&de>=re,ne.dir)}if(ae=J.to+1,ae>=ve)break}return k.length==0&&z(Y,O==null,re,w==null,t.textDirection),{top:N,bottom:R,horizontal:k}}function A(O,w){let S=l.top+(w?O.top:O.bottom);return{top:S,bottom:S,horizontal:[]}}}function f4(t,e){return t.constructor==e.constructor&&t.eq(e)}class h4{constructor(e,r){this.view=e,this.layer=r,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),r.above&&this.dom.classList.add("cm-layer-above"),r.class&&this.dom.classList.add(r.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),r.mount&&r.mount(this.dom,e)}update(e){e.startState.facet(Po)!=e.state.facet(Po)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}setOrder(e){let r=0,n=e.facet(Po);for(;r<n.length&&n[r]!=this.layer;)r++;this.dom.style.zIndex=String((this.layer.above?150:-1)-r)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:r}=this.view;(e!=this.scaleX||r!=this.scaleY)&&(this.scaleX=e,this.scaleY=r,this.dom.style.transform=`scale(${1/e}, ${1/r})`)}draw(e){if(e.length!=this.drawn.length||e.some((r,n)=>!f4(r,this.drawn[n]))){let r=this.dom.firstChild,n=0;for(let i of e)i.update&&r&&i.constructor&&this.drawn[n].constructor&&i.update(r,this.drawn[n])?(r=r.nextSibling,n++):this.dom.insertBefore(i.draw(),r);for(;r;){let i=r.nextSibling;r.remove(),r=i}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const Po=$e.define();function dy(t){return[It.define(e=>new h4(e,t)),Po.of(t)]}const py=!Fe.ios,ls=$e.define({combine(t){return yn(t,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,r)=>Math.min(e,r),drawRangeCursor:(e,r)=>e||r})}});function d4(t={}){return[ls.of(t),p4,g4,m4,B1.of(!0)]}function gy(t){return t.startState.facet(ls)!=t.state.facet(ls)}const p4=dy({above:!0,markers(t){let{state:e}=t,r=e.facet(ls),n=[];for(let i of e.selection.ranges){let a=i==e.selection.main;if(i.empty?!a||py:r.drawRangeCursor){let s=a?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",l=i.empty?i:Ee.cursor(i.head,i.head>i.anchor?-1:1);for(let u of Is.forRange(t,s,l))n.push(u)}}return n},update(t,e){t.transactions.some(n=>n.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let r=gy(t);return r&&Gg(t.state,e),t.docChanged||t.selectionSet||r},mount(t,e){Gg(e.state,t)},class:"cm-cursorLayer"});function Gg(t,e){e.style.animationDuration=t.facet(ls).cursorBlinkRate+"ms"}const g4=dy({above:!1,markers(t){return t.state.selection.ranges.map(e=>e.empty?[]:Is.forRange(t,"cm-selectionBackground",e)).reduce((e,r)=>e.concat(r))},update(t,e){return t.docChanged||t.selectionSet||t.viewportChanged||gy(t)},class:"cm-selectionLayer"}),df={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};py&&(df[".cm-line"].caretColor="transparent !important",df[".cm-content"]={caretColor:"transparent !important"});const m4=ya.highest(Be.theme(df)),my=Ze.define({map(t,e){return t==null?null:e.mapPos(t)}}),qa=rr.define({create(){return null},update(t,e){return t!=null&&(t=e.changes.mapPos(t)),e.effects.reduce((r,n)=>n.is(my)?n.value:r,t)}}),v4=It.fromClass(class{constructor(t){this.view=t,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(t){var e;let r=t.state.field(qa);r==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(t.startState.field(qa)!=r||t.docChanged||t.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view:t}=this,e=t.state.field(qa),r=e!=null&&t.coordsAtPos(e);if(!r)return null;let n=t.scrollDOM.getBoundingClientRect();return{left:r.left-n.left+t.scrollDOM.scrollLeft*t.scaleX,top:r.top-n.top+t.scrollDOM.scrollTop*t.scaleY,height:r.bottom-r.top}}drawCursor(t){if(this.cursor){let{scaleX:e,scaleY:r}=this.view;t?(this.cursor.style.left=t.left/e+"px",this.cursor.style.top=t.top/r+"px",this.cursor.style.height=t.height/r+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(t){this.view.state.field(qa)!=t&&this.view.dispatch({effects:my.of(t)})}},{eventObservers:{dragover(t){this.setDropPos(this.view.posAtCoords({x:t.clientX,y:t.clientY}))},dragleave(t){(t.target==this.view.contentDOM||!this.view.contentDOM.contains(t.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function y4(){return[qa,v4]}function zg(t,e,r,n,i){e.lastIndex=0;for(let a=t.iterRange(r,n),s=r,l;!a.next().done;s+=a.value.length)if(!a.lineBreak)for(;l=e.exec(a.value);)i(s+l.index,l)}function b4(t,e){let r=t.visibleRanges;if(r.length==1&&r[0].from==t.viewport.from&&r[0].to==t.viewport.to)return r;let n=[];for(let{from:i,to:a}of r)i=Math.max(t.state.doc.lineAt(i).from,i-e),a=Math.min(t.state.doc.lineAt(a).to,a+e),n.length&&n[n.length-1].to>=i?n[n.length-1].to=a:n.push({from:i,to:a});return n}class E4{constructor(e){const{regexp:r,decoration:n,decorate:i,boundary:a,maxLength:s=1e3}=e;if(!r.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=r,i)this.addMatch=(l,u,c,o)=>i(o,c,c+l[0].length,l,u);else if(typeof n=="function")this.addMatch=(l,u,c,o)=>{let f=n(l,u,c);f&&o(c,c+l[0].length,f)};else if(n)this.addMatch=(l,u,c,o)=>o(c,c+l[0].length,n);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=a,this.maxLength=s}createDeco(e){let r=new Yn,n=r.add.bind(r);for(let{from:i,to:a}of b4(e,this.maxLength))zg(e.state.doc,this.regexp,i,a,(s,l)=>this.addMatch(l,e,s,n));return r.finish()}updateDeco(e,r){let n=1e9,i=-1;return e.docChanged&&e.changes.iterChanges((a,s,l,u)=>{u>e.view.viewport.from&&l<e.view.viewport.to&&(n=Math.min(l,n),i=Math.max(u,i))}),e.viewportChanged||i-n>1e3?this.createDeco(e.view):i>-1?this.updateRange(e.view,r.map(e.changes),n,i):r}updateRange(e,r,n,i){for(let a of e.visibleRanges){let s=Math.max(a.from,n),l=Math.min(a.to,i);if(l>s){let u=e.state.doc.lineAt(s),c=u.to<l?e.state.doc.lineAt(l):u,o=Math.max(a.from,u.from),f=Math.min(a.to,c.to);if(this.boundary){for(;s>u.from;s--)if(this.boundary.test(u.text[s-1-u.from])){o=s;break}for(;l<c.to;l++)if(this.boundary.test(c.text[l-c.from])){f=l;break}}let h=[],d,p=(g,m,v)=>h.push(v.range(g,m));if(u==c)for(this.regexp.lastIndex=o-u.from;(d=this.regexp.exec(u.text))&&d.index<f-u.from;)this.addMatch(d,e,d.index+u.from,p);else zg(e.state.doc,this.regexp,o,f,(g,m)=>this.addMatch(m,e,g,p));r=r.update({filterFrom:o,filterTo:f,filter:(g,m)=>g<o||m>f,add:h})}}return r}}const pf=/x/.unicode!=null?"gu":"g",O4=new RegExp(`[\0-\b
--­؜​‎‏\u2028\u2029‭‮⁦⁧⁩\uFEFF￹-￼]`,pf),A4={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let jc=null;function C4(){var t;if(jc==null&&typeof document<"u"&&document.body){let e=document.body.style;jc=((t=e.tabSize)!==null&&t!==void 0?t:e.MozTabSize)!=null}return jc||!1}const Io=$e.define({combine(t){let e=yn(t,{render:null,specialChars:O4,addSpecialChars:null});return(e.replaceTabs=!C4())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,pf)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,pf)),e}});function w4(t={}){return[Io.of(t),S4()]}let qg=null;function S4(){return qg||(qg=It.fromClass(class{constructor(t){this.view=t,this.decorations=qe.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(t.state.facet(Io)),this.decorations=this.decorator.createDeco(t)}makeDecorator(t){return new E4({regexp:t.specialChars,decoration:(e,r,n)=>{let{doc:i}=r.state,a=Zt(e[0],0);if(a==9){let s=i.lineAt(n),l=r.state.tabSize,u=ba(s.text,l,n-s.from);return qe.replace({widget:new x4((l-u%l)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[a]||(this.decorationCache[a]=qe.replace({widget:new N4(t,a)}))},boundary:t.replaceTabs?void 0:/[^]/})}update(t){let e=t.state.facet(Io);t.startState.facet(Io)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(t.view)):this.decorations=this.decorator.updateDeco(t,this.decorations)}},{decorations:t=>t.decorations}))}const T4="•";function R4(t){return t>=32?T4:t==10?"␤":String.fromCharCode(9216+t)}class N4 extends kn{constructor(e,r){super(),this.options=e,this.code=r}eq(e){return e.code==this.code}toDOM(e){let r=R4(this.code),n=e.state.phrase("Control character")+" "+(A4[this.code]||"0x"+this.code.toString(16)),i=this.options.render&&this.options.render(this.code,n,r);if(i)return i;let a=document.createElement("span");return a.textContent=r,a.title=n,a.setAttribute("aria-label",n),a.className="cm-specialChar",a}ignoreEvent(){return!1}}class x4 extends kn{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}function M4(){return k4}const _4=qe.line({class:"cm-activeLine"}),k4=It.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.docChanged||t.selectionSet)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=-1,r=[];for(let n of t.state.selection.ranges){let i=t.lineBlockAt(n.head);i.from>e&&(r.push(_4.range(i.from)),e=i.from)}return qe.set(r)}},{decorations:t=>t.decorations});class P4 extends kn{constructor(e){super(),this.content=e}toDOM(){let e=document.createElement("span");return e.className="cm-placeholder",e.style.pointerEvents="none",e.appendChild(typeof this.content=="string"?document.createTextNode(this.content):this.content),typeof this.content=="string"?e.setAttribute("aria-label","placeholder "+this.content):e.setAttribute("aria-hidden","true"),e}coordsAt(e){let r=e.firstChild?Ji(e.firstChild):[];if(!r.length)return null;let n=window.getComputedStyle(e.parentNode),i=tc(r[0],n.direction!="rtl"),a=parseInt(n.lineHeight);return i.bottom-i.top>a*1.5?{left:i.left,right:i.right,top:i.top,bottom:i.top+a}:i}ignoreEvent(){return!1}}function I4(t){return It.fromClass(class{constructor(e){this.view=e,this.placeholder=t?qe.set([qe.widget({widget:new P4(t),side:1}).range(0)]):qe.none}get decorations(){return this.view.state.doc.length?qe.none:this.placeholder}},{decorations:e=>e.decorations})}const gf=2e3;function D4(t,e,r){let n=Math.min(e.line,r.line),i=Math.max(e.line,r.line),a=[];if(e.off>gf||r.off>gf||e.col<0||r.col<0){let s=Math.min(e.off,r.off),l=Math.max(e.off,r.off);for(let u=n;u<=i;u++){let c=t.doc.line(u);c.length<=l&&a.push(Ee.range(c.from+s,c.to+l))}}else{let s=Math.min(e.col,r.col),l=Math.max(e.col,r.col);for(let u=n;u<=i;u++){let c=t.doc.line(u),o=qu(c.text,s,t.tabSize,!0);if(o<0)a.push(Ee.cursor(c.to));else{let f=qu(c.text,l,t.tabSize);a.push(Ee.range(c.from+o,c.from+f))}}}return a}function L4(t,e){let r=t.coordsAtPos(t.viewport.from);return r?Math.round(Math.abs((r.left-e)/t.defaultCharacterWidth)):-1}function Yg(t,e){let r=t.posAtCoords({x:e.clientX,y:e.clientY},!1),n=t.state.doc.lineAt(r),i=r-n.from,a=i>gf?-1:i==n.length?L4(t,e.clientX):ba(n.text,t.state.tabSize,r-n.from);return{line:n.number,col:a,off:i}}function B4(t,e){let r=Yg(t,e),n=t.state.selection;return r?{update(i){if(i.docChanged){let a=i.changes.mapPos(i.startState.doc.line(r.line).from),s=i.state.doc.lineAt(a);r={line:s.number,col:r.col,off:Math.min(r.off,s.length)},n=n.map(i.changes)}},get(i,a,s){let l=Yg(t,i);if(!l)return n;let u=D4(t.state,r,l);return u.length?s?Ee.create(u.concat(n.ranges)):Ee.create(u):n}}:null}function U4(t){let e=(t==null?void 0:t.eventFilter)||(r=>r.altKey&&r.button==0);return Be.mouseSelectionStyle.of((r,n)=>e(n)?B4(r,n):null)}const $4={Alt:[18,t=>!!t.altKey],Control:[17,t=>!!t.ctrlKey],Shift:[16,t=>!!t.shiftKey],Meta:[91,t=>!!t.metaKey]},F4={style:"cursor: crosshair"};function V4(t={}){let[e,r]=$4[t.key||"Alt"],n=It.fromClass(class{constructor(i){this.view=i,this.isDown=!1}set(i){this.isDown!=i&&(this.isDown=i,this.view.update([]))}},{eventObservers:{keydown(i){this.set(i.keyCode==e||r(i))},keyup(i){(i.keyCode==e||!r(i))&&this.set(!1)},mousemove(i){this.set(r(i))}}});return[n,Be.contentAttributes.of(i=>{var a;return!((a=i.plugin(n))===null||a===void 0)&&a.isDown?F4:null})]}const Ba="-10000px";class vy{constructor(e,r,n){this.facet=r,this.createTooltipView=n,this.input=e.state.facet(r),this.tooltips=this.input.filter(i=>i),this.tooltipViews=this.tooltips.map(n)}update(e,r){var n;let i=e.state.facet(this.facet),a=i.filter(u=>u);if(i===this.input){for(let u of this.tooltipViews)u.update&&u.update(e);return!1}let s=[],l=r?[]:null;for(let u=0;u<a.length;u++){let c=a[u],o=-1;if(c){for(let f=0;f<this.tooltips.length;f++){let h=this.tooltips[f];h&&h.create==c.create&&(o=f)}if(o<0)s[u]=this.createTooltipView(c),l&&(l[u]=!!c.above);else{let f=s[u]=this.tooltipViews[o];l&&(l[u]=r[o]),f.update&&f.update(e)}}}for(let u of this.tooltipViews)s.indexOf(u)<0&&(u.dom.remove(),(n=u.destroy)===null||n===void 0||n.call(u));return r&&(l.forEach((u,c)=>r[c]=u),r.length=l.length),this.input=i,this.tooltips=a,this.tooltipViews=s,!0}}function W4(t={}){return Do.of(t)}function H4(t){let{win:e}=t;return{top:0,left:0,bottom:e.innerHeight,right:e.innerWidth}}const Do=$e.define({combine:t=>{var e,r,n;return{position:Fe.ios?"absolute":((e=t.find(i=>i.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((r=t.find(i=>i.parent))===null||r===void 0?void 0:r.parent)||null,tooltipSpace:((n=t.find(i=>i.tooltipSpace))===null||n===void 0?void 0:n.tooltipSpace)||H4}}}),Xg=new WeakMap,Ph=It.fromClass(class{constructor(t){this.view=t,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let e=t.state.facet(Do);this.position=e.position,this.parent=e.parent,this.classes=t.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new vy(t,Ih,r=>this.createTooltip(r)),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(r=>{Date.now()>this.lastTransaction-50&&r.length>0&&r[r.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),t.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let t of this.manager.tooltipViews)this.intersectionObserver.observe(t.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(t){t.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(t,this.above);e&&this.observeIntersection();let r=e||t.geometryChanged,n=t.state.facet(Do);if(n.position!=this.position&&!this.madeAbsolute){this.position=n.position;for(let i of this.manager.tooltipViews)i.dom.style.position=this.position;r=!0}if(n.parent!=this.parent){this.parent&&this.container.remove(),this.parent=n.parent,this.createContainer();for(let i of this.manager.tooltipViews)this.container.appendChild(i.dom);r=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);r&&this.maybeMeasure()}createTooltip(t){let e=t.create(this.view);if(e.dom.classList.add("cm-tooltip"),t.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let r=document.createElement("div");r.className="cm-tooltip-arrow",e.dom.appendChild(r)}return e.dom.style.position=this.position,e.dom.style.top=Ba,e.dom.style.left="0px",this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var t,e;this.view.win.removeEventListener("resize",this.measureSoon);for(let r of this.manager.tooltipViews)r.dom.remove(),(t=r.destroy)===null||t===void 0||t.call(r);this.parent&&this.container.remove(),(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let t=this.view.dom.getBoundingClientRect(),e=1,r=1,n=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:i}=this.manager.tooltipViews[0];if(Fe.gecko)n=i.offsetParent!=this.container.ownerDocument.body;else if(this.view.scaleX!=1||this.view.scaleY!=1)n=!0;else if(i.style.top==Ba&&i.style.left=="0px"){let a=i.getBoundingClientRect();n=Math.abs(a.top+1e4)>1||Math.abs(a.left)>1}}if(n||this.position=="absolute")if(this.parent){let i=this.parent.getBoundingClientRect();i.width&&i.height&&(e=i.width/this.parent.offsetWidth,r=i.height/this.parent.offsetHeight)}else({scaleX:e,scaleY:r}=this.view.viewState);return{editor:t,parent:this.parent?this.container.getBoundingClientRect():t,pos:this.manager.tooltips.map((i,a)=>{let s=this.manager.tooltipViews[a];return s.getCoords?s.getCoords(i.pos):this.view.coordsAtPos(i.pos)}),size:this.manager.tooltipViews.map(({dom:i})=>i.getBoundingClientRect()),space:this.view.state.facet(Do).tooltipSpace(this.view),scaleX:e,scaleY:r,makeAbsolute:n}}writeMeasure(t){var e;if(t.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let l of this.manager.tooltipViews)l.dom.style.position="absolute"}let{editor:r,space:n,scaleX:i,scaleY:a}=t,s=[];for(let l=0;l<this.manager.tooltips.length;l++){let u=this.manager.tooltips[l],c=this.manager.tooltipViews[l],{dom:o}=c,f=t.pos[l],h=t.size[l];if(!f||f.bottom<=Math.max(r.top,n.top)||f.top>=Math.min(r.bottom,n.bottom)||f.right<Math.max(r.left,n.left)-.1||f.left>Math.min(r.right,n.right)+.1){o.style.top=Ba;continue}let d=u.arrow?c.dom.querySelector(".cm-tooltip-arrow"):null,p=d?7:0,g=h.right-h.left,m=(e=Xg.get(c))!==null&&e!==void 0?e:h.bottom-h.top,v=c.offset||z4,b=this.view.textDirection==_t.LTR,C=h.width>n.right-n.left?b?n.left:n.right-h.width:b?Math.min(f.left-(d?14:0)+v.x,n.right-g):Math.max(n.left,f.left-g+(d?14:0)-v.x),A=this.above[l];!u.strictSide&&(A?f.top-(h.bottom-h.top)-v.y<n.top:f.bottom+(h.bottom-h.top)+v.y>n.bottom)&&A==n.bottom-f.bottom>f.top-n.top&&(A=this.above[l]=!A);let O=(A?f.top-n.top:n.bottom-f.bottom)-p;if(O<m&&c.resize!==!1){if(O<this.view.defaultLineHeight){o.style.top=Ba;continue}Xg.set(c,m),o.style.height=(m=O)/a+"px"}else o.style.height&&(o.style.height="");let w=A?f.top-m-p-v.y:f.bottom+p+v.y,S=C+g;if(c.overlap!==!0)for(let N of s)N.left<S&&N.right>C&&N.top<w+m&&N.bottom>w&&(w=A?N.top-m-2-p:N.bottom+p+2);if(this.position=="absolute"?(o.style.top=(w-t.parent.top)/a+"px",o.style.left=(C-t.parent.left)/i+"px"):(o.style.top=w/a+"px",o.style.left=C/i+"px"),d){let N=f.left+(b?v.x:-v.x)-(C+14-7);d.style.left=N/i+"px"}c.overlap!==!0&&s.push({left:C,top:w,right:S,bottom:w+m}),o.classList.toggle("cm-tooltip-above",A),o.classList.toggle("cm-tooltip-below",!A),c.positioned&&c.positioned(t.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let t of this.manager.tooltipViews)t.dom.style.top=Ba}},{eventObservers:{scroll(){this.maybeMeasure()}}}),G4=Be.baseTheme({".cm-tooltip":{zIndex:100,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),z4={x:0,y:0},Ih=$e.define({enables:[Ph,G4]}),Zo=$e.define();class ic{static create(e){return new ic(e)}constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new vy(e,Zo,r=>this.createHostedView(r))}createHostedView(e){let r=e.create(this.view);return r.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(r.dom),this.mounted&&r.mount&&r.mount(this.view),r}mount(e){for(let r of this.manager.tooltipViews)r.mount&&r.mount(e);this.mounted=!0}positioned(e){for(let r of this.manager.tooltipViews)r.positioned&&r.positioned(e)}update(e){this.manager.update(e)}destroy(){var e;for(let r of this.manager.tooltipViews)(e=r.destroy)===null||e===void 0||e.call(r)}passProp(e){let r;for(let n of this.manager.tooltipViews){let i=n[e];if(i!==void 0){if(r===void 0)r=i;else if(r!==i)return}}return r}get offset(){return this.passProp("offset")}get getCoords(){return this.passProp("getCoords")}get overlap(){return this.passProp("overlap")}get resize(){return this.passProp("resize")}}const q4=Ih.compute([Zo],t=>{let e=t.facet(Zo).filter(r=>r);return e.length===0?null:{pos:Math.min(...e.map(r=>r.pos)),end:Math.max(...e.map(r=>{var n;return(n=r.end)!==null&&n!==void 0?n:r.pos})),create:ic.create,above:e[0].above,arrow:e.some(r=>r.arrow)}});class Y4{constructor(e,r,n,i,a){this.view=e,this.source=r,this.field=n,this.setHover=i,this.hoverTime=a,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view:e,lastMove:r}=this,n=e.docView.nearest(r.target);if(!n)return;let i,a=1;if(n instanceof Fn)i=n.posAtStart;else{if(i=e.posAtCoords(r),i==null)return;let l=e.coordsAtPos(i);if(!l||r.y<l.top||r.y>l.bottom||r.x<l.left-e.defaultCharacterWidth||r.x>l.right+e.defaultCharacterWidth)return;let u=e.bidiSpans(e.state.doc.lineAt(i)).find(o=>o.from<=i&&o.to>=i),c=u&&u.dir==_t.RTL?-1:1;a=r.x<l.left?-c:c}let s=this.source(e,i,a);if(s!=null&&s.then){let l=this.pending={pos:i};s.then(u=>{this.pending==l&&(this.pending=null,u&&e.dispatch({effects:this.setHover.of(u)}))},u=>kr(e.state,u,"hover tooltip"))}else s&&e.dispatch({effects:this.setHover.of(s)})}get tooltip(){let e=this.view.plugin(Ph),r=e?e.manager.tooltips.findIndex(n=>n.create==ic.create):-1;return r>-1?e.manager.tooltipViews[r]:null}mousemove(e){var r;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let{active:n,tooltip:i}=this;if(n&&i&&!X4(i.dom,e)||this.pending){let{pos:a}=n||this.pending,s=(r=n==null?void 0:n.end)!==null&&r!==void 0?r:a;(a==s?this.view.posAtCoords(this.lastMove)!=a:!Q4(this.view,a,s,e.clientX,e.clientY))&&(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(e){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1;let{active:r}=this;if(r){let{tooltip:n}=this;n&&n.dom.contains(e.relatedTarget)?this.watchTooltipLeave(n.dom):this.view.dispatch({effects:this.setHover.of(null)})}}watchTooltipLeave(e){let r=n=>{e.removeEventListener("mouseleave",r),this.active&&!this.view.dom.contains(n.relatedTarget)&&this.view.dispatch({effects:this.setHover.of(null)})};e.addEventListener("mouseleave",r)}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}const oo=4;function X4(t,e){let r=t.getBoundingClientRect();return e.clientX>=r.left-oo&&e.clientX<=r.right+oo&&e.clientY>=r.top-oo&&e.clientY<=r.bottom+oo}function Q4(t,e,r,n,i,a){let s=t.scrollDOM.getBoundingClientRect(),l=t.documentTop+t.documentPadding.top+t.contentHeight;if(s.left>n||s.right<n||s.top>i||Math.min(s.bottom,l)<i)return!1;let u=t.posAtCoords({x:n,y:i},!1);return u>=e&&u<=r}function K4(t,e={}){let r=Ze.define(),n=rr.define({create(){return null},update(i,a){if(i&&(e.hideOnChange&&(a.docChanged||a.selection)||e.hideOn&&e.hideOn(a,i)))return null;if(i&&a.docChanged){let s=a.changes.mapPos(i.pos,-1,fr.TrackDel);if(s==null)return null;let l=Object.assign(Object.create(null),i);l.pos=s,i.end!=null&&(l.end=a.changes.mapPos(i.end)),i=l}for(let s of a.effects)s.is(r)&&(i=s.value),s.is(j4)&&(i=null);return i},provide:i=>Zo.from(i)});return[n,It.define(i=>new Y4(i,t,n,r,e.hoverTime||300)),q4]}function yy(t,e){let r=t.plugin(Ph);if(!r)return null;let n=r.manager.tooltips.indexOf(e);return n<0?null:r.manager.tooltipViews[n]}const j4=Ze.define(),Qg=$e.define({combine(t){let e,r;for(let n of t)e=e||n.topContainer,r=r||n.bottomContainer;return{topContainer:e,bottomContainer:r}}});function cs(t,e){let r=t.plugin(by),n=r?r.specs.indexOf(e):-1;return n>-1?r.panels[n]:null}const by=It.fromClass(class{constructor(t){this.input=t.state.facet(us),this.specs=this.input.filter(r=>r),this.panels=this.specs.map(r=>r(t));let e=t.state.facet(Qg);this.top=new lo(t,!0,e.topContainer),this.bottom=new lo(t,!1,e.bottomContainer),this.top.sync(this.panels.filter(r=>r.top)),this.bottom.sync(this.panels.filter(r=>!r.top));for(let r of this.panels)r.dom.classList.add("cm-panel"),r.mount&&r.mount()}update(t){let e=t.state.facet(Qg);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new lo(t.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new lo(t.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let r=t.state.facet(us);if(r!=this.input){let n=r.filter(u=>u),i=[],a=[],s=[],l=[];for(let u of n){let c=this.specs.indexOf(u),o;c<0?(o=u(t.view),l.push(o)):(o=this.panels[c],o.update&&o.update(t)),i.push(o),(o.top?a:s).push(o)}this.specs=n,this.panels=i,this.top.sync(a),this.bottom.sync(s);for(let u of l)u.dom.classList.add("cm-panel"),u.mount&&u.mount()}else for(let n of this.panels)n.update&&n.update(t)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:t=>Be.scrollMargins.of(e=>{let r=e.plugin(t);return r&&{top:r.top.scrollMargin(),bottom:r.bottom.scrollMargin()}})});class lo{constructor(e,r,n){this.view=e,this.top=r,this.container=n,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let r of this.panels)r.destroy&&e.indexOf(r)<0&&r.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let r=this.container||this.view.dom;r.insertBefore(this.dom,this.top?r.firstChild:null)}let e=this.dom.firstChild;for(let r of this.panels)if(r.dom.parentNode==this.dom){for(;e!=r.dom;)e=Kg(e);e=e.nextSibling}else this.dom.insertBefore(r.dom,e);for(;e;)e=Kg(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function Kg(t){let e=t.nextSibling;return t.remove(),e}const us=$e.define({enables:by});class Rn extends Ai{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}Rn.prototype.elementClass="";Rn.prototype.toDOM=void 0;Rn.prototype.mapMode=fr.TrackBefore;Rn.prototype.startSide=Rn.prototype.endSide=-1;Rn.prototype.point=!0;const Lo=$e.define(),Z4={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>ut.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Ja=$e.define();function J4(t){return[Ey(),Ja.of(Object.assign(Object.assign({},Z4),t))]}const mf=$e.define({combine:t=>t.some(e=>e)});function Ey(t){let e=[e9];return t&&t.fixed===!1&&e.push(mf.of(!0)),e}const e9=It.fromClass(class{constructor(t){this.view=t,this.prevViewport=t.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=t.state.facet(Ja).map(e=>new Zg(t,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!t.state.facet(mf),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),t.scrollDOM.insertBefore(this.dom,t.contentDOM)}update(t){if(this.updateGutters(t)){let e=this.prevViewport,r=t.view.viewport,n=Math.min(e.to,r.to)-Math.max(e.from,r.from);this.syncGutters(n<(r.to-r.from)*.8)}t.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(mf)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=t.view.viewport}syncGutters(t){let e=this.dom.nextSibling;t&&this.dom.remove();let r=ut.iter(this.view.state.facet(Lo),this.view.viewport.from),n=[],i=this.gutters.map(a=>new t9(a,this.view.viewport,-this.view.documentPadding.top));for(let a of this.view.viewportLineBlocks)if(n.length&&(n=[]),Array.isArray(a.type)){let s=!0;for(let l of a.type)if(l.type==hr.Text&&s){vf(r,n,l.from);for(let u of i)u.line(this.view,l,n);s=!1}else if(l.widget)for(let u of i)u.widget(this.view,l)}else if(a.type==hr.Text){vf(r,n,a.from);for(let s of i)s.line(this.view,a,n)}else if(a.widget)for(let s of i)s.widget(this.view,a);for(let a of i)a.finish();t&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(t){let e=t.startState.facet(Ja),r=t.state.facet(Ja),n=t.docChanged||t.heightChanged||t.viewportChanged||!ut.eq(t.startState.facet(Lo),t.state.facet(Lo),t.view.viewport.from,t.view.viewport.to);if(e==r)for(let i of this.gutters)i.update(t)&&(n=!0);else{n=!0;let i=[];for(let a of r){let s=e.indexOf(a);s<0?i.push(new Zg(this.view,a)):(this.gutters[s].update(t),i.push(this.gutters[s]))}for(let a of this.gutters)a.dom.remove(),i.indexOf(a)<0&&a.destroy();for(let a of i)this.dom.appendChild(a.dom);this.gutters=i}return n}destroy(){for(let t of this.gutters)t.destroy();this.dom.remove()}},{provide:t=>Be.scrollMargins.of(e=>{let r=e.plugin(t);return!r||r.gutters.length==0||!r.fixed?null:e.textDirection==_t.LTR?{left:r.dom.offsetWidth*e.scaleX}:{right:r.dom.offsetWidth*e.scaleX}})});function jg(t){return Array.isArray(t)?t:[t]}function vf(t,e,r){for(;t.value&&t.from<=r;)t.from==r&&e.push(t.value),t.next()}class t9{constructor(e,r,n){this.gutter=e,this.height=n,this.i=0,this.cursor=ut.iter(e.markers,r.from)}addElement(e,r,n){let{gutter:i}=this,a=(r.top-this.height)/e.scaleY,s=r.height/e.scaleY;if(this.i==i.elements.length){let l=new Oy(e,s,a,n);i.elements.push(l),i.dom.appendChild(l.dom)}else i.elements[this.i].update(e,s,a,n);this.height=r.bottom,this.i++}line(e,r,n){let i=[];vf(this.cursor,i,r.from),n.length&&(i=i.concat(n));let a=this.gutter.config.lineMarker(e,r,i);a&&i.unshift(a);let s=this.gutter;i.length==0&&!s.config.renderEmptyElements||this.addElement(e,r,i)}widget(e,r){let n=this.gutter.config.widgetMarker(e,r.widget,r);n&&this.addElement(e,r,[n])}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let r=e.elements.pop();e.dom.removeChild(r.dom),r.destroy()}}}class Zg{constructor(e,r){this.view=e,this.config=r,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let n in r.domEventHandlers)this.dom.addEventListener(n,i=>{let a=i.target,s;if(a!=this.dom&&this.dom.contains(a)){for(;a.parentNode!=this.dom;)a=a.parentNode;let u=a.getBoundingClientRect();s=(u.top+u.bottom)/2}else s=i.clientY;let l=e.lineBlockAtHeight(s-e.documentTop);r.domEventHandlers[n](e,l,i)&&i.preventDefault()});this.markers=jg(r.markers(e)),r.initialSpacer&&(this.spacer=new Oy(e,0,0,[r.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let r=this.markers;if(this.markers=jg(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let i=this.config.updateSpacer(this.spacer.markers[0],e);i!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[i])}let n=e.view.viewport;return!ut.eq(this.markers,r,n.from,n.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class Oy{constructor(e,r,n,i){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,r,n,i)}update(e,r,n,i){this.height!=r&&(this.height=r,this.dom.style.height=r+"px"),this.above!=n&&(this.dom.style.marginTop=(this.above=n)?n+"px":""),r9(this.markers,i)||this.setMarkers(e,i)}setMarkers(e,r){let n="cm-gutterElement",i=this.dom.firstChild;for(let a=0,s=0;;){let l=s,u=a<r.length?r[a++]:null,c=!1;if(u){let o=u.elementClass;o&&(n+=" "+o);for(let f=s;f<this.markers.length;f++)if(this.markers[f].compare(u)){l=f,c=!0;break}}else l=this.markers.length;for(;s<l;){let o=this.markers[s++];if(o.toDOM){o.destroy(i);let f=i.nextSibling;i.remove(),i=f}}if(!u)break;u.toDOM&&(c?i=i.nextSibling:this.dom.insertBefore(u.toDOM(e),i)),c&&s++}this.dom.className=n,this.markers=r}destroy(){this.setMarkers(null,[])}}function r9(t,e){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!t[r].compare(e[r]))return!1;return!0}const n9=$e.define(),Fi=$e.define({combine(t){return yn(t,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,r){let n=Object.assign({},e);for(let i in r){let a=n[i],s=r[i];n[i]=a?(l,u,c)=>a(l,u,c)||s(l,u,c):s}return n}})}});class Zc extends Rn{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function Jc(t,e){return t.state.facet(Fi).formatNumber(e,t.state)}const i9=Ja.compute([Fi],t=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(n9)},lineMarker(e,r,n){return n.some(i=>i.toDOM)?null:new Zc(Jc(e,e.state.doc.lineAt(r.from).number))},widgetMarker:()=>null,lineMarkerChange:e=>e.startState.facet(Fi)!=e.state.facet(Fi),initialSpacer(e){return new Zc(Jc(e,Jg(e.state.doc.lines)))},updateSpacer(e,r){let n=Jc(r.view,Jg(r.view.state.doc.lines));return n==e.number?e:new Zc(n)},domEventHandlers:t.facet(Fi).domEventHandlers}));function a9(t={}){return[Fi.of(t),Ey(),i9]}function Jg(t){let e=9;for(;e<t;)e=e*10+9;return e}const s9=new class extends Rn{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},o9=Lo.compute(["selection"],t=>{let e=[],r=-1;for(let n of t.selection.ranges){let i=t.doc.lineAt(n.head).from;i>r&&(r=i,e.push(s9.range(i)))}return ut.of(e)});function l9(){return o9}let c9=0;class Zr{constructor(e,r,n){this.set=e,this.base=r,this.modified=n,this.id=c9++}static define(e){if(e!=null&&e.base)throw new Error("Can not derive from a modified tag");let r=new Zr([],null,[]);if(r.set.push(r),e)for(let n of e.set)r.set.push(n);return r}static defineModifier(){let e=new Jo;return r=>r.modified.indexOf(e)>-1?r:Jo.get(r.base||r,r.modified.concat(e).sort((n,i)=>n.id-i.id))}}let u9=0;class Jo{constructor(){this.instances=[],this.id=u9++}static get(e,r){if(!r.length)return e;let n=r[0].instances.find(l=>l.base==e&&f9(r,l.modified));if(n)return n;let i=[],a=new Zr(i,e,r);for(let l of r)l.instances.push(a);let s=h9(r);for(let l of e.set)if(!l.modified.length)for(let u of s)i.push(Jo.get(l,u));return a}}function f9(t,e){return t.length==e.length&&t.every((r,n)=>r==e[n])}function h9(t){let e=[[]];for(let r=0;r<t.length;r++)for(let n=0,i=e.length;n<i;n++)e.push(e[n].concat(t[r]));return e.sort((r,n)=>n.length-r.length)}function Ay(t){let e=Object.create(null);for(let r in t){let n=t[r];Array.isArray(n)||(n=[n]);for(let i of r.split(" "))if(i){let a=[],s=2,l=i;for(let f=0;;){if(l=="..."&&f>0&&f+3==i.length){s=1;break}let h=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(l);if(!h)throw new RangeError("Invalid path: "+i);if(a.push(h[0]=="*"?"":h[0][0]=='"'?JSON.parse(h[0]):h[0]),f+=h[0].length,f==i.length)break;let d=i[f++];if(f==i.length&&d=="!"){s=0;break}if(d!="/")throw new RangeError("Invalid path: "+i);l=i.slice(f)}let u=a.length-1,c=a[u];if(!c)throw new RangeError("Invalid path: "+i);let o=new el(n,s,u>0?a.slice(0,u):null);e[c]=o.sort(e[c])}}return Cy.add(e)}const Cy=new nt;class el{constructor(e,r,n,i){this.tags=e,this.mode=r,this.context=n,this.next=i}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}el.empty=new el([],2,null);function wy(t,e){let r=Object.create(null);for(let a of t)if(!Array.isArray(a.tag))r[a.tag.id]=a.class;else for(let s of a.tag)r[s.id]=a.class;let{scope:n,all:i=null}=e||{};return{style:a=>{let s=i;for(let l of a)for(let u of l.set){let c=r[u.id];if(c){s=s?s+" "+c:c;break}}return s},scope:n}}function d9(t,e){let r=null;for(let n of t){let i=n.style(e);i&&(r=r?r+" "+i:i)}return r}function p9(t,e,r,n=0,i=t.length){let a=new g9(n,Array.isArray(e)?e:[e],r);a.highlightRange(t.cursor(),n,i,"",a.highlighters),a.flush(i)}class g9{constructor(e,r,n){this.at=e,this.highlighters=r,this.span=n,this.class=""}startSpan(e,r){r!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=r)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,r,n,i,a){let{type:s,from:l,to:u}=e;if(l>=n||u<=r)return;s.isTop&&(a=this.highlighters.filter(d=>!d.scope||d.scope(s)));let c=i,o=m9(e)||el.empty,f=d9(a,o.tags);if(f&&(c&&(c+=" "),c+=f,o.mode==1&&(i+=(i?" ":"")+f)),this.startSpan(Math.max(r,l),c),o.opaque)return;let h=e.tree&&e.tree.prop(nt.mounted);if(h&&h.overlay){let d=e.node.enter(h.overlay[0].from+l,1),p=this.highlighters.filter(m=>!m.scope||m.scope(h.tree.type)),g=e.firstChild();for(let m=0,v=l;;m++){let b=m<h.overlay.length?h.overlay[m]:null,C=b?b.from+l:u,A=Math.max(r,v),O=Math.min(n,C);if(A<O&&g)for(;e.from<O&&(this.highlightRange(e,A,O,i,a),this.startSpan(Math.min(O,e.to),c),!(e.to>=C||!e.nextSibling())););if(!b||C>n)break;v=b.to+l,v>r&&(this.highlightRange(d.cursor(),Math.max(r,b.from+l),Math.min(n,v),"",p),this.startSpan(Math.min(n,v),c))}g&&e.parent()}else if(e.firstChild()){h&&(i="");do if(!(e.to<=r)){if(e.from>=n)break;this.highlightRange(e,r,n,i,a),this.startSpan(Math.min(n,e.to),c)}while(e.nextSibling());e.parent()}}}function m9(t){let e=t.type.prop(Cy);for(;e&&e.context&&!t.matchContext(e.context);)e=e.next;return e||null}const xe=Zr.define,co=xe(),Dn=xe(),em=xe(Dn),tm=xe(Dn),Ln=xe(),uo=xe(Ln),eu=xe(Ln),jr=xe(),li=xe(jr),Qr=xe(),Kr=xe(),yf=xe(),Ua=xe(yf),fo=xe(),Se={comment:co,lineComment:xe(co),blockComment:xe(co),docComment:xe(co),name:Dn,variableName:xe(Dn),typeName:em,tagName:xe(em),propertyName:tm,attributeName:xe(tm),className:xe(Dn),labelName:xe(Dn),namespace:xe(Dn),macroName:xe(Dn),literal:Ln,string:uo,docString:xe(uo),character:xe(uo),attributeValue:xe(uo),number:eu,integer:xe(eu),float:xe(eu),bool:xe(Ln),regexp:xe(Ln),escape:xe(Ln),color:xe(Ln),url:xe(Ln),keyword:Qr,self:xe(Qr),null:xe(Qr),atom:xe(Qr),unit:xe(Qr),modifier:xe(Qr),operatorKeyword:xe(Qr),controlKeyword:xe(Qr),definitionKeyword:xe(Qr),moduleKeyword:xe(Qr),operator:Kr,derefOperator:xe(Kr),arithmeticOperator:xe(Kr),logicOperator:xe(Kr),bitwiseOperator:xe(Kr),compareOperator:xe(Kr),updateOperator:xe(Kr),definitionOperator:xe(Kr),typeOperator:xe(Kr),controlOperator:xe(Kr),punctuation:yf,separator:xe(yf),bracket:Ua,angleBracket:xe(Ua),squareBracket:xe(Ua),paren:xe(Ua),brace:xe(Ua),content:jr,heading:li,heading1:xe(li),heading2:xe(li),heading3:xe(li),heading4:xe(li),heading5:xe(li),heading6:xe(li),contentSeparator:xe(jr),list:xe(jr),quote:xe(jr),emphasis:xe(jr),strong:xe(jr),link:xe(jr),monospace:xe(jr),strikethrough:xe(jr),inserted:xe(),deleted:xe(),changed:xe(),invalid:xe(),meta:fo,documentMeta:xe(fo),annotation:xe(fo),processingInstruction:xe(fo),definition:Zr.defineModifier(),constant:Zr.defineModifier(),function:Zr.defineModifier(),standard:Zr.defineModifier(),local:Zr.defineModifier(),special:Zr.defineModifier()};wy([{tag:Se.link,class:"tok-link"},{tag:Se.heading,class:"tok-heading"},{tag:Se.emphasis,class:"tok-emphasis"},{tag:Se.strong,class:"tok-strong"},{tag:Se.keyword,class:"tok-keyword"},{tag:Se.atom,class:"tok-atom"},{tag:Se.bool,class:"tok-bool"},{tag:Se.url,class:"tok-url"},{tag:Se.labelName,class:"tok-labelName"},{tag:Se.inserted,class:"tok-inserted"},{tag:Se.deleted,class:"tok-deleted"},{tag:Se.literal,class:"tok-literal"},{tag:Se.string,class:"tok-string"},{tag:Se.number,class:"tok-number"},{tag:[Se.regexp,Se.escape,Se.special(Se.string)],class:"tok-string2"},{tag:Se.variableName,class:"tok-variableName"},{tag:Se.local(Se.variableName),class:"tok-variableName tok-local"},{tag:Se.definition(Se.variableName),class:"tok-variableName tok-definition"},{tag:Se.special(Se.variableName),class:"tok-variableName2"},{tag:Se.definition(Se.propertyName),class:"tok-propertyName tok-definition"},{tag:Se.typeName,class:"tok-typeName"},{tag:Se.namespace,class:"tok-namespace"},{tag:Se.className,class:"tok-className"},{tag:Se.macroName,class:"tok-macroName"},{tag:Se.propertyName,class:"tok-propertyName"},{tag:Se.operator,class:"tok-operator"},{tag:Se.comment,class:"tok-comment"},{tag:Se.meta,class:"tok-meta"},{tag:Se.invalid,class:"tok-invalid"},{tag:Se.punctuation,class:"tok-punctuation"}]);var tu;const Vi=new nt;function v9(t){return $e.define({combine:t?e=>e.concat(t):void 0})}const y9=new nt;class Vr{constructor(e,r,n=[],i=""){this.data=e,this.name=i,rt.prototype.hasOwnProperty("tree")||Object.defineProperty(rt.prototype,"tree",{get(){return tr(this)}}),this.parser=r,this.extension=[jn.of(this),rt.languageData.of((a,s,l)=>{let u=rm(a,s,l),c=u.type.prop(Vi);if(!c)return[];let o=a.facet(c),f=u.type.prop(y9);if(f){let h=u.resolve(s-u.from,l);for(let d of f)if(d.test(h,a)){let p=a.facet(d.facet);return d.type=="replace"?p:p.concat(o)}}return o})].concat(n)}isActiveAt(e,r,n=-1){return rm(e,r,n).type.prop(Vi)==this.data}findRegions(e){let r=e.facet(jn);if((r==null?void 0:r.data)==this.data)return[{from:0,to:e.doc.length}];if(!r||!r.allowsNesting)return[];let n=[],i=(a,s)=>{if(a.prop(Vi)==this.data){n.push({from:s,to:s+a.length});return}let l=a.prop(nt.mounted);if(l){if(l.tree.prop(Vi)==this.data){if(l.overlay)for(let u of l.overlay)n.push({from:u.from+s,to:u.to+s});else n.push({from:s,to:s+a.length});return}else if(l.overlay){let u=n.length;if(i(l.tree,l.overlay[0].from+s),n.length>u)return}}for(let u=0;u<a.children.length;u++){let c=a.children[u];c instanceof Vt&&i(c,a.positions[u]+s)}};return i(tr(e),0),n}get allowsNesting(){return!0}}Vr.setState=Ze.define();function rm(t,e,r){let n=t.facet(jn),i=tr(t).topNode;if(!n||n.allowsNesting)for(let a=i;a;a=a.enter(e,r,Xt.ExcludeBuffers))a.type.isTop&&(i=a);return i}class tl extends Vr{constructor(e,r,n){super(e,r,[],n),this.parser=r}static define(e){let r=v9(e.languageData);return new tl(r,e.parser.configure({props:[Vi.add(n=>n.isTop?r:void 0)]}),e.name)}configure(e,r){return new tl(this.data,this.parser.configure(e),r||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function tr(t){let e=t.field(Vr.state,!1);return e?e.tree:Vt.empty}class b9{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,r){let n=this.cursorPos-this.string.length;return e<n||r>=this.cursorPos?this.doc.sliceString(e,r):this.string.slice(e-n,r-n)}}let $a=null;class rl{constructor(e,r,n=[],i,a,s,l,u){this.parser=e,this.state=r,this.fragments=n,this.tree=i,this.treeLen=a,this.viewport=s,this.skipped=l,this.scheduleOn=u,this.parse=null,this.tempSkipped=[]}static create(e,r,n){return new rl(e,r,[],Vt.empty,0,n,[],null)}startParse(){return this.parser.startParse(new b9(this.state.doc),this.fragments)}work(e,r){return r!=null&&r>=this.state.doc.length&&(r=void 0),this.tree!=Vt.empty&&this.isDone(r??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var n;if(typeof e=="number"){let i=Date.now()+e;e=()=>Date.now()>i}for(this.parse||(this.parse=this.startParse()),r!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>r)&&r<this.state.doc.length&&this.parse.stopAt(r);;){let i=this.parse.advance();if(i)if(this.fragments=this.withoutTempSkipped(yi.addTree(i,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(n=this.parse.stoppedAt)!==null&&n!==void 0?n:this.state.doc.length,this.tree=i,this.parse=null,this.treeLen<(r??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,r;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(r=this.parse.advance()););}),this.treeLen=e,this.tree=r,this.fragments=this.withoutTempSkipped(yi.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let r=$a;$a=this;try{return e()}finally{$a=r}}withoutTempSkipped(e){for(let r;r=this.tempSkipped.pop();)e=nm(e,r.from,r.to);return e}changes(e,r){let{fragments:n,tree:i,treeLen:a,viewport:s,skipped:l}=this;if(this.takeTree(),!e.empty){let u=[];if(e.iterChangedRanges((c,o,f,h)=>u.push({fromA:c,toA:o,fromB:f,toB:h})),n=yi.applyChanges(n,u),i=Vt.empty,a=0,s={from:e.mapPos(s.from,-1),to:e.mapPos(s.to,1)},this.skipped.length){l=[];for(let c of this.skipped){let o=e.mapPos(c.from,1),f=e.mapPos(c.to,-1);o<f&&l.push({from:o,to:f})}}}return new rl(this.parser,r,n,i,a,s,l,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let r=this.skipped.length;for(let n=0;n<this.skipped.length;n++){let{from:i,to:a}=this.skipped[n];i<e.to&&a>e.from&&(this.fragments=nm(this.fragments,i,a),this.skipped.splice(n--,1))}return this.skipped.length>=r?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,r){this.skipped.push({from:e,to:r})}static getSkippingParser(e){return new class extends e1{createParse(r,n,i){let a=i[0].from,s=i[i.length-1].to;return{parsedPos:a,advance(){let u=$a;if(u){for(let c of i)u.tempSkipped.push(c);e&&(u.scheduleOn=u.scheduleOn?Promise.all([u.scheduleOn,e]):e)}return this.parsedPos=s,new Vt(yr.none,[],[],s-a)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let r=this.fragments;return this.treeLen>=e&&r.length&&r[0].from==0&&r[0].to>=e}static get(){return $a}}function nm(t,e,r){return yi.applyChanges(t,[{fromA:e,toA:r,fromB:e,toB:r}])}class ta{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let r=this.context.changes(e.changes,e.state),n=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),r.viewport.to);return r.work(20,n)||r.takeTree(),new ta(r)}static init(e){let r=Math.min(3e3,e.doc.length),n=rl.create(e.facet(jn).parser,e,{from:0,to:r});return n.work(20,r)||n.takeTree(),new ta(n)}}Vr.state=rr.define({create:ta.init,update(t,e){for(let r of e.effects)if(r.is(Vr.setState))return r.value;return e.startState.facet(jn)!=e.state.facet(jn)?ta.init(e.state):t.apply(e)}});let Sy=t=>{let e=setTimeout(()=>t(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(Sy=t=>{let e=-1,r=setTimeout(()=>{e=requestIdleCallback(t,{timeout:400})},100);return()=>e<0?clearTimeout(r):cancelIdleCallback(e)});const ru=typeof navigator<"u"&&(!((tu=navigator.scheduling)===null||tu===void 0)&&tu.isInputPending)?()=>navigator.scheduling.isInputPending():null,E9=It.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let r=this.view.state.field(Vr.state).context;(r.updateViewport(e.view.viewport)||this.view.viewport.to>r.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(r)}scheduleWork(){if(this.working)return;let{state:e}=this.view,r=e.field(Vr.state);(r.tree!=r.context.tree||!r.context.isDone(e.doc.length))&&(this.working=Sy(this.work))}work(e){this.working=null;let r=Date.now();if(this.chunkEnd<r&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=r+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:n,viewport:{to:i}}=this.view,a=n.field(Vr.state);if(a.tree==a.context.tree&&a.context.isDone(i+1e5))return;let s=Date.now()+Math.min(this.chunkBudget,100,e&&!ru?Math.max(25,e.timeRemaining()-5):1e9),l=a.context.treeLen<i&&n.doc.length>i+1e3,u=a.context.work(()=>ru&&ru()||Date.now()>s,i+(l?0:1e5));this.chunkBudget-=Date.now()-r,(u||this.chunkBudget<=0)&&(a.context.takeTree(),this.view.dispatch({effects:Vr.setState.of(new ta(a.context))})),this.chunkBudget>0&&!(u&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(a.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(r=>kr(this.view.state,r)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),jn=$e.define({combine(t){return t.length?t[0]:null},enables:t=>[Vr.state,E9,Be.contentAttributes.compute([t],e=>{let r=e.facet(t);return r&&r.name?{"data-language":r.name}:{}})]});class O9{constructor(e,r=[]){this.language=e,this.support=r,this.extension=[e,r]}}const A9=$e.define(),ac=$e.define({combine:t=>{if(!t.length)return"  ";let e=t[0];if(!e||/\S/.test(e)||Array.from(e).some(r=>r!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(t[0]));return e}});function nl(t){let e=t.facet(ac);return e.charCodeAt(0)==9?t.tabSize*e.length:e.length}function fs(t,e){let r="",n=t.tabSize,i=t.facet(ac)[0];if(i=="	"){for(;e>=n;)r+="	",e-=n;i=" "}for(let a=0;a<e;a++)r+=i;return r}function Dh(t,e){t instanceof rt&&(t=new sc(t));for(let n of t.state.facet(A9)){let i=n(t,e);if(i!==void 0)return i}let r=tr(t.state);return r.length>=e?C9(t,r,e):null}class sc{constructor(e,r={}){this.state=e,this.options=r,this.unit=nl(e)}lineAt(e,r=1){let n=this.state.doc.lineAt(e),{simulateBreak:i,simulateDoubleBreak:a}=this.options;return i!=null&&i>=n.from&&i<=n.to?a&&i==e?{text:"",from:e}:(r<0?i<e:i<=e)?{text:n.text.slice(i-n.from),from:i}:{text:n.text.slice(0,i-n.from),from:n.from}:n}textAfterPos(e,r=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:n,from:i}=this.lineAt(e,r);return n.slice(e-i,Math.min(n.length,e+100-i))}column(e,r=1){let{text:n,from:i}=this.lineAt(e,r),a=this.countColumn(n,e-i),s=this.options.overrideIndentation?this.options.overrideIndentation(i):-1;return s>-1&&(a+=s-this.countColumn(n,n.search(/\S|$/))),a}countColumn(e,r=e.length){return ba(e,this.state.tabSize,r)}lineIndent(e,r=1){let{text:n,from:i}=this.lineAt(e,r),a=this.options.overrideIndentation;if(a){let s=a(i);if(s>-1)return s}return this.countColumn(n,n.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const Ty=new nt;function C9(t,e,r){let n=e.resolveStack(r),i=n.node.enterUnfinishedNodesBefore(r);if(i!=n.node){let a=[];for(let s=i;s!=n.node;s=s.parent)a.push(s);for(let s=a.length-1;s>=0;s--)n={node:a[s],next:n}}return Ry(n,t,r)}function Ry(t,e,r){for(let n=t;n;n=n.next){let i=S9(n.node);if(i)return i(Lh.create(e,r,n))}return 0}function w9(t){return t.pos==t.options.simulateBreak&&t.options.simulateDoubleBreak}function S9(t){let e=t.type.prop(Ty);if(e)return e;let r=t.firstChild,n;if(r&&(n=r.type.prop(nt.closedBy))){let i=t.lastChild,a=i&&n.indexOf(i.name)>-1;return s=>Ny(s,!0,1,void 0,a&&!w9(s)?i.from:void 0)}return t.parent==null?T9:null}function T9(){return 0}class Lh extends sc{constructor(e,r,n){super(e.state,e.options),this.base=e,this.pos=r,this.context=n}get node(){return this.context.node}static create(e,r,n){return new Lh(e,r,n)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let r=this.state.doc.lineAt(e.from);for(;;){let n=e.resolve(r.from);for(;n.parent&&n.parent.from==n.from;)n=n.parent;if(R9(n,e))break;r=this.state.doc.lineAt(n.from)}return this.lineIndent(r.from)}continue(){return Ry(this.context.next,this.base,this.pos)}}function R9(t,e){for(let r=e;r;r=r.parent)if(t==r)return!0;return!1}function N9(t){let e=t.node,r=e.childAfter(e.from),n=e.lastChild;if(!r)return null;let i=t.options.simulateBreak,a=t.state.doc.lineAt(r.from),s=i==null||i<=a.from?a.to:Math.min(a.to,i);for(let l=r.to;;){let u=e.childAfter(l);if(!u||u==n)return null;if(!u.type.isSkipped)return u.from<s?r:null;l=u.to}}function x9({closing:t,align:e=!0,units:r=1}){return n=>Ny(n,e,r,t)}function Ny(t,e,r,n,i){let a=t.textAfter,s=a.match(/^\s*/)[0].length,l=n&&a.slice(s,s+n.length)==n||i==t.pos+s,u=e?N9(t):null;return u?l?t.column(u.from):t.column(u.to):t.baseIndent+(l?0:t.unit*r)}const M9=200;function _9(){return rt.transactionFilter.of(t=>{if(!t.docChanged||!t.isUserEvent("input.type")&&!t.isUserEvent("input.complete"))return t;let e=t.startState.languageDataAt("indentOnInput",t.startState.selection.main.head);if(!e.length)return t;let r=t.newDoc,{head:n}=t.newSelection.main,i=r.lineAt(n);if(n>i.from+M9)return t;let a=r.sliceString(i.from,n);if(!e.some(c=>c.test(a)))return t;let{state:s}=t,l=-1,u=[];for(let{head:c}of s.selection.ranges){let o=s.doc.lineAt(c);if(o.from==l)continue;l=o.from;let f=Dh(s,o.from);if(f==null)continue;let h=/^\s*/.exec(o.text)[0],d=fs(s,f);h!=d&&u.push({from:o.from,to:o.from+h.length,insert:d})}return u.length?[t,{changes:u,sequential:!0}]:t})}const k9=$e.define(),xy=new nt;function P9(t){let e=t.firstChild,r=t.lastChild;return e&&e.to<r.from?{from:e.to,to:r.type.isError?t.to:r.from}:null}function I9(t,e,r){let n=tr(t);if(n.length<r)return null;let i=n.resolveStack(r,1),a=null;for(let s=i;s;s=s.next){let l=s.node;if(l.to<=r||l.from>r)continue;if(a&&l.from<e)break;let u=l.type.prop(xy);if(u&&(l.to<n.length-50||n.length==t.doc.length||!D9(l))){let c=u(l,t);c&&c.from<=r&&c.from>=e&&c.to>r&&(a=c)}}return a}function D9(t){let e=t.lastChild;return e&&e.to==t.to&&e.type.isError}function il(t,e,r){for(let n of t.facet(k9)){let i=n(t,e,r);if(i)return i}return I9(t,e,r)}function My(t,e){let r=e.mapPos(t.from,1),n=e.mapPos(t.to,-1);return r>=n?void 0:{from:r,to:n}}const oc=Ze.define({map:My}),Ds=Ze.define({map:My});function _y(t){let e=[];for(let{head:r}of t.state.selection.ranges)e.some(n=>n.from<=r&&n.to>=r)||e.push(t.lineBlockAt(r));return e}const wi=rr.define({create(){return qe.none},update(t,e){t=t.map(e.changes);for(let r of e.effects)if(r.is(oc)&&!L9(t,r.value.from,r.value.to)){let{preparePlaceholder:n}=e.state.facet(Bh),i=n?qe.replace({widget:new H9(n(e.state,r.value))}):im;t=t.update({add:[i.range(r.value.from,r.value.to)]})}else r.is(Ds)&&(t=t.update({filter:(n,i)=>r.value.from!=n||r.value.to!=i,filterFrom:r.value.from,filterTo:r.value.to}));if(e.selection){let r=!1,{head:n}=e.selection.main;t.between(n,n,(i,a)=>{i<n&&a>n&&(r=!0)}),r&&(t=t.update({filterFrom:n,filterTo:n,filter:(i,a)=>a<=n||i>=n}))}return t},provide:t=>Be.decorations.from(t),toJSON(t,e){let r=[];return t.between(0,e.doc.length,(n,i)=>{r.push(n,i)}),r},fromJSON(t){if(!Array.isArray(t)||t.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let r=0;r<t.length;){let n=t[r++],i=t[r++];if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid JSON for fold state");e.push(im.range(n,i))}return qe.set(e,!0)}});function al(t,e,r){var n;let i=null;return(n=t.field(wi,!1))===null||n===void 0||n.between(e,r,(a,s)=>{(!i||i.from>a)&&(i={from:a,to:s})}),i}function L9(t,e,r){let n=!1;return t.between(e,e,(i,a)=>{i==e&&a==r&&(n=!0)}),n}function ky(t,e){return t.field(wi,!1)?e:e.concat(Ze.appendConfig.of(Iy()))}const B9=t=>{for(let e of _y(t)){let r=il(t.state,e.from,e.to);if(r)return t.dispatch({effects:ky(t.state,[oc.of(r),Py(t,r)])}),!0}return!1},U9=t=>{if(!t.state.field(wi,!1))return!1;let e=[];for(let r of _y(t)){let n=al(t.state,r.from,r.to);n&&e.push(Ds.of(n),Py(t,n,!1))}return e.length&&t.dispatch({effects:e}),e.length>0};function Py(t,e,r=!0){let n=t.state.doc.lineAt(e.from).number,i=t.state.doc.lineAt(e.to).number;return Be.announce.of(`${t.state.phrase(r?"Folded lines":"Unfolded lines")} ${n} ${t.state.phrase("to")} ${i}.`)}const $9=t=>{let{state:e}=t,r=[];for(let n=0;n<e.doc.length;){let i=t.lineBlockAt(n),a=il(e,i.from,i.to);a&&r.push(oc.of(a)),n=(a?t.lineBlockAt(a.to):i).to+1}return r.length&&t.dispatch({effects:ky(t.state,r)}),!!r.length},F9=t=>{let e=t.state.field(wi,!1);if(!e||!e.size)return!1;let r=[];return e.between(0,t.state.doc.length,(n,i)=>{r.push(Ds.of({from:n,to:i}))}),t.dispatch({effects:r}),!0},V9=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:B9},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:U9},{key:"Ctrl-Alt-[",run:$9},{key:"Ctrl-Alt-]",run:F9}],W9={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},Bh=$e.define({combine(t){return yn(t,W9)}});function Iy(t){let e=[wi,q9];return t&&e.push(Bh.of(t)),e}function Dy(t,e){let{state:r}=t,n=r.facet(Bh),i=s=>{let l=t.lineBlockAt(t.posAtDOM(s.target)),u=al(t.state,l.from,l.to);u&&t.dispatch({effects:Ds.of(u)}),s.preventDefault()};if(n.placeholderDOM)return n.placeholderDOM(t,i,e);let a=document.createElement("span");return a.textContent=n.placeholderText,a.setAttribute("aria-label",r.phrase("folded code")),a.title=r.phrase("unfold"),a.className="cm-foldPlaceholder",a.onclick=i,a}const im=qe.replace({widget:new class extends kn{toDOM(t){return Dy(t,null)}}});class H9 extends kn{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return Dy(e,this.value)}}const G9={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class nu extends Rn{constructor(e,r){super(),this.config=e,this.open=r}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let r=document.createElement("span");return r.textContent=this.open?this.config.openText:this.config.closedText,r.title=e.state.phrase(this.open?"Fold line":"Unfold line"),r}}function z9(t={}){let e=Object.assign(Object.assign({},G9),t),r=new nu(e,!0),n=new nu(e,!1),i=It.fromClass(class{constructor(s){this.from=s.viewport.from,this.markers=this.buildMarkers(s)}update(s){(s.docChanged||s.viewportChanged||s.startState.facet(jn)!=s.state.facet(jn)||s.startState.field(wi,!1)!=s.state.field(wi,!1)||tr(s.startState)!=tr(s.state)||e.foldingChanged(s))&&(this.markers=this.buildMarkers(s.view))}buildMarkers(s){let l=new Yn;for(let u of s.viewportLineBlocks){let c=al(s.state,u.from,u.to)?n:il(s.state,u.from,u.to)?r:null;c&&l.add(u.from,u.from,c)}return l.finish()}}),{domEventHandlers:a}=e;return[i,J4({class:"cm-foldGutter",markers(s){var l;return((l=s.plugin(i))===null||l===void 0?void 0:l.markers)||ut.empty},initialSpacer(){return new nu(e,!1)},domEventHandlers:Object.assign(Object.assign({},a),{click:(s,l,u)=>{if(a.click&&a.click(s,l,u))return!0;let c=al(s.state,l.from,l.to);if(c)return s.dispatch({effects:Ds.of(c)}),!0;let o=il(s.state,l.from,l.to);return o?(s.dispatch({effects:oc.of(o)}),!0):!1}})}),Iy()]}const q9=Be.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class Ls{constructor(e,r){this.specs=e;let n;function i(l){let u=Xn.newName();return(n||(n=Object.create(null)))["."+u]=l,u}const a=typeof r.all=="string"?r.all:r.all?i(r.all):void 0,s=r.scope;this.scope=s instanceof Vr?l=>l.prop(Vi)==s.data:s?l=>l==s:void 0,this.style=wy(e.map(l=>({tag:l.tag,class:l.class||i(Object.assign({},l,{tag:null}))})),{all:a}).style,this.module=n?new Xn(n):null,this.themeType=r.themeType}static define(e,r){return new Ls(e,r||{})}}const bf=$e.define(),Ly=$e.define({combine(t){return t.length?[t[0]]:null}});function iu(t){let e=t.facet(bf);return e.length?e:t.facet(Ly)}function By(t,e){let r=[X9],n;return t instanceof Ls&&(t.module&&r.push(Be.styleModule.of(t.module)),n=t.themeType),e!=null&&e.fallback?r.push(Ly.of(t)):n?r.push(bf.computeN([Be.darkTheme],i=>i.facet(Be.darkTheme)==(n=="dark")?[t]:[])):r.push(bf.of(t)),r}class Y9{constructor(e){this.markCache=Object.create(null),this.tree=tr(e.state),this.decorations=this.buildDeco(e,iu(e.state))}update(e){let r=tr(e.state),n=iu(e.state),i=n!=iu(e.startState);r.length<e.view.viewport.to&&!i&&r.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(r!=this.tree||e.viewportChanged||i)&&(this.tree=r,this.decorations=this.buildDeco(e.view,n))}buildDeco(e,r){if(!r||!this.tree.length)return qe.none;let n=new Yn;for(let{from:i,to:a}of e.visibleRanges)p9(this.tree,r,(s,l,u)=>{n.add(s,l,this.markCache[u]||(this.markCache[u]=qe.mark({class:u})))},i,a);return n.finish()}}const X9=ya.high(It.fromClass(Y9,{decorations:t=>t.decorations})),Q9=Ls.define([{tag:Se.meta,color:"#404740"},{tag:Se.link,textDecoration:"underline"},{tag:Se.heading,textDecoration:"underline",fontWeight:"bold"},{tag:Se.emphasis,fontStyle:"italic"},{tag:Se.strong,fontWeight:"bold"},{tag:Se.strikethrough,textDecoration:"line-through"},{tag:Se.keyword,color:"#708"},{tag:[Se.atom,Se.bool,Se.url,Se.contentSeparator,Se.labelName],color:"#219"},{tag:[Se.literal,Se.inserted],color:"#164"},{tag:[Se.string,Se.deleted],color:"#a11"},{tag:[Se.regexp,Se.escape,Se.special(Se.string)],color:"#e40"},{tag:Se.definition(Se.variableName),color:"#00f"},{tag:Se.local(Se.variableName),color:"#30a"},{tag:[Se.typeName,Se.namespace],color:"#085"},{tag:Se.className,color:"#167"},{tag:[Se.special(Se.variableName),Se.macroName],color:"#256"},{tag:Se.definition(Se.propertyName),color:"#00c"},{tag:Se.comment,color:"#940"},{tag:Se.invalid,color:"#f00"}]),K9=Be.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),Uy=1e4,$y="()[]{}",Fy=$e.define({combine(t){return yn(t,{afterCursor:!0,brackets:$y,maxScanDistance:Uy,renderMatch:J9})}}),j9=qe.mark({class:"cm-matchingBracket"}),Z9=qe.mark({class:"cm-nonmatchingBracket"});function J9(t){let e=[],r=t.matched?j9:Z9;return e.push(r.range(t.start.from,t.start.to)),t.end&&e.push(r.range(t.end.from,t.end.to)),e}const e8=rr.define({create(){return qe.none},update(t,e){if(!e.docChanged&&!e.selection)return t;let r=[],n=e.state.facet(Fy);for(let i of e.state.selection.ranges){if(!i.empty)continue;let a=sn(e.state,i.head,-1,n)||i.head>0&&sn(e.state,i.head-1,1,n)||n.afterCursor&&(sn(e.state,i.head,1,n)||i.head<e.state.doc.length&&sn(e.state,i.head+1,-1,n));a&&(r=r.concat(n.renderMatch(a,e.state)))}return qe.set(r,!0)},provide:t=>Be.decorations.from(t)}),t8=[e8,K9];function r8(t={}){return[Fy.of(t),t8]}const n8=new nt;function Ef(t,e,r){let n=t.prop(e<0?nt.openedBy:nt.closedBy);if(n)return n;if(t.name.length==1){let i=r.indexOf(t.name);if(i>-1&&i%2==(e<0?1:0))return[r[i+e]]}return null}function Of(t){let e=t.type.prop(n8);return e?e(t.node):t}function sn(t,e,r,n={}){let i=n.maxScanDistance||Uy,a=n.brackets||$y,s=tr(t),l=s.resolveInner(e,r);for(let u=l;u;u=u.parent){let c=Ef(u.type,r,a);if(c&&u.from<u.to){let o=Of(u);if(o&&(r>0?e>=o.from&&e<o.to:e>o.from&&e<=o.to))return i8(t,e,r,u,o,c,a)}}return a8(t,e,r,s,l.type,i,a)}function i8(t,e,r,n,i,a,s){let l=n.parent,u={from:i.from,to:i.to},c=0,o=l==null?void 0:l.cursor();if(o&&(r<0?o.childBefore(n.from):o.childAfter(n.to)))do if(r<0?o.to<=n.from:o.from>=n.to){if(c==0&&a.indexOf(o.type.name)>-1&&o.from<o.to){let f=Of(o);return{start:u,end:f?{from:f.from,to:f.to}:void 0,matched:!0}}else if(Ef(o.type,r,s))c++;else if(Ef(o.type,-r,s)){if(c==0){let f=Of(o);return{start:u,end:f&&f.from<f.to?{from:f.from,to:f.to}:void 0,matched:!1}}c--}}while(r<0?o.prevSibling():o.nextSibling());return{start:u,matched:!1}}function a8(t,e,r,n,i,a,s){let l=r<0?t.sliceDoc(e-1,e):t.sliceDoc(e,e+1),u=s.indexOf(l);if(u<0||u%2==0!=r>0)return null;let c={from:r<0?e-1:e,to:r>0?e+1:e},o=t.doc.iterRange(e,r>0?t.doc.length:0),f=0;for(let h=0;!o.next().done&&h<=a;){let d=o.value;r<0&&(h+=d.length);let p=e+h*r;for(let g=r>0?0:d.length-1,m=r>0?d.length:-1;g!=m;g+=r){let v=s.indexOf(d[g]);if(!(v<0||n.resolveInner(p+g,1).type!=i))if(v%2==0==r>0)f++;else{if(f==1)return{start:c,end:{from:p+g,to:p+g+1},matched:v>>1==u>>1};f--}}r>0&&(h+=d.length)}return o.done?{start:c,matched:!1}:null}const s8=Object.create(null),am=[yr.none],sm=[],om=Object.create(null),o8=Object.create(null);for(let[t,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])o8[t]=l8(s8,e);function au(t,e){sm.indexOf(t)>-1||(sm.push(t),console.warn(e))}function l8(t,e){let r=[];for(let l of e.split(" ")){let u=[];for(let c of l.split(".")){let o=t[c]||Se[c];o?typeof o=="function"?u.length?u=u.map(o):au(c,`Modifier ${c} used at start of tag`):u.length?au(c,`Tag ${c} used as modifier`):u=Array.isArray(o)?o:[o]:au(c,`Unknown highlighting tag ${c}`)}for(let c of u)r.push(c)}if(!r.length)return 0;let n=e.replace(/ /g,"_"),i=n+" "+r.map(l=>l.id),a=om[i];if(a)return a.id;let s=om[i]=yr.define({id:am.length,name:n,props:[Ay({[n]:r})]});return am.push(s),s.id}const c8=t=>{let{state:e}=t,r=e.doc.lineAt(e.selection.main.from),n=$h(t.state,r.from);return n.line?u8(t):n.block?h8(t):!1};function Uh(t,e){return({state:r,dispatch:n})=>{if(r.readOnly)return!1;let i=t(e,r);return i?(n(r.update(i)),!0):!1}}const u8=Uh(g8,0),f8=Uh(Vy,0),h8=Uh((t,e)=>Vy(t,e,p8(e)),0);function $h(t,e){let r=t.languageDataAt("commentTokens",e);return r.length?r[0]:{}}const Fa=50;function d8(t,{open:e,close:r},n,i){let a=t.sliceDoc(n-Fa,n),s=t.sliceDoc(i,i+Fa),l=/\s*$/.exec(a)[0].length,u=/^\s*/.exec(s)[0].length,c=a.length-l;if(a.slice(c-e.length,c)==e&&s.slice(u,u+r.length)==r)return{open:{pos:n-l,margin:l&&1},close:{pos:i+u,margin:u&&1}};let o,f;i-n<=2*Fa?o=f=t.sliceDoc(n,i):(o=t.sliceDoc(n,n+Fa),f=t.sliceDoc(i-Fa,i));let h=/^\s*/.exec(o)[0].length,d=/\s*$/.exec(f)[0].length,p=f.length-d-r.length;return o.slice(h,h+e.length)==e&&f.slice(p,p+r.length)==r?{open:{pos:n+h+e.length,margin:/\s/.test(o.charAt(h+e.length))?1:0},close:{pos:i-d-r.length,margin:/\s/.test(f.charAt(p-1))?1:0}}:null}function p8(t){let e=[];for(let r of t.selection.ranges){let n=t.doc.lineAt(r.from),i=r.to<=n.to?n:t.doc.lineAt(r.to),a=e.length-1;a>=0&&e[a].to>n.from?e[a].to=i.to:e.push({from:n.from+/^\s*/.exec(n.text)[0].length,to:i.to})}return e}function Vy(t,e,r=e.selection.ranges){let n=r.map(a=>$h(e,a.from).block);if(!n.every(a=>a))return null;let i=r.map((a,s)=>d8(e,n[s],a.from,a.to));if(t!=2&&!i.every(a=>a))return{changes:e.changes(r.map((a,s)=>i[s]?[]:[{from:a.from,insert:n[s].open+" "},{from:a.to,insert:" "+n[s].close}]))};if(t!=1&&i.some(a=>a)){let a=[];for(let s=0,l;s<i.length;s++)if(l=i[s]){let u=n[s],{open:c,close:o}=l;a.push({from:c.pos-u.open.length,to:c.pos+c.margin},{from:o.pos-o.margin,to:o.pos+u.close.length})}return{changes:a}}return null}function g8(t,e,r=e.selection.ranges){let n=[],i=-1;for(let{from:a,to:s}of r){let l=n.length,u=1e9,c=$h(e,a).line;if(c){for(let o=a;o<=s;){let f=e.doc.lineAt(o);if(f.from>i&&(a==s||s>f.from)){i=f.from;let h=/^\s*/.exec(f.text)[0].length,d=h==f.length,p=f.text.slice(h,h+c.length)==c?h:-1;h<f.text.length&&h<u&&(u=h),n.push({line:f,comment:p,token:c,indent:h,empty:d,single:!1})}o=f.to+1}if(u<1e9)for(let o=l;o<n.length;o++)n[o].indent<n[o].line.text.length&&(n[o].indent=u);n.length==l+1&&(n[l].single=!0)}}if(t!=2&&n.some(a=>a.comment<0&&(!a.empty||a.single))){let a=[];for(let{line:l,token:u,indent:c,empty:o,single:f}of n)(f||!o)&&a.push({from:l.from+c,insert:u+" "});let s=e.changes(a);return{changes:s,selection:e.selection.map(s,1)}}else if(t!=1&&n.some(a=>a.comment>=0)){let a=[];for(let{line:s,comment:l,token:u}of n)if(l>=0){let c=s.from+l,o=c+u.length;s.text[o-s.from]==" "&&o++,a.push({from:c,to:o})}return{changes:a}}return null}const Af=_n.define(),m8=_n.define(),v8=$e.define(),Wy=$e.define({combine(t){return yn(t,{minDepth:100,newGroupDelay:500,joinToEvent:(e,r)=>r},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,r)=>(n,i)=>e(n,i)||r(n,i)})}}),Hy=rr.define({create(){return on.empty},update(t,e){let r=e.state.facet(Wy),n=e.annotation(Af);if(n){let u=vr.fromTransaction(e,n.selection),c=n.side,o=c==0?t.undone:t.done;return u?o=sl(o,o.length,r.minDepth,u):o=qy(o,e.startState.selection),new on(c==0?n.rest:o,c==0?o:n.rest)}let i=e.annotation(m8);if((i=="full"||i=="before")&&(t=t.isolate()),e.annotation(zt.addToHistory)===!1)return e.changes.empty?t:t.addMapping(e.changes.desc);let a=vr.fromTransaction(e),s=e.annotation(zt.time),l=e.annotation(zt.userEvent);return a?t=t.addChanges(a,s,l,r,e):e.selection&&(t=t.addSelection(e.startState.selection,s,l,r.newGroupDelay)),(i=="full"||i=="after")&&(t=t.isolate()),t},toJSON(t){return{done:t.done.map(e=>e.toJSON()),undone:t.undone.map(e=>e.toJSON())}},fromJSON(t){return new on(t.done.map(vr.fromJSON),t.undone.map(vr.fromJSON))}});function y8(t={}){return[Hy,Wy.of(t),Be.domEventHandlers({beforeinput(e,r){let n=e.inputType=="historyUndo"?Gy:e.inputType=="historyRedo"?Cf:null;return n?(e.preventDefault(),n(r)):!1}})]}function lc(t,e){return function({state:r,dispatch:n}){if(!e&&r.readOnly)return!1;let i=r.field(Hy,!1);if(!i)return!1;let a=i.pop(t,r,e);return a?(n(a),!0):!1}}const Gy=lc(0,!1),Cf=lc(1,!1),b8=lc(0,!0),E8=lc(1,!0);class vr{constructor(e,r,n,i,a){this.changes=e,this.effects=r,this.mapped=n,this.startSelection=i,this.selectionsAfter=a}setSelAfter(e){return new vr(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,r,n;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(r=this.mapped)===null||r===void 0?void 0:r.toJSON(),startSelection:(n=this.startSelection)===null||n===void 0?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map(i=>i.toJSON())}}static fromJSON(e){return new vr(e.changes&&Gt.fromJSON(e.changes),[],e.mapped&&ln.fromJSON(e.mapped),e.startSelection&&Ee.fromJSON(e.startSelection),e.selectionsAfter.map(Ee.fromJSON))}static fromTransaction(e,r){let n=Mr;for(let i of e.startState.facet(v8)){let a=i(e);a.length&&(n=n.concat(a))}return!n.length&&e.changes.empty?null:new vr(e.changes.invert(e.startState.doc),n,void 0,r||e.startState.selection,Mr)}static selection(e){return new vr(void 0,Mr,void 0,void 0,e)}}function sl(t,e,r,n){let i=e+1>r+20?e-r-1:0,a=t.slice(i,e);return a.push(n),a}function O8(t,e){let r=[],n=!1;return t.iterChangedRanges((i,a)=>r.push(i,a)),e.iterChangedRanges((i,a,s,l)=>{for(let u=0;u<r.length;){let c=r[u++],o=r[u++];l>=c&&s<=o&&(n=!0)}}),n}function A8(t,e){return t.ranges.length==e.ranges.length&&t.ranges.filter((r,n)=>r.empty!=e.ranges[n].empty).length===0}function zy(t,e){return t.length?e.length?t.concat(e):t:e}const Mr=[],C8=200;function qy(t,e){if(t.length){let r=t[t.length-1],n=r.selectionsAfter.slice(Math.max(0,r.selectionsAfter.length-C8));return n.length&&n[n.length-1].eq(e)?t:(n.push(e),sl(t,t.length-1,1e9,r.setSelAfter(n)))}else return[vr.selection([e])]}function w8(t){let e=t[t.length-1],r=t.slice();return r[t.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),r}function su(t,e){if(!t.length)return t;let r=t.length,n=Mr;for(;r;){let i=S8(t[r-1],e,n);if(i.changes&&!i.changes.empty||i.effects.length){let a=t.slice(0,r);return a[r-1]=i,a}else e=i.mapped,r--,n=i.selectionsAfter}return n.length?[vr.selection(n)]:Mr}function S8(t,e,r){let n=zy(t.selectionsAfter.length?t.selectionsAfter.map(l=>l.map(e)):Mr,r);if(!t.changes)return vr.selection(n);let i=t.changes.map(e),a=e.mapDesc(t.changes,!0),s=t.mapped?t.mapped.composeDesc(a):a;return new vr(i,Ze.mapEffects(t.effects,e),s,t.startSelection.map(a),n)}const T8=/^(input\.type|delete)($|\.)/;class on{constructor(e,r,n=0,i=void 0){this.done=e,this.undone=r,this.prevTime=n,this.prevUserEvent=i}isolate(){return this.prevTime?new on(this.done,this.undone):this}addChanges(e,r,n,i,a){let s=this.done,l=s[s.length-1];return l&&l.changes&&!l.changes.empty&&e.changes&&(!n||T8.test(n))&&(!l.selectionsAfter.length&&r-this.prevTime<i.newGroupDelay&&i.joinToEvent(a,O8(l.changes,e.changes))||n=="input.type.compose")?s=sl(s,s.length-1,i.minDepth,new vr(e.changes.compose(l.changes),zy(e.effects,l.effects),l.mapped,l.startSelection,Mr)):s=sl(s,s.length,i.minDepth,e),new on(s,Mr,r,n)}addSelection(e,r,n,i){let a=this.done.length?this.done[this.done.length-1].selectionsAfter:Mr;return a.length>0&&r-this.prevTime<i&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&A8(a[a.length-1],e)?this:new on(qy(this.done,e),this.undone,r,n)}addMapping(e){return new on(su(this.done,e),su(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,r,n){let i=e==0?this.done:this.undone;if(i.length==0)return null;let a=i[i.length-1],s=a.selectionsAfter[0]||r.selection;if(n&&a.selectionsAfter.length)return r.update({selection:a.selectionsAfter[a.selectionsAfter.length-1],annotations:Af.of({side:e,rest:w8(i),selection:s}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(a.changes){let l=i.length==1?Mr:i.slice(0,i.length-1);return a.mapped&&(l=su(l,a.mapped)),r.update({changes:a.changes,selection:a.startSelection,effects:a.effects,annotations:Af.of({side:e,rest:l,selection:s}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}on.empty=new on(Mr,Mr);const R8=[{key:"Mod-z",run:Gy,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Cf,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Cf,preventDefault:!0},{key:"Mod-u",run:b8,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:E8,preventDefault:!0}];function Ea(t,e){return Ee.create(t.ranges.map(e),t.mainIndex)}function bn(t,e){return t.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function qr({state:t,dispatch:e},r){let n=Ea(t.selection,r);return n.eq(t.selection)?!1:(e(bn(t,n)),!0)}function cc(t,e){return Ee.cursor(e?t.to:t.from)}function Yy(t,e){return qr(t,r=>r.empty?t.moveByChar(r,e):cc(r,e))}function cr(t){return t.textDirectionAt(t.state.selection.main.head)==_t.LTR}const Xy=t=>Yy(t,!cr(t)),Qy=t=>Yy(t,cr(t));function Ky(t,e){return qr(t,r=>r.empty?t.moveByGroup(r,e):cc(r,e))}const N8=t=>Ky(t,!cr(t)),x8=t=>Ky(t,cr(t));function M8(t,e,r){if(e.type.prop(r))return!0;let n=e.to-e.from;return n&&(n>2||/[^\s,.;:]/.test(t.sliceDoc(e.from,e.to)))||e.firstChild}function uc(t,e,r){let n=tr(t).resolveInner(e.head),i=r?nt.closedBy:nt.openedBy;for(let u=e.head;;){let c=r?n.childAfter(u):n.childBefore(u);if(!c)break;M8(t,c,i)?n=c:u=r?c.to:c.from}let a=n.type.prop(i),s,l;return a&&(s=r?sn(t,n.from,1):sn(t,n.to,-1))&&s.matched?l=r?s.end.to:s.end.from:l=r?n.to:n.from,Ee.cursor(l,r?-1:1)}const _8=t=>qr(t,e=>uc(t.state,e,!cr(t))),k8=t=>qr(t,e=>uc(t.state,e,cr(t)));function jy(t,e){return qr(t,r=>{if(!r.empty)return cc(r,e);let n=t.moveVertically(r,e);return n.head!=r.head?n:t.moveToLineBoundary(r,e)})}const Zy=t=>jy(t,!1),Jy=t=>jy(t,!0);function eb(t){let e=t.scrollDOM.clientHeight<t.scrollDOM.scrollHeight-2,r=0,n=0,i;if(e){for(let a of t.state.facet(Be.scrollMargins)){let s=a(t);s!=null&&s.top&&(r=Math.max(s==null?void 0:s.top,r)),s!=null&&s.bottom&&(n=Math.max(s==null?void 0:s.bottom,n))}i=t.scrollDOM.clientHeight-r-n}else i=(t.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:r,marginBottom:n,selfScroll:e,height:Math.max(t.defaultLineHeight,i-5)}}function tb(t,e){let r=eb(t),{state:n}=t,i=Ea(n.selection,s=>s.empty?t.moveVertically(s,e,r.height):cc(s,e));if(i.eq(n.selection))return!1;let a;if(r.selfScroll){let s=t.coordsAtPos(n.selection.main.head),l=t.scrollDOM.getBoundingClientRect(),u=l.top+r.marginTop,c=l.bottom-r.marginBottom;s&&s.top>u&&s.bottom<c&&(a=Be.scrollIntoView(i.main.head,{y:"start",yMargin:s.top-u}))}return t.dispatch(bn(n,i),{effects:a}),!0}const lm=t=>tb(t,!1),wf=t=>tb(t,!0);function ei(t,e,r){let n=t.lineBlockAt(e.head),i=t.moveToLineBoundary(e,r);if(i.head==e.head&&i.head!=(r?n.to:n.from)&&(i=t.moveToLineBoundary(e,r,!1)),!r&&i.head==n.from&&n.length){let a=/^\s*/.exec(t.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;a&&e.head!=n.from+a&&(i=Ee.cursor(n.from+a))}return i}const P8=t=>qr(t,e=>ei(t,e,!0)),I8=t=>qr(t,e=>ei(t,e,!1)),D8=t=>qr(t,e=>ei(t,e,!cr(t))),L8=t=>qr(t,e=>ei(t,e,cr(t))),B8=t=>qr(t,e=>Ee.cursor(t.lineBlockAt(e.head).from,1)),U8=t=>qr(t,e=>Ee.cursor(t.lineBlockAt(e.head).to,-1));function $8(t,e,r){let n=!1,i=Ea(t.selection,a=>{let s=sn(t,a.head,-1)||sn(t,a.head,1)||a.head>0&&sn(t,a.head-1,1)||a.head<t.doc.length&&sn(t,a.head+1,-1);if(!s||!s.end)return a;n=!0;let l=s.start.from==a.head?s.end.to:s.end.from;return r?Ee.range(a.anchor,l):Ee.cursor(l)});return n?(e(bn(t,i)),!0):!1}const F8=({state:t,dispatch:e})=>$8(t,e,!1);function Br(t,e){let r=Ea(t.state.selection,n=>{let i=e(n);return Ee.range(n.anchor,i.head,i.goalColumn,i.bidiLevel||void 0)});return r.eq(t.state.selection)?!1:(t.dispatch(bn(t.state,r)),!0)}function rb(t,e){return Br(t,r=>t.moveByChar(r,e))}const nb=t=>rb(t,!cr(t)),ib=t=>rb(t,cr(t));function ab(t,e){return Br(t,r=>t.moveByGroup(r,e))}const V8=t=>ab(t,!cr(t)),W8=t=>ab(t,cr(t)),H8=t=>Br(t,e=>uc(t.state,e,!cr(t))),G8=t=>Br(t,e=>uc(t.state,e,cr(t)));function sb(t,e){return Br(t,r=>t.moveVertically(r,e))}const ob=t=>sb(t,!1),lb=t=>sb(t,!0);function cb(t,e){return Br(t,r=>t.moveVertically(r,e,eb(t).height))}const cm=t=>cb(t,!1),um=t=>cb(t,!0),z8=t=>Br(t,e=>ei(t,e,!0)),q8=t=>Br(t,e=>ei(t,e,!1)),Y8=t=>Br(t,e=>ei(t,e,!cr(t))),X8=t=>Br(t,e=>ei(t,e,cr(t))),Q8=t=>Br(t,e=>Ee.cursor(t.lineBlockAt(e.head).from)),K8=t=>Br(t,e=>Ee.cursor(t.lineBlockAt(e.head).to)),fm=({state:t,dispatch:e})=>(e(bn(t,{anchor:0})),!0),hm=({state:t,dispatch:e})=>(e(bn(t,{anchor:t.doc.length})),!0),dm=({state:t,dispatch:e})=>(e(bn(t,{anchor:t.selection.main.anchor,head:0})),!0),pm=({state:t,dispatch:e})=>(e(bn(t,{anchor:t.selection.main.anchor,head:t.doc.length})),!0),j8=({state:t,dispatch:e})=>(e(t.update({selection:{anchor:0,head:t.doc.length},userEvent:"select"})),!0),Z8=({state:t,dispatch:e})=>{let r=fc(t).map(({from:n,to:i})=>Ee.range(n,Math.min(i+1,t.doc.length)));return e(t.update({selection:Ee.create(r),userEvent:"select"})),!0},J8=({state:t,dispatch:e})=>{let r=Ea(t.selection,n=>{var i;let a=tr(t).resolveStack(n.from,1);for(let s=a;s;s=s.next){let{node:l}=s;if((l.from<n.from&&l.to>=n.to||l.to>n.to&&l.from<=n.from)&&(!((i=l.parent)===null||i===void 0)&&i.parent))return Ee.range(l.to,l.from)}return n});return e(bn(t,r)),!0},eV=({state:t,dispatch:e})=>{let r=t.selection,n=null;return r.ranges.length>1?n=Ee.create([r.main]):r.main.empty||(n=Ee.create([Ee.cursor(r.main.head)])),n?(e(bn(t,n)),!0):!1};function Bs(t,e){if(t.state.readOnly)return!1;let r="delete.selection",{state:n}=t,i=n.changeByRange(a=>{let{from:s,to:l}=a;if(s==l){let u=e(a);u<s?(r="delete.backward",u=ho(t,u,!1)):u>s&&(r="delete.forward",u=ho(t,u,!0)),s=Math.min(s,u),l=Math.max(l,u)}else s=ho(t,s,!1),l=ho(t,l,!0);return s==l?{range:a}:{changes:{from:s,to:l},range:Ee.cursor(s,s<a.head?-1:1)}});return i.changes.empty?!1:(t.dispatch(n.update(i,{scrollIntoView:!0,userEvent:r,effects:r=="delete.selection"?Be.announce.of(n.phrase("Selection deleted")):void 0})),!0)}function ho(t,e,r){if(t instanceof Be)for(let n of t.state.facet(Be.atomicRanges).map(i=>i(t)))n.between(e,e,(i,a)=>{i<e&&a>e&&(e=r?a:i)});return e}const ub=(t,e)=>Bs(t,r=>{let n=r.from,{state:i}=t,a=i.doc.lineAt(n),s,l;if(!e&&n>a.from&&n<a.from+200&&!/[^ \t]/.test(s=a.text.slice(0,n-a.from))){if(s[s.length-1]=="	")return n-1;let u=ba(s,i.tabSize),c=u%nl(i)||nl(i);for(let o=0;o<c&&s[s.length-1-o]==" ";o++)n--;l=n}else l=er(a.text,n-a.from,e,e)+a.from,l==n&&a.number!=(e?i.doc.lines:1)?l+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(a.text.slice(l-a.from,n-a.from))&&(l=er(a.text,l-a.from,!1,!1)+a.from);return l}),Sf=t=>ub(t,!1),fb=t=>ub(t,!0),hb=(t,e)=>Bs(t,r=>{let n=r.head,{state:i}=t,a=i.doc.lineAt(n),s=i.charCategorizer(n);for(let l=null;;){if(n==(e?a.to:a.from)){n==r.head&&a.number!=(e?i.doc.lines:1)&&(n+=e?1:-1);break}let u=er(a.text,n-a.from,e)+a.from,c=a.text.slice(Math.min(n,u)-a.from,Math.max(n,u)-a.from),o=s(c);if(l!=null&&o!=l)break;(c!=" "||n!=r.head)&&(l=o),n=u}return n}),db=t=>hb(t,!1),tV=t=>hb(t,!0),rV=t=>Bs(t,e=>{let r=t.lineBlockAt(e.head).to;return e.head<r?r:Math.min(t.state.doc.length,e.head+1)}),nV=t=>Bs(t,e=>{let r=t.moveToLineBoundary(e,!1).head;return e.head>r?r:Math.max(0,e.head-1)}),iV=t=>Bs(t,e=>{let r=t.moveToLineBoundary(e,!0).head;return e.head<r?r:Math.min(t.state.doc.length,e.head+1)}),aV=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let r=t.changeByRange(n=>({changes:{from:n.from,to:n.to,insert:ot.of(["",""])},range:Ee.cursor(n.from)}));return e(t.update(r,{scrollIntoView:!0,userEvent:"input"})),!0},sV=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let r=t.changeByRange(n=>{if(!n.empty||n.from==0||n.from==t.doc.length)return{range:n};let i=n.from,a=t.doc.lineAt(i),s=i==a.from?i-1:er(a.text,i-a.from,!1)+a.from,l=i==a.to?i+1:er(a.text,i-a.from,!0)+a.from;return{changes:{from:s,to:l,insert:t.doc.slice(i,l).append(t.doc.slice(s,i))},range:Ee.cursor(l)}});return r.changes.empty?!1:(e(t.update(r,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function fc(t){let e=[],r=-1;for(let n of t.selection.ranges){let i=t.doc.lineAt(n.from),a=t.doc.lineAt(n.to);if(!n.empty&&n.to==a.from&&(a=t.doc.lineAt(n.to-1)),r>=i.number){let s=e[e.length-1];s.to=a.to,s.ranges.push(n)}else e.push({from:i.from,to:a.to,ranges:[n]});r=a.number+1}return e}function pb(t,e,r){if(t.readOnly)return!1;let n=[],i=[];for(let a of fc(t)){if(r?a.to==t.doc.length:a.from==0)continue;let s=t.doc.lineAt(r?a.to+1:a.from-1),l=s.length+1;if(r){n.push({from:a.to,to:s.to},{from:a.from,insert:s.text+t.lineBreak});for(let u of a.ranges)i.push(Ee.range(Math.min(t.doc.length,u.anchor+l),Math.min(t.doc.length,u.head+l)))}else{n.push({from:s.from,to:a.from},{from:a.to,insert:t.lineBreak+s.text});for(let u of a.ranges)i.push(Ee.range(u.anchor-l,u.head-l))}}return n.length?(e(t.update({changes:n,scrollIntoView:!0,selection:Ee.create(i,t.selection.mainIndex),userEvent:"move.line"})),!0):!1}const oV=({state:t,dispatch:e})=>pb(t,e,!1),lV=({state:t,dispatch:e})=>pb(t,e,!0);function gb(t,e,r){if(t.readOnly)return!1;let n=[];for(let i of fc(t))r?n.push({from:i.from,insert:t.doc.slice(i.from,i.to)+t.lineBreak}):n.push({from:i.to,insert:t.lineBreak+t.doc.slice(i.from,i.to)});return e(t.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const cV=({state:t,dispatch:e})=>gb(t,e,!1),uV=({state:t,dispatch:e})=>gb(t,e,!0),fV=t=>{if(t.state.readOnly)return!1;let{state:e}=t,r=e.changes(fc(e).map(({from:i,to:a})=>(i>0?i--:a<e.doc.length&&a++,{from:i,to:a}))),n=Ea(e.selection,i=>t.moveVertically(i,!0)).map(r);return t.dispatch({changes:r,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0};function hV(t,e){if(/\(\)|\[\]|\{\}/.test(t.sliceDoc(e-1,e+1)))return{from:e,to:e};let r=tr(t).resolveInner(e),n=r.childBefore(e),i=r.childAfter(e),a;return n&&i&&n.to<=e&&i.from>=e&&(a=n.type.prop(nt.closedBy))&&a.indexOf(i.name)>-1&&t.doc.lineAt(n.to).from==t.doc.lineAt(i.from).from&&!/\S/.test(t.sliceDoc(n.to,i.from))?{from:n.to,to:i.from}:null}const dV=mb(!1),pV=mb(!0);function mb(t){return({state:e,dispatch:r})=>{if(e.readOnly)return!1;let n=e.changeByRange(i=>{let{from:a,to:s}=i,l=e.doc.lineAt(a),u=!t&&a==s&&hV(e,a);t&&(a=s=(s<=l.to?l:e.doc.lineAt(s)).to);let c=new sc(e,{simulateBreak:a,simulateDoubleBreak:!!u}),o=Dh(c,a);for(o==null&&(o=ba(/^\s*/.exec(e.doc.lineAt(a).text)[0],e.tabSize));s<l.to&&/\s/.test(l.text[s-l.from]);)s++;u?{from:a,to:s}=u:a>l.from&&a<l.from+100&&!/\S/.test(l.text.slice(0,a))&&(a=l.from);let f=["",fs(e,o)];return u&&f.push(fs(e,c.lineIndent(l.from,-1))),{changes:{from:a,to:s,insert:ot.of(f)},range:Ee.cursor(a+1+f[1].length)}});return r(e.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function Fh(t,e){let r=-1;return t.changeByRange(n=>{let i=[];for(let s=n.from;s<=n.to;){let l=t.doc.lineAt(s);l.number>r&&(n.empty||n.to>l.from)&&(e(l,i,n),r=l.number),s=l.to+1}let a=t.changes(i);return{changes:i,range:Ee.range(a.mapPos(n.anchor,1),a.mapPos(n.head,1))}})}const gV=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let r=Object.create(null),n=new sc(t,{overrideIndentation:a=>{let s=r[a];return s??-1}}),i=Fh(t,(a,s,l)=>{let u=Dh(n,a.from);if(u==null)return;/\S/.test(a.text)||(u=0);let c=/^\s*/.exec(a.text)[0],o=fs(t,u);(c!=o||l.from<a.from+c.length)&&(r[a.from]=u,s.push({from:a.from,to:a.from+c.length,insert:o}))});return i.changes.empty||e(t.update(i,{userEvent:"indent"})),!0},vb=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(Fh(t,(r,n)=>{n.push({from:r.from,insert:t.facet(ac)})}),{userEvent:"input.indent"})),!0),yb=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(Fh(t,(r,n)=>{let i=/^\s*/.exec(r.text)[0];if(!i)return;let a=ba(i,t.tabSize),s=0,l=fs(t,Math.max(0,a-nl(t)));for(;s<i.length&&s<l.length&&i.charCodeAt(s)==l.charCodeAt(s);)s++;n.push({from:r.from+s,to:r.from+i.length,insert:l.slice(s)})}),{userEvent:"delete.dedent"})),!0),mV=[{key:"Ctrl-b",run:Xy,shift:nb,preventDefault:!0},{key:"Ctrl-f",run:Qy,shift:ib},{key:"Ctrl-p",run:Zy,shift:ob},{key:"Ctrl-n",run:Jy,shift:lb},{key:"Ctrl-a",run:B8,shift:Q8},{key:"Ctrl-e",run:U8,shift:K8},{key:"Ctrl-d",run:fb},{key:"Ctrl-h",run:Sf},{key:"Ctrl-k",run:rV},{key:"Ctrl-Alt-h",run:db},{key:"Ctrl-o",run:aV},{key:"Ctrl-t",run:sV},{key:"Ctrl-v",run:wf}],vV=[{key:"ArrowLeft",run:Xy,shift:nb,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:N8,shift:V8,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:D8,shift:Y8,preventDefault:!0},{key:"ArrowRight",run:Qy,shift:ib,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:x8,shift:W8,preventDefault:!0},{mac:"Cmd-ArrowRight",run:L8,shift:X8,preventDefault:!0},{key:"ArrowUp",run:Zy,shift:ob,preventDefault:!0},{mac:"Cmd-ArrowUp",run:fm,shift:dm},{mac:"Ctrl-ArrowUp",run:lm,shift:cm},{key:"ArrowDown",run:Jy,shift:lb,preventDefault:!0},{mac:"Cmd-ArrowDown",run:hm,shift:pm},{mac:"Ctrl-ArrowDown",run:wf,shift:um},{key:"PageUp",run:lm,shift:cm},{key:"PageDown",run:wf,shift:um},{key:"Home",run:I8,shift:q8,preventDefault:!0},{key:"Mod-Home",run:fm,shift:dm},{key:"End",run:P8,shift:z8,preventDefault:!0},{key:"Mod-End",run:hm,shift:pm},{key:"Enter",run:dV},{key:"Mod-a",run:j8},{key:"Backspace",run:Sf,shift:Sf},{key:"Delete",run:fb},{key:"Mod-Backspace",mac:"Alt-Backspace",run:db},{key:"Mod-Delete",mac:"Alt-Delete",run:tV},{mac:"Mod-Backspace",run:nV},{mac:"Mod-Delete",run:iV}].concat(mV.map(t=>({mac:t.key,run:t.run,shift:t.shift}))),yV=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:_8,shift:H8},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:k8,shift:G8},{key:"Alt-ArrowUp",run:oV},{key:"Shift-Alt-ArrowUp",run:cV},{key:"Alt-ArrowDown",run:lV},{key:"Shift-Alt-ArrowDown",run:uV},{key:"Escape",run:eV},{key:"Mod-Enter",run:pV},{key:"Alt-l",mac:"Ctrl-l",run:Z8},{key:"Mod-i",run:J8,preventDefault:!0},{key:"Mod-[",run:yb},{key:"Mod-]",run:vb},{key:"Mod-Alt-\\",run:gV},{key:"Shift-Mod-k",run:fV},{key:"Shift-Mod-\\",run:F8},{key:"Mod-/",run:c8},{key:"Alt-A",run:f8}].concat(vV),ol={key:"Tab",run:vb,shift:yb};function vt(){var t=arguments[0];typeof t=="string"&&(t=document.createElement(t));var e=1,r=arguments[1];if(r&&typeof r=="object"&&r.nodeType==null&&!Array.isArray(r)){for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){var i=r[n];typeof i=="string"?t.setAttribute(n,i):i!=null&&(t[n]=i)}e++}for(;e<arguments.length;e++)bb(t,arguments[e]);return t}function bb(t,e){if(typeof e=="string")t.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)t.appendChild(e);else if(Array.isArray(e))for(var r=0;r<e.length;r++)bb(t,e[r]);else throw new RangeError("Unsupported child node: "+e)}const gm=typeof String.prototype.normalize=="function"?t=>t.normalize("NFKD"):t=>t;class ra{constructor(e,r,n=0,i=e.length,a,s){this.test=s,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(n,i),this.bufferStart=n,this.normalize=a?l=>a(gm(l)):gm,this.query=this.normalize(r)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Zt(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let r=wh(e),n=this.bufferStart+this.bufferPos;this.bufferPos+=Nr(e);let i=this.normalize(r);for(let a=0,s=n;;a++){let l=i.charCodeAt(a),u=this.match(l,s);if(a==i.length-1){if(u)return this.value=u,this;break}s==n&&a<r.length&&r.charCodeAt(a)==l&&s++}}}match(e,r){let n=null;for(let i=0;i<this.matches.length;i+=2){let a=this.matches[i],s=!1;this.query.charCodeAt(a)==e&&(a==this.query.length-1?n={from:this.matches[i+1],to:r+1}:(this.matches[i]++,s=!0)),s||(this.matches.splice(i,2),i-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?n={from:r,to:r+1}:this.matches.push(1,r)),n&&this.test&&!this.test(n.from,n.to,this.buffer,this.bufferStart)&&(n=null),n}}typeof Symbol<"u"&&(ra.prototype[Symbol.iterator]=function(){return this});const Eb={from:-1,to:-1,match:/.*/.exec("")},Vh="gm"+(/x/.unicode==null?"":"u");class Ob{constructor(e,r,n,i=0,a=e.length){if(this.text=e,this.to=a,this.curLine="",this.done=!1,this.value=Eb,/\\[sWDnr]|\n|\r|\[\^/.test(r))return new Ab(e,r,n,i,a);this.re=new RegExp(r,Vh+(n!=null&&n.ignoreCase?"i":"")),this.test=n==null?void 0:n.test,this.iter=e.iter();let s=e.lineAt(i);this.curLineStart=s.from,this.matchPos=ll(e,i),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let r=this.matchPos<=this.to&&this.re.exec(this.curLine);if(r){let n=this.curLineStart+r.index,i=n+r[0].length;if(this.matchPos=ll(this.text,i+(n==i?1:0)),n==this.curLineStart+this.curLine.length&&this.nextLine(),(n<i||n>this.value.to)&&(!this.test||this.test(n,i,r)))return this.value={from:n,to:i,match:r},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const ou=new WeakMap;class Qi{constructor(e,r){this.from=e,this.text=r}get to(){return this.from+this.text.length}static get(e,r,n){let i=ou.get(e);if(!i||i.from>=n||i.to<=r){let l=new Qi(r,e.sliceString(r,n));return ou.set(e,l),l}if(i.from==r&&i.to==n)return i;let{text:a,from:s}=i;return s>r&&(a=e.sliceString(r,s)+a,s=r),i.to<n&&(a+=e.sliceString(i.to,n)),ou.set(e,new Qi(s,a)),new Qi(r,a.slice(r-s,n-s))}}class Ab{constructor(e,r,n,i,a){this.text=e,this.to=a,this.done=!1,this.value=Eb,this.matchPos=ll(e,i),this.re=new RegExp(r,Vh+(n!=null&&n.ignoreCase?"i":"")),this.test=n==null?void 0:n.test,this.flat=Qi.get(e,i,this.chunkEnd(i+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,r=this.re.exec(this.flat.text);if(r&&!r[0]&&r.index==e&&(this.re.lastIndex=e+1,r=this.re.exec(this.flat.text)),r){let n=this.flat.from+r.index,i=n+r[0].length;if((this.flat.to>=this.to||r.index+r[0].length<=this.flat.text.length-10)&&(!this.test||this.test(n,i,r)))return this.value={from:n,to:i,match:r},this.matchPos=ll(this.text,i+(n==i?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=Qi.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(Ob.prototype[Symbol.iterator]=Ab.prototype[Symbol.iterator]=function(){return this});function bV(t){try{return new RegExp(t,Vh),!0}catch{return!1}}function ll(t,e){if(e>=t.length)return e;let r=t.lineAt(e),n;for(;e<r.to&&(n=r.text.charCodeAt(e-r.from))>=56320&&n<57344;)e++;return e}function Tf(t){let e=String(t.state.doc.lineAt(t.state.selection.main.head).number),r=vt("input",{class:"cm-textfield",name:"line",value:e}),n=vt("form",{class:"cm-gotoLine",onkeydown:a=>{a.keyCode==27?(a.preventDefault(),t.dispatch({effects:cl.of(!1)}),t.focus()):a.keyCode==13&&(a.preventDefault(),i())},onsubmit:a=>{a.preventDefault(),i()}},vt("label",t.state.phrase("Go to line"),": ",r)," ",vt("button",{class:"cm-button",type:"submit"},t.state.phrase("go")));function i(){let a=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(r.value);if(!a)return;let{state:s}=t,l=s.doc.lineAt(s.selection.main.head),[,u,c,o,f]=a,h=o?+o.slice(1):0,d=c?+c:l.number;if(c&&f){let m=d/100;u&&(m=m*(u=="-"?-1:1)+l.number/s.doc.lines),d=Math.round(s.doc.lines*m)}else c&&u&&(d=d*(u=="-"?-1:1)+l.number);let p=s.doc.line(Math.max(1,Math.min(s.doc.lines,d))),g=Ee.cursor(p.from+Math.max(0,Math.min(h,p.length)));t.dispatch({effects:[cl.of(!1),Be.scrollIntoView(g.from,{y:"center"})],selection:g}),t.focus()}return{dom:n}}const cl=Ze.define(),mm=rr.define({create(){return!0},update(t,e){for(let r of e.effects)r.is(cl)&&(t=r.value);return t},provide:t=>us.from(t,e=>e?Tf:null)}),EV=t=>{let e=cs(t,Tf);if(!e){let r=[cl.of(!0)];t.state.field(mm,!1)==null&&r.push(Ze.appendConfig.of([mm,OV])),t.dispatch({effects:r}),e=cs(t,Tf)}return e&&e.dom.querySelector("input").select(),!0},OV=Be.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),AV={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},Cb=$e.define({combine(t){return yn(t,AV,{highlightWordAroundCursor:(e,r)=>e||r,minSelectionLength:Math.min,maxMatches:Math.min})}});function CV(t){let e=[NV,RV];return t&&e.push(Cb.of(t)),e}const wV=qe.mark({class:"cm-selectionMatch"}),SV=qe.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function vm(t,e,r,n){return(r==0||t(e.sliceDoc(r-1,r))!=Tt.Word)&&(n==e.doc.length||t(e.sliceDoc(n,n+1))!=Tt.Word)}function TV(t,e,r,n){return t(e.sliceDoc(r,r+1))==Tt.Word&&t(e.sliceDoc(n-1,n))==Tt.Word}const RV=It.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.selectionSet||t.docChanged||t.viewportChanged)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=t.state.facet(Cb),{state:r}=t,n=r.selection;if(n.ranges.length>1)return qe.none;let i=n.main,a,s=null;if(i.empty){if(!e.highlightWordAroundCursor)return qe.none;let u=r.wordAt(i.head);if(!u)return qe.none;s=r.charCategorizer(i.head),a=r.sliceDoc(u.from,u.to)}else{let u=i.to-i.from;if(u<e.minSelectionLength||u>200)return qe.none;if(e.wholeWords){if(a=r.sliceDoc(i.from,i.to),s=r.charCategorizer(i.head),!(vm(s,r,i.from,i.to)&&TV(s,r,i.from,i.to)))return qe.none}else if(a=r.sliceDoc(i.from,i.to).trim(),!a)return qe.none}let l=[];for(let u of t.visibleRanges){let c=new ra(r.doc,a,u.from,u.to);for(;!c.next().done;){let{from:o,to:f}=c.value;if((!s||vm(s,r,o,f))&&(i.empty&&o<=i.from&&f>=i.to?l.push(SV.range(o,f)):(o>=i.to||f<=i.from)&&l.push(wV.range(o,f)),l.length>e.maxMatches))return qe.none}}return qe.set(l)}},{decorations:t=>t.decorations}),NV=Be.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),xV=({state:t,dispatch:e})=>{let{selection:r}=t,n=Ee.create(r.ranges.map(i=>t.wordAt(i.head)||Ee.cursor(i.head)),r.mainIndex);return n.eq(r)?!1:(e(t.update({selection:n})),!0)};function MV(t,e){let{main:r,ranges:n}=t.selection,i=t.wordAt(r.head),a=i&&i.from==r.from&&i.to==r.to;for(let s=!1,l=new ra(t.doc,e,n[n.length-1].to);;)if(l.next(),l.done){if(s)return null;l=new ra(t.doc,e,0,Math.max(0,n[n.length-1].from-1)),s=!0}else{if(s&&n.some(u=>u.from==l.value.from))continue;if(a){let u=t.wordAt(l.value.from);if(!u||u.from!=l.value.from||u.to!=l.value.to)continue}return l.value}}const _V=({state:t,dispatch:e})=>{let{ranges:r}=t.selection;if(r.some(a=>a.from===a.to))return xV({state:t,dispatch:e});let n=t.sliceDoc(r[0].from,r[0].to);if(t.selection.ranges.some(a=>t.sliceDoc(a.from,a.to)!=n))return!1;let i=MV(t,n);return i?(e(t.update({selection:t.selection.addRange(Ee.range(i.from,i.to),!1),effects:Be.scrollIntoView(i.to)})),!0):!1},Oa=$e.define({combine(t){return yn(t,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new HV(e),scrollToMatch:e=>Be.scrollIntoView(e)})}});class wb{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||bV(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(r,n)=>n=="n"?`
`:n=="r"?"\r":n=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new DV(this):new PV(this)}getCursor(e,r=0,n){let i=e.doc?e:rt.create({doc:e});return n==null&&(n=i.doc.length),this.regexp?Bi(this,i,r,n):Li(this,i,r,n)}}class Sb{constructor(e){this.spec=e}}function Li(t,e,r,n){return new ra(e.doc,t.unquoted,r,n,t.caseSensitive?void 0:i=>i.toLowerCase(),t.wholeWord?kV(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function kV(t,e){return(r,n,i,a)=>((a>r||a+i.length<n)&&(a=Math.max(0,r-2),i=t.sliceString(a,Math.min(t.length,n+2))),(e(ul(i,r-a))!=Tt.Word||e(fl(i,r-a))!=Tt.Word)&&(e(fl(i,n-a))!=Tt.Word||e(ul(i,n-a))!=Tt.Word))}class PV extends Sb{constructor(e){super(e)}nextMatch(e,r,n){let i=Li(this.spec,e,n,e.doc.length).nextOverlapping();return i.done&&(i=Li(this.spec,e,0,r).nextOverlapping()),i.done?null:i.value}prevMatchInRange(e,r,n){for(let i=n;;){let a=Math.max(r,i-1e4-this.spec.unquoted.length),s=Li(this.spec,e,a,i),l=null;for(;!s.nextOverlapping().done;)l=s.value;if(l)return l;if(a==r)return null;i-=1e4}}prevMatch(e,r,n){return this.prevMatchInRange(e,0,r)||this.prevMatchInRange(e,n,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,r){let n=Li(this.spec,e,0,e.doc.length),i=[];for(;!n.next().done;){if(i.length>=r)return null;i.push(n.value)}return i}highlight(e,r,n,i){let a=Li(this.spec,e,Math.max(0,r-this.spec.unquoted.length),Math.min(n+this.spec.unquoted.length,e.doc.length));for(;!a.next().done;)i(a.value.from,a.value.to)}}function Bi(t,e,r,n){return new Ob(e.doc,t.search,{ignoreCase:!t.caseSensitive,test:t.wholeWord?IV(e.charCategorizer(e.selection.main.head)):void 0},r,n)}function ul(t,e){return t.slice(er(t,e,!1),e)}function fl(t,e){return t.slice(e,er(t,e))}function IV(t){return(e,r,n)=>!n[0].length||(t(ul(n.input,n.index))!=Tt.Word||t(fl(n.input,n.index))!=Tt.Word)&&(t(fl(n.input,n.index+n[0].length))!=Tt.Word||t(ul(n.input,n.index+n[0].length))!=Tt.Word)}class DV extends Sb{nextMatch(e,r,n){let i=Bi(this.spec,e,n,e.doc.length).next();return i.done&&(i=Bi(this.spec,e,0,r).next()),i.done?null:i.value}prevMatchInRange(e,r,n){for(let i=1;;i++){let a=Math.max(r,n-i*1e4),s=Bi(this.spec,e,a,n),l=null;for(;!s.next().done;)l=s.value;if(l&&(a==r||l.from>a+10))return l;if(a==r)return null}}prevMatch(e,r,n){return this.prevMatchInRange(e,0,r)||this.prevMatchInRange(e,n,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&\d+])/g,(r,n)=>n=="$"?"$":n=="&"?e.match[0]:n!="0"&&+n<e.match.length?e.match[n]:r)}matchAll(e,r){let n=Bi(this.spec,e,0,e.doc.length),i=[];for(;!n.next().done;){if(i.length>=r)return null;i.push(n.value)}return i}highlight(e,r,n,i){let a=Bi(this.spec,e,Math.max(0,r-250),Math.min(n+250,e.doc.length));for(;!a.next().done;)i(a.value.from,a.value.to)}}const hs=Ze.define(),Wh=Ze.define(),Hn=rr.define({create(t){return new lu(Rf(t).create(),null)},update(t,e){for(let r of e.effects)r.is(hs)?t=new lu(r.value.create(),t.panel):r.is(Wh)&&(t=new lu(t.query,r.value?Hh:null));return t},provide:t=>us.from(t,e=>e.panel)});class lu{constructor(e,r){this.query=e,this.panel=r}}const LV=qe.mark({class:"cm-searchMatch"}),BV=qe.mark({class:"cm-searchMatch cm-searchMatch-selected"}),UV=It.fromClass(class{constructor(t){this.view=t,this.decorations=this.highlight(t.state.field(Hn))}update(t){let e=t.state.field(Hn);(e!=t.startState.field(Hn)||t.docChanged||t.selectionSet||t.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:t,panel:e}){if(!e||!t.spec.valid)return qe.none;let{view:r}=this,n=new Yn;for(let i=0,a=r.visibleRanges,s=a.length;i<s;i++){let{from:l,to:u}=a[i];for(;i<s-1&&u>a[i+1].from-2*250;)u=a[++i].to;t.highlight(r.state,l,u,(c,o)=>{let f=r.state.selection.ranges.some(h=>h.from==c&&h.to==o);n.add(c,o,f?BV:LV)})}return n.finish()}},{decorations:t=>t.decorations});function Us(t){return e=>{let r=e.state.field(Hn,!1);return r&&r.query.spec.valid?t(e,r):Nb(e)}}const hl=Us((t,{query:e})=>{let{to:r}=t.state.selection.main,n=e.nextMatch(t.state,r,r);if(!n)return!1;let i=Ee.single(n.from,n.to),a=t.state.facet(Oa);return t.dispatch({selection:i,effects:[Gh(t,n),a.scrollToMatch(i.main,t)],userEvent:"select.search"}),Rb(t),!0}),dl=Us((t,{query:e})=>{let{state:r}=t,{from:n}=r.selection.main,i=e.prevMatch(r,n,n);if(!i)return!1;let a=Ee.single(i.from,i.to),s=t.state.facet(Oa);return t.dispatch({selection:a,effects:[Gh(t,i),s.scrollToMatch(a.main,t)],userEvent:"select.search"}),Rb(t),!0}),$V=Us((t,{query:e})=>{let r=e.matchAll(t.state,1e3);return!r||!r.length?!1:(t.dispatch({selection:Ee.create(r.map(n=>Ee.range(n.from,n.to))),userEvent:"select.search.matches"}),!0)}),FV=({state:t,dispatch:e})=>{let r=t.selection;if(r.ranges.length>1||r.main.empty)return!1;let{from:n,to:i}=r.main,a=[],s=0;for(let l=new ra(t.doc,t.sliceDoc(n,i));!l.next().done;){if(a.length>1e3)return!1;l.value.from==n&&(s=a.length),a.push(Ee.range(l.value.from,l.value.to))}return e(t.update({selection:Ee.create(a,s),userEvent:"select.search.matches"})),!0},ym=Us((t,{query:e})=>{let{state:r}=t,{from:n,to:i}=r.selection.main;if(r.readOnly)return!1;let a=e.nextMatch(r,n,n);if(!a)return!1;let s=[],l,u,c=[];if(a.from==n&&a.to==i&&(u=r.toText(e.getReplacement(a)),s.push({from:a.from,to:a.to,insert:u}),a=e.nextMatch(r,a.from,a.to),c.push(Be.announce.of(r.phrase("replaced match on line $",r.doc.lineAt(n).number)+"."))),a){let o=s.length==0||s[0].from>=a.to?0:a.to-a.from-u.length;l=Ee.single(a.from-o,a.to-o),c.push(Gh(t,a)),c.push(r.facet(Oa).scrollToMatch(l.main,t))}return t.dispatch({changes:s,selection:l,effects:c,userEvent:"input.replace"}),!0}),VV=Us((t,{query:e})=>{if(t.state.readOnly)return!1;let r=e.matchAll(t.state,1e9).map(i=>{let{from:a,to:s}=i;return{from:a,to:s,insert:e.getReplacement(i)}});if(!r.length)return!1;let n=t.state.phrase("replaced $ matches",r.length)+".";return t.dispatch({changes:r,effects:Be.announce.of(n),userEvent:"input.replace.all"}),!0});function Hh(t){return t.state.facet(Oa).createPanel(t)}function Rf(t,e){var r,n,i,a,s;let l=t.selection.main,u=l.empty||l.to>l.from+100?"":t.sliceDoc(l.from,l.to);if(e&&!u)return e;let c=t.facet(Oa);return new wb({search:((r=e==null?void 0:e.literal)!==null&&r!==void 0?r:c.literal)?u:u.replace(/\n/g,"\\n"),caseSensitive:(n=e==null?void 0:e.caseSensitive)!==null&&n!==void 0?n:c.caseSensitive,literal:(i=e==null?void 0:e.literal)!==null&&i!==void 0?i:c.literal,regexp:(a=e==null?void 0:e.regexp)!==null&&a!==void 0?a:c.regexp,wholeWord:(s=e==null?void 0:e.wholeWord)!==null&&s!==void 0?s:c.wholeWord})}function Tb(t){let e=cs(t,Hh);return e&&e.dom.querySelector("[main-field]")}function Rb(t){let e=Tb(t);e&&e==t.root.activeElement&&e.select()}const Nb=t=>{let e=t.state.field(Hn,!1);if(e&&e.panel){let r=Tb(t);if(r&&r!=t.root.activeElement){let n=Rf(t.state,e.query.spec);n.valid&&t.dispatch({effects:hs.of(n)}),r.focus(),r.select()}}else t.dispatch({effects:[Wh.of(!0),e?hs.of(Rf(t.state,e.query.spec)):Ze.appendConfig.of(zV)]});return!0},xb=t=>{let e=t.state.field(Hn,!1);if(!e||!e.panel)return!1;let r=cs(t,Hh);return r&&r.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:Wh.of(!1)}),!0},WV=[{key:"Mod-f",run:Nb,scope:"editor search-panel"},{key:"F3",run:hl,shift:dl,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:hl,shift:dl,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:xb,scope:"editor search-panel"},{key:"Mod-Shift-l",run:FV},{key:"Mod-Alt-g",run:EV},{key:"Mod-d",run:_V,preventDefault:!0}];class HV{constructor(e){this.view=e;let r=this.query=e.state.field(Hn).query.spec;this.commit=this.commit.bind(this),this.searchField=vt("input",{value:r.search,placeholder:Or(e,"Find"),"aria-label":Or(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=vt("input",{value:r.replace,placeholder:Or(e,"Replace"),"aria-label":Or(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=vt("input",{type:"checkbox",name:"case",form:"",checked:r.caseSensitive,onchange:this.commit}),this.reField=vt("input",{type:"checkbox",name:"re",form:"",checked:r.regexp,onchange:this.commit}),this.wordField=vt("input",{type:"checkbox",name:"word",form:"",checked:r.wholeWord,onchange:this.commit});function n(i,a,s){return vt("button",{class:"cm-button",name:i,onclick:a,type:"button"},s)}this.dom=vt("div",{onkeydown:i=>this.keydown(i),class:"cm-search"},[this.searchField,n("next",()=>hl(e),[Or(e,"next")]),n("prev",()=>dl(e),[Or(e,"previous")]),n("select",()=>$V(e),[Or(e,"all")]),vt("label",null,[this.caseField,Or(e,"match case")]),vt("label",null,[this.reField,Or(e,"regexp")]),vt("label",null,[this.wordField,Or(e,"by word")]),...e.state.readOnly?[]:[vt("br"),this.replaceField,n("replace",()=>ym(e),[Or(e,"replace")]),n("replaceAll",()=>VV(e),[Or(e,"replace all")])],vt("button",{name:"close",onclick:()=>xb(e),"aria-label":Or(e,"close"),type:"button"},["×"])])}commit(){let e=new wb({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:hs.of(e)}))}keydown(e){o4(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?dl:hl)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),ym(this.view))}update(e){for(let r of e.transactions)for(let n of r.effects)n.is(hs)&&!n.value.eq(this.query)&&this.setQuery(n.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(Oa).top}}function Or(t,e){return t.state.phrase(e)}const po=30,go=/[\s\.,:;?!]/;function Gh(t,{from:e,to:r}){let n=t.state.doc.lineAt(e),i=t.state.doc.lineAt(r).to,a=Math.max(n.from,e-po),s=Math.min(i,r+po),l=t.state.sliceDoc(a,s);if(a!=n.from){for(let u=0;u<po;u++)if(!go.test(l[u+1])&&go.test(l[u])){l=l.slice(u);break}}if(s!=i){for(let u=l.length-1;u>l.length-po;u--)if(!go.test(l[u-1])&&go.test(l[u])){l=l.slice(0,u);break}}return Be.announce.of(`${t.state.phrase("current match")}. ${l} ${t.state.phrase("on line")} ${n.number}.`)}const GV=Be.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),zV=[Hn,ya.low(UV),GV];class Mb{constructor(e,r,n){this.state=e,this.pos=r,this.explicit=n,this.abortListeners=[]}tokenBefore(e){let r=tr(this.state).resolveInner(this.pos,-1);for(;r&&e.indexOf(r.name)<0;)r=r.parent;return r?{from:r.from,to:this.pos,text:this.state.sliceDoc(r.from,this.pos),type:r.type}:null}matchBefore(e){let r=this.state.doc.lineAt(this.pos),n=Math.max(r.from,this.pos-250),i=r.text.slice(n-r.from,this.pos-r.from),a=i.search(_b(e,!1));return a<0?null:{from:n+a,to:this.pos,text:i.slice(a)}}get aborted(){return this.abortListeners==null}addEventListener(e,r){e=="abort"&&this.abortListeners&&this.abortListeners.push(r)}}function bm(t){let e=Object.keys(t).join(""),r=/\w/.test(e);return r&&(e=e.replace(/\w/g,"")),`[${r?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function qV(t){let e=Object.create(null),r=Object.create(null);for(let{label:i}of t){e[i[0]]=!0;for(let a=1;a<i.length;a++)r[i[a]]=!0}let n=bm(e)+bm(r)+"*$";return[new RegExp("^"+n),new RegExp(n)]}function YV(t){let e=t.map(i=>typeof i=="string"?{label:i}:i),[r,n]=e.every(i=>/^\w+$/.test(i.label))?[/\w*$/,/\w+$/]:qV(e);return i=>{let a=i.matchBefore(n);return a||i.explicit?{from:a?a.from:i.pos,options:e,validFor:r}:null}}class Em{constructor(e,r,n,i){this.completion=e,this.source=r,this.match=n,this.score=i}}function Gn(t){return t.selection.main.from}function _b(t,e){var r;let{source:n}=t,i=e&&n[0]!="^",a=n[n.length-1]!="$";return!i&&!a?t:new RegExp(`${i?"^":""}(?:${n})${a?"$":""}`,(r=t.flags)!==null&&r!==void 0?r:t.ignoreCase?"i":"")}const XV=_n.define();function QV(t,e,r,n){let{main:i}=t.selection,a=r-i.from,s=n-i.from;return Object.assign(Object.assign({},t.changeByRange(l=>l!=i&&r!=n&&t.sliceDoc(l.from+a,l.from+s)!=t.sliceDoc(r,n)?{range:l}:{changes:{from:l.from+a,to:n==i.from?l.to:l.from+s,insert:e},range:Ee.cursor(l.from+a+e.length)})),{scrollIntoView:!0,userEvent:"input.complete"})}const Om=new WeakMap;function KV(t){if(!Array.isArray(t))return t;let e=Om.get(t);return e||Om.set(t,e=YV(t)),e}const zh=Ze.define(),ds=Ze.define();class jV{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let r=0;r<e.length;){let n=Zt(e,r),i=Nr(n);this.chars.push(n);let a=e.slice(r,r+i),s=a.toUpperCase();this.folded.push(Zt(s==a?a.toLowerCase():s,0)),r+=i}this.astral=e.length!=this.chars.length}ret(e,r){return this.score=e,this.matched=r,!0}match(e){if(this.pattern.length==0)return this.ret(-100,[]);if(e.length<this.pattern.length)return!1;let{chars:r,folded:n,any:i,precise:a,byWord:s}=this;if(r.length==1){let b=Zt(e,0),C=Nr(b),A=C==e.length?0:-100;if(b!=r[0])if(b==n[0])A+=-200;else return!1;return this.ret(A,[0,C])}let l=e.indexOf(this.pattern);if(l==0)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let u=r.length,c=0;if(l<0){for(let b=0,C=Math.min(e.length,200);b<C&&c<u;){let A=Zt(e,b);(A==r[c]||A==n[c])&&(i[c++]=b),b+=Nr(A)}if(c<u)return!1}let o=0,f=0,h=!1,d=0,p=-1,g=-1,m=/[a-z]/.test(e),v=!0;for(let b=0,C=Math.min(e.length,200),A=0;b<C&&f<u;){let O=Zt(e,b);l<0&&(o<u&&O==r[o]&&(a[o++]=b),d<u&&(O==r[d]||O==n[d]?(d==0&&(p=b),g=b+1,d++):d=0));let w,S=O<255?O>=48&&O<=57||O>=97&&O<=122?2:O>=65&&O<=90?1:0:(w=wh(O))!=w.toLowerCase()?1:w!=w.toUpperCase()?2:0;(!b||S==1&&m||A==0&&S!=0)&&(r[f]==O||n[f]==O&&(h=!0)?s[f++]=b:s.length&&(v=!1)),A=S,b+=Nr(O)}return f==u&&s[0]==0&&v?this.result(-100+(h?-200:0),s,e):d==u&&p==0?this.ret(-200-e.length+(g==e.length?0:-100),[0,g]):l>-1?this.ret(-700-e.length,[l,l+this.pattern.length]):d==u?this.ret(-900-e.length,[p,g]):f==u?this.result(-100+(h?-200:0)+-700+(v?0:-1100),s,e):r.length==2?!1:this.result((i[0]?-700:0)+-200+-1100,i,e)}result(e,r,n){let i=[],a=0;for(let s of r){let l=s+(this.astral?Nr(Zt(n,s)):1);a&&i[a-1]==s?i[a-1]=l:(i[a++]=s,i[a++]=l)}return this.ret(e-n.length,i)}}const sr=$e.define({combine(t){return yn(t,{activateOnTyping:!0,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:ZV,compareCompletions:(e,r)=>e.label.localeCompare(r.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,r)=>e&&r,closeOnBlur:(e,r)=>e&&r,icons:(e,r)=>e&&r,tooltipClass:(e,r)=>n=>Am(e(n),r(n)),optionClass:(e,r)=>n=>Am(e(n),r(n)),addToOptions:(e,r)=>e.concat(r)})}});function Am(t,e){return t?e?t+" "+e:t:e}function ZV(t,e,r,n,i,a){let s=t.textDirection==_t.RTL,l=s,u=!1,c="top",o,f,h=e.left-i.left,d=i.right-e.right,p=n.right-n.left,g=n.bottom-n.top;if(l&&h<Math.min(p,d)?l=!1:!l&&d<Math.min(p,h)&&(l=!0),p<=(l?h:d))o=Math.max(i.top,Math.min(r.top,i.bottom-g))-e.top,f=Math.min(400,l?h:d);else{u=!0,f=Math.min(400,(s?e.right:i.right-e.left)-30);let b=i.bottom-e.bottom;b>=g||b>e.top?o=r.bottom-e.top:(c="bottom",o=e.bottom-r.top)}let m=(e.bottom-e.top)/a.offsetHeight,v=(e.right-e.left)/a.offsetWidth;return{style:`${c}: ${o/m}px; max-width: ${f/v}px`,class:"cm-completionInfo-"+(u?s?"left-narrow":"right-narrow":l?"left":"right")}}function JV(t){let e=t.addToOptions.slice();return t.icons&&e.push({render(r){let n=document.createElement("div");return n.classList.add("cm-completionIcon"),r.type&&n.classList.add(...r.type.split(/\s+/g).map(i=>"cm-completionIcon-"+i)),n.setAttribute("aria-hidden","true"),n},position:20}),e.push({render(r,n,i,a){let s=document.createElement("span");s.className="cm-completionLabel";let l=r.displayLabel||r.label,u=0;for(let c=0;c<a.length;){let o=a[c++],f=a[c++];o>u&&s.appendChild(document.createTextNode(l.slice(u,o)));let h=s.appendChild(document.createElement("span"));h.appendChild(document.createTextNode(l.slice(o,f))),h.className="cm-completionMatchedText",u=f}return u<l.length&&s.appendChild(document.createTextNode(l.slice(u))),s},position:50},{render(r){if(!r.detail)return null;let n=document.createElement("span");return n.className="cm-completionDetail",n.textContent=r.detail,n},position:80}),e.sort((r,n)=>r.position-n.position).map(r=>r.render)}function cu(t,e,r){if(t<=r)return{from:0,to:t};if(e<0&&(e=0),e<=t>>1){let i=Math.floor(e/r);return{from:i*r,to:(i+1)*r}}let n=Math.floor((t-e)/r);return{from:t-(n+1)*r,to:t-n*r}}class e6{constructor(e,r,n){this.view=e,this.stateField=r,this.applyCompletion=n,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:u=>this.placeInfo(u),key:this},this.space=null,this.currentClass="";let i=e.state.field(r),{options:a,selected:s}=i.open,l=e.state.facet(sr);this.optionContent=JV(l),this.optionClass=l.optionClass,this.tooltipClass=l.tooltipClass,this.range=cu(a.length,s,l.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",u=>{let{options:c}=e.state.field(r).open;for(let o=u.target,f;o&&o!=this.dom;o=o.parentNode)if(o.nodeName=="LI"&&(f=/-(\d+)$/.exec(o.id))&&+f[1]<c.length){this.applyCompletion(e,c[+f[1]]),u.preventDefault();return}}),this.dom.addEventListener("focusout",u=>{let c=e.state.field(this.stateField,!1);c&&c.tooltip&&e.state.facet(sr).closeOnBlur&&u.relatedTarget!=e.contentDOM&&e.dispatch({effects:ds.of(null)})}),this.showOptions(a,i.id)}mount(){this.updateSel()}showOptions(e,r){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,r,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var r;let n=e.state.field(this.stateField),i=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),n!=i){let{options:a,selected:s,disabled:l}=n.open;(!i.open||i.open.options!=a)&&(this.range=cu(a.length,s,e.state.facet(sr).maxRenderedOptions),this.showOptions(a,n.id)),this.updateSel(),l!=((r=i.open)===null||r===void 0?void 0:r.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!l)}}updateTooltipClass(e){let r=this.tooltipClass(e);if(r!=this.currentClass){for(let n of this.currentClass.split(" "))n&&this.dom.classList.remove(n);for(let n of r.split(" "))n&&this.dom.classList.add(n);this.currentClass=r}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),r=e.open;if((r.selected>-1&&r.selected<this.range.from||r.selected>=this.range.to)&&(this.range=cu(r.options.length,r.selected,this.view.state.facet(sr).maxRenderedOptions),this.showOptions(r.options,e.id)),this.updateSelectedOption(r.selected)){this.destroyInfo();let{completion:n}=r.options[r.selected],{info:i}=n;if(!i)return;let a=typeof i=="string"?document.createTextNode(i):i(n);if(!a)return;"then"in a?a.then(s=>{s&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(s,n)}).catch(s=>kr(this.view.state,s,"completion info")):this.addInfoPane(a,n)}}addInfoPane(e,r){this.destroyInfo();let n=this.info=document.createElement("div");if(n.className="cm-tooltip cm-completionInfo",e.nodeType!=null)n.appendChild(e),this.infoDestroy=null;else{let{dom:i,destroy:a}=e;n.appendChild(i),this.infoDestroy=a||null}this.dom.appendChild(n),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let r=null;for(let n=this.list.firstChild,i=this.range.from;n;n=n.nextSibling,i++)n.nodeName!="LI"||!n.id?i--:i==e?n.hasAttribute("aria-selected")||(n.setAttribute("aria-selected","true"),r=n):n.hasAttribute("aria-selected")&&n.removeAttribute("aria-selected");return r&&r6(this.list,r),r}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let r=this.dom.getBoundingClientRect(),n=this.info.getBoundingClientRect(),i=e.getBoundingClientRect(),a=this.space;if(!a){let s=this.dom.ownerDocument.defaultView||window;a={left:0,top:0,right:s.innerWidth,bottom:s.innerHeight}}return i.top>Math.min(a.bottom,r.bottom)-10||i.bottom<Math.max(a.top,r.top)+10?null:this.view.state.facet(sr).positionInfo(this.view,r,i,n,a,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,r,n){const i=document.createElement("ul");i.id=r,i.setAttribute("role","listbox"),i.setAttribute("aria-expanded","true"),i.setAttribute("aria-label",this.view.state.phrase("Completions"));let a=null;for(let s=n.from;s<n.to;s++){let{completion:l,match:u}=e[s],{section:c}=l;if(c){let h=typeof c=="string"?c:c.name;if(h!=a&&(s>n.from||n.from==0))if(a=h,typeof c!="string"&&c.header)i.appendChild(c.header(c));else{let d=i.appendChild(document.createElement("completion-section"));d.textContent=h}}const o=i.appendChild(document.createElement("li"));o.id=r+"-"+s,o.setAttribute("role","option");let f=this.optionClass(l);f&&(o.className=f);for(let h of this.optionContent){let d=h(l,this.view.state,this.view,u);d&&o.appendChild(d)}}return n.from&&i.classList.add("cm-completionListIncompleteTop"),n.to<e.length&&i.classList.add("cm-completionListIncompleteBottom"),i}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function t6(t,e){return r=>new e6(r,t,e)}function r6(t,e){let r=t.getBoundingClientRect(),n=e.getBoundingClientRect(),i=r.height/t.offsetHeight;n.top<r.top?t.scrollTop-=(r.top-n.top)/i:n.bottom>r.bottom&&(t.scrollTop+=(n.bottom-r.bottom)/i)}function Cm(t){return(t.boost||0)*100+(t.apply?10:0)+(t.info?5:0)+(t.type?1:0)}function n6(t,e){let r=[],n=null,i=u=>{r.push(u);let{section:c}=u.completion;if(c){n||(n=[]);let o=typeof c=="string"?c:c.name;n.some(f=>f.name==o)||n.push(typeof c=="string"?{name:o}:c)}};for(let u of t)if(u.hasResult()){let c=u.result.getMatch;if(u.result.filter===!1)for(let o of u.result.options)i(new Em(o,u.source,c?c(o):[],1e9-r.length));else{let o=new jV(e.sliceDoc(u.from,u.to));for(let f of u.result.options)if(o.match(f.label)){let h=f.displayLabel?c?c(f,o.matched):[]:o.matched;i(new Em(f,u.source,h,o.score+(f.boost||0)))}}}if(n){let u=Object.create(null),c=0,o=(f,h)=>{var d,p;return((d=f.rank)!==null&&d!==void 0?d:1e9)-((p=h.rank)!==null&&p!==void 0?p:1e9)||(f.name<h.name?-1:1)};for(let f of n.sort(o))c-=1e5,u[f.name]=c;for(let f of r){let{section:h}=f.completion;h&&(f.score+=u[typeof h=="string"?h:h.name])}}let a=[],s=null,l=e.facet(sr).compareCompletions;for(let u of r.sort((c,o)=>o.score-c.score||l(c.completion,o.completion))){let c=u.completion;!s||s.label!=c.label||s.detail!=c.detail||s.type!=null&&c.type!=null&&s.type!=c.type||s.apply!=c.apply||s.boost!=c.boost?a.push(u):Cm(u.completion)>Cm(s)&&(a[a.length-1]=u),s=u.completion}return a}class Wi{constructor(e,r,n,i,a,s){this.options=e,this.attrs=r,this.tooltip=n,this.timestamp=i,this.selected=a,this.disabled=s}setSelected(e,r){return e==this.selected||e>=this.options.length?this:new Wi(this.options,wm(r,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,r,n,i,a){let s=n6(e,r);if(!s.length)return i&&e.some(u=>u.state==1)?new Wi(i.options,i.attrs,i.tooltip,i.timestamp,i.selected,!0):null;let l=r.facet(sr).selectOnOpen?0:-1;if(i&&i.selected!=l&&i.selected!=-1){let u=i.options[i.selected].completion;for(let c=0;c<s.length;c++)if(s[c].completion==u){l=c;break}}return new Wi(s,wm(n,l),{pos:e.reduce((u,c)=>c.hasResult()?Math.min(u,c.from):u,1e8),create:l6,above:a.aboveCursor},i?i.timestamp:Date.now(),l,!1)}map(e){return new Wi(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}}class pl{constructor(e,r,n){this.active=e,this.id=r,this.open=n}static start(){return new pl(s6,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:r}=e,n=r.facet(sr),a=(n.override||r.languageDataAt("autocomplete",Gn(r)).map(KV)).map(l=>(this.active.find(c=>c.source==l)||new gr(l,this.active.some(c=>c.state!=0)?1:0)).update(e,n));a.length==this.active.length&&a.every((l,u)=>l==this.active[u])&&(a=this.active);let s=this.open;s&&e.docChanged&&(s=s.map(e.changes)),e.selection||a.some(l=>l.hasResult()&&e.changes.touchesRange(l.from,l.to))||!i6(a,this.active)?s=Wi.build(a,r,this.id,s,n):s&&s.disabled&&!a.some(l=>l.state==1)&&(s=null),!s&&a.every(l=>l.state!=1)&&a.some(l=>l.hasResult())&&(a=a.map(l=>l.hasResult()?new gr(l.source,0):l));for(let l of e.effects)l.is(Pb)&&(s=s&&s.setSelected(l.value,this.id));return a==this.active&&s==this.open?this:new pl(a,this.id,s)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:a6}}function i6(t,e){if(t==e)return!0;for(let r=0,n=0;;){for(;r<t.length&&!t[r].hasResult;)r++;for(;n<e.length&&!e[n].hasResult;)n++;let i=r==t.length,a=n==e.length;if(i||a)return i==a;if(t[r++].result!=e[n++].result)return!1}}const a6={"aria-autocomplete":"list"};function wm(t,e){let r={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":t};return e>-1&&(r["aria-activedescendant"]=t+"-"+e),r}const s6=[];function Nf(t){return t.isUserEvent("input.type")?"input":t.isUserEvent("delete.backward")?"delete":null}class gr{constructor(e,r,n=-1){this.source=e,this.state=r,this.explicitPos=n}hasResult(){return!1}update(e,r){let n=Nf(e),i=this;n?i=i.handleUserEvent(e,n,r):e.docChanged?i=i.handleChange(e):e.selection&&i.state!=0&&(i=new gr(i.source,0));for(let a of e.effects)if(a.is(zh))i=new gr(i.source,1,a.value?Gn(e.state):-1);else if(a.is(ds))i=new gr(i.source,0);else if(a.is(kb))for(let s of a.value)s.source==i.source&&(i=s);return i}handleUserEvent(e,r,n){return r=="delete"||!n.activateOnTyping?this.map(e.changes):new gr(this.source,1)}handleChange(e){return e.changes.touchesRange(Gn(e.startState))?new gr(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new gr(this.source,this.state,e.mapPos(this.explicitPos))}}class Ki extends gr{constructor(e,r,n,i,a){super(e,2,r),this.result=n,this.from=i,this.to=a}hasResult(){return!0}handleUserEvent(e,r,n){var i;let a=e.changes.mapPos(this.from),s=e.changes.mapPos(this.to,1),l=Gn(e.state);if((this.explicitPos<0?l<=a:l<this.from)||l>s||r=="delete"&&Gn(e.startState)==this.from)return new gr(this.source,r=="input"&&n.activateOnTyping?1:0);let u=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos),c;return o6(this.result.validFor,e.state,a,s)?new Ki(this.source,u,this.result,a,s):this.result.update&&(c=this.result.update(this.result,a,s,new Mb(e.state,l,u>=0)))?new Ki(this.source,u,c,c.from,(i=c.to)!==null&&i!==void 0?i:Gn(e.state)):new gr(this.source,1,u)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new gr(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new Ki(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1))}}function o6(t,e,r,n){if(!t)return!1;let i=e.sliceDoc(r,n);return typeof t=="function"?t(i,r,n,e):_b(t,!0).test(i)}const kb=Ze.define({map(t,e){return t.map(r=>r.map(e))}}),Pb=Ze.define(),mr=rr.define({create(){return pl.start()},update(t,e){return t.update(e)},provide:t=>[Ih.from(t,e=>e.tooltip),Be.contentAttributes.from(t,e=>e.attrs)]});function Ib(t,e){const r=e.completion.apply||e.completion.label;let n=t.state.field(mr).active.find(i=>i.source==e.source);return n instanceof Ki?(typeof r=="string"?t.dispatch(Object.assign(Object.assign({},QV(t.state,r,n.from,n.to)),{annotations:XV.of(e.completion)})):r(t,e.completion,n.from,n.to),!0):!1}const l6=t6(mr,Ib);function mo(t,e="option"){return r=>{let n=r.state.field(mr,!1);if(!n||!n.open||n.open.disabled||Date.now()-n.open.timestamp<r.state.facet(sr).interactionDelay)return!1;let i=1,a;e=="page"&&(a=yy(r,n.open.tooltip))&&(i=Math.max(2,Math.floor(a.dom.offsetHeight/a.dom.querySelector("li").offsetHeight)-1));let{length:s}=n.open.options,l=n.open.selected>-1?n.open.selected+i*(t?1:-1):t?0:s-1;return l<0?l=e=="page"?0:s-1:l>=s&&(l=e=="page"?s-1:0),r.dispatch({effects:Pb.of(l)}),!0}}const Db=t=>{let e=t.state.field(mr,!1);return t.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<t.state.facet(sr).interactionDelay?!1:Ib(t,e.open.options[e.open.selected])},c6=t=>t.state.field(mr,!1)?(t.dispatch({effects:zh.of(!0)}),!0):!1,u6=t=>{let e=t.state.field(mr,!1);return!e||!e.active.some(r=>r.state!=0)?!1:(t.dispatch({effects:ds.of(null)}),!0)};class f6{constructor(e,r){this.active=e,this.context=r,this.time=Date.now(),this.updates=[],this.done=void 0}}const h6=50,d6=1e3,p6=It.fromClass(class{constructor(t){this.view=t,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of t.state.field(mr).active)e.state==1&&this.startQuery(e)}update(t){let e=t.state.field(mr);if(!t.selectionSet&&!t.docChanged&&t.startState.field(mr)==e)return;let r=t.transactions.some(n=>(n.selection||n.docChanged)&&!Nf(n));for(let n=0;n<this.running.length;n++){let i=this.running[n];if(r||i.updates.length+t.transactions.length>h6&&Date.now()-i.time>d6){for(let a of i.context.abortListeners)try{a()}catch(s){kr(this.view.state,s)}i.context.abortListeners=null,this.running.splice(n--,1)}else i.updates.push(...t.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some(n=>n.state==1&&!this.running.some(i=>i.active.source==n.source))?setTimeout(()=>this.startUpdate(),50):-1,this.composing!=0)for(let n of t.transactions)Nf(n)=="input"?this.composing=2:this.composing==2&&n.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:t}=this.view,e=t.field(mr);for(let r of e.active)r.state==1&&!this.running.some(n=>n.active.source==r.source)&&this.startQuery(r)}startQuery(t){let{state:e}=this.view,r=Gn(e),n=new Mb(e,r,t.explicitPos==r),i=new f6(t,n);this.running.push(i),Promise.resolve(t.source(n)).then(a=>{i.context.aborted||(i.done=a||null,this.scheduleAccept())},a=>{this.view.dispatch({effects:ds.of(null)}),kr(this.view.state,a)})}scheduleAccept(){this.running.every(t=>t.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(sr).updateSyncTime))}accept(){var t;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],r=this.view.state.facet(sr);for(let n=0;n<this.running.length;n++){let i=this.running[n];if(i.done===void 0)continue;if(this.running.splice(n--,1),i.done){let s=new Ki(i.active.source,i.active.explicitPos,i.done,i.done.from,(t=i.done.to)!==null&&t!==void 0?t:Gn(i.updates.length?i.updates[0].startState:this.view.state));for(let l of i.updates)s=s.update(l,r);if(s.hasResult()){e.push(s);continue}}let a=this.view.state.field(mr).active.find(s=>s.source==i.active.source);if(a&&a.state==1)if(i.done==null){let s=new gr(i.active.source,0);for(let l of i.updates)s=s.update(l,r);s.state!=1&&e.push(s)}else this.startQuery(a)}e.length&&this.view.dispatch({effects:kb.of(e)})}},{eventHandlers:{blur(t){let e=this.view.state.field(mr,!1);if(e&&e.tooltip&&this.view.state.facet(sr).closeOnBlur){let r=e.open&&yy(this.view,e.open.tooltip);(!r||!r.dom.contains(t.relatedTarget))&&this.view.dispatch({effects:ds.of(null)})}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:zh.of(!1)}),20),this.composing=0}}}),g6=Be.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),ps={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},pi=Ze.define({map(t,e){let r=e.mapPos(t,-1,fr.TrackAfter);return r??void 0}}),qh=new class extends Ai{};qh.startSide=1;qh.endSide=-1;const Lb=rr.define({create(){return ut.empty},update(t,e){if(t=t.map(e.changes),e.selection){let r=e.state.doc.lineAt(e.selection.main.head);t=t.update({filter:n=>n>=r.from&&n<=r.to})}for(let r of e.effects)r.is(pi)&&(t=t.update({add:[qh.range(r.value,r.value+1)]}));return t}});function m6(){return[y6,Lb]}const uu="()[]{}<>";function Bb(t){for(let e=0;e<uu.length;e+=2)if(uu.charCodeAt(e)==t)return uu.charAt(e+1);return wh(t<128?t:t+1)}function Ub(t,e){return t.languageDataAt("closeBrackets",e)[0]||ps}const v6=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),y6=Be.inputHandler.of((t,e,r,n)=>{if((v6?t.composing:t.compositionStarted)||t.state.readOnly)return!1;let i=t.state.selection.main;if(n.length>2||n.length==2&&Nr(Zt(n,0))==1||e!=i.from||r!=i.to)return!1;let a=O6(t.state,n);return a?(t.dispatch(a),!0):!1}),b6=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let n=Ub(t,t.selection.main.head).brackets||ps.brackets,i=null,a=t.changeByRange(s=>{if(s.empty){let l=A6(t.doc,s.head);for(let u of n)if(u==l&&hc(t.doc,s.head)==Bb(Zt(u,0)))return{changes:{from:s.head-u.length,to:s.head+u.length},range:Ee.cursor(s.head-u.length)}}return{range:i=s}});return i||e(t.update(a,{scrollIntoView:!0,userEvent:"delete.backward"})),!i},E6=[{key:"Backspace",run:b6}];function O6(t,e){let r=Ub(t,t.selection.main.head),n=r.brackets||ps.brackets;for(let i of n){let a=Bb(Zt(i,0));if(e==i)return a==i?S6(t,i,n.indexOf(i+i+i)>-1,r):C6(t,i,a,r.before||ps.before);if(e==a&&$b(t,t.selection.main.from))return w6(t,i,a)}return null}function $b(t,e){let r=!1;return t.field(Lb).between(0,t.doc.length,n=>{n==e&&(r=!0)}),r}function hc(t,e){let r=t.sliceString(e,e+2);return r.slice(0,Nr(Zt(r,0)))}function A6(t,e){let r=t.sliceString(e-2,e);return Nr(Zt(r,0))==r.length?r:r.slice(1)}function C6(t,e,r,n){let i=null,a=t.changeByRange(s=>{if(!s.empty)return{changes:[{insert:e,from:s.from},{insert:r,from:s.to}],effects:pi.of(s.to+e.length),range:Ee.range(s.anchor+e.length,s.head+e.length)};let l=hc(t.doc,s.head);return!l||/\s/.test(l)||n.indexOf(l)>-1?{changes:{insert:e+r,from:s.head},effects:pi.of(s.head+e.length),range:Ee.cursor(s.head+e.length)}:{range:i=s}});return i?null:t.update(a,{scrollIntoView:!0,userEvent:"input.type"})}function w6(t,e,r){let n=null,i=t.changeByRange(a=>a.empty&&hc(t.doc,a.head)==r?{changes:{from:a.head,to:a.head+r.length,insert:r},range:Ee.cursor(a.head+r.length)}:n={range:a});return n?null:t.update(i,{scrollIntoView:!0,userEvent:"input.type"})}function S6(t,e,r,n){let i=n.stringPrefixes||ps.stringPrefixes,a=null,s=t.changeByRange(l=>{if(!l.empty)return{changes:[{insert:e,from:l.from},{insert:e,from:l.to}],effects:pi.of(l.to+e.length),range:Ee.range(l.anchor+e.length,l.head+e.length)};let u=l.head,c=hc(t.doc,u),o;if(c==e){if(Sm(t,u))return{changes:{insert:e+e,from:u},effects:pi.of(u+e.length),range:Ee.cursor(u+e.length)};if($b(t,u)){let h=r&&t.sliceDoc(u,u+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:u,to:u+h.length,insert:h},range:Ee.cursor(u+h.length)}}}else{if(r&&t.sliceDoc(u-2*e.length,u)==e+e&&(o=Tm(t,u-2*e.length,i))>-1&&Sm(t,o))return{changes:{insert:e+e+e+e,from:u},effects:pi.of(u+e.length),range:Ee.cursor(u+e.length)};if(t.charCategorizer(u)(c)!=Tt.Word&&Tm(t,u,i)>-1&&!T6(t,u,e,i))return{changes:{insert:e+e,from:u},effects:pi.of(u+e.length),range:Ee.cursor(u+e.length)}}return{range:a=l}});return a?null:t.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function Sm(t,e){let r=tr(t).resolveInner(e+1);return r.parent&&r.from==e}function T6(t,e,r,n){let i=tr(t).resolveInner(e,-1),a=n.reduce((s,l)=>Math.max(s,l.length),0);for(let s=0;s<5;s++){let l=t.sliceDoc(i.from,Math.min(i.to,i.from+r.length+a)),u=l.indexOf(r);if(!u||u>-1&&n.indexOf(l.slice(0,u))>-1){let o=i.firstChild;for(;o&&o.from==i.from&&o.to-o.from>r.length+u;){if(t.sliceDoc(o.to-r.length,o.to)==r)return!1;o=o.firstChild}return!0}let c=i.to==e&&i.parent;if(!c)break;i=c}return!1}function Tm(t,e,r){let n=t.charCategorizer(e);if(n(t.sliceDoc(e-1,e))!=Tt.Word)return e;for(let i of r){let a=e-i.length;if(t.sliceDoc(a,e)==i&&n(t.sliceDoc(a-1,a))!=Tt.Word)return a}return-1}function Fb(t={}){return[mr,sr.of(t),p6,R6,g6]}const Vb=[{key:"Ctrl-Space",run:c6},{key:"Escape",run:u6},{key:"ArrowDown",run:mo(!0)},{key:"ArrowUp",run:mo(!1)},{key:"PageDown",run:mo(!0,"page")},{key:"PageUp",run:mo(!1,"page")},{key:"Enter",run:Db}],R6=ya.highest(Ps.computeN([sr],t=>t.facet(sr).defaultKeymap?[Vb]:[]));function N6(t){let e=t.field(mr,!1);return e&&e.active.some(r=>r.state==1)?"pending":e&&e.active.some(r=>r.state!=0)?"active":null}class x6{constructor(e,r,n){this.from=e,this.to=r,this.diagnostic=n}}class hi{constructor(e,r,n){this.diagnostics=e,this.panel=r,this.selected=n}static init(e,r,n){let i=e,a=n.facet(Gb).markerFilter;a&&(i=a(i));let s=qe.set(i.map(l=>l.from==l.to||l.from==l.to-1&&n.doc.lineAt(l.from).to==l.from?qe.widget({widget:new U6(l),diagnostic:l}).range(l.from):qe.mark({attributes:{class:"cm-lintRange cm-lintRange-"+l.severity+(l.markClass?" "+l.markClass:"")},diagnostic:l}).range(l.from,l.to)),!0);return new hi(s,r,na(s))}}function na(t,e=null,r=0){let n=null;return t.between(r,1e9,(i,a,{spec:s})=>{if(!(e&&s.diagnostic!=e))return n=new x6(i,a,s.diagnostic),!1}),n}function M6(t,e){let r=t.startState.doc.lineAt(e.pos);return!!(t.effects.some(n=>n.is(Wb))||t.changes.touchesRange(r.from,r.to))}function _6(t,e){return t.field(Tr,!1)?e:e.concat(Ze.appendConfig.of(V6))}const Wb=Ze.define(),Yh=Ze.define(),Hb=Ze.define(),Tr=rr.define({create(){return new hi(qe.none,null,null)},update(t,e){if(e.docChanged){let r=t.diagnostics.map(e.changes),n=null;if(t.selected){let i=e.changes.mapPos(t.selected.from,1);n=na(r,t.selected.diagnostic,i)||na(r,null,i)}t=new hi(r,t.panel,n)}for(let r of e.effects)r.is(Wb)?t=hi.init(r.value,t.panel,e.state):r.is(Yh)?t=new hi(t.diagnostics,r.value?dc.open:null,t.selected):r.is(Hb)&&(t=new hi(t.diagnostics,t.panel,r.value));return t},provide:t=>[us.from(t,e=>e.panel),Be.decorations.from(t,e=>e.diagnostics)]}),k6=qe.mark({class:"cm-lintRange cm-lintRange-active"});function P6(t,e,r){let{diagnostics:n}=t.state.field(Tr),i=[],a=2e8,s=0;n.between(e-(r<0?1:0),e+(r>0?1:0),(u,c,{spec:o})=>{e>=u&&e<=c&&(u==c||(e>u||r>0)&&(e<c||r<0))&&(i.push(o.diagnostic),a=Math.min(u,a),s=Math.max(c,s))});let l=t.state.facet(Gb).tooltipFilter;return l&&(i=l(i)),i.length?{pos:a,end:s,above:t.state.doc.lineAt(a).to<s,create(){return{dom:I6(t,i)}}}:null}function I6(t,e){return vt("ul",{class:"cm-tooltip-lint"},e.map(r=>qb(t,r,!1)))}const D6=t=>{let e=t.state.field(Tr,!1);(!e||!e.panel)&&t.dispatch({effects:_6(t.state,[Yh.of(!0)])});let r=cs(t,dc.open);return r&&r.dom.querySelector(".cm-panel-lint ul").focus(),!0},Rm=t=>{let e=t.state.field(Tr,!1);return!e||!e.panel?!1:(t.dispatch({effects:Yh.of(!1)}),!0)},L6=t=>{let e=t.state.field(Tr,!1);if(!e)return!1;let r=t.state.selection.main,n=e.diagnostics.iter(r.to+1);return!n.value&&(n=e.diagnostics.iter(0),!n.value||n.from==r.from&&n.to==r.to)?!1:(t.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0}),!0)},B6=[{key:"Mod-Shift-m",run:D6,preventDefault:!0},{key:"F8",run:L6}],Gb=$e.define({combine(t){return Object.assign({sources:t.map(e=>e.source)},yn(t.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null},{needsRefresh:(e,r)=>e?r?n=>e(n)||r(n):e:r}))}});function zb(t){let e=[];if(t)e:for(let{name:r}of t){for(let n=0;n<r.length;n++){let i=r[n];if(/[a-zA-Z]/.test(i)&&!e.some(a=>a.toLowerCase()==i.toLowerCase())){e.push(i);continue e}}e.push("")}return e}function qb(t,e,r){var n;let i=r?zb(e.actions):[];return vt("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},vt("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage():e.message),(n=e.actions)===null||n===void 0?void 0:n.map((a,s)=>{let l=!1,u=h=>{if(h.preventDefault(),l)return;l=!0;let d=na(t.state.field(Tr).diagnostics,e);d&&a.apply(t,d.from,d.to)},{name:c}=a,o=i[s]?c.indexOf(i[s]):-1,f=o<0?c:[c.slice(0,o),vt("u",c.slice(o,o+1)),c.slice(o+1)];return vt("button",{type:"button",class:"cm-diagnosticAction",onclick:u,onmousedown:u,"aria-label":` Action: ${c}${o<0?"":` (access key "${i[s]})"`}.`},f)}),e.source&&vt("div",{class:"cm-diagnosticSource"},e.source))}class U6 extends kn{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return vt("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class Nm{constructor(e,r){this.diagnostic=r,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=qb(e,r,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class dc{constructor(e){this.view=e,this.items=[];let r=i=>{if(i.keyCode==27)Rm(this.view),this.view.focus();else if(i.keyCode==38||i.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(i.keyCode==40||i.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(i.keyCode==36)this.moveSelection(0);else if(i.keyCode==35)this.moveSelection(this.items.length-1);else if(i.keyCode==13)this.view.focus();else if(i.keyCode>=65&&i.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:a}=this.items[this.selectedIndex],s=zb(a.actions);for(let l=0;l<s.length;l++)if(s[l].toUpperCase().charCodeAt(0)==i.keyCode){let u=na(this.view.state.field(Tr).diagnostics,a);u&&a.actions[l].apply(e,u.from,u.to)}}else return;i.preventDefault()},n=i=>{for(let a=0;a<this.items.length;a++)this.items[a].dom.contains(i.target)&&this.moveSelection(a)};this.list=vt("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:r,onclick:n}),this.dom=vt("div",{class:"cm-panel-lint"},this.list,vt("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>Rm(this.view)},"×")),this.update()}get selectedIndex(){let e=this.view.state.field(Tr).selected;if(!e)return-1;for(let r=0;r<this.items.length;r++)if(this.items[r].diagnostic==e.diagnostic)return r;return-1}update(){let{diagnostics:e,selected:r}=this.view.state.field(Tr),n=0,i=!1,a=null;for(e.between(0,this.view.state.doc.length,(s,l,{spec:u})=>{let c=-1,o;for(let f=n;f<this.items.length;f++)if(this.items[f].diagnostic==u.diagnostic){c=f;break}c<0?(o=new Nm(this.view,u.diagnostic),this.items.splice(n,0,o),i=!0):(o=this.items[c],c>n&&(this.items.splice(n,c-n),i=!0)),r&&o.diagnostic==r.diagnostic?o.dom.hasAttribute("aria-selected")||(o.dom.setAttribute("aria-selected","true"),a=o):o.dom.hasAttribute("aria-selected")&&o.dom.removeAttribute("aria-selected"),n++});n<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)i=!0,this.items.pop();this.items.length==0&&(this.items.push(new Nm(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),i=!0),a?(this.list.setAttribute("aria-activedescendant",a.id),this.view.requestMeasure({key:this,read:()=>({sel:a.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:s,panel:l})=>{let u=l.height/this.list.offsetHeight;s.top<l.top?this.list.scrollTop-=(l.top-s.top)/u:s.bottom>l.bottom&&(this.list.scrollTop+=(s.bottom-l.bottom)/u)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),i&&this.sync()}sync(){let e=this.list.firstChild;function r(){let n=e;e=n.nextSibling,n.remove()}for(let n of this.items)if(n.dom.parentNode==this.list){for(;e!=n.dom;)r();e=n.dom.nextSibling}else this.list.insertBefore(n.dom,e);for(;e;)r()}moveSelection(e){if(this.selectedIndex<0)return;let r=this.view.state.field(Tr),n=na(r.diagnostics,this.items[e].diagnostic);n&&this.view.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:Hb.of(n)})}static open(e){return new dc(e)}}function $6(t,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(t)}</svg>')`}function vo(t){return $6(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${t}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const F6=Be.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:vo("#d11")},".cm-lintRange-warning":{backgroundImage:vo("orange")},".cm-lintRange-info":{backgroundImage:vo("#999")},".cm-lintRange-hint":{backgroundImage:vo("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}}),V6=[Tr,Be.decorations.compute([Tr],t=>{let{selected:e,panel:r}=t.field(Tr);return!e||!r||e.from==e.to?qe.none:qe.set([k6.range(e.from,e.to)])}),K4(P6,{hideOn:M6}),F6],Yb=[a9(),l9(),w4(),y8(),z9(),d4(),y4(),rt.allowMultipleSelections.of(!0),_9(),By(Q9,{fallback:!0}),r8(),m6(),Fb(),U4(),V4(),M4(),CV(),Ps.of([...E6,...yV,...WV,...R8,...V9,...Vb,...B6])],W6=qt({name:"VmaFormulaGridCompTextarea",props:{type:{type:String,default:"default"},modelValue:[String,Number],immediate:{type:Boolean,default:!1},name:String,readonly:Boolean,disabled:Boolean,placeholder:String,maxlength:[String,Number],size:{type:String,default:"normal"},rows:{type:[String,Number],default:2},wrap:{type:Boolean,default:!0},autofocus:{type:Boolean,default:!0}},emits:["update:modelValue","input","change","focus","blur","keydown","keyup"],setup(t,e){const{emit:r}=e,n=bi("$vmaFormulaGrid",{}),{currentCellEditorStyle:i}=n.reactiveData;let a;Si(()=>{const ne=s.value;a=mu(()=>{ve()}),ne&&a.observe(ne)}),El(()=>{a&&a.disconnect()});const s=He(),l=He(),u=He(),c=He(),o=He(),f=Ft("VmaFormulaGridCompCodeMirror");let h=null;const d={refElem:s,refTextarea:o,refLinesDiv:l,refCountHelperDiv:u,refCountTargetHelperDiv:c},p=Ir({initiated:!1,isActivated:!1,inputValue:t.modelValue}),g={uId:Pt.create().toString(),props:t,context:e,reactiveData:p,getRefs:()=>d};yt(()=>t.modelValue,ne=>{p.inputValue=ne});const m=it(()=>{const{placeholder:ne}=t;return ne||""}),v=it(()=>{const{immediate:ne}=t;return ne});let b={};b={dispatchEvent(ne,se,de){r(ne,{$input:g,...se,payload:de})},focus(){return p.isActivated=!0,h&&h.view.focus(),gt()},blur(){return h&&h.view.blur(),p.isActivated=!1,gt()}},Object.assign(g,b);const C=ne=>{p.inputValue=ne,b.dispatchEvent("input",{value:ne}),r("update:modelValue",ne),b.dispatchEvent("change",{value:ne})},A=(ne,se)=>{const{inputValue:de}=p;b.dispatchEvent(ne,{value:de})},O=ne=>{N(ne),v.value?A("change"):C(p.inputValue)},w=ne=>{p.isActivated=!0,A("focus")},S=(ne,se)=>{const{inputValue:de}=p;v.value||C(de),p.isActivated=!1,b.dispatchEvent("blur",{value:de},se)},N=ne=>{const se=v.value;p.inputValue=ne,se?C(ne):b.dispatchEvent("input",{value:ne})},R=Ir({indentWithTab:!0,tabSize:4,backgroundColor:"white",language:"",phrases:{}}),k=Ls.define([{tag:Se.name,color:"green"},{tag:Se.bool,color:"#A020F0"},{tag:Se.color,color:"#0000FF"},{tag:Se.invalid,color:"#FA6F66"}]),z=new Oi,Y=new Oi,re=[Yb,Ps.of([gW]),By(k),mW(),Be.lineWrapping,W4({parent:document.body})],Q=it(()=>[...re,z.of(fW()),Y.of([])]),ae=ne=>{h=ne,dW(ne.view,Y)},ve=()=>{i.resized=!0,i.height=`${s.value.offsetHeight}px`,i.width=`${s.value.offsetWidth}px`},J=()=>{const{inputValue:ne,isActivated:se}=p,{disabled:de,readonly:be,rows:Ae,wrap:Te,autofocus:_e}=t,ke=m.value;return X("div",{ref:s,class:["vma-formula-grid-textarea",t.size,t.type,{"is--active":se,"is--disabled":de}],onResize:ve},[X(f,{ref:o,class:"codemirror",autofocus:t.autofocus,placeholder:ke,indentWithTab:R.indentWithTab,tabSize:R.tabSize,disabled:t.disabled,style:{backgroundColor:R.backgroundColor,width:"100%",height:"100%"},extensions:Q.value,modelValue:ne==null?"":`${ne}`,phrases:R.phrases,onReady:ae,onChange:O,onFocus:w,onBlur:S})])};return g.renderVN=J,g},render(){return this.renderVN()}}),H6=qt({name:"VmaFormulaGridCompButton",props:{text:String,icon:String,color:String,block:Boolean,plain:Boolean,round:Boolean,square:Boolean,loading:Boolean,disabled:Boolean,iconPrefix:String,loadingText:String,loadingCategory:String,type:{type:String,default:"default"},size:{type:String,default:"normal"},iconPosition:{type:String,default:"left"}},emits:["click"],setup(t,e){const{slots:r,emit:n}=e,i={uId:Pt.create().toString(),props:t,context:e},a=Ft("VmaFormulaGridCompButton"),s=Ft("VmaFormulaGridCompIcon"),l=()=>{let p;return t.loading?p=t.loadingText:p=r.default?r.default({}):t.text,p?X("span",{class:["text"]},p):st()},u=()=>r.loading?r.loading():X(a,{size:t.size,type:t.type,category:t.loadingCategory,style:{display:"inline-block"},currentColor:!0}),c=()=>t.loading?u():t.icon?X(s,{name:t.icon,size:t.size,type:t.type,color:"currentColor"}):st(),o=()=>{const{color:p,plain:g}=t;if(p){const m={};return m.color=g?p:"white",g||(m.background=p),p.indexOf("gradient")!==-1?m.border=0:m.borderColor=p,m}return{}},f=p=>{!t.loading&&!t.disabled&&n("click",p)},h=it(()=>{const p=["vma-formula-grid-button",t.size,t.type];return t.plain&&p.push("plain"),t.block&&p.push("block"),t.round&&p.push("round"),t.square&&p.push("square"),t.loading&&p.push("loading"),t.disabled&&p.push("disabled"),p}),d=()=>X("button",{class:h.value,style:o(),disabled:t.disabled,onClick:f},[X("div",{class:["content"]},[t.iconPosition==="left"&&c(),l(),t.iconPosition==="right"&&c()])]);return i.renderVN=d,or("$vmaFormulaGridCompButton",i),i},render(){return this.renderVN()}}),G6=qt({name:"VmaFormulaGridCompLoading",props:{size:{type:String,default:"normal"},currentColor:{type:Boolean,default:!1},vertical:Boolean,type:{type:String,default:"default"},category:{type:String,default:"circle-fade"}},setup(t,e){const{slots:r}=e,n={uId:Pt.create().toString(),props:t,context:e},i=it(()=>t.type),a=it(()=>t.size),s=()=>{const c=r.default?r.default({}):()=>"";return X("span",{class:["text",i.value,a.value],style:{display:t.vertical?"block":"inline-block"}},c)},l=()=>{if(t.category==="plane")return st();if(t.category==="chase"){const c=[];return c.push(X("div",{class:"chase-dot"})),c.push(X("div",{class:"chase-dot"})),c.push(X("div",{class:"chase-dot"})),c.push(X("div",{class:"chase-dot"})),c.push(X("div",{class:"chase-dot"})),c.push(X("div",{class:"chase-dot"})),c}if(t.category==="bounce"){const c=[];return c.push(X("div",{class:"bounce-dot"})),c.push(X("div",{class:"bounce-dot"})),c}if(t.category==="wave"){const c=[];return c.push(X("div",{class:"wave-rect"})),c.push(X("div",{class:"wave-rect"})),c.push(X("div",{class:"wave-rect"})),c.push(X("div",{class:"wave-rect"})),c.push(X("div",{class:"wave-rect"})),c}if(t.category==="pulse")return st();if(t.category==="flow"){const c=[];return c.push(X("div",{class:"flow-dot"})),c.push(X("div",{class:"flow-dot"})),c.push(X("div",{class:"flow-dot"})),c}if(t.category==="swing"){const c=[];return c.push(X("div",{class:"swing-dot"})),c.push(X("div",{class:"swing-dot"})),c}if(t.category==="circle"){const c=[];return c.push(X("div",{class:"circle-dot"})),c.push(X("div",{class:"circle-dot"})),c.push(X("div",{class:"circle-dot"})),c.push(X("div",{class:"circle-dot"})),c.push(X("div",{class:"circle-dot"})),c.push(X("div",{class:"circle-dot"})),c.push(X("div",{class:"circle-dot"})),c.push(X("div",{class:"circle-dot"})),c.push(X("div",{class:"circle-dot"})),c.push(X("div",{class:"circle-dot"})),c.push(X("div",{class:"circle-dot"})),c.push(X("div",{class:"circle-dot"})),c}if(t.category==="circle-fade"){const c=[];return c.push(X("div",{class:"circle-fade-dot"})),c.push(X("div",{class:"circle-fade-dot"})),c.push(X("div",{class:"circle-fade-dot"})),c.push(X("div",{class:"circle-fade-dot"})),c.push(X("div",{class:"circle-fade-dot"})),c.push(X("div",{class:"circle-fade-dot"})),c.push(X("div",{class:"circle-fade-dot"})),c.push(X("div",{class:"circle-fade-dot"})),c.push(X("div",{class:"circle-fade-dot"})),c.push(X("div",{class:"circle-fade-dot"})),c.push(X("div",{class:"circle-fade-dot"})),c.push(X("div",{class:"circle-fade-dot"})),c}if(t.category==="fold"){const c=[];return c.push(X("div",{class:"fold-cube"})),c.push(X("div",{class:"fold-cube"})),c.push(X("div",{class:"fold-cube"})),c.push(X("div",{class:"fold-cube"})),c}return st()},u=()=>X("div",{class:["vma-formula-grid-loading",{vertical:t.vertical}]},[X("div",{class:[{plane:t.category==="plane",chase:t.category==="chase",bounce:t.category==="bounce",wave:t.category==="wave",pulse:t.category==="pulse",flow:t.category==="flow",swing:t.category==="swing",circle:t.category==="circle","circle-fade":t.category==="circle-fade",fold:t.category==="fold",currentColor:t.currentColor},i.value,a.value]},l()),s()]);return n.renderVN=u,or("$vmaFormulaGridCompLoading",n),n},render(){return this.renderVN()}});function gl(t){"@babel/helpers - typeof";return gl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gl(t)}var z6=/^\s+/,q6=/\s+$/;function Pe(t,e){if(t=t||"",e=e||{},t instanceof Pe)return t;if(!(this instanceof Pe))return new Pe(t,e);var r=Y6(t);this._originalInput=t,this._r=r.r,this._g=r.g,this._b=r.b,this._a=r.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||r.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=r.ok}Pe.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),r,n,i,a,s,l;return r=e.r/255,n=e.g/255,i=e.b/255,r<=.03928?a=r/12.92:a=Math.pow((r+.055)/1.055,2.4),n<=.03928?s=n/12.92:s=Math.pow((n+.055)/1.055,2.4),i<=.03928?l=i/12.92:l=Math.pow((i+.055)/1.055,2.4),.2126*a+.7152*s+.0722*l},setAlpha:function(e){return this._a=Xb(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=Mm(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=Mm(this._r,this._g,this._b),r=Math.round(e.h*360),n=Math.round(e.s*100),i=Math.round(e.v*100);return this._a==1?"hsv("+r+", "+n+"%, "+i+"%)":"hsva("+r+", "+n+"%, "+i+"%, "+this._roundA+")"},toHsl:function(){var e=xm(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=xm(this._r,this._g,this._b),r=Math.round(e.h*360),n=Math.round(e.s*100),i=Math.round(e.l*100);return this._a==1?"hsl("+r+", "+n+"%, "+i+"%)":"hsla("+r+", "+n+"%, "+i+"%, "+this._roundA+")"},toHex:function(e){return _m(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return j6(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(Ct(this._r,255)*100)+"%",g:Math.round(Ct(this._g,255)*100)+"%",b:Math.round(Ct(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(Ct(this._r,255)*100)+"%, "+Math.round(Ct(this._g,255)*100)+"%, "+Math.round(Ct(this._b,255)*100)+"%)":"rgba("+Math.round(Ct(this._r,255)*100)+"%, "+Math.round(Ct(this._g,255)*100)+"%, "+Math.round(Ct(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:c7[_m(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var r="#"+km(this._r,this._g,this._b,this._a),n=r,i=this._gradientType?"GradientType = 1, ":"";if(e){var a=Pe(e);n="#"+km(a._r,a._g,a._b,a._a)}return"progid:DXImageTransform.Microsoft.gradient("+i+"startColorstr="+r+",endColorstr="+n+")"},toString:function(e){var r=!!e;e=e||this._format;var n=!1,i=this._a<1&&this._a>=0,a=!r&&i&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return a?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(n=this.toRgbString()),e==="prgb"&&(n=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(n=this.toHexString()),e==="hex3"&&(n=this.toHexString(!0)),e==="hex4"&&(n=this.toHex8String(!0)),e==="hex8"&&(n=this.toHex8String()),e==="name"&&(n=this.toName()),e==="hsl"&&(n=this.toHslString()),e==="hsv"&&(n=this.toHsvString()),n||this.toHexString())},clone:function(){return Pe(this.toString())},_applyModification:function(e,r){var n=e.apply(null,[this].concat([].slice.call(r)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(t7,arguments)},brighten:function(){return this._applyModification(r7,arguments)},darken:function(){return this._applyModification(n7,arguments)},desaturate:function(){return this._applyModification(Z6,arguments)},saturate:function(){return this._applyModification(J6,arguments)},greyscale:function(){return this._applyModification(e7,arguments)},spin:function(){return this._applyModification(i7,arguments)},_applyCombination:function(e,r){return e.apply(null,[this].concat([].slice.call(r)))},analogous:function(){return this._applyCombination(o7,arguments)},complement:function(){return this._applyCombination(a7,arguments)},monochromatic:function(){return this._applyCombination(l7,arguments)},splitcomplement:function(){return this._applyCombination(s7,arguments)},triad:function(){return this._applyCombination(Pm,[3])},tetrad:function(){return this._applyCombination(Pm,[4])}};Pe.fromRatio=function(t,e){if(gl(t)=="object"){var r={};for(var n in t)t.hasOwnProperty(n)&&(n==="a"?r[n]=t[n]:r[n]=Ya(t[n]));t=r}return Pe(t,e)};function Y6(t){var e={r:0,g:0,b:0},r=1,n=null,i=null,a=null,s=!1,l=!1;return typeof t=="string"&&(t=d7(t)),gl(t)=="object"&&(On(t.r)&&On(t.g)&&On(t.b)?(e=X6(t.r,t.g,t.b),s=!0,l=String(t.r).substr(-1)==="%"?"prgb":"rgb"):On(t.h)&&On(t.s)&&On(t.v)?(n=Ya(t.s),i=Ya(t.v),e=K6(t.h,n,i),s=!0,l="hsv"):On(t.h)&&On(t.s)&&On(t.l)&&(n=Ya(t.s),a=Ya(t.l),e=Q6(t.h,n,a),s=!0,l="hsl"),t.hasOwnProperty("a")&&(r=t.a)),r=Xb(r),{ok:s,format:t.format||l,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:r}}function X6(t,e,r){return{r:Ct(t,255)*255,g:Ct(e,255)*255,b:Ct(r,255)*255}}function xm(t,e,r){t=Ct(t,255),e=Ct(e,255),r=Ct(r,255);var n=Math.max(t,e,r),i=Math.min(t,e,r),a,s,l=(n+i)/2;if(n==i)a=s=0;else{var u=n-i;switch(s=l>.5?u/(2-n-i):u/(n+i),n){case t:a=(e-r)/u+(e<r?6:0);break;case e:a=(r-t)/u+2;break;case r:a=(t-e)/u+4;break}a/=6}return{h:a,s,l}}function Q6(t,e,r){var n,i,a;t=Ct(t,360),e=Ct(e,100),r=Ct(r,100);function s(c,o,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?c+(o-c)*6*f:f<1/2?o:f<2/3?c+(o-c)*(2/3-f)*6:c}if(e===0)n=i=a=r;else{var l=r<.5?r*(1+e):r+e-r*e,u=2*r-l;n=s(u,l,t+1/3),i=s(u,l,t),a=s(u,l,t-1/3)}return{r:n*255,g:i*255,b:a*255}}function Mm(t,e,r){t=Ct(t,255),e=Ct(e,255),r=Ct(r,255);var n=Math.max(t,e,r),i=Math.min(t,e,r),a,s,l=n,u=n-i;if(s=n===0?0:u/n,n==i)a=0;else{switch(n){case t:a=(e-r)/u+(e<r?6:0);break;case e:a=(r-t)/u+2;break;case r:a=(t-e)/u+4;break}a/=6}return{h:a,s,v:l}}function K6(t,e,r){t=Ct(t,360)*6,e=Ct(e,100),r=Ct(r,100);var n=Math.floor(t),i=t-n,a=r*(1-e),s=r*(1-i*e),l=r*(1-(1-i)*e),u=n%6,c=[r,s,a,a,l,r][u],o=[l,r,r,s,a,a][u],f=[a,a,l,r,r,s][u];return{r:c*255,g:o*255,b:f*255}}function _m(t,e,r,n){var i=[Wr(Math.round(t).toString(16)),Wr(Math.round(e).toString(16)),Wr(Math.round(r).toString(16))];return n&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function j6(t,e,r,n,i){var a=[Wr(Math.round(t).toString(16)),Wr(Math.round(e).toString(16)),Wr(Math.round(r).toString(16)),Wr(Qb(n))];return i&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)&&a[3].charAt(0)==a[3].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join("")}function km(t,e,r,n){var i=[Wr(Qb(n)),Wr(Math.round(t).toString(16)),Wr(Math.round(e).toString(16)),Wr(Math.round(r).toString(16))];return i.join("")}Pe.equals=function(t,e){return!t||!e?!1:Pe(t).toRgbString()==Pe(e).toRgbString()};Pe.random=function(){return Pe.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function Z6(t,e){e=e===0?0:e||10;var r=Pe(t).toHsl();return r.s-=e/100,r.s=pc(r.s),Pe(r)}function J6(t,e){e=e===0?0:e||10;var r=Pe(t).toHsl();return r.s+=e/100,r.s=pc(r.s),Pe(r)}function e7(t){return Pe(t).desaturate(100)}function t7(t,e){e=e===0?0:e||10;var r=Pe(t).toHsl();return r.l+=e/100,r.l=pc(r.l),Pe(r)}function r7(t,e){e=e===0?0:e||10;var r=Pe(t).toRgb();return r.r=Math.max(0,Math.min(255,r.r-Math.round(255*-(e/100)))),r.g=Math.max(0,Math.min(255,r.g-Math.round(255*-(e/100)))),r.b=Math.max(0,Math.min(255,r.b-Math.round(255*-(e/100)))),Pe(r)}function n7(t,e){e=e===0?0:e||10;var r=Pe(t).toHsl();return r.l-=e/100,r.l=pc(r.l),Pe(r)}function i7(t,e){var r=Pe(t).toHsl(),n=(r.h+e)%360;return r.h=n<0?360+n:n,Pe(r)}function a7(t){var e=Pe(t).toHsl();return e.h=(e.h+180)%360,Pe(e)}function Pm(t,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var r=Pe(t).toHsl(),n=[Pe(t)],i=360/e,a=1;a<e;a++)n.push(Pe({h:(r.h+a*i)%360,s:r.s,l:r.l}));return n}function s7(t){var e=Pe(t).toHsl(),r=e.h;return[Pe(t),Pe({h:(r+72)%360,s:e.s,l:e.l}),Pe({h:(r+216)%360,s:e.s,l:e.l})]}function o7(t,e,r){e=e||6,r=r||30;var n=Pe(t).toHsl(),i=360/r,a=[Pe(t)];for(n.h=(n.h-(i*e>>1)+720)%360;--e;)n.h=(n.h+i)%360,a.push(Pe(n));return a}function l7(t,e){e=e||6;for(var r=Pe(t).toHsv(),n=r.h,i=r.s,a=r.v,s=[],l=1/e;e--;)s.push(Pe({h:n,s:i,v:a})),a=(a+l)%1;return s}Pe.mix=function(t,e,r){r=r===0?0:r||50;var n=Pe(t).toRgb(),i=Pe(e).toRgb(),a=r/100,s={r:(i.r-n.r)*a+n.r,g:(i.g-n.g)*a+n.g,b:(i.b-n.b)*a+n.b,a:(i.a-n.a)*a+n.a};return Pe(s)};Pe.readability=function(t,e){var r=Pe(t),n=Pe(e);return(Math.max(r.getLuminance(),n.getLuminance())+.05)/(Math.min(r.getLuminance(),n.getLuminance())+.05)};Pe.isReadable=function(t,e,r){var n=Pe.readability(t,e),i,a;switch(a=!1,i=p7(r),i.level+i.size){case"AAsmall":case"AAAlarge":a=n>=4.5;break;case"AAlarge":a=n>=3;break;case"AAAsmall":a=n>=7;break}return a};Pe.mostReadable=function(t,e,r){var n=null,i=0,a,s,l,u;r=r||{},s=r.includeFallbackColors,l=r.level,u=r.size;for(var c=0;c<e.length;c++)a=Pe.readability(t,e[c]),a>i&&(i=a,n=Pe(e[c]));return Pe.isReadable(t,n,{level:l,size:u})||!s?n:(r.includeFallbackColors=!1,Pe.mostReadable(t,["#fff","#000"],r))};var xf=Pe.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},c7=Pe.hexNames=u7(xf);function u7(t){var e={};for(var r in t)t.hasOwnProperty(r)&&(e[t[r]]=r);return e}function Xb(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function Ct(t,e){f7(t)&&(t="100%");var r=h7(t);return t=Math.min(e,Math.max(0,parseFloat(t))),r&&(t=parseInt(t*e,10)/100),Math.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function pc(t){return Math.min(1,Math.max(0,t))}function Cr(t){return parseInt(t,16)}function f7(t){return typeof t=="string"&&t.indexOf(".")!=-1&&parseFloat(t)===1}function h7(t){return typeof t=="string"&&t.indexOf("%")!=-1}function Wr(t){return t.length==1?"0"+t:""+t}function Ya(t){return t<=1&&(t=t*100+"%"),t}function Qb(t){return Math.round(parseFloat(t)*255).toString(16)}function Im(t){return Cr(t)/255}var $r=function(){var t="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",r="(?:"+e+")|(?:"+t+")",n="[\\s|\\(]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")\\s*\\)?",i="[\\s|\\(]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")\\s*\\)?";return{CSS_UNIT:new RegExp(r),rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+i),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function On(t){return!!$r.CSS_UNIT.exec(t)}function d7(t){t=t.replace(z6,"").replace(q6,"").toLowerCase();var e=!1;if(xf[t])t=xf[t],e=!0;else if(t=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var r;return(r=$r.rgb.exec(t))?{r:r[1],g:r[2],b:r[3]}:(r=$r.rgba.exec(t))?{r:r[1],g:r[2],b:r[3],a:r[4]}:(r=$r.hsl.exec(t))?{h:r[1],s:r[2],l:r[3]}:(r=$r.hsla.exec(t))?{h:r[1],s:r[2],l:r[3],a:r[4]}:(r=$r.hsv.exec(t))?{h:r[1],s:r[2],v:r[3]}:(r=$r.hsva.exec(t))?{h:r[1],s:r[2],v:r[3],a:r[4]}:(r=$r.hex8.exec(t))?{r:Cr(r[1]),g:Cr(r[2]),b:Cr(r[3]),a:Im(r[4]),format:e?"name":"hex8"}:(r=$r.hex6.exec(t))?{r:Cr(r[1]),g:Cr(r[2]),b:Cr(r[3]),format:e?"name":"hex"}:(r=$r.hex4.exec(t))?{r:Cr(r[1]+""+r[1]),g:Cr(r[2]+""+r[2]),b:Cr(r[3]+""+r[3]),a:Im(r[4]+""+r[4]),format:e?"name":"hex8"}:(r=$r.hex3.exec(t))?{r:Cr(r[1]+""+r[1]),g:Cr(r[2]+""+r[2]),b:Cr(r[3]+""+r[3]),format:e?"name":"hex"}:!1}function p7(t){var e,r;return t=t||{level:"AA",size:"small"},e=(t.level||"AA").toUpperCase(),r=(t.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),r!=="small"&&r!=="large"&&(r="small"),{level:e,size:r}}const Dt=t=>Math.round(t*100)/100;class cn{constructor(e){fe(this,"instance");fe(this,"alphaValue",0);fe(this,"redValue",0);fe(this,"greenValue",0);fe(this,"blueValue",0);fe(this,"hueValue",0);fe(this,"saturationValue",0);fe(this,"brightnessValue",0);fe(this,"hslSaturationValue",0);fe(this,"lightnessValue",0);fe(this,"initAlpha",()=>{const e=this.instance.getAlpha();this.alphaValue=Math.min(1,e)*100});fe(this,"initLightness",()=>{const{s:e,l:r}=this.instance.toHsl();this.hslSaturationValue=Dt(e),this.lightnessValue=Dt(r)});fe(this,"initRgb",()=>{const{r:e,g:r,b:n}=this.instance.toRgb();this.redValue=Dt(e),this.greenValue=Dt(r),this.blueValue=Dt(n)});fe(this,"initHsb",()=>{const{h:e,s:r,v:n}=this.instance.toHsv();this.hueValue=Math.min(360,Math.ceil(e)),this.saturationValue=Dt(r),this.brightnessValue=Dt(n)});fe(this,"toHexString",()=>this.instance.toHexString());fe(this,"toRgbString",()=>this.instance.toRgbString());this.instance=Pe(e),this.initRgb(),this.initHsb(),this.initLightness(),this.initAlpha()}toString(e){return this.instance.toString(e)}get hex(){return this.instance.toHex()}set hex(e){this.instance=Pe(e),this.initHsb(),this.initRgb(),this.initAlpha(),this.initLightness()}set hue(e){this.saturation===0&&this.brightness===0&&(this.saturationValue=1,this.brightnessValue=1),this.instance=Pe({h:Dt(e),s:this.saturation,v:this.brightness,a:this.alphaValue/100}),this.initRgb(),this.initLightness(),this.hueValue=Dt(e)}get hue(){return this.hueValue}set saturation(e){this.instance=Pe({h:this.hue,s:Dt(e),v:this.brightness,a:this.alphaValue/100}),this.initRgb(),this.initLightness(),this.saturationValue=Dt(e)}get saturation(){return this.saturationValue}set brightness(e){this.instance=Pe({h:this.hue,s:this.saturation,v:Dt(e),a:this.alphaValue/100}),this.initRgb(),this.initLightness(),this.brightnessValue=Dt(e)}get brightness(){return this.brightnessValue}set lightness(e){this.instance=Pe({h:this.hue,s:this.hslSaturationValue,l:Dt(e),a:this.alphaValue/100}),this.initRgb(),this.initHsb(),this.lightnessValue=Dt(e)}get lightness(){return this.lightnessValue}set red(e){const r=this.instance.toRgb();this.instance=Pe({...r,r:Dt(e),a:this.alphaValue/100}),this.initHsb(),this.initLightness(),this.redValue=Dt(e)}get red(){return this.redValue}set green(e){const r=this.instance.toRgb();this.instance=Pe({...r,g:Dt(e),a:this.alphaValue/100}),this.initHsb(),this.initLightness(),this.greenValue=Dt(e)}get green(){return this.greenValue}set blue(e){const r=this.instance.toRgb();this.instance=Pe({...r,b:Dt(e),a:this.alphaValue/100}),this.initHsb(),this.initLightness(),this.blueValue=Dt(e)}get blue(){return this.blueValue}set alpha(e){this.instance.setAlpha(e/100),this.alphaValue=e}get alpha(){return this.alphaValue}get RGB(){return[this.red,this.green,this.blue,this.alpha/100]}get HSB(){return[this.hue,this.saturation,this.brightness,this.alpha/100]}get HSL(){return[this.hue,this.hslSaturationValue,this.lightness,this.alpha/100]}}const fu=(t,e,r)=>e<r?t<e?e:t>r?r:t:t<r?r:t>e?e:t,g7=qt({name:"VmaFormulaGridCompColorPicker",props:{color:cn},emits:["update:color","change","advanceChange"],setup(t,e){const{emit:r}=e,n=bi("$vmaFormulaGrid",{}),{colorPickerStore:i}=n.reactiveData,{refGridColorPicker:a}=n.getRefs(),s=t.color||new cn,l=Ir({color:s,mode:"normal",hex:s.toHexString(),rgb:s.toRgbString()}),u=Ft("VmaFormulaGridCompColorPickerPalette"),c=Ft("VmaFormulaGridCompColorPickerBoard"),o=Ft("VmaFormulaGridCompColorPickerHue"),f=Ft("VmaFormulaGridCompColorPickerLightness"),h=Ft("VmaFormulaGridCompColorPickerDisplay"),d=He(!1),p={uId:Pt.create().toString(),props:t,context:e},g=()=>{d.value=!1,r("advanceChange",!1)},m=O=>{O==="advance"?(d.value=!0,l.mode="advance",r("advanceChange",!0)):O==="transparent"?(l.color.hex=O,l.mode="transparent",r("advanceChange",!1)):(l.color.hex=O,l.mode="normal",r("advanceChange",!1))},v=(O,w)=>{l.color.saturation=O,l.color.brightness=w},b=O=>{l.color.hue=O},C=O=>{l.color.lightness=O},A=()=>X(_f,{to:"body",disabled:!1},[X("div",{ref:a,class:["vma-formula-grid-fk-colorPicker",{"is--visible":i.visible}],style:i.style},X("div",{class:"vma-formula-grid-fk-colorPicker__inner"},[X("div",{class:"vma-formula-grid-fk-colorPicker__header"},d.value?X("span",{style:{cursor:"pointer"},onClick:g},X("div",{class:"back"})):st()),d.value?st():X(u,{onChange:m}),d.value?X(c,{color:l.color,onChange:v}):st(),d.value?X(o,{color:l.color,onChange:b}):st(),d.value?st():X(f,{color:l.color,onChange:C}),X(h,{color:l.color})]))]);return p.renderVN=A,or("$vmaFormulaGridCompColorPicker",p),yt(()=>l.color,()=>{l.hex=l.color.hex,l.rgb=l.color.toRgbString(),r("update:color",{color:l.color,mode:l.mode}),r("change",{color:l.color,mode:l.mode})},{deep:!0}),p},render(){return this.renderVN()}}),m7=qt({name:"VmaFormulaGridCompColorPickerBoard",props:{color:cn,round:{type:Boolean,default:!1},hide:{type:Boolean,default:!0}},emits:["change"],setup(t,e){var v,b,C;const{emit:r}=e,n=He(),i=He(),a=He(0),s=He(0),l=aE(),u={h:((v=t.color)==null?void 0:v.hue)||0,s:1,v:1},c=new cn(u).toHexString(),o=Ir({hueColor:c,saturation:((b=t.color)==null?void 0:b.saturation)||0,brightness:((C=t.color)==null?void 0:C.brightness)||0}),f=A=>{if(l){const O=l.vnode.el,w=O==null?void 0:O.getBoundingClientRect();let S=A.clientX-w.left,N=A.clientY-w.top;S=fu(S,0,w.width),N=fu(N,0,w.height);const R=S/w.width,k=fu(-(N/w.height)+1,0,1);s.value=S,a.value=N,o.saturation=R,o.brightness=k,r("change",R,k)}},h=A=>{A.target!==i.value&&f(A)},d=it(()=>({top:a.value+"px",left:s.value+"px"})),p=()=>{if(l){const A=l.vnode.el;s.value=o.saturation*(A==null?void 0:A.clientWidth),a.value=(1-o.brightness)*(A==null?void 0:A.clientHeight)}},g={uId:Pt.create().toString(),props:t,context:e},m=()=>X("div",{ref:i,class:["vma-formula-grid-saturation",{"vma-formula-grid-saturation__chrome":t.round,"vma-formula-grid-saturation__hidden":t.hide}],style:{backgroundColor:o.hueColor},onClick:h},[X("div",{class:"vma-formula-grid-saturation__white"}),X("div",{class:"vma-formula-grid-saturation__black"}),X("div",{ref:n,class:"vma-formula-grid-saturation__cursor",style:d.value},X("div"))]);return Si(()=>{l&&l.vnode.el&&n.value&&(bh(n.value,{drag:A=>{f(A)},end:A=>{f(A)}}),gt(()=>{p()}))}),yt(()=>t.color,A=>{Object.assign(o,{hueColor:new cn({h:A.hue,s:1,v:1}).toHexString(),saturation:A.saturation,brightness:A.brightness}),p()},{deep:!0}),g.renderVN=m,or("$vmaFormulaGridCompColorPickerBoard",g),g},render(){return this.renderVN()}}),v7=qt({name:"VmaFormulaGridCompColorPickerDisplay",props:{color:cn},emits:["update:color","change"],setup(t,e){var o,f,h,d;const{emit:r}=e,n=He("hex"),i={uId:Pt.create().toString(),props:t,context:e},a=Ir({color:t.color,hex:(o=t.color)==null?void 0:o.hex,alpha:((f=t.color)==null?void 0:f.alpha)+"%",rgba:(h=t.color)==null?void 0:h.RGB,previewBgColor:(d=t.color)==null?void 0:d.toRgbString()}),s=it(()=>({background:a.previewBgColor})),l=gu((p,g)=>{if(p.target.value){if(n.value==="hex"){const m=p.target.value.replace("#","");Pe(m).isValid()&&a.color&&(a.color.hex=m)}else if(g!==void 0&&a.rgba&&a.color){p.target.value<0&&(p.target.value=0),g===3&&p.target.value>1&&(p.target.value=1),g<3&&p.target.value>255&&(p.target.value=255),a.rgba[g]=Number(p.target.value);const[m,v,b,C]=a.rgba;a.color.hex=Pe({r:m,g:v,b}).toHex(),a.color.alpha=Math.floor(C*100)}r("update:color",a.color),r("change",a.color)}},200),u=()=>{n.value=n.value==="rgba"?"hex":"rgba",console.log(n.value)},c=()=>X("div",{class:"vma-formula-grid-display"},[X("div",{class:["vma-formula-grid-current-color","vma-formula-grid-transparent"]},X("div",{class:"color-cube",style:s.value})),n.value==="hex"?X("div",{style:"display: flex; flex: 1; gap: 4px; height: 100%"},[X("div",{class:"vma-formula-grid-color-input"},X("input",{value:a.hex,onInput:l}))]):st(),n.value==="rgba"&&a.rgba?X("div",{style:"display: flex; flex: 1; gap: 4px; height: 100%"},a.rgba.map((p,g)=>{if(g<a.rgba.length-1)return X("div",{class:"vma-formula-grid-rgb-input"},X("div",{},[X("input",{value:p,onInput:m=>l(m,g)}),X("div",{style:{marginTop:"-2px"}},`${["R","G","B"][g]}`)]))})):st(),X("div",{class:"vma-formula-grid-input-toggle",onClick:u})]);return i.renderVN=c,or("$vmaFormulaGridCompColorPickerDisplay",i),yt(()=>t.color,p=>{p&&(a.color=p,a.alpha=Math.floor(a.color.alpha)+"%",a.hex=a.color.hex,a.rgba=a.color.RGB)},{deep:!0}),yt(()=>a.color,()=>{a.color&&(a.previewBgColor=a.color.toRgbString())},{deep:!0}),i},render(){return this.renderVN()}}),y7=qt({name:"VmaFormulaGridCompColorPickerHue",props:{color:cn,size:{type:String,default:"default"}},setup(t,e){const{emit:r}=e;Si(()=>{const d={drag:p=>{u(p)},end:p=>{u(p)}};n.value&&i.value&&bh(n.value,d)});const n=He(null),i=He(null);let a=t.color||new cn;const s=Ir({hue:a.hue||0}),l={uId:Pt.create().toString(),props:t,context:e},u=d=>{if(d.stopPropagation(),n.value&&i.value){const p=n.value.getBoundingClientRect(),g=i.value.offsetWidth;let m=d.clientX-p.left;m=Math.min(m,p.width-g/2),m=Math.max(g/2,m);const v=Math.round((m-g/2)/(p.width-g)*360);a.hue=v,s.hue=v,r("change",v)}},c=d=>{d.target!==n.value&&u(d)},o=()=>{if(n.value&&i.value){const d=n.value.getBoundingClientRect(),p=i.value.offsetWidth;return s.hue===360?d.width-p/2:s.hue%360*(d.width-p)/360+p/2}return 0},f=it(()=>({left:o()+"px",top:0})),h=()=>X("div",{class:["vma-formula-grid-hue-slider"]},X("div",{ref:n,class:"vma-formula-grid-hue-slider__bar",onClick:c},X("div",{class:["vma-formula-grid-hue-slider__bar-pointer","small-slider"],ref:i,style:f.value},X("div",{class:"vma-formula-grid-hue-slider__bar-handle"}))));return yt(()=>t.color,d=>{d&&(a=d,Object.assign(s,{hue:a.hue}))},{deep:!0}),l.renderVN=h,or("$vmaFormulaGridCompColorPickerHue",l),l},render(){return this.renderVN()}}),b7=qt({name:"VmaFormulaGridCompColorPickerLightness",props:{color:cn},emits:["change"],setup(t,e){const{emit:r}=e;Si(()=>{const v={drag:b=>{p(b)},end:b=>{p(b)}};n.value&&i.value&&bh(n.value,v)}),yt(()=>t.color,v=>{if(v){s=v;const[b,C,A]=s.HSL;Object.assign(o,{hue:b,saturation:C,lightness:A})}},{deep:!0});const n=He(null),i=He(null),a={uId:Pt.create().toString(),props:t,context:e};let s=t.color||new cn;const[l,u,c]=s.HSL,o=Ir({hue:l,saturation:u,lightness:c}),f=it(()=>{const v=Pe({h:o.hue,s:o.saturation,l:.8}).toPercentageRgbString(),b=Pe({h:o.hue,s:o.saturation,l:.6}).toPercentageRgbString(),C=Pe({h:o.hue,s:o.saturation,l:.4}).toPercentageRgbString(),A=Pe({h:o.hue,s:o.saturation,l:.2}).toPercentageRgbString();return{background:[`linear-gradient(to right, rgb(255, 255, 255), ${v}, ${b}, ${C}, ${A}, rgb(0, 0, 0))`,`-webkit-linear-gradient(left, rgb(255, 255, 255), ${v}, ${b}, ${C}, ${A}, rgb(0, 0, 0))`,`-moz-linear-gradient(left, rgb(255, 255, 255), ${v}, ${b}, ${C}, ${A}, rgb(0, 0, 0))`,`-ms-linear-gradient(left, rgb(255, 255, 255), ${v}, ${b}, ${C}, ${A}, rgb(0, 0, 0))`]}}),h=()=>{if(n.value&&i.value){const v=o.lightness,b=n.value.getBoundingClientRect(),C=i.value.offsetWidth;return(1-v)*(b.width-C)+C/2}return 0},d=it(()=>({left:h()+"px",top:0})),p=v=>{if(v.stopPropagation(),n.value&&i.value){const b=n.value.getBoundingClientRect(),C=i.value.offsetWidth;let A=v.clientX-b.left;A=Math.max(C/2,A),A=Math.min(A,b.width-C/2);const O=1-(A-C/2)/(b.width-C);s.lightness=O,r("change",O)}},g=v=>{v.target!==n.value&&p(v)},m=()=>X("div",{class:["vma-formula-grid-lightness-slider"]},X("div",{ref:n,class:"vma-formula-grid-lightness-slider__bar",style:f.value,onClick:g},X("div",{ref:i,class:["vma-formula-grid-lightness-slider__bar-pointer","small-slider"],style:d.value},X("div",{class:"vma-formula-grid-lightness-slider__bar-handle"}))));return a.renderVN=m,or("$vmaFormulaGridCompColorPickerLightness",a),a},render(){return this.renderVN()}}),E7=qt({name:"VmaFormulaGridCompColorPickerPalette",props:{},emits:["change"],setup(t,e){const{emit:r}=e,n=[["#fcc02e","#f67c01","#e64a19","#d81b43","#8e24aa","#512da7","#1f87e8","#008781","#05a045"],["#fed835","#fb8c00","#f5511e","#eb1d4e","#9c28b1","#5d35b0","#2097f3","#029688","#4cb050"],["#ffeb3c","#ffa727","#fe5722","#eb4165","#aa47bc","#673bb7","#42a5f6","#26a59a","#83c683"],["#fff176","#ffb74e","#ff8a66","#f1627e","#b968c7","#7986cc","#64b5f6","#80cbc4","#a5d6a7"],["#fff59c","#ffcc80","#ffab91","#fb879e","#cf93d9","#9ea8db","#90caf8","#b2dfdc","#c8e6ca"],["transparent","#ffffff","#dedede","#a9a9a9","#4b4b4b","#353535","#212121","#000000","advance"]],i=u=>u==="transparent"?u:u==="advance"?{}:{background:Pe(u).toRgbString()},a=u=>{r("change",u)},s={uId:Pt.create().toString(),props:t,context:e},l=()=>X("div",{class:"vma-formula-grid-compact"},n.map(u=>X("div",{class:"vma-formula-grid-compact__row"},u.map(c=>X("div",{class:"vma-formula-grid-compact__color-cube--wrap",onClick:()=>a(c)},X("div",{class:["vma-formula-grid-compact__color_cube",{advance:c==="advance",transparent:c==="transparent"}],style:i(c)}))))));return s.renderVN=l,or("$vmaFormulaGridCompColorPickerPalette",s),s},render(){return this.renderVN()}}),O7=qt({name:"VmaFormulaGridCompInput",props:{modelValue:[String,Number,Date],immediate:{type:Boolean,default:!0},name:String,category:{type:String,default:"text"},clearable:{type:Boolean},readonly:Boolean,disabled:Boolean,placeholder:String,maxlength:[String,Number],size:{type:String,default:"normal"},type:{type:String,default:"default"},min:{type:[String,Number],default:null},max:{type:[String,Number],default:null},step:[String,Number],controls:{type:Boolean},digits:{type:[String,Number]},prefixIcon:{type:String},suffixIcon:{type:String},placement:{type:String}},emits:["update:modelValue","input","change","keydown","keyup","mousewheel","click","focus","blur","clear","search-click","toggle-visible","prev-number","next-number","prefix-click","suffix-click"],setup(t,e){const{slots:r,emit:n}=e,i=Ft("VmaFormulaGridCompIcon"),a=He(),s=He(),l={refElem:a,refInput:s},u=Ir({initiated:!1,panelIndex:0,showPwd:!1,isActivated:!1,inputValue:t.modelValue}),c={uId:Pt.create().toString(),props:t,context:e,reactiveData:u,getRefMaps:()=>l};let o={};o={dispatchEvent(U,ue,V){n(U,Object.assign({$input:c,$event:V},ue))},focus(){const U=s.value;return u.isActivated=!0,U.focus(),gt()},blur(){return s.value.blur(),u.isActivated=!1,gt()}},Object.assign(c,o);const f=it(()=>{const{placeholder:U}=t;return U||""}),h=it(()=>["number","integer","float"].indexOf(t.category)>-1),d=it(()=>t.category==="password"),p=it(()=>{const{category:U}=t,ue=h.value,V=d.value;return t.clearable&&(V||ue||U==="text"||U==="search")}),g=it(()=>{const{category:U,immediate:ue}=t;return ue||!(U==="text"||U==="number"||U==="integer"||U==="float")}),m=it(()=>{const{readonly:U}=t;return U}),v=it(()=>Oc(t.digits)||1),b=U=>t.max===null||U<=An(t.max),C=U=>t.min===null||U>=An(t.min);function A(U){const{category:ue}=t,V=v.value;return ue==="float"?bE(An(U),V).toFixed(V):If(U)}const O=(U,ue)=>{u.inputValue=U,o.dispatchEvent("input",{value:U},ue),n("update:modelValue",U),o.dispatchEvent("change",{value:U},ue)},w=(U,ue)=>{const V=g.value;u.inputValue=U,V?O(U,ue):o.dispatchEvent("input",{value:U},ue)},S=it(()=>{const{category:U}=t,ue=v.value,V=t.step;return U==="integer"?Oc(V)||1:U==="float"?An(V)||1/Math.pow(10,ue):An(V)||1}),N=(U,ue)=>{const{min:V,max:ee,category:L}=t,{inputValue:Z}=u,K=S.value,H=L==="integer"?Oc(Z):An(Z),ie=U?H+K:H-K;let pe;C(ie)?b(ie)?pe=ie:pe=ee:pe=V,w(A(pe),ue)};let R;const k=U=>{const{disabled:ue}=t,V=m.value;clearTimeout(R),!ue&&!V&&N(!1,U),o.dispatchEvent("next-number",{},U)},z=U=>{const{disabled:ue}=t,V=m.value;clearTimeout(R),!ue&&!V&&N(!0,U),o.dispatchEvent("prev-number",{},U)},Y=U=>{const{keyCode:ue}=U,V=ue===38;(V||ue===40)&&(U.preventDefault(),V?z(U):k(U))};yt(()=>t.modelValue,U=>{u.inputValue=U});const re=U=>{const{inputValue:ue}=u;o.dispatchEvent(U.type,{value:ue},U)},Q=(U,ue)=>{const{type:V}=t;(h.value||["text","search","password"].indexOf(V)>-1)&&focus(),o.dispatchEvent("clear",{value:ue},U)},ae=U=>{const{disabled:ue}=t;if(!ue){const{inputValue:V}=u;o.dispatchEvent("prefix-click",{value:V},U)}},ve=U=>{const{disabled:ue}=t;if(!ue)if(ht.hasClass(U.currentTarget,"is--clear"))O("",U),Q(U,"");else{const{inputValue:V}=u;o.dispatchEvent("suffix-click",{value:V},U)}},J=U=>{g.value?re(U):O(u.inputValue,U)},ne=U=>{u.isActivated=!0,re(U)},se=U=>{const{inputValue:ue}=u;g.value||O(ue,U),u.isActivated=!1,o.dispatchEvent("blur",{value:ue},U)},de=U=>{if(h.value&&t.controls&&u.isActivated){const V=-U.wheelDelta||U.detail;V>0?k(U):V<0&&z(U),U.preventDefault()}re(U)},be=U=>{re(U)},Ae=U=>{const V=U.target.value;w(V,U)},Te=U=>{if(h.value){const V=U.ctrlKey,ee=U.shiftKey,L=U.altKey,Z=U.keyCode;!V&&!ee&&!L&&(Z===32||Z>=65&&Z<=90)&&U.preventDefault(),Y(U)}re(U)},_e=U=>{re(U)},ke=()=>{const{prefixIcon:U}=t,ue=[];return r.prefix?ue.push(X("span",{class:"vma-formula-grid-input--prefix-icon"},r.prefix({}))):U&&ue.push(X(i,{class:["vma-formula-grid-input--prefix-icon"],name:t.prefixIcon,size:t.size,color:"currentColor"})),ue.length?X("span",{class:"vma-formula-grid-input--prefix",onClick:ae},ue):null},E=()=>{const{disabled:U,suffixIcon:ue}=t,{inputValue:V}=u,ee=p.value,L=[];return r.suffix?L.push(X("span",{class:"vma-formula-grid-input--suffix-icon"},r.suffix({}))):ue&&L.push(X(i,{class:["vma-formula-grid-input--suffix-icon"],name:t.suffixIcon,size:t.size,color:"currentColor"})),ee&&L.push(X(i,{class:["vma-formula-grid-input--suffix-clear-icon"],name:"close",size:t.size,color:"currentColor"})),L.length?X("span",{class:["vma-formula-grid-input--suffix",{"is--clear":ee&&!U&&!(V===""||V===null||typeof V>"u")}],onClick:ve},L):null},G=()=>{const U=ke(),ue=E(),{inputValue:V,isActivated:ee}=u,{disabled:L,readonly:Z}=t,K=f.value,H=[];return U&&H.push(U),H.push(X("input",{ref:s,class:"vma-formula-grid-input--inner-input",value:V,placeholder:K,disabled:L,readonly:Z,onKeydown:Te,onKeyup:_e,onMousewheel:de,onClick:be,onInput:Ae,onChange:J,onFocus:ne,onBlur:se})),ue&&H.push(ue),X("div",{ref:a,class:["vma-formula-grid-input","vma-formula-grid-input--"+t.size,{"is--active":ee,"is--prefix":!!U,"is--suffix":!!ue,"is--disabled":L}]},H)};return c.renderVN=G,c},render(){return this.renderVN()}}),A7=({onUpdate:t,onChange:e,onFocus:r,onBlur:n,...i})=>rt.create({doc:i.doc,selection:i.selection,extensions:[...Array.isArray(i.extensions)?i.extensions:[i.extensions],Be.updateListener.of(a=>{t(a),a.docChanged&&e(a.state.doc.toString(),a),a.focusChanged&&(a.view.hasFocus?r(a.state.doc.toString(),a):n(a.state.doc.toString(),a))})]}),C7=t=>new Be({...t}),w7=t=>t.destroy(),Ui=t=>{const e=new Oi;return{compartment:e,run:n=>{e.get(t.state)?t.dispatch({effects:e.reconfigure(n)}):t.dispatch({effects:Ze.appendConfig.of(e.of(n))})}}},Dm=(t,e)=>{const{compartment:r,run:n}=Ui(t);return i=>{const a=r.get(t.state);n(i??a!==e?e:[])}},S7=t=>{const e=()=>t.state.doc.toString(),r=g=>{g!==e()&&t.dispatch({changes:{from:0,to:t.state.doc.length,insert:g}})},n=()=>t.focus(),{run:i}=Ui(t),a=Dm(t,[Be.editable.of(!1),rt.readOnly.of(!0)]),s=Dm(t,Ps.of([ol])),{run:l}=Ui(t),u=g=>{l([rt.tabSize.of(g),ac.of(" ".repeat(g))])},{run:c}=Ui(t),o=g=>{c([rt.phrases.of(g)])},{run:f}=Ui(t),h=g=>{f(I4(g))},{run:d}=Ui(t);return{focus:n,getDoc:e,setDoc:r,reExtensions:i,toggleDisabled:a,toggleIndentWithTab:s,setTabSize:u,setPhrases:o,setPlaceholder:h,setStyle:(g={})=>{d(Be.theme({"&":{...g}}))}}},T7=Object.freeze({autofocus:!1,disabled:!1,indentWithTab:!0,tabSize:2,placeholder:"",autoDestroy:!0,extensions:[Yb]}),Kb=Symbol("vue-codemirror-global-config"),R7=(t,e)=>{t.provide(Kb,e)},N7=()=>bi(Kb,{}),x7=void 0,yo={type:Boolean,default:x7},M7={autofocus:yo,disabled:yo,indentWithTab:yo,tabSize:Number,placeholder:String,style:Object,autoDestroy:yo,phrases:Object,root:Object,extensions:Array,selection:Object},_7={modelValue:{type:String,default:""}},k7={...M7,..._7};var ui=(t=>(t.Change="change",t.Update="update",t.Focus="focus",t.Blur="blur",t.Ready="ready",t.ModelUpdate="update:modelValue",t))(ui||{});const jb={change:(t,e)=>!0,update:t=>!0,focus:(t,e)=>!0,blur:(t,e)=>!0,ready:t=>!0},P7={"update:modelValue":jb.change},I7={...jb,...P7},D7=qt({name:"VmaFormulaGridCompCodeMirror",props:{...k7},emits:{...I7},setup(t,e){const r={uId:Pt.create().toString(),props:t,context:e},n=vc(),i=vc(),a=vc(),s={...T7,...N7()},l=it(()=>{const c={};return Object.keys(sE(t)).forEach(o=>{o!=="modelValue"&&(c[o]=t[o]??s[o])}),c});Si(()=>{i.value=A7({doc:t.modelValue,selection:l.value.selection,extensions:s.extensions??[],onFocus:(o,f)=>e.emit(ui.Focus,o,f),onBlur:(o,f)=>e.emit(ui.Blur,o,f),onUpdate:o=>e.emit(ui.Update,o),onChange:(o,f)=>{o!==t.modelValue&&(e.emit(ui.Change,o,f),e.emit(ui.ModelUpdate,o,f))}}),a.value=C7({state:i.value,parent:n.value,root:l.value.root});const c=S7(a.value);yt(()=>t.modelValue,o=>{o!==c.getDoc()&&c.setDoc(o)}),yt(()=>t.extensions,o=>c.reExtensions(o||[]),{immediate:!0}),yt(()=>l.value.disabled,o=>c.toggleDisabled(o),{immediate:!0}),yt(()=>l.value.indentWithTab,o=>c.toggleIndentWithTab(o),{immediate:!0}),yt(()=>l.value.tabSize,o=>c.setTabSize(o),{immediate:!0}),yt(()=>l.value.phrases,o=>c.setPhrases(o||{}),{immediate:!0}),yt(()=>l.value.placeholder,o=>c.setPlaceholder(o),{immediate:!0}),yt(()=>l.value.style,o=>c.setStyle(o),{immediate:!0}),l.value.autofocus&&c.focus(),e.emit(ui.Ready,{state:i.value,view:a.value,container:n.value})}),El(()=>{l.value.autoDestroy&&a.value&&w7(a.value)});const u=()=>X("div",{class:"v-codemirror",style:{display:"contents"},ref:n});return r.renderVN=u,or("$vmaFormulaGridCompCodeMirror",r),r},render(){return this.renderVN()}}),L7=qt({name:"VmaFormulaGridCompSelect",props:{modelValue:null,disabled:Boolean,clearable:Boolean,multiple:Boolean,placeholder:String,prefixIcon:String,placement:String,emptyText:String,multiCharOverflow:{type:[Number,String]},options:Array,optionProps:Object,optionGroups:Array,optionGroupProps:Object,optionId:String,size:{type:String,default:"normal"},type:{type:String,default:"text"},transfer:{type:Boolean,default:!1},optionKey:Boolean},emits:["update:modelValue","change","clear"],setup(t,e){const{emit:r}=e,n=Ft("VmaFormulaGridCompInput"),i=He(),a=He(),s=He(),l=Ir({initiated:!1,staticOptions:[],fullGroupList:[],fullOptionList:[],visibleGroupList:[],visibleOptionList:[],panelIndex:999,panelStyle:{},panelPlacement:null,currentValue:null,visiblePanel:!1,animateVisible:!1,isActivated:!1}),u={refSelect:i},c={uId:Pt.create().toString(),props:t,context:e,reactiveData:l,getRefMaps:()=>u},o=it(()=>An(t.multiCharOverflow)),f=()=>t.optionId||"_XID",h=K=>{const H=K[f()];return H?encodeURIComponent(H):""},d=it(()=>l.fullGroupList.some(K=>K.options&&K.options.length)),p=it(()=>t.optionProps),g=it(()=>{const K=p.value;return K&&K.value||"value"}),m=it(()=>{const K=p.value;return K&&K.label||"label"}),v=K=>{const H=g.value;K&&(l.currentValue=K[H])},b=it(()=>t.optionGroupProps),C=it(()=>{const K=b.value;return K&&K.label||"label"}),A=it(()=>{const K=b.value;return K&&K.options||"options"}),O=K=>{const{fullOptionList:H,fullGroupList:ie}=l,pe=d.value,ye=g.value;if(pe)for(let we=0;we<ie.length;we++){const Ue=ie[we];if(Ue.options)for(let De=0;De<Ue.options.length;De++){const Ie=Ue.options[De];if(K===Ie[ye])return Ie}}return H.find(we=>K===we[ye])},w=K=>{const H=m.value,ie=O(K);return If(ie?ie[H]:K)},S=it(()=>{const{modelValue:K,multiple:H}=t,ie=o.value;return K&&H?K.map(pe=>{const ye=w(pe);return ie>0&&ye.length>ie?`${ye.substring(0,ie)}...`:ye}).join(", "):w(K)}),N={dispatchEvent(K,H,ie){r(K,Object.assign({$select:c,$event:ie},H))}},R=K=>K.visible!==!1,k=(K,H)=>gt().then(()=>{if(K){const ie=a.value,ye=s.value.querySelector(`[optid='${h(K)}']`);if(ie&&ye){const we=ie.offsetHeight,Ue=5;H?ye.offsetTop+ye.offsetHeight-ie.scrollTop>we&&(ie.scrollTop=ye.offsetTop+ye.offsetHeight-we):(ye.offsetTop+Ue<ie.scrollTop||ye.offsetTop+Ue>ie.scrollTop+ie.clientHeight)&&(ie.scrollTop=ye.offsetTop-Ue)}}}),z=()=>gt().then(()=>{const{transfer:K,placement:H}=t,{panelIndex:ie}=l,pe=i.value,ye=s.value;if(ye&&pe){const we=pe.offsetHeight,Ue=pe.offsetWidth,De=ye.offsetHeight,Ie=ye.offsetWidth,We=5,Xe={zIndex:ie},{boundingTop:Qe,boundingLeft:Me,visibleHeight:me,visibleWidth:F}=ht.getAbsolutePos(pe);let y="bottom";if(K){let D=Me,x=Qe+we;H==="top"?(y="top",x=Qe-De):H||(x+De+We>Number(me)&&(y="top",x=Qe-De),x<We&&(y="bottom",x=Qe+we)),D+Ie+We>Number(F)&&(D-=D+Ie+We-Number(F)),D<We&&(D=We),Object.assign(Xe,{left:`${D}px`,top:`${x}px`,minWidth:`${Ue}px`})}else H==="top"?(y="top",Xe.bottom=`${we}px`):H||Qe+we+De>Number(me)&&Qe-we-De>We&&(y="top",Xe.bottom=`${we}px`);return l.panelStyle=Xe,l.panelPlacement=y,gt()}});let Y;const re=()=>{l.visiblePanel=!1,Y=window.setTimeout(()=>{l.animateVisible=!1},350)},Q=()=>{t.disabled||(clearTimeout(Y),l.initiated||(l.initiated=!0),l.isActivated=!0,l.animateVisible=!0,setTimeout(()=>{const{modelValue:K,multiple:H}=t,ie=O(H&&K?K[0]:K);l.visiblePanel=!0,ie&&(v(ie),k(ie))},10),ae(),z())},ae=()=>{l.panelIndex<AE()&&(l.panelIndex=OE())},ve=(K,H)=>{const{visibleOptionList:ie,visibleGroupList:pe}=l,ye=d.value,we=g.value,Ue=A.value;let De,Ie,We,Xe;if(ye)for(let Qe=0;Qe<pe.length;Qe++){const Me=pe[Qe],me=Me[Ue],F=Me.disabled;if(me)for(let y=0;y<me.length;y++){const D=me[y],x=R(D),_=F||D.disabled;if(!De&&!_&&(De=D),Xe&&x&&!_&&(We=D,!H))return{offsetOption:We};if(K===D[we]){if(Xe=D,H)return{offsetOption:Ie}}else x&&!_&&(Ie=D)}}else for(let Qe=0;Qe<ie.length;Qe++){const Me=ie[Qe],me=Me.disabled;if(!De&&!me&&(De=Me),Xe&&!me&&(We=Me,!H))return{offsetOption:We};if(K===Me[we]){if(Xe=Me,H)return{offsetOption:Ie}}else me||(Ie=Me)}return{firstOption:De}},J=()=>{t.disabled||(l.isActivated=!0)},ne=()=>{l.isActivated=!1},se=K=>{const{$event:H}=K;H.preventDefault(),l.visiblePanel?re():Q()},de=(K,H)=>{H!==t.modelValue&&(r("update:modelValue",H),N.dispatchEvent("change",{value:H},K))},be=(K,H)=>{de(K,H),N.dispatchEvent("clear",{value:H},K)},Ae=K=>{const{disabled:H}=t,{visiblePanel:ie}=l;if(!H&&ie){const pe=s.value;ht.getEventTargetNode(K,pe).flag?z():re()}},Te=K=>{const{disabled:H}=t,{visiblePanel:ie}=l;if(!H){const pe=i.value,ye=s.value;l.isActivated=ht.getEventTargetNode(K,pe).flag||ht.getEventTargetNode(K,ye).flag,ie&&!l.isActivated&&re()}},_e=(K,H)=>{const{modelValue:ie,multiple:pe}=t;if(pe){let ye;ie?ie.indexOf(H)===-1?ye=ie.concat([H]):ye=ie.filter(we=>we!==H):ye=[H],de(K,ye)}else de(K,H),re()},ke=(K,H)=>{const{optionKey:ie,modelValue:pe,multiple:ye}=t,{currentValue:we}=l,Ue=m.value,De=g.value,Ie=d.value;return K.map((We,Xe)=>{const Qe=!Ie||R(We),Me=H&&H.disabled||We.disabled,me=We[De],F=h(We);return Qe?X("div",{key:ie?F:Xe,class:["vma-formula-grid-select-option",{"is--disabled":Me,"is--selected":ye?pe&&pe.indexOf(me)>-1:pe===me,"is--hover":we===me}],optid:F,onClick:y=>{Me||_e(y,me)},onMouseenter:()=>{Me||v(We)}},We[Ue]):null})},E=()=>{const{optionKey:K}=t,{visibleGroupList:H}=l,ie=C.value,pe=A.value;return H.map((ye,we)=>{const Ue=h(ye),De=ye.disabled;return X("div",{key:K?Ue:we,class:["vma-formula-grid-optgroup",{"is--disabled":De}],optid:Ue},[X("div",{class:"vma-formula-grid-optgroup--title"},ye[ie]),X("div",{class:"vma-formula-grid-optgroup--wrapper"},ke(ye[pe],ye))])})},G=()=>{const{visibleGroupList:K,visibleOptionList:H}=l;if(d.value){if(K.length)return E()}else if(H.length)return ke(H);return[X("div",{class:"vma-formula-grid-select--empty-placeholder"},t.emptyText||"暂无数据")]},U=()=>{const{fullOptionList:K,fullGroupList:H}=l;return d.value?l.visibleGroupList=H.filter(R):l.visibleOptionList=K.filter(R),gt()},ue=()=>{const{fullOptionList:K,fullGroupList:H}=l,ie=A.value,pe=f(),ye=we=>{h(we)||(we[pe]=Pt.create().toString())};H.length?H.forEach(we=>{ye(we),we[ie]&&we[ie].forEach(ye)}):K.length&&K.forEach(ye),U()},V=K=>{const{clearable:H,disabled:ie}=t,{visiblePanel:pe,currentValue:ye}=l;if(!ie){const we=K.keyCode,Ue=we===9,De=we===13,Ie=we===27,We=we===38,Xe=we===40,Qe=we===46,Me=we===32;if(Ue&&(l.isActivated=!1),pe)if(Ie||Ue)re();else if(De)K.preventDefault(),K.stopPropagation(),_e(K,ye);else if(We||Xe){K.preventDefault();let{offsetOption:me}=ve(ye,We);const{firstOption:F}=ve(ye,We);!me&&!O(ye)&&(me=F),v(me),k(me,Xe)}else Me&&K.preventDefault();else(We||Xe||De||Me)&&l.isActivated&&(K.preventDefault(),Q());l.isActivated&&Qe&&H&&be(K,null)}},ee=()=>{re()},L=(K,H)=>{be(H,null),re()},Z=()=>{const{initiated:K,visiblePanel:H}=l,{transfer:ie,disabled:pe}=t,ye=S.value;return X("div",{ref:i,class:"vma-formula-grid-select"},[X(n,{clearable:t.clearable,placeholder:t.placeholder,readonly:!0,prefixIcon:t.prefixIcon,suffixIcon:H?"angle-up":"angle-down",size:t.size,disabled:pe,modelValue:ye,onClear:L,onClick:se,onFocus:J,onBlur:ne,onSuffixClick:se}),X(_f,{to:"body",disabled:ie?!K:!0},[X("div",{ref:s,class:["vma-formula-grid-select--panel","vma-formula-grid-select--"+t.size,{"is--transfer":ie,"animate--leave":l.animateVisible,"animate--enter":H}],placement:l.panelPlacement,style:l.panelStyle},K?[X("div",{ref:a,class:"vma-formula-grid-select-option--wrapper"},G())]:[])])])};return Object.assign(c,N),c.renderVN=Z,or("$vmaFormulaGridCompSelect",c),yt(()=>t.options,K=>{l.fullGroupList=[],l.fullOptionList=K||[],ue()}),yt(()=>t.optionGroups,K=>{l.fullOptionList=[],l.fullGroupList=K||[],ue()}),gt(()=>{const{options:K,optionGroups:H}=t;H?l.fullGroupList=H:K&&(l.fullOptionList=K),ue(),xt.on(c,"mousewheel",Ae),xt.on(c,"mousedown",Te),xt.on(c,"keydown",V),xt.on(c,"blur",ee)}),jm(()=>{xt.off(c,"mousewheel"),xt.off(c,"mousedown"),xt.off(c,"keydown"),xt.off(c,"blur")}),c},render(){return this.renderVN()}}),B7=qt({name:"VmaFormulaGridCompSelectOptionGroup",props:{modelValue:null,disabled:Boolean,clearable:Boolean,multiple:Boolean,placeholder:String,size:{type:String,default:"normal"},type:{type:String,default:"default"}},emits:["update:modelValue","change"],setup(t,e){const{emit:r}=e,n={uId:Pt.create().toString(),props:t,context:e};return Object.assign(n,{handleChecked(a,s){const{label:l}=a;r("update:modelValue",[l]),r("change",a,s)}}),or("$vmaFormulaGridCompSelectOptionGroup",n),()=>X("div",{class:"vma-formula-grid-select"},[X("div",{class:["select-input--prefix"]}),X("input",{class:["select-input--inner"]}),X("div",{class:["select-input--suffix"]})])}}),U7=qt({name:"VmaFormulaGridCompSelectOption",props:{modelValue:null,disabled:Boolean,clearable:Boolean,multiple:Boolean,placeholder:String,size:{type:String,default:"normal"},type:{type:String,default:"default"}},emits:["update:modelValue","change"],setup(t,e){const{slots:r,emit:n}=e,i={uId:Pt.create().toString(),props:t,context:e};return Object.assign(i,{handleChecked(s,l){const{label:u}=s;n("update:modelValue",[u]),n("change",s,l)}}),or("$vmaFormulaGridCompSelectOption",i),()=>X("div",{class:"vma-formula-grid-select"},[X("div",{class:["select-input--prefix"]}),X("input",{class:["select-input--inner"]}),X("div",{class:["select-input--suffix"]})])}}),TW=Object.assign(Yp,{install:function(t,e){t.component("VmaFormulaGrid",Yp),t.component("VmaFormulaGridHeader",n3),t.component("VmaFormulaGridBody",i3),t.component("VmaFormulaGridCompIcon",a3),t.component("VmaFormulaGridCompTextarea",W6),t.component("VmaFormulaGridCompButton",H6),t.component("VmaFormulaGridCompLoading",G6),t.component("VmaFormulaGridCompContextMenu",s3),t.component("VmaFormulaGridCompColorPickerBoard",m7),t.component("VmaFormulaGridCompColorPickerDisplay",v7),t.component("VmaFormulaGridCompColorPickerHue",y7),t.component("VmaFormulaGridCompColorPickerLightness",b7),t.component("VmaFormulaGridCompColorPickerPalette",E7),t.component("VmaFormulaGridCompColorPicker",g7),t.component("VmaFormulaGridCompInput",O7),t.component("VmaFormulaGridCompCodeMirror",D7),t.component("VmaFormulaGridCompSelect",L7),t.component("VmaFormulaGridCompSelectOptionGroup",B7),t.component("VmaFormulaGridCompSelectOption",U7),R7(t,e)}});var Lm={};class ml{constructor(e,r,n,i,a,s,l,u,c,o=0,f){this.p=e,this.stack=r,this.state=n,this.reducePos=i,this.pos=a,this.score=s,this.buffer=l,this.bufferBase=u,this.curContext=c,this.lookAhead=o,this.parent=f}toString(){return`[${this.stack.filter((e,r)=>r%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,r,n=0){let i=e.parser.context;return new ml(e,[],r,n,n,0,[],0,i?new Bm(i,i.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,r){this.stack.push(this.state,r,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var r;let n=e>>19,i=e&65535,{parser:a}=this.p,s=a.dynamicPrecedence(i);if(s&&(this.score+=s),n==0){this.pushState(a.getGoto(this.state,i,!0),this.reducePos),i<a.minRepeatTerm&&this.storeNode(i,this.reducePos,this.reducePos,4,!0),this.reduceContext(i,this.reducePos);return}let l=this.stack.length-(n-1)*3-(e&262144?6:0),u=l?this.stack[l-2]:this.p.ranges[0].from,c=this.reducePos-u;c>=2e3&&!(!((r=this.p.parser.nodeSet.types[i])===null||r===void 0)&&r.isAnonymous)&&(u==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=c):this.p.lastBigReductionSize<c&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=u,this.p.lastBigReductionSize=c));let o=l?this.stack[l-1]:0,f=this.bufferBase+this.buffer.length-o;if(i<a.minRepeatTerm||e&131072){let h=a.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(i,u,h,f+4,!0)}if(e&262144)this.state=this.stack[l];else{let h=this.stack[l-3];this.state=a.getGoto(h,i,!0)}for(;this.stack.length>l;)this.stack.pop();this.reduceContext(i,u)}storeNode(e,r,n,i=4,a=!1){if(e==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let s=this,l=this.buffer.length;if(l==0&&s.parent&&(l=s.bufferBase-s.parent.bufferBase,s=s.parent),l>0&&s.buffer[l-4]==0&&s.buffer[l-1]>-1){if(r==n)return;if(s.buffer[l-2]>=r){s.buffer[l-2]=n;return}}}if(!a||this.pos==n)this.buffer.push(e,r,n,i);else{let s=this.buffer.length;if(s>0&&this.buffer[s-4]!=0)for(;s>0&&this.buffer[s-2]>n;)this.buffer[s]=this.buffer[s-4],this.buffer[s+1]=this.buffer[s-3],this.buffer[s+2]=this.buffer[s-2],this.buffer[s+3]=this.buffer[s-1],s-=4,i>4&&(i-=4);this.buffer[s]=e,this.buffer[s+1]=r,this.buffer[s+2]=n,this.buffer[s+3]=i}}shift(e,r,n,i){if(e&131072)this.pushState(e&65535,this.pos);else if(e&262144)this.pos=i,this.shiftContext(r,n),r<=this.p.parser.maxNode&&this.buffer.push(r,n,i,4);else{let a=e,{parser:s}=this.p;(i>this.pos||r<=s.maxNode)&&(this.pos=i,s.stateFlag(a,1)||(this.reducePos=i)),this.pushState(a,n),this.shiftContext(r,n),r<=s.maxNode&&this.buffer.push(r,n,i,4)}}apply(e,r,n,i){e&65536?this.reduce(e):this.shift(e,r,n,i)}useNode(e,r){let n=this.p.reused.length-1;(n<0||this.p.reused[n]!=e)&&(this.p.reused.push(e),n++);let i=this.pos;this.reducePos=this.pos=i+e.length,this.pushState(r,i),this.buffer.push(n,i,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,r=e.buffer.length;for(;r>0&&e.buffer[r-2]>e.reducePos;)r-=4;let n=e.buffer.slice(r),i=e.bufferBase+r;for(;e&&i==e.bufferBase;)e=e.parent;return new ml(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,n,i,this.curContext,this.lookAhead,e)}recoverByDelete(e,r){let n=e<=this.p.parser.maxNode;n&&this.storeNode(e,this.pos,r,4),this.storeNode(0,this.pos,r,n?8:4),this.pos=this.reducePos=r,this.score-=190}canShift(e){for(let r=new $7(this);;){let n=this.p.parser.stateSlot(r.state,4)||this.p.parser.hasAction(r.state,e);if(n==0)return!1;if(!(n&65536))return!0;r.reduce(n)}}recoverByInsert(e){if(this.stack.length>=300)return[];let r=this.p.parser.nextStates(this.state);if(r.length>8||this.stack.length>=120){let i=[];for(let a=0,s;a<r.length;a+=2)(s=r[a+1])!=this.state&&this.p.parser.hasAction(s,e)&&i.push(r[a],s);if(this.stack.length<120)for(let a=0;i.length<8&&a<r.length;a+=2){let s=r[a+1];i.some((l,u)=>u&1&&l==s)||i.push(r[a],s)}r=i}let n=[];for(let i=0;i<r.length&&n.length<4;i+=2){let a=r[i+1];if(a==this.state)continue;let s=this.split();s.pushState(a,this.pos),s.storeNode(0,s.pos,s.pos,4,!0),s.shiftContext(r[i],this.pos),s.reducePos=this.pos,s.score-=200,n.push(s)}return n}forceReduce(){let{parser:e}=this.p,r=e.stateSlot(this.state,5);if(!(r&65536))return!1;if(!e.validAction(this.state,r)){let n=r>>19,i=r&65535,a=this.stack.length-n*3;if(a<0||e.getGoto(this.stack[a],i,!1)<0){let s=this.findForcedReduction();if(s==null)return!1;r=s}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(r),!0}findForcedReduction(){let{parser:e}=this.p,r=[],n=(i,a)=>{if(!r.includes(i))return r.push(i),e.allActions(i,s=>{if(!(s&393216))if(s&65536){let l=(s>>19)-a;if(l>1){let u=s&65535,c=this.stack.length-l*3;if(c>=0&&e.getGoto(this.stack[c],u,!1)>=0)return l<<19|65536|u}}else{let l=n(s,a+1);if(l!=null)return l}})};return n(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:e}=this.p;return e.data[e.stateSlot(this.state,1)]==65535&&!e.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let r=0;r<this.stack.length;r+=3)if(this.stack[r]!=e.stack[r])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,r){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(r)))}reduceContext(e,r){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(r)))}emitContext(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-3)&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-4)&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let r=new Bm(this.curContext.tracker,e);r.hash!=this.curContext.hash&&this.emitContext(),this.curContext=r}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class Bm{constructor(e,r){this.tracker=e,this.context=r,this.hash=e.strict?e.hash(r):0}}class $7{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let r=e&65535,n=e>>19;n==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(n-1)*3;let i=this.start.p.parser.getGoto(this.stack[this.base-3],r,!0);this.state=i}}class vl{constructor(e,r,n){this.stack=e,this.pos=r,this.index=n,this.buffer=e.buffer,this.index==0&&this.maybeNext()}static create(e,r=e.bufferBase+e.buffer.length){return new vl(e,r,r-e.bufferBase)}maybeNext(){let e=this.stack.parent;e!=null&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new vl(this.stack,this.pos,this.index)}}function bo(t,e=Uint16Array){if(typeof t!="string")return t;let r=null;for(let n=0,i=0;n<t.length;){let a=0;for(;;){let s=t.charCodeAt(n++),l=!1;if(s==126){a=65535;break}s>=92&&s--,s>=34&&s--;let u=s-32;if(u>=46&&(u-=46,l=!0),a+=u,l)break;a*=46}r?r[i++]=a:r=new e(a)}return r}class Bo{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const Um=new Bo;class F7{constructor(e,r){this.input=e,this.ranges=r,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=Um,this.rangeIndex=0,this.pos=this.chunkPos=r[0].from,this.range=r[0],this.end=r[r.length-1].to,this.readNext()}resolveOffset(e,r){let n=this.range,i=this.rangeIndex,a=this.pos+e;for(;a<n.from;){if(!i)return null;let s=this.ranges[--i];a-=n.from-s.to,n=s}for(;r<0?a>n.to:a>=n.to;){if(i==this.ranges.length-1)return null;let s=this.ranges[++i];a+=s.from-n.to,n=s}return a}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let r of this.ranges)if(r.to>e)return Math.max(e,r.from);return this.end}peek(e){let r=this.chunkOff+e,n,i;if(r>=0&&r<this.chunk.length)n=this.pos+e,i=this.chunk.charCodeAt(r);else{let a=this.resolveOffset(e,1);if(a==null)return-1;if(n=a,n>=this.chunk2Pos&&n<this.chunk2Pos+this.chunk2.length)i=this.chunk2.charCodeAt(n-this.chunk2Pos);else{let s=this.rangeIndex,l=this.range;for(;l.to<=n;)l=this.ranges[++s];this.chunk2=this.input.chunk(this.chunk2Pos=n),n+this.chunk2.length>l.to&&(this.chunk2=this.chunk2.slice(0,l.to-n)),i=this.chunk2.charCodeAt(0)}}return n>=this.token.lookAhead&&(this.token.lookAhead=n+1),i}acceptToken(e,r=0){let n=r?this.resolveOffset(r,-1):this.pos;if(n==null||n<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=n}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:r}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=r,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),r=this.pos+e.length;this.chunk=r>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,r){if(r?(this.token=r,r.start=e,r.lookAhead=e+1,r.value=r.extended=-1):this.token=Um,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,r){if(e>=this.chunkPos&&r<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,r-this.chunkPos);if(e>=this.chunk2Pos&&r<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,r-this.chunk2Pos);if(e>=this.range.from&&r<=this.range.to)return this.input.read(e,r);let n="";for(let i of this.ranges){if(i.from>=r)break;i.to>e&&(n+=this.input.read(Math.max(i.from,e),Math.min(i.to,r)))}return n}}class ji{constructor(e,r){this.data=e,this.id=r}token(e,r){let{parser:n}=r.p;V7(this.data,e,r,this.id,n.data,n.tokenPrecTable)}}ji.prototype.contextual=ji.prototype.fallback=ji.prototype.extend=!1;ji.prototype.fallback=ji.prototype.extend=!1;class Xh{constructor(e,r={}){this.token=e,this.contextual=!!r.contextual,this.fallback=!!r.fallback,this.extend=!!r.extend}}function V7(t,e,r,n,i,a){let s=0,l=1<<n,{dialect:u}=r.p.parser;e:for(;l&t[s];){let c=t[s+1];for(let d=s+3;d<c;d+=2)if((t[d+1]&l)>0){let p=t[d];if(u.allows(p)&&(e.token.value==-1||e.token.value==p||W7(p,e.token.value,i,a))){e.acceptToken(p);break}}let o=e.next,f=0,h=t[s+2];if(e.next<0&&h>f&&t[c+h*3-3]==65535){s=t[c+h*3-1];continue e}for(;f<h;){let d=f+h>>1,p=c+d+(d<<1),g=t[p],m=t[p+1]||65536;if(o<g)h=d;else if(o>=m)f=d+1;else{s=t[p+2],e.advance();continue e}}break}}function $m(t,e,r){for(let n=e,i;(i=t[n])!=65535;n++)if(i==r)return n-e;return-1}function W7(t,e,r,n){let i=$m(r,n,e);return i<0||$m(r,n,t)<i}const Ar=typeof process<"u"&&Lm&&/\bparse\b/.test(Lm.LOG);let hu=null;function Fm(t,e,r){let n=t.cursor(Xt.IncludeAnonymous);for(n.moveTo(e);;)if(!(r<0?n.childBefore(e):n.childAfter(e)))for(;;){if((r<0?n.to<e:n.from>e)&&!n.type.isError)return r<0?Math.max(0,Math.min(n.to-1,e-25)):Math.min(t.length,Math.max(n.from+1,e+25));if(r<0?n.prevSibling():n.nextSibling())break;if(!n.parent())return r<0?0:t.length}}class H7{constructor(e,r){this.fragments=e,this.nodeSet=r,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?Fm(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?Fm(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let r=this.trees.length-1;if(r<0)return this.nextFragment(),null;let n=this.trees[r],i=this.index[r];if(i==n.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let a=n.children[i],s=this.start[r]+n.positions[i];if(s>e)return this.nextStart=s,null;if(a instanceof Vt){if(s==e){if(s<this.safeFrom)return null;let l=s+a.length;if(l<=this.safeTo){let u=a.prop(nt.lookAhead);if(!u||l+u<this.fragment.to)return a}}this.index[r]++,s+a.length>=Math.max(this.safeFrom,e)&&(this.trees.push(a),this.start.push(s),this.index.push(0))}else this.index[r]++,this.nextStart=s+a.length}}}class G7{constructor(e,r){this.stream=r,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map(n=>new Bo)}getActions(e){let r=0,n=null,{parser:i}=e.p,{tokenizers:a}=i,s=i.stateSlot(e.state,3),l=e.curContext?e.curContext.hash:0,u=0;for(let c=0;c<a.length;c++){if(!(1<<c&s))continue;let o=a[c],f=this.tokens[c];if(!(n&&!o.fallback)&&((o.contextual||f.start!=e.pos||f.mask!=s||f.context!=l)&&(this.updateCachedToken(f,o,e),f.mask=s,f.context=l),f.lookAhead>f.end+25&&(u=Math.max(f.lookAhead,u)),f.value!=0)){let h=r;if(f.extended>-1&&(r=this.addActions(e,f.extended,f.end,r)),r=this.addActions(e,f.value,f.end,r),!o.extend&&(n=f,r>h))break}}for(;this.actions.length>r;)this.actions.pop();return u&&e.setLookAhead(u),!n&&e.pos==this.stream.end&&(n=new Bo,n.value=e.p.parser.eofTerm,n.start=n.end=e.pos,r=this.addActions(e,n.value,n.end,r)),this.mainToken=n,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let r=new Bo,{pos:n,p:i}=e;return r.start=n,r.end=Math.min(n+1,i.stream.end),r.value=n==i.stream.end?i.parser.eofTerm:0,r}updateCachedToken(e,r,n){let i=this.stream.clipPos(n.pos);if(r.token(this.stream.reset(i,e),n),e.value>-1){let{parser:a}=n.p;for(let s=0;s<a.specialized.length;s++)if(a.specialized[s]==e.value){let l=a.specializers[s](this.stream.read(e.start,e.end),n);if(l>=0&&n.p.parser.dialect.allows(l>>1)){l&1?e.extended=l>>1:e.value=l>>1;break}}}else e.value=0,e.end=this.stream.clipPos(i+1)}putAction(e,r,n,i){for(let a=0;a<i;a+=3)if(this.actions[a]==e)return i;return this.actions[i++]=e,this.actions[i++]=r,this.actions[i++]=n,i}addActions(e,r,n,i){let{state:a}=e,{parser:s}=e.p,{data:l}=s;for(let u=0;u<2;u++)for(let c=s.stateSlot(a,u?2:1);;c+=3){if(l[c]==65535)if(l[c+1]==1)c=Cn(l,c+2);else{i==0&&l[c+1]==2&&(i=this.putAction(Cn(l,c+2),r,n,i));break}l[c]==r&&(i=this.putAction(Cn(l,c+1),r,n,i))}return i}}class z7{constructor(e,r,n,i){this.parser=e,this.input=r,this.ranges=i,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new F7(r,i),this.tokens=new G7(e,this.stream),this.topTerm=e.top[1];let{from:a}=i[0];this.stacks=[ml.start(this,e.top[0],a)],this.fragments=n.length&&this.stream.end-a>e.bufferLength*4?new H7(n,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e=this.stacks,r=this.minStackPos,n=this.stacks=[],i,a;if(this.bigReductionCount>300&&e.length==1){let[s]=e;for(;s.forceReduce()&&s.stack.length&&s.stack[s.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let s=0;s<e.length;s++){let l=e[s];for(;;){if(this.tokens.mainToken=null,l.pos>r)n.push(l);else{if(this.advanceStack(l,n,e))continue;{i||(i=[],a=[]),i.push(l);let u=this.tokens.getMainToken(l);a.push(u.value,u.end)}}break}}if(!n.length){let s=i&&Y7(i);if(s)return Ar&&console.log("Finish with "+this.stackID(s)),this.stackToTree(s);if(this.parser.strict)throw Ar&&i&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+r);this.recovering||(this.recovering=5)}if(this.recovering&&i){let s=this.stoppedAt!=null&&i[0].pos>this.stoppedAt?i[0]:this.runRecovery(i,a,n);if(s)return Ar&&console.log("Force-finish "+this.stackID(s)),this.stackToTree(s.forceAll())}if(this.recovering){let s=this.recovering==1?1:this.recovering*3;if(n.length>s)for(n.sort((l,u)=>u.score-l.score);n.length>s;)n.pop();n.some(l=>l.reducePos>r)&&this.recovering--}else if(n.length>1){e:for(let s=0;s<n.length-1;s++){let l=n[s];for(let u=s+1;u<n.length;u++){let c=n[u];if(l.sameState(c)||l.buffer.length>500&&c.buffer.length>500)if((l.score-c.score||l.buffer.length-c.buffer.length)>0)n.splice(u--,1);else{n.splice(s--,1);continue e}}}n.length>12&&n.splice(12,n.length-12)}this.minStackPos=n[0].pos;for(let s=1;s<n.length;s++)n[s].pos<this.minStackPos&&(this.minStackPos=n[s].pos);return null}stopAt(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,r,n){let i=e.pos,{parser:a}=this,s=Ar?this.stackID(e)+" -> ":"";if(this.stoppedAt!=null&&i>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let c=e.curContext&&e.curContext.tracker.strict,o=c?e.curContext.hash:0;for(let f=this.fragments.nodeAt(i);f;){let h=this.parser.nodeSet.types[f.type.id]==f.type?a.getGoto(e.state,f.type.id):-1;if(h>-1&&f.length&&(!c||(f.prop(nt.contextHash)||0)==o))return e.useNode(f,h),Ar&&console.log(s+this.stackID(e)+` (via reuse of ${a.getName(f.type.id)})`),!0;if(!(f instanceof Vt)||f.children.length==0||f.positions[0]>0)break;let d=f.children[0];if(d instanceof Vt&&f.positions[0]==0)f=d;else break}}let l=a.stateSlot(e.state,4);if(l>0)return e.reduce(l),Ar&&console.log(s+this.stackID(e)+` (via always-reduce ${a.getName(l&65535)})`),!0;if(e.stack.length>=8400)for(;e.stack.length>6e3&&e.forceReduce(););let u=this.tokens.getActions(e);for(let c=0;c<u.length;){let o=u[c++],f=u[c++],h=u[c++],d=c==u.length||!n,p=d?e:e.split(),g=this.tokens.mainToken;if(p.apply(o,f,g?g.start:p.pos,h),Ar&&console.log(s+this.stackID(p)+` (via ${o&65536?`reduce of ${a.getName(o&65535)}`:"shift"} for ${a.getName(f)} @ ${i}${p==e?"":", split"})`),d)return!0;p.pos>i?r.push(p):n.push(p)}return!1}advanceFully(e,r){let n=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>n)return Vm(e,r),!0}}runRecovery(e,r,n){let i=null,a=!1;for(let s=0;s<e.length;s++){let l=e[s],u=r[s<<1],c=r[(s<<1)+1],o=Ar?this.stackID(l)+" -> ":"";if(l.deadEnd&&(a||(a=!0,l.restart(),Ar&&console.log(o+this.stackID(l)+" (restarted)"),this.advanceFully(l,n))))continue;let f=l.split(),h=o;for(let d=0;f.forceReduce()&&d<10&&(Ar&&console.log(h+this.stackID(f)+" (via force-reduce)"),!this.advanceFully(f,n));d++)Ar&&(h=this.stackID(f)+" -> ");for(let d of l.recoverByInsert(u))Ar&&console.log(o+this.stackID(d)+" (via recover-insert)"),this.advanceFully(d,n);this.stream.end>l.pos?(c==l.pos&&(c++,u=0),l.recoverByDelete(u,c),Ar&&console.log(o+this.stackID(l)+` (via recover-delete ${this.parser.getName(u)})`),Vm(l,n)):(!i||i.score<l.score)&&(i=l)}return i}stackToTree(e){return e.close(),Vt.build({buffer:vl.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let r=(hu||(hu=new WeakMap)).get(e);return r||hu.set(e,r=String.fromCodePoint(this.nextStackID++)),r+e}}function Vm(t,e){for(let r=0;r<e.length;r++){let n=e[r];if(n.pos==t.pos&&n.sameState(t)){e[r].score<t.score&&(e[r]=t);return}}e.push(t)}class q7{constructor(e,r,n){this.source=e,this.flags=r,this.disabled=n}allows(e){return!this.disabled||this.disabled[e]==0}}class yl extends e1{constructor(e){if(super(),this.wrappers=[],e.version!=14)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let r=e.nodeNames.split(" ");this.minRepeatTerm=r.length;for(let l=0;l<e.repeatNodeCount;l++)r.push("");let n=Object.keys(e.topRules).map(l=>e.topRules[l][1]),i=[];for(let l=0;l<r.length;l++)i.push([]);function a(l,u,c){i[l].push([u,u.deserialize(String(c))])}if(e.nodeProps)for(let l of e.nodeProps){let u=l[0];typeof u=="string"&&(u=nt[u]);for(let c=1;c<l.length;){let o=l[c++];if(o>=0)a(o,u,l[c++]);else{let f=l[c+-o];for(let h=-o;h>0;h--)a(l[c++],u,f);c++}}}this.nodeSet=new Eh(r.map((l,u)=>yr.define({name:u>=this.minRepeatTerm?void 0:l,id:u,props:i[u],top:n.indexOf(u)>-1,error:u==0,skipped:e.skippedNodes&&e.skippedNodes.indexOf(u)>-1}))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=Kv;let s=bo(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let l=0;l<this.specializerSpecs.length;l++)this.specialized[l]=this.specializerSpecs[l].term;this.specializers=this.specializerSpecs.map(Wm),this.states=bo(e.states,Uint32Array),this.data=bo(e.stateData),this.goto=bo(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map(l=>typeof l=="number"?new ji(s,l):l),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,r,n){let i=new z7(this,e,r,n);for(let a of this.wrappers)i=a(i,e,r,n);return i}getGoto(e,r,n=!1){let i=this.goto;if(r>=i[0])return-1;for(let a=i[r+1];;){let s=i[a++],l=s&1,u=i[a++];if(l&&n)return u;for(let c=a+(s>>1);a<c;a++)if(i[a]==e)return u;if(l)return-1}}hasAction(e,r){let n=this.data;for(let i=0;i<2;i++)for(let a=this.stateSlot(e,i?2:1),s;;a+=3){if((s=n[a])==65535)if(n[a+1]==1)s=n[a=Cn(n,a+2)];else{if(n[a+1]==2)return Cn(n,a+2);break}if(s==r||s==0)return Cn(n,a+1)}return 0}stateSlot(e,r){return this.states[e*6+r]}stateFlag(e,r){return(this.stateSlot(e,0)&r)>0}validAction(e,r){return!!this.allActions(e,n=>n==r?!0:null)}allActions(e,r){let n=this.stateSlot(e,4),i=n?r(n):void 0;for(let a=this.stateSlot(e,1);i==null;a+=3){if(this.data[a]==65535)if(this.data[a+1]==1)a=Cn(this.data,a+2);else break;i=r(Cn(this.data,a+1))}return i}nextStates(e){let r=[];for(let n=this.stateSlot(e,1);;n+=3){if(this.data[n]==65535)if(this.data[n+1]==1)n=Cn(this.data,n+2);else break;if(!(this.data[n+2]&1)){let i=this.data[n+1];r.some((a,s)=>s&1&&a==i)||r.push(this.data[n],i)}}return r}configure(e){let r=Object.assign(Object.create(yl.prototype),this);if(e.props&&(r.nodeSet=this.nodeSet.extend(...e.props)),e.top){let n=this.topRules[e.top];if(!n)throw new RangeError(`Invalid top rule name ${e.top}`);r.top=n}return e.tokenizers&&(r.tokenizers=this.tokenizers.map(n=>{let i=e.tokenizers.find(a=>a.from==n);return i?i.to:n})),e.specializers&&(r.specializers=this.specializers.slice(),r.specializerSpecs=this.specializerSpecs.map((n,i)=>{let a=e.specializers.find(l=>l.from==n.external);if(!a)return n;let s=Object.assign(Object.assign({},n),{external:a.to});return r.specializers[i]=Wm(s),s})),e.contextTracker&&(r.context=e.contextTracker),e.dialect&&(r.dialect=this.parseDialect(e.dialect)),e.strict!=null&&(r.strict=e.strict),e.wrap&&(r.wrappers=r.wrappers.concat(e.wrap)),e.bufferLength!=null&&(r.bufferLength=e.bufferLength),r}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let r=this.dynamicPrecedences;return r==null?0:r[e]||0}parseDialect(e){let r=Object.keys(this.dialects),n=r.map(()=>!1);if(e)for(let a of e.split(" ")){let s=r.indexOf(a);s>=0&&(n[s]=!0)}let i=null;for(let a=0;a<r.length;a++)if(!n[a])for(let s=this.dialects[r[a]],l;(l=this.data[s++])!=65535;)(i||(i=new Uint8Array(this.maxTerm+1)))[l]=1;return new q7(e,n,i)}static deserialize(e){return new yl(e)}}function Cn(t,e){return t[e]|t[e+1]<<16}function Y7(t){let e=null;for(let r of t){let n=r.p.stoppedAt;(r.pos==r.p.stream.end||n!=null&&r.pos>n)&&r.p.parser.stateFlag(r.state,2)&&(!e||e.score<r.score)&&(e=r)}return e}function Wm(t){if(t.external){let e=t.extend?1:0;return(r,n)=>t.external(r,n)<<1|e}return t.get}const X7=39,Q7=1,K7=40,j7=41,Z7=2,J7=3,eW=4,Hm=92,Zb=44,tW=41,Jb=46,rW=8364,nW=40,iW=63,aW=59,Gm=95,zm=t=>t>=65&&t<=90||t>=97&&t<=122,qm=t=>t>=48&&t<=57,Ym=t=>[9,10,11,12,13,32,133,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288].indexOf(t)!==-1;let gc=".",bl="en-US";const Mf={BoolToken:{"en-US":["TRUE","FALSE"],"pt-BR":["VERDADEIRO","FALSO"]},RefErrorToken:{"en-US":"#REF!","pt-BR":"#REF!"},ErrorToken:{"en-US":["#NULL!","#DIV/0!","#VALUE!","#NAME?","#NUM!","#N/A","#GETTING_DATA","#SPILL!"],"pt-BR":["#NULO!","#DIV/0!","#VALOR!","#NOME?","#NÚM!","#N/D","#OBTENDO_DADOS","#DESPEJAR!"]}},sW=new Xh((t,e)=>{let{next:r}=t,n;if(!(!Ym(r)&&((n=t.peek(-1))!==tW||!qm(n)||!zm(n)||n!==Hm||n!==Gm||n!==Jb||n!==iW||n!==rW))){for(;r=t.advance(),!!Ym(r););if(r===nW||zm(r)||qm(r)||n===Hm||n===Gm)return t.acceptToken(X7)}},{contextual:!0}),oW=new Xh((t,e)=>{const{next:r}=t,n={".":Jb,",":Zb}[gc];if(r===n)return t.acceptToken(K7,1)}),lW=new Xh((t,e)=>{const{next:r}=t,n={".":Zb,",":aW}[gc];if(r===n)return t.acceptToken(Q7,1)}),Xm=(t,e)=>{const r={".":",",",":"\\"}[gc];return t===r?j7:-1},Qm=(t,e)=>Mf.BoolToken[bl].indexOf(t.toUpperCase())!==-1?eW:-1,Km=(t,e)=>Mf.RefErrorToken[bl].indexOf(t.toUpperCase())!==-1?Z7:Mf.ErrorToken[bl].indexOf(t.toUpperCase())!==-1?J7:-1,eE=t=>bl=t,tE=t=>gc=t,cW=yl.deserialize({version:14,states:",lO!aQ[OOOOQR'#Cc'#CcO!kQZO'#CcO$[QZO'#D[OOQR'#Ch'#ChO%iQ[O'#D[O&wQZO'#D]OOQO'#D`'#D`O'XQ`O'#D`OOQR'#Cb'#CbO'aQWO'#CbOOQU'#DO'#DOO'rQ^O'#CsO)VQWO'#CsOOQQ'#Cr'#CrO*VQWO'#DYO*^Q^O'#CuO%lQ[O'#CuOOQQ'#Cu'#CuO+YQ[O'#CyOOQQ'#D['#D[OOQO'#DY'#DYQOQWOOO%lQ[O'#DYO+aQWO,59TO+aQWO,59SO,OQZO,59wO,YQWO,59SO,_QWO,59vO*kQ[O'#CyOOQQ,59v,59vOOQR,59S,59SOOQO,59z,59zOOQR,58|,58|OOQU-E6|-E6|O,fQYO,59_OOQQ,59_,59_O%lQ[O,5:QO%lQ[O,5:QO%lQ[O,5:QO%lQ[O,5:QO%lQ[O,5:QOOQQ,59a,59aO-vQYO'#CxO.QQYO'#CwO.YQWO,59aO._QYO,59aOOQS'#Dq'#DqOOQO'#C|'#C|O.oQ[O'#C|O.wQWO'#C{O/SQWO'#CzO/[QWO,59eO%lQ[O,5:`O/aQWO,59tOOQR1G.o1G.oO+aQWO'#ChO/hQZO1G.nO+aQWO'#C}O0xQYO,59VOOQR1G/c1G/cOOQR1G.n1G.nOOQQ1G/b1G/bO1QQYO1G.yO3fQYO1G/lO3mQYO1G/lO4uQYO1G/lO5PQYO1G/lO5rQYO1G/lO*^Q^O'#DPO6fQYO,59cOOQQ1G.{1G.{OOQO,59h,59hO*kQ[O'#DQO6nQWO,59gO6yQWO,59fO*kQ[O'#DROOQQ1G/P1G/PO7RQWO1G/zO7YQXO'#CiO7bQZO,59iOOQQ-E6{-E6{OOQQ,59k,59kOOQQ-E6}-E6}OOQO,59l,59lOOQO-E7O-E7OOOQO-E7P-E7POOQO,59m,59mOOQO7+%f7+%f",stateData:"8W~O{OS~OQQOR^OS^OWPOXPOYPOZPO^TOaVObWOdVOh^Oj`Ox]O!TZO!UaO!VaO!WaO~O}gO!dcO~PVOQ!SXW!SXX!SXY!SXZ!SXvVXwVX}VX!QVX!RVX!UVX!VVX!XVX!ZVX![VX!]VX!^VX!_VX!`VX!aVX!bVX!cVXPVX`VX!gVX~OwiO!QhOv!OX}!OX!U!OX!V!OX!X!OX!Z!OX![!OX!]!OX!^!OX!_!OX!`!OX!a!OX!b!OX!c!OX`!OXP!OX!g!OX~O`nO!dmO~PVO!RoOw!PX}!PX!Q!PX!U!PX!V!PX!X!PX!Z!PX![!PX!]!PX!^!PX!_!PX!`!PX!a!PX!b!PX!c!PX~Ov!PXP!PX`!PX!g!PX~P%sOcpOepO~OQPOWPOXPOYPOZPO~OxsO!TZOvgX}gX!UgX!VgX!XgX!ZgX![gX!]gX!^gX!_gX!`gX!agX!bgX!cgX`gXPgXygX!fgX!ggX~O!TtO~O}yO!UwO!VwO!XzO!ZuO![vO!]vO!^xO!_yO!`yO!ayO!byO!cyO~Ov|X~P)[O!dmOPlP`lP~PVOQ!QOR^OS^Oh^Ox]O!TZO!U!PO!V!PO!W!PO~O}!VO~P*kOQQOWPOXPOYPOZPO^!YOaVObWOdVO~OP![O`!^O~P%sO`!_O~O`!`O~P)[O!TZOvga}ga!Uga!Vga!Xga!Zga![ga!]ga!^ga!_ga!`ga!aga!bga!cga`gaPgayga!fga!gga~OPlX`lX~P)[OP!gO`kX~O`!iO~Ovia`iaPia!gia~P)[Ox]O!TZO~Oy!kO!foX!goX~O!f!nO!gnX~O!g!oO~Ov|a~P)[O!QhOv[iw[i}[i!R[i!U[i!V[i!X[i!Z[i![[i!][i!^[i!_[i!`[i!a[i!b[i!c[iP[i`[i!g[i~OP![O`_a~O!TZOvgi}gi!Ugi!Vgi!Xgi!Zgi![gi!]gi!^gi!_gi!`gi!agi!bgi!cgi`giPgiygi!fgi!ggi~O!XzOv!Yi}!Yi!U!Yi!V!Yi![!Yi!]!Yi!^!Yi!_!Yi!`!Yi!a!Yi!b!Yi!c!Yi`!YiP!Yi!g!Yi~O!Z!Yi~P2bO!ZuO~P2bO!XzO!ZuO![vO!]vOv!Yi}!Yi!^!Yi!_!Yi!`!Yi!a!Yi!b!Yi!c!Yi`!YiP!Yi!g!Yi~O!U!Yi!V!Yi~P3tO!UwO!VwO~P3tO!UwO!VwO!XzO!ZuO![vO!]vO!^xO~Ov!Yi}!Yi!_!Yi!`!Yi!a!Yi!b!Yi!c!Yi`!YiP!Yi!g!Yi~P5ZOP!gO`ka~Oy!kO!foa!goa~O!f!nO!gna~O!g!zO~P)[OwiO!QhO~O!RoOPqa`qaw!PX!Q!PX~OZecdha!TjYW!iX!j!R!W!U{Y~",goto:")f!iPPPPPP!j#QPPPP#g#yP$]PPPPPP$a$uP%[P%j%m%[%s%w&O&W&^&x'O'UPPPPPP'[P'_(RPP(kPPPPP(}PPPPPPPPPP)]PP)cjUO`aghiuvwxy!V!gSjT!YR!r![pXOT`aghiuvwxy!V!Y![!gRqYqXOT`aghiuvwxy!V!Y![!gqSOT`aghiuvwxy!V!Y![!gTkT!YhdOT`aguvwxy!V!gX!Qcm!k!np^OT`acgmuvwxy!V!g!k!nR!j!RidOT`aguvwxy!V!gR}`Q|`R!t!gT!UcmS!TcmR!y!nU!Scm!nR!v!kQ!]jR!s!]r[OT`acgmuvwxy!R!V!g!k!nSr[!aR!asQ!h|R!u!hQ!l!SR!w!lQ!m!TR!x!mRfOQ_OQlTS{`!gQ!OaQ!WgQ!buQ!cvQ!dwQ!exQ!fyR!p!VhROT`aguvwxy!V!gQ!XhQ!ZiT!q!Y![qYOT`aghiuvwxy!V!Y![!gibOT`aguvwxy!V!gX!Rcm!k!nReO",nodeNames:"⚠ Separator RefErrorToken ErrorToken BoolToken Program Reference ReferenceItem CellToken NameToken VerticalRangeToken HorizontalRangeToken ReferenceFunctionCall RangeToken OpenParen Union CloseParen SheetToken QuoteS SheetQuotedToken MultipleSheetsToken MultipleSheetsQuotedToken Constant Number TextToken FunctionCall Function Arguments Argument ConstantArray ArrayColumns ArrayRows ArrayConstant",maxTerm:72,nodeProps:[["closedBy",-2,14,26,"CloseParen"],["openedBy",16,"OpenParen | Function"]],skippedNodes:[0],repeatNodeCount:5,tokenData:"#*i~RyOX#rXY/XYZ/XZ]#r]^/X^p#rpq1Xqr#rrs2fstHetuK_uv!6[vw!7Swx!7zxy!8Syz!8zz{!9r{|!9w|}!;h}!O!<`!O!P#r!P!Q!=W!Q![!=]![!]!>|!]!^!?R!^!_!?y!_!`!Bg!`!a!C_!b!c!ET!c!}!Ft#O#P#'b#Q#R#(R#R#S!Iu#S#T#r#T#o!Ft#o#p#(y#p#q#r#q#r#)q#r;'S#r;'S;=`/R<%lO#r~#uhOp#rpq%aqr(krs#rst%atu#ruw%awx&Vxz%a{|#r|!O%a!O!P#r!Q![#r![!]*[!]!a%a!b!}#r#Q#R%a#R#o#r#o#p%a#p#q#r#q#r%a#r;'S#r;'S;=`/R<%lO#rQ%dZOw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%aQ&YQqr&`wx%aQ&eOcQQ&hYOw'Wwx(_xz'W{!P'W!Q!['W!]!a'W!b!}'W#Q;'S'W;'S;=`(X<%lO'WQ'ZYOw'Wwx'yxz'W{!P'W!Q!['W!]!a'W!b!}'W#Q;'S'W;'S;=`(X<%lO'WQ'|Qqr(Swx'WQ(XOeQQ([P;=`<%l'WQ(bPwx'WQ(hP;=`<%l%a~(pha~Op#rpq%aqr(krs#rst%atu#ruw%awx&Vxz%a{|#r|!O%a!O!P#r!Q![#r![!]*[!]!a%a!b!}#r#Q#R%a#R#o#r#o#p%a#p#q#r#q#r%a#r;'S#r;'S;=`/R<%lO#r~*_fOp+spq'Wqs+sst'Wtu+suw'Wwx(_xz'W{|+s|!O'W!O!P+s!Q![+s!]!a'W!b!}+s#Q#R'W#R#o+s#o#p'W#p#q+s#q#r'W#r;'S+s;'S;=`.{<%lO+s~+vgOp+spq'Wqr-_rs+sst'Wtu+suw'Wwx'yxz'W{|+s|!O'W!O!P+s!Q![+s!]!a'W!b!}+s#Q#R'W#R#o+s#o#p'W#p#q+s#q#r'W#r;'S+s;'S;=`.{<%lO+s~-dgd~Op+spq'Wqr-_rs+sst'Wtu+suw'Wwx'yxz'W{|+s|!O'W!O!P+s!Q![+s!]!a'W!b!}+s#Q#R'W#R#o+s#o#p'W#p#q+s#q#r'W#r;'S+s;'S;=`.{<%lO+s~/OP;=`<%l+s~/UP;=`<%l#r~/^m{~OX#rXY/XYZ/XZ]#r]^/X^p#rpq1Xqr(krs#rst%atu#ruw%awx&Vxz%a{|#r|!O%a!O!P#r!Q![#r![!]*[!]!a%a!b!}#r#Q#R%a#R#o#r#o#p%a#p#q#r#q#r%a#r;'S#r;'S;=`/R<%lO#r~1^b{~OX%aXY1XYZ1XZ]%a]^1X^p%apq1Xqw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%a~2ilOp2fpq4aqr=[rs?Xst4atu2fuw4awx6gxz4az{7S{|2f|!O4a!O!P2f!P!Q7S!Q![2f![!]@x!]!a4a!a!b7S!b!}2f!}#Q7S#Q#R4a#R#o2f#o#p4a#p#q2f#q#r4a#r;'S2f;'S;=`H_<%lO2f~4daOr4ars5isw4awx6gxz4az{7S{!P4a!P!Q7S!Q![4a![!]8Y!]!a4a!a!b7S!b!}4a!}#Q7S#Q;'S4a;'S;=`=U<%lO4a~5n]h~Or%ars4asw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%a~6jWOq7Sqr7trs7fsw7Swx4ax;'S7S;'S;=`7n<%lO7S~7VTOr7Srs7fs;'S7S;'S;=`7n<%lO7S~7kPh~rs7S~7qP;=`<%l7S~7yTcQOr7Srs7fs;'S7S;'S;=`7n<%lO7S~8]aOr9brs:jsw9bwx<lxz9bz{7S{!P9b!P!Q7S!Q![9b![!]7S!]!a9b!a!b7S!b!}9b!}#Q7S#Q;'S9b;'S;=`<f<%lO9b~9eaOr9brs:jsw9bwx;exz9bz{7S{!P9b!P!Q7S!Q![9b![!]7S!]!a9b!a!b7S!b!}9b!}#Q7S#Q;'S9b;'S;=`<f<%lO9b~:o[h~Or'Wrs9bsw'Wwx'yxz'W{!P'W!Q!['W!]!a'W!b!}'W#Q;'S'W;'S;=`(X<%lO'W~;hWOq7Sqr<Qrs7fsw7Swx9bx;'S7S;'S;=`7n<%lO7S~<VTeQOr7Srs7fs;'S7S;'S;=`7n<%lO7S~<iP;=`<%l9b~<oVOr7Srs7fsw7Swx9bx;'S7S;'S;=`7n<%lO7S~=XP;=`<%l4a~=ala~Op2fpq4aqr=[rs?Xst4atu2fuw4awx6gxz4az{7S{|2f|!O4a!O!P2f!P!Q7S!Q![2f![!]@x!]!a4a!a!b7S!b!}2f!}#Q7S#Q#R4a#R#o2f#o#p4a#p#q2f#q#r4a#r;'S2f;'S;=`H_<%lO2f~?^hh~Op#rpq%aqr(krs2fst%atu#ruw%awx&Vxz%a{|#r|!O%a!O!P#r!Q![#r![!]*[!]!a%a!b!}#r#Q#R%a#R#o#r#o#p%a#p#q#r#q#r%a#r;'S#r;'S;=`/R<%lO#r~@{lOpBspq9bqrBsrsFkst9btuBsuw9bwx<lxz9bz{7S{|Bs|!O9b!O!PBs!P!Q7S!Q![Bs![!]7S!]!a9b!a!b7S!b!}Bs!}#Q7S#Q#R9b#R#oBs#o#p9b#p#qBs#q#r9b#r;'SBs;'S;=`HX<%lOBs~BvlOpBspq9bqrDnrsFkst9btuBsuw9bwx;exz9bz{7S{|Bs|!O9b!O!PBs!P!Q7S!Q![Bs![!]7S!]!a9b!a!b7S!b!}Bs!}#Q7S#Q#R9b#R#oBs#o#p9b#p#qBs#q#r9b#r;'SBs;'S;=`HX<%lOBs~Dsld~OpBspq9bqrDnrsFkst9btuBsuw9bwx;exz9bz{7S{|Bs|!O9b!O!PBs!P!Q7S!Q![Bs![!]7S!]!a9b!a!b7S!b!}Bs!}#Q7S#Q#R9b#R#oBs#o#p9b#p#qBs#q#r9b#r;'SBs;'S;=`HX<%lOBs~Fpgh~Op+spq'Wqr-_rsBsst'Wtu+suw'Wwx'yxz'W{|+s|!O'W!O!P+s!Q![+s!]!a'W!b!}+s#Q#R'W#R#o+s#o#p'W#p#q+s#q#r'W#r;'S+s;'S;=`.{<%lO+s~H[P;=`<%lBs~HbP;=`<%l2f~Hj[!R~Ow%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!c%a!c!}I`#Q;'S%a;'S;=`(e<%lO%a~Ied!j~Oq%aqrI`rw%awx&Vxz%a{!P%a!P!QJs!Q![I`![!]&e!]!a%a!a!bJs!b!c%a!c!}I`#Q#R%a#R#SI`#S%r%a%r%sI`%s;'S%a;'S;=`(e<%lO%a~JxV!j~qrJs!P!QJs!Q![Js!a!bJs!c!}Js#R#SJs%r%sJs~KbjOp#rpq%aqr(krs#rst%atu#ruw%awx&Vxz%a{|#r|!O%a!O!P#r!Q![MS![!]*[!]!a%a!b!c#r!c!}!%b#Q#R%a#R#T#r#T#o!%b#o#p%a#p#q#r#q#r%a#r;'S#r;'S;=`/R<%lO#r~MVhOp#rpq%aqr(krs#rst%atu#ruw%awx&Vxz%a{|#r|!O%a!O!P#r!Q![MS![!]Nq!]!a%a!b!}#r#Q#R%a#R#o#r#o#p%a#p#q#r#q#r%a#r;'S#r;'S;=`/R<%lO#r~NtfOp+spq'Wqs+sst'Wtu!!Yuw'Wwx(_xz'W{|+s|!O'W!O!P+s!Q![!#t!]!a'W!b!}+s#Q#R'W#R#o+s#o#p'W#p#q+s#q#r'W#r;'S+s;'S;=`.{<%lO+s~!!]gOp+spq'Wqr-_rs+sst'Wtu+suw'Wwx'yxz'W{|+s|!O'W!O!P+s!Q![!#t!]!a'W!b!}+s#Q#R'W#R#o+s#o#p'W#p#q+s#q#r'W#r;'S+s;'S;=`.{<%lO+s~!#ygZ~Op+spq'Wqr-_rs+sst'Wtu+suw'Wwx'yxz'W{|+s|!O'W!O!P+s!Q![!#t!]!a'W!b!}+s#Q#R'W#R#o+s#o#p'W#p#q+s#q#r'W#r;'S+s;'S;=`.{<%lO+s~!%ejOp#rpq%aqr(krs#rst%atu!'Vuw%awx&Vxz%a{|#r|!O%a!O!P#r!Q![!(t![!]!*e!]!a%a!b!c#r!c!}!2x#Q#R%a#R#T#r#T#o!2x#o#p%a#p#q#r#q#r%a#r;'S#r;'S;=`/R<%lO#r~!'YhOp#rpq%aqr(krs#rst%atu#ruw%awx&Vxz%a{|#r|!O%a!O!P#r!Q![!(t![!]*[!]!a%a!b!}#r#Q#R%a#R#o#r#o#p%a#p#q#r#q#r%a#r;'S#r;'S;=`/R<%lO#r~!(yhW~Op#rpq%aqr(krs#rst%atu#ruw%awx&Vxz%a{|#r|!O%a!O!P#r!Q![!(t![!]*[!]!a%a!b!}#r#Q#R%a#R#o#r#o#p%a#p#q#r#q#r%a#r;'S#r;'S;=`/R<%lO#r~!*hhOp+spq'Wqs+sst'Wtu!,Suw'Wwx(_xz'W{|+s|!O'W!O!P+s!Q![+s!]!a'W!b!c+s!c!}!-t#Q#R'W#R#T+s#T#o!-t#o#p'W#p#q+s#q#r'W#r;'S+s;'S;=`.{<%lO+s~!,ViOp+spq'Wqr-_rs+sst'Wtu+suw'Wwx'yxz'W{|+s|!O'W!O!P+s!Q![+s!]!a'W!b!c+s!c!}!-t#Q#R'W#R#T+s#T#o!-t#o#p'W#p#q+s#q#r'W#r;'S+s;'S;=`.{<%lO+s~!-yiY~Op+spq'Wqr-_rs+sst'Wtu+suw'Wwx'yxz'W{|+s|!O'W!O!P+s!Q![+s!]!a'W!b!c+s!c!}!/h#Q#R'W#R#T+s#T#o!/h#o#p'W#p#q+s#q#r'W#r;'S+s;'S;=`.{<%lO+s~!/miY~Op+spq'Wqr-_rs+sst'Wtu+suw'Wwx'yxz'W{|+s|!O'W!O!P+s!Q![+s!]!a'W!b!c+s!c!}!1[#Q#R'W#R#T+s#T#o!1[#o#p'W#p#q+s#q#r'W#r;'S+s;'S;=`.{<%lO+s~!1agY~Op+spq'Wqr-_rs+sst'Wtu+suw'Wwx'yxz'W{|+s|!O'W!O!P+s!Q![+s!]!a'W!b!}+s#Q#R'W#R#o+s#o#p'W#p#q+s#q#r'W#r;'S+s;'S;=`.{<%lO+s~!2{jOp#rpq%aqr(krs#rst%atu!'Vuw%awx&Vxz%a{|#r|!O%a!O!P#r!Q![!(t![!]!*e!]!a%a!b!c#r!c!}!4m#Q#R%a#R#T#r#T#o!4m#o#p%a#p#q#r#q#r%a#r;'S#r;'S;=`/R<%lO#r~!4phOp#rpq%aqr(krs#rst%atu!'Vuw%awx&Vxz%a{|#r|!O%a!O!P#r!Q![!(t![!]!*e!]!a%a!b!}#r#Q#R%a#R#o#r#o#p%a#p#q#r#q#r%a#r;'S#r;'S;=`/R<%lO#rR!6aZ!XPOw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%aR!7XZ!^POw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%aR!8PPbPwx%aR!8XZ^POw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%aR!9PZ`POw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%a~!9wO![~~!9|h!U~Op#rpq%aqr(krs#rst%atu#ruw%awx&Vxz%a{|#r|!O%a!O!P#r!Q![#r![!]*[!]!a%a!b!}#r#Q#R%a#R#o#r#o#p%a#p#q#r#q#r%a#r;'S#r;'S;=`/R<%lO#r~!;mZ!i~Ow%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%aR!<eZ!VPOw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%a~!=]O!]~~!=bh!T~Op#rpq%aqr(krs#rst%atu#ruw%awx&Vxz%a{|#r|!O%a!O!P#r!Q![!=]![!]Nq!]!a%a!b!}#r#Q#R%a#R#o#r#o#p%a#p#q#r#q#r%a#r;'S#r;'S;=`/R<%lO#r~!?RO!Q~R!?WZ!fPOw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%aR!@O]!`POw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!_%a!_!`!@w!`!a!Ao!b!}%a#Q;'S%a;'S;=`(e<%lO%aR!@|Z!cPOw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%aR!AtZ!aPOw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%aR!BlZ}POw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%aR!Cd]!_POw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!_%a!_!`!D]!`!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%aR!DbZ!bPOw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%a~!EYh!W~Op#rpq%aqr(krs#rst%atu#ruw%awx&Vxz%a{|#r|!O%a!O!P#r!Q![#r![!]*[!]!a%a!b!}#r#Q#R%a#R#o#r#o#p%a#p#q#r#q#r%a#r;'S#r;'S;=`/R<%lO#r~!FypX~Op#rpq%aqr(krs#rst%atu!'Vuw%awx&Vxy!H}yz%a{|#r|!O%a!O!P!Iu!Q![!Ns![!]!*e!]!a%a!a!b!LO!b!c#r!c!}##O#O#P!LO#Q#R%a#R#S!Iu#S#T#r#T#o##O#o#p%a#p#q#r#q#r%a#r$Lv#r$Lv$Lw!Lm$Lw;'S#r;'S;=`/R<%lO#r~!ISZj~Ow%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%a~!IzpX~Op#rpq%aqr(krs#rst%atu#ruw%awx&Vxy!H}yz%a{|#r|!O%a!O!P!Iu!Q![!Iu![!]*[!]!a%a!a!b!LO!b!c#r!c!}!Iu#O#P!LO#Q#R%a#R#S!Iu#S#T#r#T#o!Iu#o#p%a#p#q#r#q#r%a#r$Lv#r$Lv$Lw!Lm$Lw;'S#r;'S;=`/R<%lO#r~!LTWX~!O!P!LO!Q![!LO!a!b!LO!c!}!LO#O#P!LO#R#S!LO#T#o!LO$Lv$Lw!LO~!LroX~Op#rpq%aqr(krs#rst%atu#ruw%awx&Vxz%a{|#r|!O%a!O!P!Lm!Q![!Lm![!]*[!]!a%a!a!b!LO!b!c#r!c!}!Lm#O#P!LO#Q#R%a#R#S!Lm#S#T#r#T#o!Lm#o#p%a#p#q#r#q#r%a#r$Lv#r$Lv$Lw!Lm$Lw;'S#r;'S;=`/R<%lO#r~!NzpW~X~Op#rpq%aqr(krs#rst%atu#ruw%awx&Vxy!H}yz%a{|#r|!O%a!O!P!Iu!Q![!Ns![!]*[!]!a%a!a!b!LO!b!c#r!c!}!Iu#O#P!LO#Q#R%a#R#S!Iu#S#T#r#T#o!Iu#o#p%a#p#q#r#q#r%a#r$Lv#r$Lv$Lw!Lm$Lw;'S#r;'S;=`/R<%lO#r~##TpX~Op#rpq%aqr(krs#rst%atu!'Vuw%awx&Vxy!H}yz%a{|#r|!O%a!O!P!Iu!Q![!Ns![!]!*e!]!a%a!a!b!LO!b!c#r!c!}#%X#O#P!LO#Q#R%a#R#S!Iu#S#T#r#T#o#%X#o#p%a#p#q#r#q#r%a#r$Lv#r$Lv$Lw!Lm$Lw;'S#r;'S;=`/R<%lO#r~#%^pX~Op#rpq%aqr(krs#rst%atu!'Vuw%awx&Vxy!H}yz%a{|#r|!O%a!O!P!Iu!Q![!Ns![!]!*e!]!a%a!a!b!LO!b!c#r!c!}!Iu#O#P!LO#Q#R%a#R#S!Iu#S#T#r#T#o!Iu#o#p%a#p#q#r#q#r%a#r$Lv#r$Lv$Lw!Lm$Lw;'S#r;'S;=`/R<%lO#r~#'iW!i~X~!O!P!LO!Q![!LO!a!b!LO!c!}!LO#O#P!LO#R#S!LO#T#o!LO$Lv$Lw!LOR#(WZ!ZPOw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%aR#)OZ!dPOw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%aR#)vZ!gPOw%awx&Vxz%a{!P%a!Q![%a![!]&e!]!a%a!b!}%a#Q;'S%a;'S;=`(e<%lO%a",tokenizers:[sW,lW,oW,0,1],topRules:{Program:[0,5]},specialized:[{term:71,get:(t,e)=>Xm(t)<<1,external:Xm},{term:72,get:(t,e)=>Km(t)<<1,external:Km},{term:9,get:(t,e)=>Qm(t)<<1,external:Qm}],tokenPrec:1047}),uW=tl.define({parser:cW.configure({props:[Ty.add({Application:x9({closing:")",align:!1})}),xy.add({Application:P9}),Ay({"Reference/...":Se.color,"RangeToken!":Se.tagName,CellToken:Se.tagName,VerticalRangeToken:Se.tagName,HorizontalRangeToken:Se.tagName,RefErrorToken:Se.invalid,BoolToken:Se.bool,ErrorToken:Se.invalid,NumberToken:Se.number,TextToken:Se.string,Function:Se.function(Se.name),OpenParen:Se.name,CloseParen:Se.name,"[ ]":Se.squareBracket,"{ }":Se.brace})]})}),RW=eE,NW=tE;function fW({idiom:t="en-US",decimalSeparator:e="."}={}){return eE(t),tE(e),new O9(uW)}const hW=["ABS","ACCRINT","ACCRINTM","ACOS","ACOSH","ACOT","ACOTH","AGGREGATE","ADDRESS","AMORDEGRC","AMORLINC","AND","ARABIC","AREAS","ARRAYTOTEXT","ASC","ASIN","ASINH","ATAN","ATAN2","ATANH","AVEDEV","AVERAGE","AVERAGEA","AVERAGEIF","AVERAGEIFS","BAHTTEXT","BASE","BESSELI","BESSELJ","BESSELK","BESSELY","BETADIST","BETA.DIST","BETAINV","BETA.INV","BIN2DEC","BIN2HEX","BIN2OCT","BINOMDIST","BINOM.DIST","BINOM.DIST.RANGE","BINOM.INV","BITAND","BITLSHIFT","BITOR","BITRSHIFT","BITXOR","BYCOL","BYROW","CALL","CEILING","CEILING.MATH","CEILING.PRECISE","CELL","CHAR","CHIDIST","CHIINV","CHITEST","CHISQ.DIST","CHISQ.DIST.RT","CHISQ.INV","CHISQ.INV.RT","CHISQ.TEST","CHOOSE","CHOOSECOLS","CHOOSEROWS","CLEAN","CODE","COLUMN","COLUMNS","COMBIN","COMBINA","COMPLEX","CONCAT","CONCATENATE","CONFIDENCE","CONFIDENCE.NORM","CONFIDENCE.T","CONVERT","CORREL","COS","COSH","COT","COTH","COUNT","COUNTA","COUNTBLANK","COUNTIF","COUNTIFS","COUPDAYBS","COUPDAYS","COUPDAYSNC","COUPNCD","COUPNUM","COUPPCD","COVAR","COVARIANCE.P","COVARIANCE.S","CRITBINOM","CSC","CSCH","CUBEKPIMEMBER","CUBEMEMBER","CUBEMEMBERPROPERTY","CUBERANKEDMEMBER","CUBESET","CUBESETCOUNT","CUBEVALUE","CUMIPMT","CUMPRINC","DATE","DATEDIF","DATEVALUE","DAVERAGE","DAY","DAYS","DAYS360","DB","DBCS","DCOUNT","DCOUNTA","DDB","DEC2BIN","DEC2HEX","DEC2OCT","DECIMAL","DEGREES","DELTA","DEVSQ","DGET","DISC","DMAX","DMIN","DOLLAR","DOLLARDE","DOLLARFR","DPRODUCT","DROP","DSTDEV","DSTDEVP","DSUM","DURATION","DVAR","DVARP","EDATE","EFFECT","ENCODEURL","EOMONTH","ERF","ERF.PRECISE","ERFC","ERFC.PRECISE","ERROR.TYPE","EUROCONVERT","EVEN","EXACT","EXP","EXPAND","EXPON.DIST","EXPONDIST","FACT","FACTDOUBLE","FALSE","F.DIST","FDIST","F.DIST.RT","FILTER","FILTERXML","FIND","F.INV","F.INV.RT","FINV","FISHER","FISHERINV","FIXED","FLOOR","FLOOR.MATH","FLOOR.PRECISE","FORECAST","Forecastings","FORMULATEXT","FREQUENCY","F.TEST","FTEST","FV","FVSCHEDULE","GAMMA","GAMMA.DIST","GAMMADIST","GAMMA.INV","GAMMAINV","GAMMALN","GAMMALN.PRECISE","GAUSS","GCD","GEOMEAN","GESTEP","GETPIVOTDATA","GROWTH","HARMEAN","HEX2BIN","HEX2DEC","HEX2OCT","HLOOKUP","HOUR","HSTACK","HYPERLINK","HYPGEOM.DIST","HYPGEOMDIST","IF","IFERROR","IFNA","IFS","IMABS","IMAGINARY","IMARGUMENT","IMCONJUGATE","IMCOS","IMCOSH","IMCOT","IMCSC","IMCSCH","IMDIV","IMEXP","IMLN","IMLOG10","IMLOG2","IMPOWER","IMPRODUCT","IMREAL","IMSEC","IMSECH","IMSIN","IMSINH","IMSQRT","IMSUB","IMSUM","IMTAN","INDEX","INDIRECT","INFO","INT","INTERCEPT","INTRATE","IPMT","IRR","ISBLANK","ISERR","ISERROR","ISEVEN","ISFORMULA","ISLOGICAL","ISNA","ISNONTEXT","ISNUMBER","ISODD","ISOMITTED","ISREF","ISTEXT","ISO.CEILING","ISOWEEKNUM","ISPMT","JIS","KURT","LAMBDA","LARGE","LCM","LEFT","LEN","LET","LINEST","LN","LOG","LOG10","LOGEST","LOGINV","LOGNORM.DIST","LOGNORMDIST","LOGNORM.INV","LOOKUP","LOWER","MAKEARRAY","MAP","MATCH","MAX","MAXA","MAXIFS","MDETERM","MDURATION","MEDIAN","MID","MIN","MINIFS","MINA","MINUTE","MINVERSE","MIRR","MMULT","MOD","MODE","MODE.MULT","MODE.SNGL","MONTH","MROUND","MULTINOMIAL","MUNIT","N","NA","NEGBINOM.DIST","NEGBINOMDIST","NETWORKDAYS","NETWORKDAYS.INTL","NOMINAL","NORM.DIST","NORMDIST","NORMINV","NORM.INV","NORM.S.DIST","NORMSDIST","NORM.S.INV","NORMSINV","NOT","NOW","NPER","NPV","NUMBERVALUE","OCT2BIN","OCT2DEC","OCT2HEX","ODD","ODDFPRICE","ODDFYIELD","ODDLPRICE","ODDLYIELD","OFFSET","OR","PDURATION","PEARSON","PERCENTILE.EXC","PERCENTILE.INC","PERCENTILE","PERCENTRANK.EXC","PERCENTRANK.INC","PERCENTRANK","PERMUT","PERMUTATIONA","PHI","PHONETIC","PI","PMT","POISSON.DIST","POISSON","POWER","PPMT","PRICE","PRICEDISC","PRICEMAT","PROB","PRODUCT","PROPER","PV","QUARTILE","QUARTILE.EXC","QUARTILE.INC","QUOTIENT","RADIANS","RAND","RANDARRAY","RANDBETWEEN","RANK.AVG","RANK.EQ","RANK","RATE","RECEIVED","REDUCE","REGISTER.ID","REPLACE","REPT","RIGHT","ROMAN","ROUND","ROUNDDOWN","ROUNDUP","ROW","ROWS","RRI","RSQ","RTD","SCAN","SEARCH","SEC","SECH","SECOND","SEQUENCE","SERIESSUM","SHEET","SHEETS","SIGN","SIN","SINH","SKEW","SKEW.P","SLN","SLOPE","SMALL","SORT","SORTBY","SQRT","SQRTPI","STANDARDIZE","STOCKHISTORY","STDEV","STDEV.P","STDEV.S","STDEVA","STDEVP","STDEVPA","STEYX","SUBSTITUTE","SUBTOTAL","SUM","SUMIF","SUMIFS","SUMPRODUCT","SUMSQ","SUMX2MY2","SUMX2PY2","SUMXMY2","SWITCH","SYD","T","TAN","TANH","TAKE","TBILLEQ","TBILLPRICE","TBILLYIELD","T.DIST","T.DIST.2T","T.DIST.RT","TDIST","TEXT","TEXTAFTER","TEXTBEFORE","TEXTJOIN","TEXTSPLIT","TIME","TIMEVALUE","T.INV","T.INV.2T","TINV","TOCOL","TOROW","TODAY","TRANSPOSE","TREND","TRIM","TRIMMEAN","TRUE","TRUNC","T.TEST","TTEST","TYPE","UNICHAR","UNICODE","UNIQUE","UPPER","VALUE","VALUETOTEXT","VAR","VAR.P","VAR.S","VARA","VARP","VARPA","VDB","VLOOKUP","VSTACK","WEBSERVICE","WEEKDAY","WEEKNUM","WEIBULL","WEIBULL.DIST","WORKDAY","WORKDAY.INTL","WRAPCOLS","WRAPROWS","XIRR","XLOOKUP","XMATCH","XNPV","XOR","YEAR","YEARFRAC","YIELD","YIELDDISC","YIELDMAT","Z.TEST","ZTEST"];async function dW(t,e){const r=hW;function n(i){if(tr(i.state).resolveInner(i.pos,0).name==="TextToken")return null;const s=i.matchBefore(/\w*/);return s&&s.from==s.to&&!i.explicit?null:{from:s.from,options:r.map(l=>({label:l,type:"function",apply:`${l}(`}))}}t.dispatch({effects:e.reconfigure(Fb({override:[n]}))})}let rE=!1;function pW(t){return rE?Db(t):ol.run&&ol.run(t)}const gW={...ol,run:pW};function mW(){return[It.fromClass(class{constructor(t){this.view=t}update(t){rE=N6(t.state)!==null}})]}export{vi as A,Oi as C,LF as D,Be as E,a0 as F,Ls as H,NE as R,Xa as S,M as T,TW as V,tn as W,mW as a,Yb as b,dW as c,fW as d,yu as e,B as f,St as g,DF as h,gW as i,KF as j,Ps as k,Pu as l,NW as m,RW as n,gE as o,mE as p,vE as q,uW as r,By as s,Se as t,JF as u,ZF as v};
